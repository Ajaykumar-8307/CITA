(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6686],{79534:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function Events(){}function EE(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function addListener(e,t,r,i,o){if("function"!=typeof r)throw TypeError("The listener must be a function");var a=new EE(r,i||e,o),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function clearEvent(e,t){0==--e._eventsCount?e._events=new Events:delete e._events[t]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),new Events().__proto__||(n=!1)),EventEmitter.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},EventEmitter.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=Array(o);i<o;i++)a[i]=r[i].fn;return a},EventEmitter.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},EventEmitter.prototype.emit=function(e,t,r,i,o,a){var l=n?n+e:e;if(!this._events[l])return!1;var d,c,u=this._events[l],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,o),!0;case 6:return u.fn.call(u.context,t,r,i,o,a),!0}for(c=1,d=Array(h-1);c<h;c++)d[c-1]=arguments[c];u.fn.apply(u.context,d)}else{var p,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!d)for(p=1,d=Array(h-1);p<h;p++)d[p-1]=arguments[p];u[c].fn.apply(u[c].context,d)}}return!0},EventEmitter.prototype.on=function(e,t,n){return addListener(this,e,t,n,!1)},EventEmitter.prototype.once=function(e,t,n){return addListener(this,e,t,n,!0)},EventEmitter.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return clearEvent(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||clearEvent(this,o);else{for(var l=0,d=[],c=a.length;l<c;l++)(a[l].fn!==t||i&&!a[l].once||r&&a[l].context!==r)&&d.push(a[l]);d.length?this._events[o]=1===d.length?d[0]:d:clearEvent(this,o)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&clearEvent(this,t)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=n,EventEmitter.EventEmitter=EventEmitter,e.exports=EventEmitter},62729:function(){},99780:function(e,t,n){e=n.nmd(e);var r,i,o,a="__lodash_hash_undefined__",l="[object Arguments]",d="[object Array]",c="[object Boolean]",u="[object Date]",h="[object Error]",p="[object Function]",f="[object Map]",g="[object Number]",m="[object Object]",y="[object Promise]",b="[object RegExp]",S="[object Set]",v="[object String]",k="[object WeakMap]",_="[object ArrayBuffer]",C="[object DataView]",E=/^\[object .+?Constructor\]$/,M=/^(?:0|[1-9]\d*)$/,P={};P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P[l]=P[d]=P[_]=P[c]=P[C]=P[u]=P[h]=P[p]=P[f]=P[g]=P[m]=P[b]=P[S]=P[v]=P[k]=!1;var A="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,j="object"==typeof self&&self&&self.Object===Object&&self,D=A||j||Function("return this")(),B=t&&!t.nodeType&&t,F=B&&e&&!e.nodeType&&e,O=F&&F.exports===B,R=O&&A.process,L=function(){try{return R&&R.binding&&R.binding("util")}catch(e){}}(),N=L&&L.isTypedArray;function mapToArray(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function setToArray(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var z=Array.prototype,$=Function.prototype,G=Object.prototype,W=D["__core-js_shared__"],Z=$.toString,q=G.hasOwnProperty,Y=(r=/[^.]+$/.exec(W&&W.keys&&W.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",X=G.toString,Q=RegExp("^"+Z.call(q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ee=O?D.Buffer:void 0,et=D.Symbol,en=D.Uint8Array,er=G.propertyIsEnumerable,ei=z.splice,eo=et?et.toStringTag:void 0,ea=Object.getOwnPropertySymbols,es=ee?ee.isBuffer:void 0,el=(i=Object.keys,o=Object,function(e){return i(o(e))}),ed=getNative(D,"DataView"),ec=getNative(D,"Map"),eu=getNative(D,"Promise"),eh=getNative(D,"Set"),ep=getNative(D,"WeakMap"),ef=getNative(Object,"create"),eg=toSource(ed),em=toSource(ec),ey=toSource(eu),eb=toSource(eh),ex=toSource(ep),ew=et?et.prototype:void 0,eS=ew?ew.valueOf:void 0;function Hash(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ListCache(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function MapCache(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function SetCache(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new MapCache;++t<n;)this.add(e[t])}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}function assocIndexOf(e,t){for(var n=e.length;n--;)if(eq(e[n][0],t))return n;return -1}function baseGetTag(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":eo&&eo in Object(e)?function(e){var t=q.call(e,eo),n=e[eo];try{e[eo]=void 0;var r=!0}catch(e){}var i=X.call(e);return r&&(t?e[eo]=n:delete e[eo]),i}(e):X.call(e)}function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==l}function equalArrays(e,t,n,r,i,o){var a=1&n,l=e.length,d=t.length;if(l!=d&&!(a&&d>l))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var u=-1,h=!0,p=2&n?new SetCache:void 0;for(o.set(e,t),o.set(t,e);++u<l;){var f=e[u],g=t[u];if(r)var m=a?r(g,f,u,t,e,o):r(f,g,u,e,t,o);if(void 0!==m){if(m)continue;h=!1;break}if(p){if(!function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}(t,function(e,t){if(!p.has(t)&&(f===e||i(f,e,n,r,o)))return p.push(t)})){h=!1;break}}else if(!(f===g||i(f,g,n,r,o))){h=!1;break}}return o.delete(e),o.delete(t),h}function getAllKeys(e){var t;return t=function(e){return null!=e&&isLength(e.length)&&!isFunction(e)?function(e,t){var n,r=e_(e),i=!r&&ek(e),o=!r&&!i&&eC(e),a=!r&&!i&&!o&&eI(e),l=r||i||o||a,d=l?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=d.length;for(var u in e)q.call(e,u)&&!(l&&("length"==u||o&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||(n=null==(n=c)?9007199254740991:n)&&("number"==typeof u||M.test(u))&&u>-1&&u%1==0&&u<n))&&d.push(u);return d}(e):function(e){if(t=e&&e.constructor,e!==("function"==typeof t&&t.prototype||G))return el(e);var t,n=[];for(var r in Object(e))q.call(e,r)&&"constructor"!=r&&n.push(r);return n}(e)}(e),e_(e)?t:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(t,ev(e))}function getMapData(e,t){var n,r=e.__data__;return("string"==(n=typeof t)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function getNative(e,t){var n=null==e?void 0:e[t];return!(!isObject(n)||Y&&Y in n)&&(isFunction(n)?Q:E).test(toSource(n))?n:void 0}Hash.prototype.clear=function(){this.__data__=ef?ef(null):{},this.size=0},Hash.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Hash.prototype.get=function(e){var t=this.__data__;if(ef){var n=t[e];return n===a?void 0:n}return q.call(t,e)?t[e]:void 0},Hash.prototype.has=function(e){var t=this.__data__;return ef?void 0!==t[e]:q.call(t,e)},Hash.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ef&&void 0===t?a:t,this},ListCache.prototype.clear=function(){this.__data__=[],this.size=0},ListCache.prototype.delete=function(e){var t=this.__data__,n=assocIndexOf(t,e);return!(n<0)&&(n==t.length-1?t.pop():ei.call(t,n,1),--this.size,!0)},ListCache.prototype.get=function(e){var t=this.__data__,n=assocIndexOf(t,e);return n<0?void 0:t[n][1]},ListCache.prototype.has=function(e){return assocIndexOf(this.__data__,e)>-1},ListCache.prototype.set=function(e,t){var n=this.__data__,r=assocIndexOf(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},MapCache.prototype.clear=function(){this.size=0,this.__data__={hash:new Hash,map:new(ec||ListCache),string:new Hash}},MapCache.prototype.delete=function(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t},MapCache.prototype.get=function(e){return getMapData(this,e).get(e)},MapCache.prototype.has=function(e){return getMapData(this,e).has(e)},MapCache.prototype.set=function(e,t){var n=getMapData(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},SetCache.prototype.add=SetCache.prototype.push=function(e){return this.__data__.set(e,a),this},SetCache.prototype.has=function(e){return this.__data__.has(e)},Stack.prototype.clear=function(){this.__data__=new ListCache,this.size=0},Stack.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Stack.prototype.get=function(e){return this.__data__.get(e)},Stack.prototype.has=function(e){return this.__data__.has(e)},Stack.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ListCache){var r=n.__data__;if(!ec||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new MapCache(r)}return n.set(e,t),this.size=n.size,this};var ev=ea?function(e){return null==e?[]:function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}(ea(e=Object(e)),function(t){return er.call(e,t)})}:function(){return[]},eT=baseGetTag;function toSource(e){if(null!=e){try{return Z.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function eq(e,t){return e===t||e!=e&&t!=t}(ed&&eT(new ed(new ArrayBuffer(1)))!=C||ec&&eT(new ec)!=f||eu&&eT(eu.resolve())!=y||eh&&eT(new eh)!=S||ep&&eT(new ep)!=k)&&(eT=function(e){var t=baseGetTag(e),n=t==m?e.constructor:void 0,r=n?toSource(n):"";if(r)switch(r){case eg:return C;case em:return f;case ey:return y;case eb:return S;case ex:return k}return t});var ek=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&q.call(e,"callee")&&!er.call(e,"callee")},e_=Array.isArray,eC=es||function(){return!1};function isFunction(e){if(!isObject(e))return!1;var t=baseGetTag(e);return t==p||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function isObject(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function isObjectLike(e){return null!=e&&"object"==typeof e}var eI=N?function(e){return N(e)}:function(e){return isObjectLike(e)&&isLength(e.length)&&!!P[baseGetTag(e)]};e.exports=function(e,t){return function baseIsEqual(e,t,n,r,i){return e===t||(null!=e&&null!=t&&(isObjectLike(e)||isObjectLike(t))?function(e,t,n,r,i,o){var a=e_(e),p=e_(t),y=a?d:eT(e),k=p?d:eT(t);y=y==l?m:y,k=k==l?m:k;var E=y==m,M=k==m,P=y==k;if(P&&eC(e)){if(!eC(t))return!1;a=!0,E=!1}if(P&&!E)return o||(o=new Stack),a||eI(e)?equalArrays(e,t,n,r,i,o):function(e,t,n,r,i,o,a){switch(n){case C:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case _:if(e.byteLength!=t.byteLength||!o(new en(e),new en(t)))break;return!0;case c:case u:case g:return eq(+e,+t);case h:return e.name==t.name&&e.message==t.message;case b:case v:return e==t+"";case f:var l=mapToArray;case S:var d=1&r;if(l||(l=setToArray),e.size!=t.size&&!d)break;var p=a.get(e);if(p)return p==t;r|=2,a.set(e,t);var m=equalArrays(l(e),l(t),r,i,o,a);return a.delete(e),m;case"[object Symbol]":if(eS)return eS.call(e)==eS.call(t)}return!1}(e,t,y,n,r,i,o);if(!(1&n)){var A=E&&q.call(e,"__wrapped__"),j=M&&q.call(t,"__wrapped__");if(A||j){var D=A?e.value():e,B=j?t.value():t;return o||(o=new Stack),i(D,B,n,r,o)}}return!!P&&(o||(o=new Stack),function(e,t,n,r,i,o){var a=1&n,l=getAllKeys(e),d=l.length;if(d!=getAllKeys(t).length&&!a)return!1;for(var c=d;c--;){var u=l[c];if(!(a?u in t:q.call(t,u)))return!1}var h=o.get(e);if(h&&o.get(t))return h==t;var p=!0;o.set(e,t),o.set(t,e);for(var f=a;++c<d;){var g=e[u=l[c]],m=t[u];if(r)var y=a?r(m,g,u,t,e,o):r(g,m,u,e,t,o);if(!(void 0===y?g===m||i(g,m,n,r,o):y)){p=!1;break}f||(f="constructor"==u)}if(p&&!f){var b=e.constructor,S=t.constructor;b!=S&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof S&&S instanceof S)&&(p=!1)}return o.delete(e),o.delete(t),p}(e,t,n,r,i,o))}(e,t,n,r,baseIsEqual,i):e!=e&&t!=t)}(e,t)}},32818:function(e,t,n){e=n.nmd(e);var r,i,o,a="__lodash_hash_undefined__",l="[object Arguments]",d="[object Array]",c="[object Boolean]",u="[object Date]",h="[object Error]",p="[object Function]",f="[object Map]",g="[object Number]",m="[object Object]",y="[object Promise]",b="[object RegExp]",S="[object Set]",v="[object String]",k="[object WeakMap]",_="[object ArrayBuffer]",C="[object DataView]",E=/^\[object .+?Constructor\]$/,M=/^(?:0|[1-9]\d*)$/,P={};P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P[l]=P[d]=P[_]=P[c]=P[C]=P[u]=P[h]=P[p]=P[f]=P[g]=P[m]=P[b]=P[S]=P[v]=P[k]=!1;var A="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,j="object"==typeof self&&self&&self.Object===Object&&self,D=A||j||Function("return this")(),B=t&&!t.nodeType&&t,F=B&&e&&!e.nodeType&&e,O=F&&F.exports===B&&A.process,R=function(){try{return O&&O.binding("util")}catch(e){}}(),L=R&&R.isTypedArray;function isHostObject(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function mapToArray(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function setToArray(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var N=Array.prototype,z=Function.prototype,$=Object.prototype,G=D["__core-js_shared__"],W=(r=/[^.]+$/.exec(G&&G.keys&&G.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",Z=z.toString,q=$.hasOwnProperty,Y=$.toString,X=RegExp("^"+Z.call(q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Q=D.Symbol,ee=D.Uint8Array,et=$.propertyIsEnumerable,en=N.splice,er=(i=Object.keys,o=Object,function(e){return i(o(e))}),ei=getNative(D,"DataView"),eo=getNative(D,"Map"),ea=getNative(D,"Promise"),es=getNative(D,"Set"),el=getNative(D,"WeakMap"),ed=getNative(Object,"create"),ec=toSource(ei),eu=toSource(eo),eh=toSource(ea),ep=toSource(es),ef=toSource(el),eg=Q?Q.prototype:void 0,em=eg?eg.valueOf:void 0;function Hash(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ListCache(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function MapCache(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function SetCache(e){var t=-1,n=e?e.length:0;for(this.__data__=new MapCache;++t<n;)this.add(e[t])}function Stack(e){this.__data__=new ListCache(e)}function assocIndexOf(e,t){for(var n=e.length;n--;)if(eq(e[n][0],t))return n;return -1}function equalArrays(e,t,n,r,i,o){var a=2&i,l=e.length,d=t.length;if(l!=d&&!(a&&d>l))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var u=-1,h=!0,p=1&i?new SetCache:void 0;for(o.set(e,t),o.set(t,e);++u<l;){var f=e[u],g=t[u];if(r)var m=a?r(g,f,u,t,e,o):r(f,g,u,e,t,o);if(void 0!==m){if(m)continue;h=!1;break}if(p){if(!function(e,t){for(var n=-1,r=e?e.length:0;++n<r;)if(t(e[n],n,e))return!0;return!1}(t,function(e,t){if(!p.has(t)&&(f===e||n(f,e,r,i,o)))return p.add(t)})){h=!1;break}}else if(!(f===g||n(f,g,r,i,o))){h=!1;break}}return o.delete(e),o.delete(t),h}function getMapData(e,t){var n,r=e.__data__;return("string"==(n=typeof t)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function getNative(e,t){var n=null==e?void 0:e[t];return!(!isObject(n)||W&&W in n)&&(isFunction(n)||isHostObject(n)?X:E).test(toSource(n))?n:void 0}Hash.prototype.clear=function(){this.__data__=ed?ed(null):{}},Hash.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Hash.prototype.get=function(e){var t=this.__data__;if(ed){var n=t[e];return n===a?void 0:n}return q.call(t,e)?t[e]:void 0},Hash.prototype.has=function(e){var t=this.__data__;return ed?void 0!==t[e]:q.call(t,e)},Hash.prototype.set=function(e,t){return this.__data__[e]=ed&&void 0===t?a:t,this},ListCache.prototype.clear=function(){this.__data__=[]},ListCache.prototype.delete=function(e){var t=this.__data__,n=assocIndexOf(t,e);return!(n<0)&&(n==t.length-1?t.pop():en.call(t,n,1),!0)},ListCache.prototype.get=function(e){var t=this.__data__,n=assocIndexOf(t,e);return n<0?void 0:t[n][1]},ListCache.prototype.has=function(e){return assocIndexOf(this.__data__,e)>-1},ListCache.prototype.set=function(e,t){var n=this.__data__,r=assocIndexOf(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},MapCache.prototype.clear=function(){this.__data__={hash:new Hash,map:new(eo||ListCache),string:new Hash}},MapCache.prototype.delete=function(e){return getMapData(this,e).delete(e)},MapCache.prototype.get=function(e){return getMapData(this,e).get(e)},MapCache.prototype.has=function(e){return getMapData(this,e).has(e)},MapCache.prototype.set=function(e,t){return getMapData(this,e).set(e,t),this},SetCache.prototype.add=SetCache.prototype.push=function(e){return this.__data__.set(e,a),this},SetCache.prototype.has=function(e){return this.__data__.has(e)},Stack.prototype.clear=function(){this.__data__=new ListCache},Stack.prototype.delete=function(e){return this.__data__.delete(e)},Stack.prototype.get=function(e){return this.__data__.get(e)},Stack.prototype.has=function(e){return this.__data__.has(e)},Stack.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ListCache){var r=n.__data__;if(!eo||r.length<199)return r.push([e,t]),this;n=this.__data__=new MapCache(r)}return n.set(e,t),this};var getTag=function(e){return Y.call(e)};function toSource(e){if(null!=e){try{return Z.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function eq(e,t){return e===t||e!=e&&t!=t}(ei&&getTag(new ei(new ArrayBuffer(1)))!=C||eo&&getTag(new eo)!=f||ea&&getTag(ea.resolve())!=y||es&&getTag(new es)!=S||el&&getTag(new el)!=k)&&(getTag=function(e){var t=Y.call(e),n=t==m?e.constructor:void 0,r=n?toSource(n):void 0;if(r)switch(r){case ec:return C;case eu:return f;case eh:return y;case ep:return S;case ef:return k}return t});var ey=Array.isArray;function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}function isFunction(e){var t=isObject(e)?Y.call(e):"";return t==p||"[object GeneratorFunction]"==t}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==typeof e}var eb=L?function(e){return L(e)}:function(e){return isObjectLike(e)&&isLength(e.length)&&!!P[Y.call(e)]};function keys(e){return isArrayLike(e)?function(e,t){var n,r=ey(e)||isObjectLike(e)&&isArrayLike(e)&&q.call(e,"callee")&&(!et.call(e,"callee")||Y.call(e)==l)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],i=r.length,o=!!i;for(var a in e)q.call(e,a)&&!(o&&("length"==a||(n=null==(n=i)?9007199254740991:n)&&("number"==typeof a||M.test(a))&&a>-1&&a%1==0&&a<n))&&r.push(a);return r}(e):function(e){if(t=e&&e.constructor,e!==("function"==typeof t&&t.prototype||$))return er(e);var t,n=[];for(var r in Object(e))q.call(e,r)&&"constructor"!=r&&n.push(r);return n}(e)}e.exports=function(e,t,n){var r=(n="function"==typeof n?n:void 0)?n(e,t):void 0;return void 0===r?function baseIsEqual(e,t,n,r,i){return e===t||(null!=e&&null!=t&&(isObject(e)||isObjectLike(t))?function(e,t,n,r,i,o){var a=ey(e),p=ey(t),y=d,k=d;a||(y=(y=getTag(e))==l?m:y),p||(k=(k=getTag(t))==l?m:k);var E=y==m&&!isHostObject(e),M=k==m&&!isHostObject(t),P=y==k;if(P&&!E)return o||(o=new Stack),a||eb(e)?equalArrays(e,t,n,r,i,o):function(e,t,n,r,i,o,a){switch(n){case C:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case _:if(e.byteLength!=t.byteLength||!r(new ee(e),new ee(t)))break;return!0;case c:case u:case g:return eq(+e,+t);case h:return e.name==t.name&&e.message==t.message;case b:case v:return e==t+"";case f:var l=mapToArray;case S:var d=2&o;if(l||(l=setToArray),e.size!=t.size&&!d)break;var p=a.get(e);if(p)return p==t;o|=1,a.set(e,t);var m=equalArrays(l(e),l(t),r,i,o,a);return a.delete(e),m;case"[object Symbol]":if(em)return em.call(e)==em.call(t)}return!1}(e,t,y,n,r,i,o);if(!(2&i)){var A=E&&q.call(e,"__wrapped__"),j=M&&q.call(t,"__wrapped__");if(A||j){var D=A?e.value():e,B=j?t.value():t;return o||(o=new Stack),n(D,B,r,i,o)}}return!!P&&(o||(o=new Stack),function(e,t,n,r,i,o){var a=2&i,l=keys(e),d=l.length;if(d!=keys(t).length&&!a)return!1;for(var c=d;c--;){var u=l[c];if(!(a?u in t:q.call(t,u)))return!1}var h=o.get(e);if(h&&o.get(t))return h==t;var p=!0;o.set(e,t),o.set(t,e);for(var f=a;++c<d;){var g=e[u=l[c]],m=t[u];if(r)var y=a?r(m,g,u,t,e,o):r(g,m,u,e,t,o);if(!(void 0===y?g===m||n(g,m,r,i,o):y)){p=!1;break}f||(f="constructor"==u)}if(p&&!f){var b=e.constructor,S=t.constructor;b!=S&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof S&&S instanceof S)&&(p=!1)}return o.delete(e),o.delete(t),p}(e,t,n,r,i,o))}(e,t,baseIsEqual,n,r,i):e!=e&&t!=t)}(e,t,n):!!r}},26978:function(e,t,n){var r="Expected a function",i=0/0,o=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,d=/^0o[0-7]+$/i,c=parseInt,u="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,h="object"==typeof self&&self&&self.Object===Object&&self,p=u||h||Function("return this")(),f=Object.prototype.toString,g=Math.max,m=Math.min,now=function(){return p.Date.now()};function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function toNumber(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||t&&"object"==typeof t&&"[object Symbol]"==f.call(t))return i;if(isObject(e)){var t,n="function"==typeof e.valueOf?e.valueOf():e;e=isObject(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var r=l.test(e);return r||d.test(e)?c(e.slice(2),r?2:8):a.test(e)?i:+e}e.exports=function(e,t,n){var i=!0,o=!0;if("function"!=typeof e)throw TypeError(r);return isObject(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),function(e,t,n){var i,o,a,l,d,c,u=0,h=!1,p=!1,f=!0;if("function"!=typeof e)throw TypeError(r);function invokeFunc(t){var n=i,r=o;return i=o=void 0,u=t,l=e.apply(r,n)}function shouldInvoke(e){var n=e-c,r=e-u;return void 0===c||n>=t||n<0||p&&r>=a}function timerExpired(){var e,n,r,i=now();if(shouldInvoke(i))return trailingEdge(i);d=setTimeout(timerExpired,(e=i-c,n=i-u,r=t-e,p?m(r,a-n):r))}function trailingEdge(e){return(d=void 0,f&&i)?invokeFunc(e):(i=o=void 0,l)}function debounced(){var e,n=now(),r=shouldInvoke(n);if(i=arguments,o=this,c=n,r){if(void 0===d)return u=e=c,d=setTimeout(timerExpired,t),h?invokeFunc(e):l;if(p)return d=setTimeout(timerExpired,t),invokeFunc(c)}return void 0===d&&(d=setTimeout(timerExpired,t)),l}return t=toNumber(t)||0,isObject(n)&&(h=!!n.leading,a=(p="maxWait"in n)?g(toNumber(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f),debounced.cancel=function(){void 0!==d&&clearTimeout(d),u=0,i=c=o=d=void 0},debounced.flush=function(){return void 0===d?l:trailingEdge(now())},debounced}(e,t,{leading:i,maxWait:t,trailing:o})}},50528:function(e,t,n){var r,i="__lodash_hash_undefined__",o=/^\[object .+?Constructor\]$/,a="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,l="object"==typeof self&&self&&self.Object===Object&&self,d=a||l||Function("return this")();function arrayIncludes(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!=t)return function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return -1}(e,baseIsNaN,n);for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return -1}(e,t,0)>-1}function arrayIncludesWith(e,t,n){for(var r=-1,i=e?e.length:0;++r<i;)if(n(t,e[r]))return!0;return!1}function baseIsNaN(e){return e!=e}function cacheHas(e,t){return e.has(t)}function setToArray(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var c=Array.prototype,u=Function.prototype,h=Object.prototype,p=d["__core-js_shared__"],f=(r=/[^.]+$/.exec(p&&p.keys&&p.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",g=u.toString,m=h.hasOwnProperty,y=h.toString,b=RegExp("^"+g.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),S=c.splice,v=getNative(d,"Map"),k=getNative(d,"Set"),_=getNative(Object,"create");function Hash(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ListCache(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function MapCache(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function SetCache(e){var t=-1,n=e?e.length:0;for(this.__data__=new MapCache;++t<n;)this.add(e[t])}function assocIndexOf(e,t){for(var n,r=e.length;r--;)if((n=e[r][0])===t||n!=n&&t!=t)return r;return -1}Hash.prototype.clear=function(){this.__data__=_?_(null):{}},Hash.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Hash.prototype.get=function(e){var t=this.__data__;if(_){var n=t[e];return n===i?void 0:n}return m.call(t,e)?t[e]:void 0},Hash.prototype.has=function(e){var t=this.__data__;return _?void 0!==t[e]:m.call(t,e)},Hash.prototype.set=function(e,t){return this.__data__[e]=_&&void 0===t?i:t,this},ListCache.prototype.clear=function(){this.__data__=[]},ListCache.prototype.delete=function(e){var t=this.__data__,n=assocIndexOf(t,e);return!(n<0)&&(n==t.length-1?t.pop():S.call(t,n,1),!0)},ListCache.prototype.get=function(e){var t=this.__data__,n=assocIndexOf(t,e);return n<0?void 0:t[n][1]},ListCache.prototype.has=function(e){return assocIndexOf(this.__data__,e)>-1},ListCache.prototype.set=function(e,t){var n=this.__data__,r=assocIndexOf(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},MapCache.prototype.clear=function(){this.__data__={hash:new Hash,map:new(v||ListCache),string:new Hash}},MapCache.prototype.delete=function(e){return getMapData(this,e).delete(e)},MapCache.prototype.get=function(e){return getMapData(this,e).get(e)},MapCache.prototype.has=function(e){return getMapData(this,e).has(e)},MapCache.prototype.set=function(e,t){return getMapData(this,e).set(e,t),this},SetCache.prototype.add=SetCache.prototype.push=function(e){return this.__data__.set(e,i),this},SetCache.prototype.has=function(e){return this.__data__.has(e)};var C=k&&1/setToArray(new k([,-0]))[1]==1/0?function(e){return new k(e)}:function(){};function getMapData(e,t){var n,r=e.__data__;return("string"==(n=typeof t)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function getNative(e,t){var n,r=null==e?void 0:e[t];return!(!isObject(r)||f&&f in r)&&("[object Function]"==(n=isObject(r)?y.call(r):"")||"[object GeneratorFunction]"==n||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(r)?b:o).test(function(e){if(null!=e){try{return g.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(r))?r:void 0}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=function(e){return e&&e.length?function(e,t,n){var r=-1,i=arrayIncludes,o=e.length,a=!0,l=[],d=l;if(n)a=!1,i=arrayIncludesWith;else if(o>=200){var c=t?null:C(e);if(c)return setToArray(c);a=!1,i=cacheHas,d=new SetCache}else d=t?[]:l;e:for(;++r<o;){var u=e[r],h=t?t(u):u;if(u=n||0!==u?u:0,a&&h==h){for(var p=d.length;p--;)if(d[p]===h)continue e;t&&d.push(h),l.push(u)}else i(d,h,n)||(d!==l&&d.push(h),l.push(u))}return l}(e):[]}},11981:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(62898);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},72894:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(62898);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r.Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},74056:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(62898);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r.Z)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},80352:function(e,t,n){var r,i=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function getBaseValue(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var i={compressToBase64:function(e){if(null==e)return"";var n=i._compress(e,6,function(e){return t.charAt(e)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:i._decompress(e.length,32,function(n){return getBaseValue(t,e.charAt(n))})},compressToUTF16:function(t){return null==t?"":i._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:i._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=i.compress(e),n=new Uint8Array(2*t.length),r=0,o=t.length;r<o;r++){var a=t.charCodeAt(r);n[2*r]=a>>>8,n[2*r+1]=a%256}return n},decompressFromUint8Array:function(t){if(null==t)return i.decompress(t);for(var n=Array(t.length/2),r=0,o=n.length;r<o;r++)n[r]=256*t[2*r]+t[2*r+1];var a=[];return n.forEach(function(t){a.push(e(t))}),i.decompress(a.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,function(e){return n.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),i._decompress(e.length,32,function(t){return getBaseValue(n,e.charAt(t))}))},compress:function(t){return i._compress(t,16,function(t){return e(t)})},_compress:function(e,t,n){if(null==e)return"";var r,i,o,a={},l={},d="",c="",u="",h=2,p=3,f=2,g=[],m=0,y=0;for(o=0;o<e.length;o+=1)if(d=e.charAt(o),Object.prototype.hasOwnProperty.call(a,d)||(a[d]=p++,l[d]=!0),c=u+d,Object.prototype.hasOwnProperty.call(a,c))u=c;else{if(Object.prototype.hasOwnProperty.call(l,u)){if(256>u.charCodeAt(0)){for(r=0;r<f;r++)m<<=1,y==t-1?(y=0,g.push(n(m)),m=0):y++;for(r=0,i=u.charCodeAt(0);r<8;r++)m=m<<1|1&i,y==t-1?(y=0,g.push(n(m)),m=0):y++,i>>=1}else{for(r=0,i=1;r<f;r++)m=m<<1|i,y==t-1?(y=0,g.push(n(m)),m=0):y++,i=0;for(r=0,i=u.charCodeAt(0);r<16;r++)m=m<<1|1&i,y==t-1?(y=0,g.push(n(m)),m=0):y++,i>>=1}0==--h&&(h=Math.pow(2,f),f++),delete l[u]}else for(r=0,i=a[u];r<f;r++)m=m<<1|1&i,y==t-1?(y=0,g.push(n(m)),m=0):y++,i>>=1;0==--h&&(h=Math.pow(2,f),f++),a[c]=p++,u=String(d)}if(""!==u){if(Object.prototype.hasOwnProperty.call(l,u)){if(256>u.charCodeAt(0)){for(r=0;r<f;r++)m<<=1,y==t-1?(y=0,g.push(n(m)),m=0):y++;for(r=0,i=u.charCodeAt(0);r<8;r++)m=m<<1|1&i,y==t-1?(y=0,g.push(n(m)),m=0):y++,i>>=1}else{for(r=0,i=1;r<f;r++)m=m<<1|i,y==t-1?(y=0,g.push(n(m)),m=0):y++,i=0;for(r=0,i=u.charCodeAt(0);r<16;r++)m=m<<1|1&i,y==t-1?(y=0,g.push(n(m)),m=0):y++,i>>=1}0==--h&&(h=Math.pow(2,f),f++),delete l[u]}else for(r=0,i=a[u];r<f;r++)m=m<<1|1&i,y==t-1?(y=0,g.push(n(m)),m=0):y++,i>>=1;0==--h&&(h=Math.pow(2,f),f++)}for(r=0,i=2;r<f;r++)m=m<<1|1&i,y==t-1?(y=0,g.push(n(m)),m=0):y++,i>>=1;for(;;){if(m<<=1,y==t-1){g.push(n(m));break}y++}return g.join("")},decompress:function(e){return null==e?"":""==e?null:i._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,n,r){var i,o,a,l,d,c,u,h=[],p=4,f=4,g=3,m="",y=[],b={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)h[i]=i;for(a=0,d=4,c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*c,c<<=1;switch(a){case 0:for(a=0,d=256,c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*c,c<<=1;u=e(a);break;case 1:for(a=0,d=65536,c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*c,c<<=1;u=e(a);break;case 2:return""}for(h[3]=u,o=u,y.push(u);;){if(b.index>t)return"";for(a=0,d=Math.pow(2,g),c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*c,c<<=1;switch(u=a){case 0:for(a=0,d=256,c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*c,c<<=1;h[f++]=e(a),u=f-1,p--;break;case 1:for(a=0,d=65536,c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*c,c<<=1;h[f++]=e(a),u=f-1,p--;break;case 2:return y.join("")}if(0==p&&(p=Math.pow(2,g),g++),h[u])m=h[u];else{if(u!==f)return null;m=o+o.charAt(0)}y.push(m),h[f++]=o+m.charAt(0),p--,o=m,0==p&&(p=Math.pow(2,g),g++)}}};return i}();void 0!==(r=(function(){return i}).call(t,n,t,e))&&(e.exports=r)},28811:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(41369),i=n(43654);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return dynamic}});var o=n(70817);n(2265);var a=o._(n(57075));function convertModule(e){return{default:(null==e?void 0:e.default)||e}}function dynamic(e,t){var n=a.default,o={loading:function(e){return e.error,e.isLoading,e.pastDelay,null}};"function"==typeof e&&(o.loader=e),Object.assign(o,t);var l=o.loader;return n(i._(r._({},o),{loader:function(){return null!=l?l().then(convertModule):Promise.resolve(convertModule(function(){return null}))}}))}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},19167:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{suspense:function(){return suspense},NoSSR:function(){return NoSSR}});var r=n(11283);function suspense(){var e=Error(r.NEXT_DYNAMIC_NO_SSR_CODE);throw e.digest=r.NEXT_DYNAMIC_NO_SSR_CODE,e}function NoSSR(e){return e.children}},57075:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return _default}});var r=n(70817)._(n(2265)),i=n(19167),_default=function(e){var t=Object.assign({loader:null,loading:null,ssr:!0},e);function LoadableComponent(e){var n=t.loading,o=r.default.createElement(n,{isLoading:!0,pastDelay:!0,error:null}),a=t.ssr?r.default.Fragment:i.NoSSR,l=t.lazy;return r.default.createElement(r.default.Suspense,{fallback:o},r.default.createElement(a,null,r.default.createElement(l,e)))}return t.lazy=r.default.lazy(t.loader),LoadableComponent.displayName="LoadableComponent",LoadableComponent}},15099:function(){},24033:function(e,t,n){e.exports=n(50094)},56342:function(e,t){"use strict";if("object"==typeof performance&&"function"==typeof performance.now){var n,r,i,o,a=performance;t.unstable_now=function(){return a.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}if("undefined"==typeof window||"function"!=typeof MessageChannel){var c=null,u=null,w=function(){if(null!==c)try{var e=t.unstable_now();c(!0,e),c=null}catch(e){throw setTimeout(w,0),e}};n=function(e){null!==c?setTimeout(n,0,e):(c=e,setTimeout(w,0))},r=function(e,t){u=setTimeout(e,t)},i=function(){clearTimeout(u)},t.unstable_shouldYield=function(){return!1},o=t.unstable_forceFrameRate=function(){}}else{var h=window.setTimeout,p=window.clearTimeout;if("undefined"!=typeof console){var f=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!=typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var g=!1,m=null,y=-1,b=5,S=0;t.unstable_shouldYield=function(){return t.unstable_now()>=S},o=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<e?Math.floor(1e3/e):5};var v=new MessageChannel,k=v.port2;v.port1.onmessage=function(){if(null!==m){var e=t.unstable_now();S=e+b;try{m(!0,e)?k.postMessage(null):(g=!1,m=null)}catch(e){throw k.postMessage(null),e}}else g=!1},n=function(e){m=e,g||(g=!0,k.postMessage(null))},r=function(e,n){y=h(function(){e(t.unstable_now())},n)},i=function(){p(y),y=-1}}function H(e,t){var n=e.length;for(e.push(t);;){var r=n-1>>>1,i=e[r];if(void 0!==i&&0<I(i,t))e[r]=t,e[n]=i,n=r;else break}}function J(e){return void 0===(e=e[0])?null:e}function K(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;for(var r=0,i=e.length;r<i;){var o=2*(r+1)-1,a=e[o],l=o+1,d=e[l];if(void 0!==a&&0>I(a,n))void 0!==d&&0>I(d,a)?(e[r]=d,e[l]=n,r=l):(e[r]=a,e[o]=n,r=o);else if(void 0!==d&&0>I(d,n))e[r]=d,e[l]=n,r=l;else break}}return t}return null}function I(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var _=[],C=[],E=1,M=null,P=3,A=!1,j=!1,D=!1;function T(e){for(var t=J(C);null!==t;){if(null===t.callback)K(C);else if(t.startTime<=e)K(C),t.sortIndex=t.expirationTime,H(_,t);else break;t=J(C)}}function U(e){if(D=!1,T(e),!j){if(null!==J(_))j=!0,n(V);else{var t=J(C);null!==t&&r(U,t.startTime-e)}}}function V(e,n){j=!1,D&&(D=!1,i()),A=!0;var o=P;try{for(T(n),M=J(_);null!==M&&(!(M.expirationTime>n)||e&&!t.unstable_shouldYield());){var a=M.callback;if("function"==typeof a){M.callback=null,P=M.priorityLevel;var l=a(M.expirationTime<=n);n=t.unstable_now(),"function"==typeof l?M.callback=l:M===J(_)&&K(_),T(n)}else K(_);M=J(_)}if(null!==M)var d=!0;else{var c=J(C);null!==c&&r(U,c.startTime-n),d=!1}return d}finally{M=null,P=o,A=!1}}var B=o;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){j||A||(j=!0,n(V))},t.unstable_getCurrentPriorityLevel=function(){return P},t.unstable_getFirstCallbackNode=function(){return J(_)},t.unstable_next=function(e){switch(P){case 1:case 2:case 3:var t=3;break;default:t=P}var n=P;P=t;try{return e()}finally{P=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=B,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=P;P=e;try{return t()}finally{P=n}},t.unstable_scheduleCallback=function(e,o,a){var l=t.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?l+a:l,e){case 1:var d=-1;break;case 2:d=250;break;case 5:d=1073741823;break;case 4:d=1e4;break;default:d=5e3}return d=a+d,e={id:E++,callback:o,priorityLevel:e,startTime:a,expirationTime:d,sortIndex:-1},a>l?(e.sortIndex=a,H(C,e),null===J(_)&&e===J(C)&&(D?i():D=!0,r(U,a-l))):(e.sortIndex=d,H(_,e),j||A||(j=!0,n(V))),e},t.unstable_wrapCallback=function(e){var t=P;return function(){var n=P;P=t;try{return e.apply(this,arguments)}finally{P=n}}}},94362:function(e,t,n){"use strict";e.exports=n(56342)},42744:function(e,t){var n;/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/!function(){"use strict";var r={}.hasOwnProperty;function classNames(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=appendClass(e,function(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return classNames.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=appendClass(t,n));return t}(n)))}return e}function appendClass(e,t){return t?e?e+" "+t:e+t:e}e.exports?(classNames.default=classNames,e.exports=classNames):void 0!==(n=(function(){return classNames}).apply(t,[]))&&(e.exports=n)}()},29228:function(e,t,n){"use strict";n(47933);var r=n(89632);e.exports=r("Array","at")},35134:function(e,t,n){"use strict";n(67781),n(79328);var r=n(89632);e.exports=r("Array","flatMap")},61521:function(e,t,n){"use strict";n(53896),n(21767);var r=n(89632);e.exports=r("Array","flat")},47942:function(e,t,n){"use strict";n(4554);var r=n(89632);e.exports=r("String","at")},30632:function(e,t,n){"use strict";n(789),n(31490),n(43510);var r=n(89632);e.exports=r("String","replaceAll")},86284:function(e,t,n){"use strict";var r=n(80043),i=n(71747),o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not a function")}},38609:function(e,t,n){"use strict";var r=n(61350),i=n(42957),o=n(94982).f,a=r("unscopables"),l=Array.prototype;void 0===l[a]&&o(l,a,{configurable:!0,value:i(null)}),e.exports=function(e){l[a][e]=!0}},44531:function(e,t,n){"use strict";var r=n(42068).charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},51485:function(e,t,n){"use strict";var r=n(56695),i=String,o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not an object")}},28786:function(e,t,n){"use strict";var r=n(50949),i=n(70076),o=n(24464),createMethod=function(e){return function(t,n,a){var l,d=r(t),c=o(d);if(0===c)return!e&&-1;var u=i(a,c);if(e&&n!=n){for(;c>u;)if((l=d[u++])!=l)return!0}else for(;c>u;u++)if((e||u in d)&&d[u]===n)return e||u||0;return!e&&-1}};e.exports={includes:createMethod(!0),indexOf:createMethod(!1)}},665:function(e,t,n){"use strict";var r=n(97631),i=n(71357),o=n(56695),a=n(61350)("species"),l=Array;e.exports=function(e){var t;return r(e)&&(i(t=e.constructor)&&(t===l||r(t.prototype))?t=void 0:o(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?l:t}},60747:function(e,t,n){"use strict";var r=n(665);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},6938:function(e,t,n){"use strict";var r=n(58842),i=r({}.toString),o=r("".slice);e.exports=function(e){return o(i(e),8,-1)}},99743:function(e,t,n){"use strict";var r=n(8830),i=n(80043),o=n(6938),a=n(61350)("toStringTag"),l=Object,d="Arguments"===o(function(){return arguments}()),tryGet=function(e,t){try{return e[t]}catch(e){}};e.exports=r?o:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=tryGet(t=l(e),a))?n:d?o(t):"Object"===(r=o(t))&&i(t.callee)?"Arguments":r}},70783:function(e,t,n){"use strict";var r=n(19472),i=n(35191),o=n(85575),a=n(94982);e.exports=function(e,t,n){for(var l=i(t),d=a.f,c=o.f,u=0;u<l.length;u++){var h=l[u];r(e,h)||n&&r(n,h)||d(e,h,c(t,h))}}},60549:function(e,t,n){"use strict";var r=n(12534),i=n(94982),o=n(29085);e.exports=r?function(e,t,n){return i.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},29085:function(e){"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},64897:function(e,t,n){"use strict";var r=n(80043),i=n(94982),o=n(75412),a=n(12501);e.exports=function(e,t,n,l){l||(l={});var d=l.enumerable,c=void 0!==l.name?l.name:t;if(r(n)&&o(n,c,l),l.global)d?e[t]=n:a(t,n);else{try{l.unsafe?e[t]&&(d=!0):delete e[t]}catch(e){}d?e[t]=n:i.f(e,t,{value:n,enumerable:!1,configurable:!l.nonConfigurable,writable:!l.nonWritable})}return e}},12501:function(e,t,n){"use strict";var r=n(84023),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},12534:function(e,t,n){"use strict";var r=n(44256);e.exports=!r(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},47039:function(e,t,n){"use strict";var r=n(84023),i=n(56695),o=r.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},53745:function(e){"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},89632:function(e,t,n){"use strict";var r=n(84023),i=n(58842);e.exports=function(e,t){return i(r[e].prototype[t])}},51971:function(e){"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},679:function(e,t,n){"use strict";var r=n(84023).navigator,i=r&&r.userAgent;e.exports=i?String(i):""},77144:function(e,t,n){"use strict";var r,i,o=n(84023),a=n(679),l=o.process,d=o.Deno,c=l&&l.versions||d&&d.version,u=c&&c.v8;u&&(i=(r=u.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&a&&(!(r=a.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=a.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},69272:function(e,t,n){"use strict";var r=n(84023),i=n(85575).f,o=n(60549),a=n(64897),l=n(12501),d=n(70783),c=n(51559);e.exports=function(e,t){var n,u,h,p,f,g=e.target,m=e.global,y=e.stat;if(n=m?r:y?r[g]||l(g,{}):r[g]&&r[g].prototype)for(u in t){if(p=t[u],h=e.dontCallGetSet?(f=i(n,u))&&f.value:n[u],!c(m?u:g+(y?".":"#")+u,e.forced)&&void 0!==h){if(typeof p==typeof h)continue;d(p,h)}(e.sham||h&&h.sham)&&o(p,"sham",!0),a(n,u,p,e)}}},44256:function(e){"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},2571:function(e,t,n){"use strict";n(789);var r=n(55817),i=n(64897),o=n(13955),a=n(44256),l=n(61350),d=n(60549),c=l("species"),u=RegExp.prototype;e.exports=function(e,t,n,h){var p=l(e),f=!a(function(){var t={};return t[p]=function(){return 7},7!==""[e](t)}),g=f&&!a(function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[c]=function(){return n},n.flags="",n[p]=/./[p]),n.exec=function(){return t=!0,null},n[p](""),!t});if(!f||!g||n){var m=/./[p],y=t(p,""[e],function(e,t,n,i,a){var l=t.exec;return l===o||l===u.exec?f&&!a?{done:!0,value:r(m,t,n,i)}:{done:!0,value:r(e,n,t,i)}:{done:!1}});i(String.prototype,e,y[0]),i(u,p,y[1])}h&&d(u[p],"sham",!0)}},89162:function(e,t,n){"use strict";var r=n(97631),i=n(24464),o=n(53745),a=n(39668),flattenIntoArray=function(e,t,n,l,d,c,u,h){for(var p,f,g=d,m=0,y=!!u&&a(u,h);m<l;)m in n&&(p=y?y(n[m],m,t):n[m],c>0&&r(p)?(f=i(p),g=flattenIntoArray(e,t,p,f,g,c-1)-1):(o(g+1),e[g]=p),g++),m++;return g};e.exports=flattenIntoArray},35815:function(e,t,n){"use strict";var r=n(21115),i=Function.prototype,o=i.apply,a=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?a.bind(o):function(){return a.apply(o,arguments)})},39668:function(e,t,n){"use strict";var r=n(16919),i=n(86284),o=n(21115),a=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?a(e,t):function(){return e.apply(t,arguments)}}},21115:function(e,t,n){"use strict";var r=n(44256);e.exports=!r(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},55817:function(e,t,n){"use strict";var r=n(21115),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},56309:function(e,t,n){"use strict";var r=n(12534),i=n(19472),o=Function.prototype,a=r&&Object.getOwnPropertyDescriptor,l=i(o,"name"),d=l&&(!r||r&&a(o,"name").configurable);e.exports={EXISTS:l,PROPER:l&&"something"===(function(){}).name,CONFIGURABLE:d}},16919:function(e,t,n){"use strict";var r=n(6938),i=n(58842);e.exports=function(e){if("Function"===r(e))return i(e)}},58842:function(e,t,n){"use strict";var r=n(21115),i=Function.prototype,o=i.call,a=r&&i.bind.bind(o,o);e.exports=r?a:function(e){return function(){return o.apply(e,arguments)}}},35651:function(e,t,n){"use strict";var r=n(84023),i=n(80043);e.exports=function(e,t){var n;return arguments.length<2?i(n=r[e])?n:void 0:r[e]&&r[e][t]}},22112:function(e,t,n){"use strict";var r=n(86284),i=n(86617);e.exports=function(e,t){var n=e[t];return i(n)?void 0:r(n)}},7175:function(e,t,n){"use strict";var r=n(58842),i=n(84405),o=Math.floor,a=r("".charAt),l=r("".replace),d=r("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,u=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,n,r,h,p){var f=n+e.length,g=r.length,m=u;return void 0!==h&&(h=i(h),m=c),l(p,m,function(i,l){var c;switch(a(l,0)){case"$":return"$";case"&":return e;case"`":return d(t,0,n);case"'":return d(t,f);case"<":c=h[d(l,1,-1)];break;default:var u=+l;if(0===u)return i;if(u>g){var p=o(u/10);if(0===p)return i;if(p<=g)return void 0===r[p-1]?a(l,1):r[p-1]+a(l,1);return i}c=r[u-1]}return void 0===c?"":c})}},84023:function(e,t,n){"use strict";var check=function(e){return e&&e.Math===Math&&e};e.exports=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof n.g&&n.g)||check("object"==typeof this&&this)||function(){return this}()||Function("return this")()},19472:function(e,t,n){"use strict";var r=n(58842),i=n(84405),o=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},68347:function(e){"use strict";e.exports={}},91162:function(e,t,n){"use strict";var r=n(35651);e.exports=r("document","documentElement")},11149:function(e,t,n){"use strict";var r=n(12534),i=n(44256),o=n(47039);e.exports=!r&&!i(function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},33910:function(e,t,n){"use strict";var r=n(58842),i=n(44256),o=n(6938),a=Object,l=r("".split);e.exports=i(function(){return!a("z").propertyIsEnumerable(0)})?function(e){return"String"===o(e)?l(e,""):a(e)}:a},12402:function(e,t,n){"use strict";var r=n(58842),i=n(80043),o=n(29145),a=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},65230:function(e,t,n){"use strict";var r,i,o,a=n(99819),l=n(84023),d=n(56695),c=n(60549),u=n(19472),h=n(29145),p=n(80050),f=n(68347),g="Object already initialized",m=l.TypeError,y=l.WeakMap;if(a||h.state){var b=h.state||(h.state=new y);b.get=b.get,b.has=b.has,b.set=b.set,r=function(e,t){if(b.has(e))throw new m(g);return t.facade=e,b.set(e,t),t},i=function(e){return b.get(e)||{}},o=function(e){return b.has(e)}}else{var S=p("state");f[S]=!0,r=function(e,t){if(u(e,S))throw new m(g);return t.facade=e,c(e,S,t),t},i=function(e){return u(e,S)?e[S]:{}},o=function(e){return u(e,S)}}e.exports={set:r,get:i,has:o,enforce:function(e){return o(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!d(t)||(n=i(t)).type!==e)throw new m("Incompatible receiver, "+e+" required");return n}}}},97631:function(e,t,n){"use strict";var r=n(6938);e.exports=Array.isArray||function(e){return"Array"===r(e)}},80043:function(e){"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},71357:function(e,t,n){"use strict";var r=n(58842),i=n(44256),o=n(80043),a=n(99743),l=n(35651),d=n(12402),noop=function(){},c=l("Reflect","construct"),u=/^\s*(?:class|function)\b/,h=r(u.exec),p=!u.test(noop),isConstructorModern=function(e){if(!o(e))return!1;try{return c(noop,[],e),!0}catch(e){return!1}},isConstructorLegacy=function(e){if(!o(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!h(u,d(e))}catch(e){return!0}};isConstructorLegacy.sham=!0,e.exports=!c||i(function(){var e;return isConstructorModern(isConstructorModern.call)||!isConstructorModern(Object)||!isConstructorModern(function(){e=!0})||e})?isConstructorLegacy:isConstructorModern},51559:function(e,t,n){"use strict";var r=n(44256),i=n(80043),o=/#|\.prototype\./,isForced=function(e,t){var n=l[a(e)];return n===c||n!==d&&(i(t)?r(t):!!t)},a=isForced.normalize=function(e){return String(e).replace(o,".").toLowerCase()},l=isForced.data={},d=isForced.NATIVE="N",c=isForced.POLYFILL="P";e.exports=isForced},86617:function(e){"use strict";e.exports=function(e){return null==e}},56695:function(e,t,n){"use strict";var r=n(80043);e.exports=function(e){return"object"==typeof e?null!==e:r(e)}},9168:function(e){"use strict";e.exports=!1},91059:function(e,t,n){"use strict";var r=n(56695),i=n(6938),o=n(61350)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"===i(e))}},65375:function(e,t,n){"use strict";var r=n(35651),i=n(80043),o=n(50112),a=n(20327),l=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&o(t.prototype,l(e))}},24464:function(e,t,n){"use strict";var r=n(42510);e.exports=function(e){return r(e.length)}},75412:function(e,t,n){"use strict";var r=n(58842),i=n(44256),o=n(80043),a=n(19472),l=n(12534),d=n(56309).CONFIGURABLE,c=n(12402),u=n(65230),h=u.enforce,p=u.get,f=String,g=Object.defineProperty,m=r("".slice),y=r("".replace),b=r([].join),S=l&&!i(function(){return 8!==g(function(){},"length",{value:8}).length}),v=String(String).split("String"),k=e.exports=function(e,t,n){"Symbol("===m(f(t),0,7)&&(t="["+y(f(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!a(e,"name")||d&&e.name!==t)&&(l?g(e,"name",{value:t,configurable:!0}):e.name=t),S&&n&&a(n,"arity")&&e.length!==n.arity&&g(e,"length",{value:n.arity});try{n&&a(n,"constructor")&&n.constructor?l&&g(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=h(e);return a(r,"source")||(r.source=b(v,"string"==typeof t?t:"")),e};Function.prototype.toString=k(function(){return o(this)&&p(this).source||c(this)},"toString")},61325:function(e){"use strict";var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?n:t)(r)}},42957:function(e,t,n){"use strict";var r,i=n(51485),o=n(79400),a=n(51971),l=n(68347),d=n(91162),c=n(47039),u=n(80050),h="prototype",p="script",f=u("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(e){return"<"+p+">"+e+"</"+p+">"},NullProtoObjectViaActiveX=function(e){e.write(scriptTag("")),e.close();var t=e.parentWindow.Object;return e=null,t},NullProtoObjectViaIFrame=function(){var e,t=c("iframe");return t.style.display="none",d.appendChild(t),t.src=String("java"+p+":"),(e=t.contentWindow.document).open(),e.write(scriptTag("document.F=Object")),e.close(),e.F},NullProtoObject=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}NullProtoObject="undefined"!=typeof document?document.domain&&r?NullProtoObjectViaActiveX(r):NullProtoObjectViaIFrame():NullProtoObjectViaActiveX(r);for(var e=a.length;e--;)delete NullProtoObject[h][a[e]];return NullProtoObject()};l[f]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(EmptyConstructor[h]=i(e),n=new EmptyConstructor,EmptyConstructor[h]=null,n[f]=e):n=NullProtoObject(),void 0===t?n:o.f(n,t)}},79400:function(e,t,n){"use strict";var r=n(12534),i=n(81887),o=n(94982),a=n(51485),l=n(50949),d=n(15540);t.f=r&&!i?Object.defineProperties:function(e,t){a(e);for(var n,r=l(t),i=d(t),c=i.length,u=0;c>u;)o.f(e,n=i[u++],r[n]);return e}},94982:function(e,t,n){"use strict";var r=n(12534),i=n(11149),o=n(81887),a=n(51485),l=n(87843),d=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,h="enumerable",p="configurable",f="writable";t.f=r?o?function(e,t,n){if(a(e),t=l(t),a(n),"function"==typeof e&&"prototype"===t&&"value"in n&&f in n&&!n[f]){var r=u(e,t);r&&r[f]&&(e[t]=n.value,n={configurable:p in n?n[p]:r[p],enumerable:h in n?n[h]:r[h],writable:!1})}return c(e,t,n)}:c:function(e,t,n){if(a(e),t=l(t),a(n),i)try{return c(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new d("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},85575:function(e,t,n){"use strict";var r=n(12534),i=n(55817),o=n(96787),a=n(29085),l=n(50949),d=n(87843),c=n(19472),u=n(11149),h=Object.getOwnPropertyDescriptor;t.f=r?h:function(e,t){if(e=l(e),t=d(t),u)try{return h(e,t)}catch(e){}if(c(e,t))return a(!i(o.f,e,t),e[t])}},67613:function(e,t,n){"use strict";var r=n(49852),i=n(51971).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},4531:function(e,t){"use strict";t.f=Object.getOwnPropertySymbols},50112:function(e,t,n){"use strict";var r=n(58842);e.exports=r({}.isPrototypeOf)},49852:function(e,t,n){"use strict";var r=n(58842),i=n(19472),o=n(50949),a=n(28786).indexOf,l=n(68347),d=r([].push);e.exports=function(e,t){var n,r=o(e),c=0,u=[];for(n in r)!i(l,n)&&i(r,n)&&d(u,n);for(;t.length>c;)i(r,n=t[c++])&&(~a(u,n)||d(u,n));return u}},15540:function(e,t,n){"use strict";var r=n(49852),i=n(51971);e.exports=Object.keys||function(e){return r(e,i)}},96787:function(e,t){"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},61823:function(e,t,n){"use strict";var r=n(55817),i=n(80043),o=n(56695),a=TypeError;e.exports=function(e,t){var n,l;if("string"===t&&i(n=e.toString)&&!o(l=r(n,e))||i(n=e.valueOf)&&!o(l=r(n,e))||"string"!==t&&i(n=e.toString)&&!o(l=r(n,e)))return l;throw new a("Can't convert object to primitive value")}},35191:function(e,t,n){"use strict";var r=n(35651),i=n(58842),o=n(67613),a=n(4531),l=n(51485),d=i([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(l(e)),n=a.f;return n?d(t,n(e)):t}},38911:function(e,t,n){"use strict";var r=n(55817),i=n(51485),o=n(80043),a=n(6938),l=n(13955),d=TypeError;e.exports=function(e,t){var n=e.exec;if(o(n)){var c=r(n,e,t);return null!==c&&i(c),c}if("RegExp"===a(e))return r(l,e,t);throw new d("RegExp#exec called on incompatible receiver")}},13955:function(e,t,n){"use strict";var r,i,o=n(55817),a=n(58842),l=n(92455),d=n(4045),c=n(9602),u=n(93801),h=n(42957),p=n(65230).get,f=n(27541),g=n(5682),m=u("native-string-replace",String.prototype.replace),y=RegExp.prototype.exec,b=y,S=a("".charAt),v=a("".indexOf),k=a("".replace),_=a("".slice),C=(i=/b*/g,o(y,r=/a/,"a"),o(y,i,"a"),0!==r.lastIndex||0!==i.lastIndex),E=c.BROKEN_CARET,M=void 0!==/()??/.exec("")[1];(C||M||E||f||g)&&(b=function(e){var t,n,r,i,a,c,u,f=p(this),g=l(e),P=f.raw;if(P)return P.lastIndex=this.lastIndex,t=o(b,P,g),this.lastIndex=P.lastIndex,t;var A=f.groups,j=E&&this.sticky,D=o(d,this),B=this.source,F=0,O=g;if(j&&(-1===v(D=k(D,"y",""),"g")&&(D+="g"),O=_(g,this.lastIndex),this.lastIndex>0&&(!this.multiline||this.multiline&&"\n"!==S(g,this.lastIndex-1))&&(B="(?: "+B+")",O=" "+O,F++),n=RegExp("^(?:"+B+")",D)),M&&(n=RegExp("^"+B+"$(?!\\s)",D)),C&&(r=this.lastIndex),i=o(y,j?n:this,O),j?i?(i.input=_(i.input,F),i[0]=_(i[0],F),i.index=this.lastIndex,this.lastIndex+=i[0].length):this.lastIndex=0:C&&i&&(this.lastIndex=this.global?i.index+i[0].length:r),M&&i&&i.length>1&&o(m,i[0],n,function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)}),i&&A)for(a=0,i.groups=c=h(null);a<A.length;a++)c[(u=A[a])[0]]=i[u[1]];return i}),e.exports=b},4045:function(e,t,n){"use strict";var r=n(51485);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},80290:function(e,t,n){"use strict";var r=n(55817),i=n(19472),o=n(50112),a=n(4045),l=RegExp.prototype;e.exports=function(e){var t=e.flags;return!(void 0===t&&!("flags"in l)&&!i(e,"flags")&&o(l,e))?t:r(a,e)}},9602:function(e,t,n){"use strict";var r=n(44256),i=n(84023).RegExp,o=r(function(){var e=i("a","y");return e.lastIndex=2,null!==e.exec("abcd")}),a=o||r(function(){return!i("a","y").sticky}),l=o||r(function(){var e=i("^r","gy");return e.lastIndex=2,null!==e.exec("str")});e.exports={BROKEN_CARET:l,MISSED_STICKY:a,UNSUPPORTED_Y:o}},27541:function(e,t,n){"use strict";var r=n(44256),i=n(84023).RegExp;e.exports=r(function(){var e=i(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})},5682:function(e,t,n){"use strict";var r=n(44256),i=n(84023).RegExp;e.exports=r(function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})},12924:function(e,t,n){"use strict";var r=n(86617),i=TypeError;e.exports=function(e){if(r(e))throw new i("Can't call method on "+e);return e}},80050:function(e,t,n){"use strict";var r=n(93801),i=n(97246),o=r("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},29145:function(e,t,n){"use strict";var r=n(9168),i=n(84023),o=n(12501),a="__core-js_shared__",l=e.exports=i[a]||o(a,{});(l.versions||(l.versions=[])).push({version:"3.42.0",mode:r?"pure":"global",copyright:"\xa9 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"})},93801:function(e,t,n){"use strict";var r=n(29145);e.exports=function(e,t){return r[e]||(r[e]=t||{})}},42068:function(e,t,n){"use strict";var r=n(58842),i=n(55963),o=n(92455),a=n(12924),l=r("".charAt),d=r("".charCodeAt),c=r("".slice),createMethod=function(e){return function(t,n){var r,u,h=o(a(t)),p=i(n),f=h.length;return p<0||p>=f?e?"":void 0:(r=d(h,p))<55296||r>56319||p+1===f||(u=d(h,p+1))<56320||u>57343?e?l(h,p):r:e?c(h,p,p+2):(r-55296<<10)+(u-56320)+65536}};e.exports={codeAt:createMethod(!1),charAt:createMethod(!0)}},24072:function(e,t,n){"use strict";var r=n(77144),i=n(44256),o=n(84023).String;e.exports=!!Object.getOwnPropertySymbols&&!i(function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e) instanceof Symbol)||!Symbol.sham&&r&&r<41})},70076:function(e,t,n){"use strict";var r=n(55963),i=Math.max,o=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):o(n,t)}},50949:function(e,t,n){"use strict";var r=n(33910),i=n(12924);e.exports=function(e){return r(i(e))}},55963:function(e,t,n){"use strict";var r=n(61325);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},42510:function(e,t,n){"use strict";var r=n(55963),i=Math.min;e.exports=function(e){var t=r(e);return t>0?i(t,9007199254740991):0}},84405:function(e,t,n){"use strict";var r=n(12924),i=Object;e.exports=function(e){return i(r(e))}},61777:function(e,t,n){"use strict";var r=n(55817),i=n(56695),o=n(65375),a=n(22112),l=n(61823),d=n(61350),c=TypeError,u=d("toPrimitive");e.exports=function(e,t){if(!i(e)||o(e))return e;var n,d=a(e,u);if(d){if(void 0===t&&(t="default"),!i(n=r(d,e,t))||o(n))return n;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),l(e,t)}},87843:function(e,t,n){"use strict";var r=n(61777),i=n(65375);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},8830:function(e,t,n){"use strict";var r=n(61350)("toStringTag"),i={};i[r]="z",e.exports="[object z]"===String(i)},92455:function(e,t,n){"use strict";var r=n(99743),i=String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return i(e)}},71747:function(e){"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},97246:function(e,t,n){"use strict";var r=n(58842),i=0,o=Math.random(),a=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++i+o,36)}},20327:function(e,t,n){"use strict";var r=n(24072);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},81887:function(e,t,n){"use strict";var r=n(12534),i=n(44256);e.exports=r&&i(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},99819:function(e,t,n){"use strict";var r=n(84023),i=n(80043),o=r.WeakMap;e.exports=i(o)&&/native code/.test(String(o))},61350:function(e,t,n){"use strict";var r=n(84023),i=n(93801),o=n(19472),a=n(97246),l=n(24072),d=n(20327),c=r.Symbol,u=i("wks"),h=d?c.for||c:c&&c.withoutSetter||a;e.exports=function(e){return o(u,e)||(u[e]=l&&o(c,e)?c[e]:h("Symbol."+e)),u[e]}},47933:function(e,t,n){"use strict";var r=n(69272),i=n(84405),o=n(24464),a=n(55963),l=n(38609);r({target:"Array",proto:!0},{at:function(e){var t=i(this),n=o(t),r=a(e),l=r>=0?r:n+r;return l<0||l>=n?void 0:t[l]}}),l("at")},67781:function(e,t,n){"use strict";var r=n(69272),i=n(89162),o=n(86284),a=n(84405),l=n(24464),d=n(60747);r({target:"Array",proto:!0},{flatMap:function(e){var t,n=a(this),r=l(n);return o(e),(t=d(n,0)).length=i(t,n,n,r,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},53896:function(e,t,n){"use strict";var r=n(69272),i=n(89162),o=n(84405),a=n(24464),l=n(55963),d=n(60747);r({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=o(this),n=a(t),r=d(t,0);return r.length=i(r,t,t,n,0,void 0===e?1:l(e)),r}})},79328:function(e,t,n){"use strict";n(38609)("flatMap")},21767:function(e,t,n){"use strict";n(38609)("flat")},789:function(e,t,n){"use strict";var r=n(69272),i=n(13955);r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},4554:function(e,t,n){"use strict";var r=n(69272),i=n(58842),o=n(12924),a=n(55963),l=n(92455),d=n(44256),c=i("".charAt);r({target:"String",proto:!0,forced:d(function(){return"\uD842"!=="\uD842\uDFB7".at(-2)})},{at:function(e){var t=l(o(this)),n=t.length,r=a(e),i=r>=0?r:n+r;return i<0||i>=n?void 0:c(t,i)}})},43510:function(e,t,n){"use strict";var r=n(69272),i=n(55817),o=n(58842),a=n(12924),l=n(80043),d=n(56695),c=n(91059),u=n(92455),h=n(22112),p=n(80290),f=n(7175),g=n(61350),m=n(9168),y=g("replace"),b=TypeError,S=o("".indexOf),v=o("".replace),k=o("".slice),_=Math.max;r({target:"String",proto:!0},{replaceAll:function(e,t){var n,r,o,g,C,E,M,P,A,j=a(this),D=0,B="";if(d(e)){if((n=c(e))&&!~S(u(a(p(e))),"g"))throw new b("`.replaceAll` does not allow non-global regexes");if(r=h(e,y))return i(r,e,j,t);if(m&&n)return v(u(j),e,t)}for(o=u(j),g=u(e),(C=l(t))||(t=u(t)),M=_(1,E=g.length),P=S(o,g);-1!==P;)A=C?u(t(g,P,o)):f(g,o,P,[],void 0,t),B+=k(o,D,P)+A,D=P+E,P=P+M>o.length?-1:S(o,g,P+M);return D<o.length&&(B+=k(o,D)),B}})},31490:function(e,t,n){"use strict";var r=n(35815),i=n(55817),o=n(58842),a=n(2571),l=n(44256),d=n(51485),c=n(80043),u=n(56695),h=n(55963),p=n(42510),f=n(92455),g=n(12924),m=n(44531),y=n(22112),b=n(7175),S=n(38911),v=n(61350)("replace"),k=Math.max,_=Math.min,C=o([].concat),E=o([].push),M=o("".indexOf),P=o("".slice),A="$0"==="a".replace(/./,"$0"),j=!!/./[v]&&""===/./[v]("a","$0");a("replace",function(e,t,n){var o=j?"$":"$0";return[function(e,n){var r=g(this),o=u(e)?y(e,v):void 0;return o?i(o,e,r,n):i(t,f(r),e,n)},function(e,i){var a=d(this),l=f(e);if("string"==typeof i&&-1===M(i,o)&&-1===M(i,"$<")){var u=n(t,a,l,i);if(u.done)return u.value}var g=c(i);g||(i=f(i));var y=a.global;y&&(F=a.unicode,a.lastIndex=0);for(var v=[];null!==(O=S(a,l))&&(E(v,O),y);)""===f(O[0])&&(a.lastIndex=m(l,p(a.lastIndex),F));for(var A="",j=0,D=0;D<v.length;D++){for(var B,F,O,R,L=f((O=v[D])[0]),N=k(_(h(O.index),l.length),0),z=[],$=1;$<O.length;$++)E(z,void 0===(B=O[$])?B:String(B));var G=O.groups;if(g){var W=C([L],z,N,l);void 0!==G&&E(W,G),R=f(r(i,void 0,W))}else R=b(L,l,N,z,G,i);N>=j&&(A+=P(l,j,N)+R,j=N+L.length)}return A+P(l,j)}]},!!l(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!A||j)},69645:function(e,t,n){"use strict";var r=n(29228);e.exports=r},86930:function(e,t,n){"use strict";var r=n(35134);e.exports=r},64770:function(e,t,n){"use strict";var r=n(61521);e.exports=r},92880:function(e,t,n){"use strict";var r=n(47942);e.exports=r},19304:function(e,t,n){"use strict";var r=n(30632);e.exports=r},80760:function(e,t,n){"use strict";function clamp(e,[t,n]){return Math.min(n,Math.max(t,e))}n.d(t,{u:function(){return clamp}})},28712:function(e,t,n){"use strict";n.r(t),n.d(t,{Close:function(){return ec},Content:function(){return es},Description:function(){return ed},Dialog:function(){return Dialog},DialogClose:function(){return Q},DialogContent:function(){return N},DialogDescription:function(){return Y},DialogOverlay:function(){return F},DialogPortal:function(){return DialogPortal},DialogTitle:function(){return Z},DialogTrigger:function(){return P},Overlay:function(){return ea},Portal:function(){return eo},Root:function(){return er},Title:function(){return el},Trigger:function(){return ei},WarningProvider:function(){return et},createDialogScope:function(){return _}});var r=n(2265),i=n(85744),o=n(42210),a=n(56989),l=n(20966),d=n(73763),c=n(79249),u=n(52759),h=n(52730),p=n(85606),f=n(9381),g=n(31244),m=n(17552),y=n(85859),b=n(67256),S=n(57437),v="Dialog",[k,_]=(0,a.b)(v),[C,E]=k(v),Dialog=e=>{let{__scopeDialog:t,children:n,open:i,defaultOpen:o,onOpenChange:a,modal:c=!0}=e,u=r.useRef(null),h=r.useRef(null),[p,f]=(0,d.T)({prop:i,defaultProp:o??!1,onChange:a,caller:v});return(0,S.jsx)(C,{scope:t,triggerRef:u,contentRef:h,contentId:(0,l.M)(),titleId:(0,l.M)(),descriptionId:(0,l.M)(),open:p,onOpenChange:f,onOpenToggle:r.useCallback(()=>f(e=>!e),[f]),modal:c,children:n})};Dialog.displayName=v;var M="DialogTrigger",P=r.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,a=E(M,n),l=(0,o.e)(t,a.triggerRef);return(0,S.jsx)(f.WV.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":getState(a.open),...r,ref:l,onClick:(0,i.Mj)(e.onClick,a.onOpenToggle)})});P.displayName=M;var A="DialogPortal",[j,D]=k(A,{forceMount:void 0}),DialogPortal=e=>{let{__scopeDialog:t,forceMount:n,children:i,container:o}=e,a=E(A,t);return(0,S.jsx)(j,{scope:t,forceMount:n,children:r.Children.map(i,e=>(0,S.jsx)(p.z,{present:n||a.open,children:(0,S.jsx)(h.h,{asChild:!0,container:o,children:e})}))})};DialogPortal.displayName=A;var B="DialogOverlay",F=r.forwardRef((e,t)=>{let n=D(B,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=E(B,e.__scopeDialog);return o.modal?(0,S.jsx)(p.z,{present:r||o.open,children:(0,S.jsx)(R,{...i,ref:t})}):null});F.displayName=B;var O=(0,b.Z8)("DialogOverlay.RemoveScroll"),R=r.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=E(B,n);return(0,S.jsx)(m.Z,{as:O,allowPinchZoom:!0,shards:[i.contentRef],children:(0,S.jsx)(f.WV.div,{"data-state":getState(i.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})}),L="DialogContent",N=r.forwardRef((e,t)=>{let n=D(L,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=E(L,e.__scopeDialog);return(0,S.jsx)(p.z,{present:r||o.open,children:o.modal?(0,S.jsx)(z,{...i,ref:t}):(0,S.jsx)($,{...i,ref:t})})});N.displayName=L;var z=r.forwardRef((e,t)=>{let n=E(L,e.__scopeDialog),a=r.useRef(null),l=(0,o.e)(t,n.contentRef,a);return r.useEffect(()=>{let e=a.current;if(e)return(0,y.hideOthers)(e)},[]),(0,S.jsx)(G,{...e,ref:l,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,i.Mj)(e.onCloseAutoFocus,e=>{e.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:(0,i.Mj)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;r&&e.preventDefault()}),onFocusOutside:(0,i.Mj)(e.onFocusOutside,e=>e.preventDefault())})}),$=r.forwardRef((e,t)=>{let n=E(L,e.__scopeDialog),i=r.useRef(!1),o=r.useRef(!1);return(0,S.jsx)(G,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(i.current||n.triggerRef.current?.focus(),t.preventDefault()),i.current=!1,o.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(i.current=!0,"pointerdown"!==t.detail.originalEvent.type||(o.current=!0));let r=t.target,a=n.triggerRef.current?.contains(r);a&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&o.current&&t.preventDefault()}})}),G=r.forwardRef((e,t)=>{let{__scopeDialog:n,trapFocus:i,onOpenAutoFocus:a,onCloseAutoFocus:l,...d}=e,h=E(L,n),p=r.useRef(null),f=(0,o.e)(t,p);return(0,g.EW)(),(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(u.M,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:a,onUnmountAutoFocus:l,children:(0,S.jsx)(c.XB,{role:"dialog",id:h.contentId,"aria-describedby":h.descriptionId,"aria-labelledby":h.titleId,"data-state":getState(h.open),...d,ref:f,onDismiss:()=>h.onOpenChange(!1)})}),(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(TitleWarning,{titleId:h.titleId}),(0,S.jsx)(DescriptionWarning,{contentRef:p,descriptionId:h.descriptionId})]})]})}),W="DialogTitle",Z=r.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=E(W,n);return(0,S.jsx)(f.WV.h2,{id:i.titleId,...r,ref:t})});Z.displayName=W;var q="DialogDescription",Y=r.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=E(q,n);return(0,S.jsx)(f.WV.p,{id:i.descriptionId,...r,ref:t})});Y.displayName=q;var X="DialogClose",Q=r.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,o=E(X,n);return(0,S.jsx)(f.WV.button,{type:"button",...r,ref:t,onClick:(0,i.Mj)(e.onClick,()=>o.onOpenChange(!1))})});function getState(e){return e?"open":"closed"}Q.displayName=X;var ee="DialogTitleWarning",[et,en]=(0,a.k)(ee,{contentName:L,titleName:W,docsSlug:"dialog"}),TitleWarning=({titleId:e})=>{let t=en(ee),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return r.useEffect(()=>{if(e){let t=document.getElementById(e);t||console.error(n)}},[n,e]),null},DescriptionWarning=({contentRef:e,descriptionId:t})=>{let n=en("DialogDescriptionWarning"),i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${n.contentName}}.`;return r.useEffect(()=>{let n=e.current?.getAttribute("aria-describedby");if(t&&n){let e=document.getElementById(t);e||console.warn(i)}},[i,e,t]),null},er=Dialog,ei=P,eo=DialogPortal,ea=F,es=N,el=Z,ed=Y,ec=Q},65050:function(e,t,n){"use strict";n.d(t,{Eh:function(){return en},VY:function(){return ee},fC:function(){return Y},h_:function(){return Q},x8:function(){return et},xz:function(){return X}});var r=n(2265),i=n(85744),o=n(42210),a=n(56989),l=n(79249),d=n(31244),c=n(52759),u=n(20966),h=n(92827),p=n(52730),f=n(85606),g=n(9381),m=n(67256),y=n(73763),b=n(85859),S=n(17552),v=n(57437),k="Popover",[_,C]=(0,a.b)(k,[h.D7]),E=(0,h.D7)(),[M,P]=_(k),Popover=e=>{let{__scopePopover:t,children:n,open:i,defaultOpen:o,onOpenChange:a,modal:l=!1}=e,d=E(t),c=r.useRef(null),[p,f]=r.useState(!1),[g,m]=(0,y.T)({prop:i,defaultProp:o??!1,onChange:a,caller:k});return(0,v.jsx)(h.fC,{...d,children:(0,v.jsx)(M,{scope:t,contentId:(0,u.M)(),triggerRef:c,open:g,onOpenChange:m,onOpenToggle:r.useCallback(()=>m(e=>!e),[m]),hasCustomAnchor:p,onCustomAnchorAdd:r.useCallback(()=>f(!0),[]),onCustomAnchorRemove:r.useCallback(()=>f(!1),[]),modal:l,children:n})})};Popover.displayName=k;var A="PopoverAnchor";r.forwardRef((e,t)=>{let{__scopePopover:n,...i}=e,o=P(A,n),a=E(n),{onCustomAnchorAdd:l,onCustomAnchorRemove:d}=o;return r.useEffect(()=>(l(),()=>d()),[l,d]),(0,v.jsx)(h.ee,{...a,...i,ref:t})}).displayName=A;var j="PopoverTrigger",D=r.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,a=P(j,n),l=E(n),d=(0,o.e)(t,a.triggerRef),c=(0,v.jsx)(g.WV.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":getState(a.open),...r,ref:d,onClick:(0,i.Mj)(e.onClick,a.onOpenToggle)});return a.hasCustomAnchor?c:(0,v.jsx)(h.ee,{asChild:!0,...l,children:c})});D.displayName=j;var B="PopoverPortal",[F,O]=_(B,{forceMount:void 0}),PopoverPortal=e=>{let{__scopePopover:t,forceMount:n,children:r,container:i}=e,o=P(B,t);return(0,v.jsx)(F,{scope:t,forceMount:n,children:(0,v.jsx)(f.z,{present:n||o.open,children:(0,v.jsx)(p.h,{asChild:!0,container:i,children:r})})})};PopoverPortal.displayName=B;var R="PopoverContent",L=r.forwardRef((e,t)=>{let n=O(R,e.__scopePopover),{forceMount:r=n.forceMount,...i}=e,o=P(R,e.__scopePopover);return(0,v.jsx)(f.z,{present:r||o.open,children:o.modal?(0,v.jsx)(z,{...i,ref:t}):(0,v.jsx)($,{...i,ref:t})})});L.displayName=R;var N=(0,m.Z8)("PopoverContent.RemoveScroll"),z=r.forwardRef((e,t)=>{let n=P(R,e.__scopePopover),a=r.useRef(null),l=(0,o.e)(t,a),d=r.useRef(!1);return r.useEffect(()=>{let e=a.current;if(e)return(0,b.hideOthers)(e)},[]),(0,v.jsx)(S.Z,{as:N,allowPinchZoom:!0,children:(0,v.jsx)(G,{...e,ref:l,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,i.Mj)(e.onCloseAutoFocus,e=>{e.preventDefault(),d.current||n.triggerRef.current?.focus()}),onPointerDownOutside:(0,i.Mj)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;d.current=r},{checkForDefaultPrevented:!1}),onFocusOutside:(0,i.Mj)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),$=r.forwardRef((e,t)=>{let n=P(R,e.__scopePopover),i=r.useRef(!1),o=r.useRef(!1);return(0,v.jsx)(G,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(i.current||n.triggerRef.current?.focus(),t.preventDefault()),i.current=!1,o.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(i.current=!0,"pointerdown"!==t.detail.originalEvent.type||(o.current=!0));let r=t.target,a=n.triggerRef.current?.contains(r);a&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&o.current&&t.preventDefault()}})}),G=r.forwardRef((e,t)=>{let{__scopePopover:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEscapeKeyDown:u,onPointerDownOutside:p,onFocusOutside:f,onInteractOutside:g,...m}=e,y=P(R,n),b=E(n);return(0,d.EW)(),(0,v.jsx)(c.M,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o,children:(0,v.jsx)(l.XB,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:g,onEscapeKeyDown:u,onPointerDownOutside:p,onFocusOutside:f,onDismiss:()=>y.onOpenChange(!1),children:(0,v.jsx)(h.VY,{"data-state":getState(y.open),role:"dialog",id:y.contentId,...b,...m,ref:t,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),W="PopoverClose",Z=r.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,o=P(W,n);return(0,v.jsx)(g.WV.button,{type:"button",...r,ref:t,onClick:(0,i.Mj)(e.onClick,()=>o.onOpenChange(!1))})});Z.displayName=W;var q=r.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=E(n);return(0,v.jsx)(h.Eh,{...i,...r,ref:t})});function getState(e){return e?"open":"closed"}q.displayName="PopoverArrow";var Y=Popover,X=D,Q=PopoverPortal,ee=L,et=Z,en=q},42788:function(e,t,n){"use strict";n.d(t,{ck:function(){return B},fC:function(){return D},oY:function(){return m}});var r=n(2265),i=n(56989),o=n(9381),a=n(44356),l=n(85744),d=n(73763),c=n(57437),u="Toggle",h=r.forwardRef((e,t)=>{let{pressed:n,defaultPressed:r,onPressedChange:i,...a}=e,[h,p]=(0,d.T)({prop:n,onChange:i,defaultProp:r??!1,caller:u});return(0,c.jsx)(o.WV.button,{type:"button","aria-pressed":h,"data-state":h?"on":"off","data-disabled":e.disabled?"":void 0,...a,ref:t,onClick:(0,l.Mj)(e.onClick,()=>{e.disabled||p(!h)})})});h.displayName=u;var p=n(65400),f="ToggleGroup",[g,m]=(0,i.b)(f,[a.Pc]),y=(0,a.Pc)(),b=r.forwardRef((e,t)=>{let{type:n,...r}=e;if("single"===n)return(0,c.jsx)(k,{...r,ref:t});if("multiple"===n)return(0,c.jsx)(_,{...r,ref:t});throw Error(`Missing prop \`type\` expected on \`${f}\``)});b.displayName=f;var[S,v]=g(f),k=r.forwardRef((e,t)=>{let{value:n,defaultValue:i,onValueChange:o=()=>{},...a}=e,[l,u]=(0,d.T)({prop:n,defaultProp:i??"",onChange:o,caller:f});return(0,c.jsx)(S,{scope:e.__scopeToggleGroup,type:"single",value:r.useMemo(()=>l?[l]:[],[l]),onItemActivate:u,onItemDeactivate:r.useCallback(()=>u(""),[u]),children:(0,c.jsx)(M,{...a,ref:t})})}),_=r.forwardRef((e,t)=>{let{value:n,defaultValue:i,onValueChange:o=()=>{},...a}=e,[l,u]=(0,d.T)({prop:n,defaultProp:i??[],onChange:o,caller:f}),h=r.useCallback(e=>u((t=[])=>[...t,e]),[u]),p=r.useCallback(e=>u((t=[])=>t.filter(t=>t!==e)),[u]);return(0,c.jsx)(S,{scope:e.__scopeToggleGroup,type:"multiple",value:l,onItemActivate:h,onItemDeactivate:p,children:(0,c.jsx)(M,{...a,ref:t})})});b.displayName=f;var[C,E]=g(f),M=r.forwardRef((e,t)=>{let{__scopeToggleGroup:n,disabled:r=!1,rovingFocus:i=!0,orientation:l,dir:d,loop:u=!0,...h}=e,f=y(n),g=(0,p.gm)(d),m={role:"group",dir:g,...h};return(0,c.jsx)(C,{scope:n,rovingFocus:i,disabled:r,children:i?(0,c.jsx)(a.fC,{asChild:!0,...f,orientation:l,dir:g,loop:u,children:(0,c.jsx)(o.WV.div,{...m,ref:t})}):(0,c.jsx)(o.WV.div,{...m,ref:t})})}),P="ToggleGroupItem",A=r.forwardRef((e,t)=>{let n=v(P,e.__scopeToggleGroup),i=E(P,e.__scopeToggleGroup),o=y(e.__scopeToggleGroup),l=n.value.includes(e.value),d=i.disabled||e.disabled,u={...e,pressed:l,disabled:d},h=r.useRef(null);return i.rovingFocus?(0,c.jsx)(a.ck,{asChild:!0,...o,focusable:!d,active:l,ref:h,children:(0,c.jsx)(j,{...u,ref:t})}):(0,c.jsx)(j,{...u,ref:t})});A.displayName=P;var j=r.forwardRef((e,t)=>{let{__scopeToggleGroup:n,value:r,...i}=e,o=v(P,n),a={role:"radio","aria-checked":e.pressed,"aria-pressed":void 0},l="single"===o.type?a:void 0;return(0,c.jsx)(h,{...l,...i,ref:t,onPressedChange:e=>{e?o.onItemActivate(r):o.onItemDeactivate(r)}})}),D=b,B=A},85184:function(e,t,n){"use strict";n.d(t,{D:function(){return usePrevious}});var r=n(2265);function usePrevious(e){let t=r.useRef({value:e,previous:e});return r.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}},8281:function(e,t,n){"use strict";n.d(t,{C2:function(){return a},TX:function(){return l}});var r=n(2265),i=n(9381),o=n(57437),a=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),l=r.forwardRef((e,t)=>(0,o.jsx)(i.WV.span,{...e,ref:t,style:{...a,...e.style}}));l.displayName="VisuallyHidden"},9354:function(e,t,n){"use strict";n.d(t,{Cs:function(){return ErrorScreen},a_:function(){return LoadingScreen},gR:function(){return Z},FI:function(){return useOnMount}});var r=n(57437),i=n(63134),o=n(70938),a=n(2265),l=n(42744),d=n(12011),c=n(24519),u=n(47328),h=n(7217),p=n(80418),f=n(45827),g=n(3231),m=n(30742),y=n(16384),b=n(3373),S=n(75053),v=n(76413),k=n(18560),_=n(60180),C=n(83480),E=n(22890),M=n(31316),P=n(39138);let A=(0,a.createContext)({}),useLicenseContext=()=>(0,a.useContext)(A);function LicenseProvider({licenseKey:e,children:t}){let[n]=(0,a.useState)(()=>new P.WN(e));return(0,r.jsx)(A.Provider,{value:n,children:t})}var j=n(17910),D=n(5932),B=n(77700),F=n(29261);let O=`data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>')}`,R=`data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>')}`,L=(0,a.memo)(function(){let e=useLicenseContext(),t=(0,b.jE)(),n=(0,m.Hg)("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),i=(0,m.Hg)("watermarkState",()=>e.state.get(),[e]);return["licensed-with-watermark","unlicensed"].includes(i)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(z,{}),(0,r.jsx)(N,{src:n?R:O})]}):null}),N=(0,a.memo)(function({src:e}){let t=(0,b.jE)(),n=(0,m.Hg)("debug mode",()=>t.getInstanceState().isDebugMode,[t]),i=(0,m.Hg)("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),o=(0,j.I)(),l=(0,a.useRef)(null);(0,D.O)(l);let d=`url('${e}') center 100% / 100% no-repeat`;return(0,r.jsx)("div",{ref:l,className:P.WN.className,"data-debug":n,"data-mobile":i,draggable:!1,...o,children:(0,r.jsx)("button",{draggable:!1,role:"button",onPointerDown:e=>{(0,B.be)(e),(0,B.PF)(e)},title:"made with tldraw",onClick:()=>F.G.openWindow("https://tldraw.dev/?utm_source=dotcom&utm_medium=organic&utm_campaign=watermark","_blank"),style:{mask:d,WebkitMask:d}})})}),z=(0,a.memo)(function(){let e=(0,b.jE)(),t=P.WN.className,n=`/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

	.${t} {
		position: absolute;
		bottom: var(--space-2);
		right: var(--space-2);
		width: 96px;
		height: 32px;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: var(--layer-watermark) !important;
		background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
		opacity: 1;
		border-radius: 5px;
		pointer-events: all;
		padding: 2px;
		box-sizing: content-box;
	}

	.${t} > button {
		position: absolute;
		width: 96px;
		height: 32px;
		pointer-events: all;
		cursor: inherit;
		color: var(--color-text);
		opacity: .38;
		border: 0;
		padding: 0;
		background-color: currentColor;
	}

	.${t}[data-debug='true'] {
		bottom: 46px;
	}

	.${t}[data-mobile='true'] {
		border-radius: 4px 0px 0px 4px;
		right: -2px;
		width: 8px;
		height: 48px;
	}

	.${t}[data-mobile='true'] > button {
		width: 8px;
		height: 32px;
	}

	@media (hover: hover) {
		.${t} > button {
			pointer-events: none;
		}

		.${t}:hover {
			background-color: var(--color-background);
			transition: background-color 0.2s ease-in-out;
			transition-delay: 0.32s;
		}

		.${t}:hover > button {
			animation: ${t}_delayed_link 0.2s forwards ease-in-out;
			animation-delay: 0.32s;
		}

		.${t} > button:focus-visible {
			opacity: 1;
		}
	}


	@keyframes ${t}_delayed_link {
		0% {
			cursor: inherit;
			opacity: .38;
			pointer-events: none;
		}
		100% {
			cursor: pointer;
			opacity: 1;
			pointer-events: all;
		}
	}`;return(0,r.jsx)("style",{nonce:e.options.nonce,children:n})}),$=[],G=[],W=[],Z=(0,a.memo)(function({store:e,components:t,className:n,user:p,options:g,...m}){let[y,b]=(0,a.useState)(null),S=(0,a.useMemo)(()=>p??(0,h.L)(),[p]),k=t?.ErrorFallback===void 0?u.d:t?.ErrorFallback,C={...m,shapeUtils:m.shapeUtils??$,bindingUtils:m.bindingUtils??G,tools:m.tools??W,components:t,options:(0,_.S)(g)};return(0,r.jsx)("div",{ref:b,"data-tldraw":d.i,draggable:!1,className:l("tl-container tl-theme__light",n),onPointerDown:B.be,tabIndex:-1,role:"application","aria-label":g?.branding??"tldraw",children:(0,r.jsx)(c.e,{fallback:k,onError:e=>(0,o.lw)(e,{tags:{origin:"react.tldraw-before-app"}}),children:y&&(0,r.jsx)(LicenseProvider,{licenseKey:m.licenseKey,children:(0,r.jsx)(f.jm,{container:y,children:(0,r.jsx)(v.I,{overrides:t,children:e?e instanceof i.yh?(0,r.jsx)(TldrawEditorWithReadyStore,{...C,store:e,user:S}):(0,r.jsx)(q,{...C,store:e,user:S}):(0,r.jsx)(TldrawEditorWithOwnStore,{...C,store:e,user:S})})})})})})});function TldrawEditorWithOwnStore(e){let{defaultName:t,snapshot:n,initialData:i,shapeUtils:o,bindingUtils:a,persistenceKey:l,sessionId:d,user:c,assets:u,migrations:h}=e,p=(0,C.h)({shapeUtils:o,bindingUtils:a,initialData:i,persistenceKey:l,sessionId:d,defaultName:t,snapshot:n,assets:u,migrations:h});return(0,r.jsx)(q,{...e,store:p,user:c})}let q=(0,a.memo)(function({store:e,user:t,...n}){let i=(0,f.uK)();(0,a.useLayoutEffect)(()=>{"dark"===t.userPreferences.get().colorScheme&&(i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark"))},[i,t]);let{LoadingScreen:o}=(0,v.o)();switch(e.status){case"error":throw e.error;case"loading":return o?(0,r.jsx)(o,{}):null}return(0,r.jsx)(TldrawEditorWithReadyStore,{...n,store:e.store,user:t})}),noAutoFocus=()=>document.location.search.includes("tldraw_preserve_focus");function TldrawEditorWithReadyStore({onMount:e,children:t,store:n,tools:i,shapeUtils:o,bindingUtils:l,user:d,initialState:u,autoFocus:h=!0,inferDarkMode:g,cameraOptions:m,textOptions:y,options:S,licenseKey:k,deepLinks:C,isShapeHidden:M,getShapeVisibility:P,assetUrls:A}){let{ErrorFallback:j}=(0,v.o)(),D=(0,f.uK)(),[B,F]=(0,E.r)(null),O=(0,a.useRef)(null),R=(0,_.S)(!0===C?{}:C),N=(0,a.useRef)({autoFocus:h&&!noAutoFocus(),inferDarkMode:g,initialState:u,cameraOptions:m,deepLinks:R});(0,a.useLayoutEffect)(()=>{N.current={autoFocus:h&&!noAutoFocus(),inferDarkMode:g,initialState:u,cameraOptions:m,deepLinks:R}},[h,g,u,m,R]),(0,a.useLayoutEffect)(()=>{let{autoFocus:e,inferDarkMode:t,initialState:r,cameraOptions:a,deepLinks:c}=N.current,u=new p.M({store:n,shapeUtils:o,bindingUtils:l,tools:i,getContainer:()=>D,user:d,initialState:r,autoFocus:e,inferDarkMode:t,cameraOptions:a,textOptions:y,options:S,licenseKey:k,isShapeHidden:M,getShapeVisibility:P,fontAssetUrls:A?.fonts});return u.updateViewportScreenBounds(O.current??D),c&&(c?.getUrl?u.navigateToDeepLink({...c,url:c.getUrl(u)}):u.navigateToDeepLink(c)),F(u),()=>{u.dispose()}},[l,D,S,o,n,i,d,F,k,M,P,y,A]),(0,a.useLayoutEffect)(()=>{if(B&&R)return B.registerDeepLinkListener(R)},[B,R]),(0,a.useLayoutEffect)(()=>{B&&m&&B.setCameraOptions(m)},[B,m]);let z=(0,a.useSyncExternalStore)((0,a.useCallback)(e=>B?(B.on("crash",e),()=>B.off("crash",e)):()=>{},[B]),()=>B?.getCrashingError()??null);(0,a.useEffect)(function(){if(B&&h&&noAutoFocus())return B.getContainer().addEventListener("pointerdown",handleFocusOnPointerDown),document.body.addEventListener("pointerdown",handleBlurOnPointerDown),()=>{B.getContainer()?.removeEventListener("pointerdown",handleFocusOnPointerDown),document.body.removeEventListener("pointerdown",handleBlurOnPointerDown)};function handleFocusOnPointerDown(){B&&B.focus()}function handleBlurOnPointerDown(){B&&B.blur()}},[B,h]);let[$,G]=(0,a.useState)(null),W=$;B!==W?.editor&&(W=null),(0,a.useEffect)(()=>{if(!B)return;let e=!1;return G({editor:B,isLoaded:!1}),B.fonts.loadRequiredFontsForCurrentPage(B.options.maxFontsToLoadBeforeRender).finally(()=>{e||G({editor:B,isLoaded:!0})}),()=>{e=!0}},[B]);let{Canvas:Z,LoadingScreen:q}=(0,v.o)();return B&&W?.isLoaded?(0,r.jsx)(c.e,{fallback:j,onError:e=>B.annotateError(e,{origin:"react.tldraw",willCrashApp:!0}),children:z?(0,r.jsx)(Crash,{crashingError:z}):(0,r.jsx)(b.KU,{editor:B,children:(0,r.jsxs)(Layout,{onMount:e,children:[t??(Z?(0,r.jsx)(Z,{},B.contextId):null),(0,r.jsx)(L,{})]})})}):(0,r.jsxs)(r.Fragment,{children:[q&&(0,r.jsx)(q,{}),(0,r.jsx)("div",{className:"tl-canvas",ref:O})]})}function Layout({children:e,onMount:t}){return!function(){let e=(0,b.jE)(),t=(0,f.uK)();a.useEffect(()=>{let setScale=e=>t.style.setProperty("--tl-zoom",e.toString()),n=(0,o.Ds)(setScale,100),r=new M.R0("useZoomCss",()=>{let t=e.getCurrentPageShapeIds().size;t<300?setScale(e.getZoomLevel()):n(e.getZoomLevel())});return r.attach(),r.execute(),()=>{r.detach(),n.cancel()}},[e,t])}(),(0,g.j)(),!function(){let e=(0,b.jE)(),t=(0,f.uK)(),n=(0,S.G)(),r=(0,m.Hg)(y.hR.forceSrgb);a.useEffect(()=>{n?(t.setAttribute("data-color-mode","dark"),t.classList.remove("tl-theme__light"),t.classList.add("tl-theme__dark")):(t.setAttribute("data-color-mode","light"),t.classList.remove("tl-theme__dark"),t.classList.add("tl-theme__light")),r?t.classList.add("tl-theme__force-sRGB"):t.classList.remove("tl-theme__force-sRGB")},[e,t,r,n])}(),!function(){let[e,t]=(0,a.useState)(0);(0,a.useEffect)(()=>t(e=>e+1),[])}(),useOnMount(e=>{let n=e.store.props.onMount(e),r=t?.(e);return()=>{n?.(),r?.()}}),e}function Crash({crashingError:e}){throw e}function LoadingScreen({children:e}){return(0,r.jsx)("div",{className:"tl-loading","aria-busy":"true",tabIndex:0,children:e})}function ErrorScreen({children:e}){return(0,r.jsx)("div",{className:"tl-loading",children:e})}function useOnMount(e){let t=(0,b.jE)(),n=(0,k.z)(t=>{let n;return t.run(()=>{n=e?.(t),t.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,n});a.useLayoutEffect(()=>{if(t)return n?.(t)},[t,n])}},24519:function(e,t,n){"use strict";n.d(t,{S:function(){return ErrorBoundary},e:function(){return OptionalErrorBoundary}});var r=n(57437),i=n(2265);let o={error:null};let ErrorBoundary=class ErrorBoundary extends i.Component{static getDerivedStateFromError(e){return{error:e}}state=o;componentDidCatch(e){this.props.onError?.(e)}render(){let{error:e}=this.state;if(null!==e){let{fallback:t}=this.props;return(0,r.jsx)(t,{error:e})}return this.props.children}};function OptionalErrorBoundary({children:e,fallback:t,...n}){return null===t?e:(0,r.jsx)(ErrorBoundary,{fallback:t,...n,children:e})}},60942:function(e,t,n){"use strict";n.d(t,{L:function(){return MenuClickCapture}});var r=n(57437),i=n(30742),o=n(2265),a=n(17910),l=n(3373),d=n(14204);function MenuClickCapture(){let e=(0,l.jE)(),t=(0,i.Hg)("is menu open",()=>e.menus.hasAnyOpenMenus(),[e]),[n,c]=(0,o.useState)(!1),u=(0,a.I)(),h=(0,o.useRef)({isDown:!1,isDragging:!1,start:new d.B}),p=(0,o.useCallback)(t=>{0===t.button&&(c(!0),h.current={isDown:!0,isDragging:!1,start:new d.B(t.clientX,t.clientY)}),e.menus.clearOpenMenus()},[e]),f=(0,o.useCallback)(t=>{if(h.current.isDown){if(h.current.isDragging){u.onPointerMove?.(t);return}if(d.B.Dist2(h.current.start,new d.B(t.clientX,t.clientY))>e.options.dragDistanceSquared){h.current={...h.current,isDown:!0,isDragging:!0};let{x:e,y:n}=h.current.start;u.onPointerDown?.({...t,clientX:e,clientY:n,button:0}),u.onPointerMove?.(t)}}},[u,e]),g=(0,o.useCallback)(e=>{u.onPointerUp?.(e),c(!1),h.current={isDown:!1,isDragging:!1,start:new d.B(e.clientX,e.clientY)}},[u]);return(t||n)&&(0,r.jsx)("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...u,onPointerDown:p,onPointerMove:f,onPointerUp:g})}},17295:function(e,t,n){"use strict";n.d(t,{g:function(){return SVGContainer}});var r=n(57437),i=n(42744);function SVGContainer({children:e,className:t="",...n}){return(0,r.jsx)("svg",{...n,className:i("tl-svg-container",t),"aria-hidden":"true",children:e})}},62673:function(e,t,n){"use strict";n.d(t,{bn:function(){return f},cv:function(){return g},t8:function(){return m}});var r=n(57437),i=n(31316),o=n(30742),a=n(2265),l=n(3373),d=n(76413),c=n(45404),u=n(20047),h=n(77700),p=n(24519);let f=(0,a.memo)(function({id:e,shape:t,util:n,index:u,backgroundIndex:f,opacity:y,dprMultiple:b}){let S=(0,l.jE)(),{ShapeErrorFallback:v}=(0,d.o)(),k=(0,a.useRef)(null),_=(0,a.useRef)(null);(0,a.useEffect)(()=>(0,i.Ym)("load fonts",()=>{let t=S.fonts.getShapeFontFaces(e);S.fonts.requestFonts(t)}),[S,e]);let C=(0,a.useRef)({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});(0,o.BK)("set shape stuff",()=>{let t=S.getShape(e);if(!t)return;let n=C.current,r=S.getShapeClipPath(e)??"none";r!==n.clipPath&&((0,h.U0)(k.current,"clip-path",r),(0,h.U0)(_.current,"clip-path",r),n.clipPath=r);let i=S.getShapePageTransform(e),o=c._.toCssString(i),a=S.getShapeGeometry(t).bounds;o!==n.transform&&((0,h.U0)(k.current,"transform",o),(0,h.U0)(_.current,"transform",o),n.transform=o);let l=a.w%b,d=a.h%b,u=0===l?a.w:a.w+(b-l),p=0===d?a.h:a.h+(b-d);(u!==n.width||p!==n.height)&&((0,h.U0)(k.current,"width",Math.max(u,b)+"px"),(0,h.U0)(k.current,"height",Math.max(p,b)+"px"),(0,h.U0)(_.current,"width",Math.max(u,b)+"px"),(0,h.U0)(_.current,"height",Math.max(p,b)+"px"),n.width=u,n.height=p)},[S]),(0,a.useLayoutEffect)(()=>{let e=k.current,t=_.current;(0,h.U0)(e,"opacity",y),(0,h.U0)(t,"opacity",y),(0,h.U0)(e,"z-index",u),(0,h.U0)(t,"z-index",f)},[y,u,f]),(0,o.BK)("set display",()=>{let t=S.getShape(e);if(!t)return;let n=S.getCulledShapes(),r=n.has(e);r!==C.current.isCulled&&((0,h.U0)(k.current,"display",r?"none":"block"),(0,h.U0)(_.current,"display",r?"none":"block"),C.current.isCulled=r)},[S]);let E=(0,a.useCallback)(e=>S.annotateError(e,{origin:"shape",willCrashApp:!1}),[S]);if(!t)return null;let M="fill"in t.props&&"none"!==t.props.fill;return(0,r.jsxs)(r.Fragment,{children:[n.backgroundComponent&&(0,r.jsx)("div",{ref:_,className:"tl-shape tl-shape-background","data-shape-type":t.type,"data-shape-id":t.id,draggable:!1,children:(0,r.jsx)(p.e,{fallback:v,onError:E,children:(0,r.jsx)(m,{shape:t,util:n})})}),(0,r.jsx)("div",{ref:k,className:"tl-shape","data-shape-type":t.type,"data-shape-is-filled":M,"data-shape-id":t.id,draggable:!1,children:(0,r.jsx)(p.e,{fallback:v,onError:E,children:(0,r.jsx)(g,{shape:t,util:n})})})]})}),g=(0,a.memo)(function({shape:e,util:t}){return(0,o.uC)("InnerShape:"+e.type,()=>t.component(t.editor.store.unsafeGetWithoutCapture(e.id)),[t,e.id])},(e,t)=>(0,u.e)(e.shape,t.shape)&&e.util===t.util),m=(0,a.memo)(function({shape:e,util:t}){return(0,o.uC)("InnerShape:"+e.type,()=>t.backgroundComponent?.(t.editor.store.unsafeGetWithoutCapture(e.id)),[t,e.id])},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta&&e.util===t.util)},40255:function(e,t,n){"use strict";n.d(t,{d:function(){return DefaultBackground}});var r=n(57437);function DefaultBackground(){return(0,r.jsx)("div",{className:"tl-background"})}},36067:function(e,t,n){"use strict";n.d(t,{o:function(){return DefaultBrush}});var r=n(57437),i=n(2265),o=n(68576),a=n(46166);let DefaultBrush=({brush:e,color:t,opacity:n,className:l})=>{let d=(0,i.useRef)(null);(0,o.H)(d,e.x,e.y);let c=(0,a.$Z)(Math.max(1,e.w)),u=(0,a.$Z)(Math.max(1,e.h));return(0,r.jsx)("svg",{className:"tl-overlays__item",ref:d,"aria-hidden":"true",children:t?(0,r.jsxs)("g",{className:"tl-brush",opacity:n,children:[(0,r.jsx)("rect",{width:c,height:u,fill:t,opacity:.75}),(0,r.jsx)("rect",{width:c,height:u,fill:"none",stroke:t,opacity:.1})]}):(0,r.jsx)("rect",{className:`tl-brush tl-brush__default ${l}`,width:c,height:u})})}},79548:function(e,t,n){"use strict";let r;n.d(t,{o:function(){return DefaultCanvas}});var i=n(57437),o=n(31316),a=n(30742),l=n(70938),d=n(42744),c=n(2265),u=n(49894),h=n(17910),p=n(3373),f=n(45827),g=n(77700),m=n(25689);function areShortcutsDisabled(e){return e.menus.hasOpenMenus()||(0,g.hZ)()}var y=n(76413);let b=["textarea","input"],S={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function rubberband(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function rubberbandIfOutOfBounds(e,t,n,r=.15){return 0===r?Math.max(t,Math.min(e,n)):e<t?-rubberband(t-e,n-t,r)+t:e>n?+rubberband(e-n,n-t,r)+n:e}function _defineProperty(e,t,n){var r;return(t="symbol"==typeof(r=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let v={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function capitalize(e){return e?e[0].toUpperCase()+e.slice(1):""}let k=["enter","leave"],_=["gotpointercapture","lostpointercapture"];function isTouch(e){return"touches"in e}function distanceAngle(e,t){try{let n=t.clientX-e.clientX,r=t.clientY-e.clientY,i=(t.clientX+e.clientX)/2,o=(t.clientY+e.clientY)/2;return{angle:-(180*Math.atan2(n,r))/Math.PI,distance:Math.hypot(n,r),origin:[i,o]}}catch(e){}return null}function touchDistanceAngle(e,t){let[n,r]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return distanceAngle(n,r)}function wheelValues(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return 1===r?(t*=40,n*=40):2===r&&(t*=800,n*=800),[t,n]}function call(e,...t){return"function"==typeof e?e(...t):e}function noop(){}function assignDefault(e,t){return Object.assign({},t,e||{})}let Engine=class Engine{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){let t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?call(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){let t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){let e=this.state;e._initial=e._values,e.initial=e.values}compute(e){let{state:t,config:n,shared:r}=this;t.args=this.args;let i=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,function(e){let t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){let{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return t}(e)),r.down=r.pressed=r.buttons%2==1||r.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){let e=t._delta.map(Math.abs);S.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);let[o,a]=t._movement,[l,d]=n.threshold,{_step:c,values:u}=t;if(n.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(o)>=l&&u[0]),!1===c[1]&&(c[1]=Math.abs(a)>=d&&u[1])):(!1===c[0]&&(c[0]=Math.abs(o)>=l&&Math.sign(o)*l),!1===c[1]&&(c[1]=Math.abs(a)>=d&&Math.sign(a)*d)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;let h=[0,0];if(n.hasCustomTransform){let[e,t]=u;h[0]=!1!==c[0]?e-c[0]:0,h[1]=!1!==c[1]?t-c[1]:0}else h[0]=!1!==c[0]?o-c[0]:0,h[1]=!1!==c[1]?a-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);let p=t.offset,f=t._active&&!t._blocked||t.active;f&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=call(n.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));let[g,m]=t.offset,[[y,b],[v,k]]=t._bounds;t.overflow=[g<y?-1:g>b?1:0,m<v?-1:m>k?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);let _=t._active&&n.rubberband||[0,0];if(t.offset=function(e,[t,n],[r,i]){let[[o,a],[l,d]]=e;return[rubberbandIfOutOfBounds(t,o,a,r),rubberbandIfOutOfBounds(n,l,d,i)]}(t._bounds,t.offset,_),t.delta=S.sub(t.offset,p),this.computeMovement(),f&&(!t.last||i>32)){t.delta=S.sub(t.offset,p);let e=t.delta.map(Math.abs);S.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[e[0]/i,e[1]/i],t.timeDelta=i)}}emit(){let e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;let r=this.handler(_objectSpread2(_objectSpread2(_objectSpread2({},t),e),{},{[this.aliasKey]:e.values}));void 0!==r&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}};let CoordinatesEngine=class CoordinatesEngine extends Engine{constructor(...e){super(...e),_defineProperty(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=S.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=S.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){let t=this.state,n=this.config;if(!t.axis&&e){let r="object"==typeof n.axisThreshold?n.axisThreshold[isTouch(e)?"touch":"pointerType"in e?e.pointerType:"mouse"]:n.axisThreshold;t.axis=function([e,t],n){let r=Math.abs(e),i=Math.abs(t);return r>i&&r>n?"x":i>r&&i>n?"y":void 0}(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}};let identity=e=>e,C={enabled:(e=!0)=>e,eventOptions:(e,t,n)=>_objectSpread2(_objectSpread2({},n.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return S.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?S.toVector(e):void 0,transform(e,t,n){let r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||identity},threshold:e=>S.toVector(e,0)},E=0,M=_objectSpread2(_objectSpread2({},C),{},{axis(e,t,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(e=E)=>e,bounds(e={}){if("function"==typeof e)return t=>M.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;let{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=e;return[[t,n],[r,i]]}}),P="undefined"!=typeof window&&window.document&&window.document.createElement;function supportsTouchEvents(){return P&&"ontouchstart"in window}let A={isBrowser:P,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:supportsTouchEvents(),touchscreen:supportsTouchEvents()||P&&window.navigator.maxTouchPoints>1,pointer:P&&"onpointerdown"in window,pointerLock:P&&"exitPointerLock"in window.document},j=10,D={mouse:0,touch:0,pen:8};function clampStateInternalMovementToBounds(e){let[t,n]=e.overflow,[r,i]=e._delta,[o,a]=e._direction;(t<0&&r>0&&o<0||t>0&&r<0&&o>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&i>0&&a<0||n>0&&i<0&&a>0)&&(e._movement[1]=e._movementBound[1])}_objectSpread2(_objectSpread2({},M),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return(this.pointerLock=r&&A.pointerLock,A.touch&&n)?"touch":this.pointerLock?"mouse":A.pointer&&!i?"pointer":A.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&e?250:void 0,A.touchscreen&&!1!==n)return e||(void 0!==n?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:i}){let o=S.toVector(e,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:e=.5,distance:t=50,duration:n=250}={}){return{velocity:this.transform(S.toVector(e)),distance:this.transform(S.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?_objectSpread2(_objectSpread2({},D),e):D,keyboardDisplacement:(e=j)=>e});let B=_objectSpread2(_objectSpread2({},C),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!A.touch&&A.gesture)return"gesture";if(A.touch&&r)return"touch";if(A.touchscreen){if(A.pointer)return"pointer";if(A.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){let _scaleBounds=e=>{let t=assignDefault(call(n,e),{min:-1/0,max:1/0});return[t.min,t.max]},_angleBounds=e=>{let t=assignDefault(call(r,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof n&&"function"!=typeof r?[_scaleBounds(),_angleBounds()]:e=>[_scaleBounds(e),_angleBounds(e)]},threshold(e,t,n){this.lockDirection="lock"===n.axis;let r=S.toVector(e,this.lockDirection?[.1,3]:0);return r},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});_objectSpread2(_objectSpread2({},M),{},{mouseOnly:(e=!0)=>e}),_objectSpread2(_objectSpread2({},M),{},{mouseOnly:(e=!0)=>e});let F=new Map,O=new Map,R={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=A.isBrowser?window:void 0)=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},L=["target","eventOptions","window","enabled","transform"];function resolveWith(e={},t){let n={};for(let[r,i]of Object.entries(t))switch(typeof i){case"function":n[r]=i.call(n,e[r],r,e);break;case"object":n[r]=resolveWith(e[r],i);break;case"boolean":i&&(n[r]=e[r])}return n}let EventStore=class EventStore{constructor(e,t){_defineProperty(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,i){let o=this._listeners,a=function(e,t=""){let n=v[e],r=n&&n[t]||t;return e+r}(t,n),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},d=_objectSpread2(_objectSpread2({},l),i);e.addEventListener(a,r,d);let remove=()=>{e.removeEventListener(a,r,d),o.delete(remove)};return o.add(remove),remove}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}};let TimeoutStore=class TimeoutStore{constructor(){_defineProperty(this,"_timeouts",new Map)}add(e,t,n=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){let t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}};let Controller=class Controller{constructor(e){_defineProperty(this,"gestures",new Set),_defineProperty(this,"_targetEventStore",new EventStore(this)),_defineProperty(this,"gestureEventStores",{}),_defineProperty(this,"gestureTimeoutStores",{}),_defineProperty(this,"handlers",{}),_defineProperty(this,"config",{}),_defineProperty(this,"pointerIds",new Set),_defineProperty(this,"touchIds",new Set),_defineProperty(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),e.drag&&setupGesture(this,"drag"),e.wheel&&setupGesture(this,"wheel"),e.scroll&&setupGesture(this,"scroll"),e.move&&setupGesture(this,"move"),e.pinch&&setupGesture(this,"pinch"),e.hover&&setupGesture(this,"hover")}setEventIds(e){return isTouch(e)?(this.touchIds=new Set(Array.from(e.touches).filter(t=>{var n,r;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,t.target))}).map(e=>e.identifier)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,n={}){let{target:r,eventOptions:i,window:o,enabled:a,transform:l}=e,d=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,L);if(n.shared=resolveWith({target:r,eventOptions:i,window:o,enabled:a,transform:l},R),t){let e=O.get(t);n[t]=resolveWith(_objectSpread2({shared:n.shared},d),e)}else for(let e in d){let t=O.get(e);t&&(n[e]=resolveWith(_objectSpread2({shared:n.shared},d[e]),t))}return n}(e,t,this.config)}clean(){for(let e of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){let t;let n=this.config.shared,r={};if(!n.target||(t=n.target())){if(n.enabled){for(let n of this.gestures){let i=this.config[n],o=bindToProps(r,i.eventOptions,!!t);if(i.enabled){let t=F.get(n);new t(this,e,n).bind(o)}}let i=bindToProps(r,n.eventOptions,!!t);for(let t in this.nativeHandlers)i(t,"",n=>this.nativeHandlers[t](_objectSpread2(_objectSpread2({},this.state.shared),{},{event:n,args:e})),void 0,!0)}for(let e in r)r[e]=function(...e){return 0===e.length?noop:1===e.length?e[0]:function(){let t;for(let n of e)t=n.apply(this,arguments)||t;return t}}(...r[e]);if(!t)return r;for(let e in r){let{device:n,capture:i,passive:o}=function(e){let t=e.substring(2).toLowerCase(),n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));let r=_.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(r);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:n}}(e);this._targetEventStore.add(t,n,"",r[e],{capture:i,passive:o})}}}};function setupGesture(e,t){e.gestures.add(t),e.gestureEventStores[t]=new EventStore(e,t),e.gestureTimeoutStores[t]=new TimeoutStore}let bindToProps=(e,t,n)=>(r,i,o,a={},l=!1)=>{var d,c;let u=null!==(d=a.capture)&&void 0!==d?d:t.capture,h=null!==(c=a.passive)&&void 0!==c?c:t.passive,p=l?r:function(e,t="",n=!1){let r=v[e],i=r&&r[t]||t;return"on"+capitalize(e)+capitalize(i)+(!function(e=!1,t){return e&&!k.includes(t)}(n,i)?"":"Capture")}(r,i,u);n&&h&&(p+="Passive"),e[p]=e[p]||[],e[p].push(o)},N=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function registerGesture(e,t,n,r,i,o){if(!e.has(n)||!F.has(r))return;let a=n+"Start",l=n+"End";i[r]=e=>{let r;return e.first&&a in t&&t[a](e),n in t&&(r=t[n](e)),e.last&&l in t&&t[l](e),r},o[r]=o[r]||{}}n(62729);var z=n(14204),$=n(77744);let G=([{key:"wheel",engine:class extends CoordinatesEngine{constructor(...e){super(...e),_defineProperty(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){let t=this.state;t._delta=wheelValues(e),S.addTo(t._movement,t._delta),clampStateInternalMovementToBounds(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}},resolver:M},{key:"pinch",engine:class extends Engine{constructor(...e){super(...e),_defineProperty(this,"ingKey","pinching"),_defineProperty(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){let{type:e,movement:t,lastOffset:n}=this.state;"wheel"===e?this.state.offset=S.add(t,n):this.state.offset=[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){let{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){let e=this.state,[t,n]=e._movement;if(!e.axis){let r=30*Math.abs(t)-Math.abs(n);r<0?e.axis="angle":r>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){let e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);let t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>n.has(e))||n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);let r=touchDistanceAngle(e,t._touchIds);r&&this.pinchStart(e,r)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);let t=this.state,n=t._pointerEvents,r=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every(e=>r.has(e))||(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);let i=distanceAngle(...Array.from(n.values()));i&&this.pinchStart(e,i)}pinchStart(e,t){let n=this.state;n.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;let t=touchDistanceAngle(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){let t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;let n=distanceAngle(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){let n=this.state,r=n._values[1],i=t.angle-r,o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([t.distance,t.angle-360*o]),n.origin=t.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){let t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(e){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();let t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;let t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];let n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=S.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){let t=this.config.modifierKey;(!t||(Array.isArray(t)?t.find(t=>e[t]):e[t]))&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){let t="uv"in e;!t&&e.cancelable&&e.preventDefault();let n=this.state;n._delta=[-wheelValues(e)[1]/100*n.offset[0],0],S.addTo(n._movement,n._delta),clampStateInternalMovementToBounds(n),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){let t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:B}].forEach(function(e){F.set(e.key,e.engine),O.set(e.key,e.resolver)}),function(e,t){let{handlers:n,nativeHandlers:r,config:i}=function(e,t){let[n,r,i]=function(e){let t={},n={},r=new Set;for(let i in e)N.test(i)?(r.add(RegExp.lastMatch),n[i]=e[i]):t[i]=e[i];return[n,t,r]}(e),o={};return registerGesture(i,n,"onDrag","drag",o,t),registerGesture(i,n,"onWheel","wheel",o,t),registerGesture(i,n,"onScroll","scroll",o,t),registerGesture(i,n,"onPinch","pinch",o,t),registerGesture(i,n,"onMove","move",o,t),registerGesture(i,n,"onHover","hover",o,t),{handlers:o,config:t,nativeHandlers:r}}(e,t||{});return function(e,t={},n,r){let i=c.useMemo(()=>new Controller(e),[]);if(i.applyHandlers(e,r),i.applyConfig(t,n),c.useEffect(i.effect.bind(i)),c.useEffect(()=>i.clean.bind(i),[]),void 0===t.target)return i.bind.bind(i)}(n,i,void 0,r)}),isWheelEndEvent=e=>void 0===r?(r=e,!1):e-r>120&&e-r<160?(r=e,!0):(r=e,!1);var W=n(49065);function getHandle(e,t,n){let r=e.getShape(t),i=e.getShapeHandles(r);return{shape:r,handle:i.find(e=>e.id===n)}}var Z=n(91496);/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */let getNearestScrollableContainer=e=>{let t=e.parentElement;for(;t&&t!==document.body;){let{overflowY:e}=window.getComputedStyle(t),n=t.scrollHeight>t.clientHeight;if(n&&("auto"===e||"scroll"===e||"overlay"===e))return t;t=t.parentElement}return document};var q=n(45404),Y=n(46166),X=n(16384);function nearestMultiple(e){let t=e.toString().split(".")[1];if(!t)return 1;let n=Math.pow(10,t.length),r=parseInt(t,10);return n/function gcd(e,t){return 0===t?e:gcd(t,e%t)}(r,n)}var Q=n(87684);let ee=(0,a.j)(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:n=!0}){let r=(0,p.jE)();!function(e=!0){let[t,n]=(0,c.useState)(0),r=(0,p.jE)();(0,c.useEffect)(()=>{if(!e)return;let update=()=>n(e=>e+1);return r.on("tick",update),()=>{r.off("tick",update)}},[r,e])}(n);let o=r.getZoomLevel(),a=r.getRenderingShapes(),{inputs:{currentPagePoint:d}}=r;return(0,i.jsx)("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:a.map(a=>{let c=r.getShape(a.id);if("group"===c.type)return null;let u=r.getShapeGeometry(c),h=r.getShapePageTransform(c),p=r.getPointInShapeSpace(c,d),f=u.nearestPoint(p),g=u.distanceToPoint(p,!0),m=Math.abs(g)*o,{vertices:y}=u;return(0,i.jsxs)("g",{transform:h.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&(0,i.jsx)("g",{stroke:u.debugColor??"red",opacity:"1",strokeWidth:2/o,fill:"none",children:(0,i.jsx)(GeometryStroke,{geometry:u})}),t&&y.map((e,t)=>(0,i.jsx)("circle",{cx:e.x,cy:e.y,r:2/o,fill:`hsl(${(0,l.vm)(t,[0,y.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/o},`v${t}`)),n&&m<150&&(0,i.jsx)("line",{x1:f.x,y1:f.y,x2:p.x,y2:p.y,opacity:1-m/150,stroke:g<0?"goldenrod":"dodgerblue",strokeWidth:2/o})]},a.id+"_outline")})})});function GeometryStroke({geometry:e}){return e instanceof Q.m?(0,i.jsx)("g",{stroke:e.debugColor,children:[...e.children,...e.ignoredChildren].map((e,t)=>(0,i.jsx)(GeometryStroke,{geometry:e},t))}):(0,i.jsx)("path",{d:e.toSimpleSvgPath(),stroke:e.debugColor})}var et=n(27359),en=n(80730);let er=(0,a.j)(function(){let e=(0,et.k)();return e.map(e=>(0,i.jsx)(ei,{collaboratorId:e},e))}),ei=(0,a.j)(function({collaboratorId:e}){let t=(0,p.jE)(),n=(0,en.o)(e),r=function(e,t){let n=(0,c.useRef)(t?.lastActivityTimestamp??-1),[r,i]=(0,c.useState)(()=>getStateFromElapsedTime(e,Date.now()-n.current));return(0,c.useEffect)(()=>{let t=e.timers.setInterval(()=>{i(getStateFromElapsedTime(e,Date.now()-n.current))},e.options.collaboratorCheckIntervalMs);return()=>clearInterval(t)},[e]),t&&(n.current=t.lastActivityTimestamp??1/0),r}(t,n);if(!(n&&n.currentPageId===t.getCurrentPageId()))return null;switch(r){case"inactive":{let{followingUserId:e,highlightedUserIds:r}=t.getInstanceState();if(!(e===n.userId||r.includes(n.userId)))return null;break}case"idle":{let{highlightedUserIds:e}=t.getInstanceState();if(n.followingUserId===t.user.getId()&&!(n.chatMessage||e.includes(n.userId)))return null}}return(0,i.jsx)(eo,{latestPresence:n})}),eo=(0,a.j)(function({latestPresence:e}){let t=(0,p.jE)(),{CollaboratorBrush:n,CollaboratorScribble:r,CollaboratorCursor:o,CollaboratorHint:a,CollaboratorShapeIndicator:l}=(0,y.o)(),d=t.getZoomLevel(),c=t.getViewportPageBounds(),{userId:u,chatMessage:h,brush:f,scribbles:g,selectedShapeIds:m,userName:b,cursor:S,color:v}=e;if(!S)return null;let k=!(S.x<c.minX-12/d||S.y<c.minY-16/d||S.x>c.maxX-12/d||S.y>c.maxY-16/d);return(0,i.jsxs)(i.Fragment,{children:[f&&n?(0,i.jsx)(n,{className:"tl-collaborator__brush",userId:u,brush:f,color:v,opacity:.1},u+"_brush"):null,k&&o?(0,i.jsx)(o,{className:"tl-collaborator__cursor",userId:u,point:S,color:v,zoom:d,name:"New User"!==b?b:null,chatMessage:h??""},u+"_cursor"):a?(0,i.jsx)(a,{className:"tl-collaborator__cursor-hint",userId:u,point:S,color:v,zoom:d,viewport:c},u+"_cursor_hint"):null,r&&g.length?(0,i.jsx)(i.Fragment,{children:g.map(e=>(0,i.jsx)(r,{className:"tl-collaborator__scribble",userId:u,scribble:e,color:v,zoom:d,opacity:"laser"===e.color?.5:.1},u+"_scribble_"+e.id))}):null,l&&m.filter(e=>!t.isShapeHidden(e)).map(e=>(0,i.jsx)(l,{className:"tl-collaborator__shape-indicator",userId:u,shapeId:e,color:v,opacity:.5},u+"_"+e))]})});function getStateFromElapsedTime(e,t){return t>e.options.collaboratorInactiveTimeoutMs?"inactive":t>e.options.collaboratorIdleTimeoutMs?"idle":"active"}var ea=n(60942),es=n(62673);function DefaultCanvas({className:e}){let t=(0,p.jE)(),{SelectionBackground:n,Background:r,SvgDefs:o,ShapeIndicators:S}=(0,y.o)(),v=(0,c.useRef)(null),k=(0,c.useRef)(null),_=(0,c.useRef)(null),C=(0,f.uK)();!function(e){let t=(0,p.jE)();(0,c.useLayoutEffect)(()=>{let n=(0,l.P2)(()=>{e.current&&t.updateViewportScreenBounds(e.current)},200,{trailing:!0}),r=t.timers.setInterval(n,1e3);window.addEventListener("resize",n);let i=new ResizeObserver(e=>{e[0].contentRect&&n()}),o=e.current,a=null;return o&&(i.observe(o),(a=getNearestScrollableContainer(o)).addEventListener("scroll",n)),()=>{clearInterval(r),window.removeEventListener("resize",n),i.disconnect(),a?.removeEventListener("scroll",n),n.cancel()}},[t,e])}(v),function(){let e=(0,p.jE)(),t=(0,f.uK)(),n=(0,a.Hg)("isEditing",()=>e.getEditingShapeId(),[e]),r=(0,a.Hg)("isFocused",()=>e.getIsFocused(),[e]);(0,c.useEffect)(()=>{if(t)return t.addEventListener("dragover",onDrop),t.addEventListener("drop",onDrop),()=>{t.removeEventListener("dragover",onDrop),t.removeEventListener("drop",onDrop)};function onDrop(e){if(e.isSpecialRedispatchedEvent)return;(0,g.PF)(e),(0,g.be)(e);let n=t.querySelector(".tl-canvas");if(!n)return;let r=new DragEvent(e.type,e);r.isSpecialRedispatchedEvent=!0,n.dispatchEvent(r)}},[t]),(0,c.useEffect)(()=>{if("undefined"==typeof window||!("matchMedia"in window))return;let t=null,updatePixelRatio=()=>{null!=t&&t();let n=`(resolution: ${window.devicePixelRatio}dppx)`,r=matchMedia(n),safariCb=e=>{"change"===e.type&&updatePixelRatio()};r.addEventListener?r.addEventListener("change",updatePixelRatio):r.addListener&&r.addListener(safariCb),t=()=>{r.removeEventListener?r.removeEventListener("change",updatePixelRatio):r.removeListener&&r.removeListener(safariCb)},e.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return updatePixelRatio(),()=>{t?.()}},[e]),(0,c.useEffect)(()=>{if(!r)return;let handleKeyDown=r=>{if(r.altKey&&(e.isIn("zoom")||!e.getPath().endsWith(".idle"))&&!areShortcutsDisabled(e)&&(0,g.PF)(r),r.isKilled)return;r.isKilled=!0;let i=!!e.getSelectedShapeIds().length;switch(r.key){case"=":case"-":case"0":if(r.metaKey||r.ctrlKey){(0,g.PF)(r);return}break;case"Tab":if(areShortcutsDisabled(e))return;i&&!n&&(0,g.PF)(r);break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(areShortcutsDisabled(e))return;i&&(r.metaKey||r.ctrlKey)&&(0,g.PF)(r);break;case",":return;case"Escape":if((e.getEditingShape()||e.getSelectedShapeIds().length>0)&&(0,g.PF)(r),e.menus.getOpenMenus().length>0)return;e.inputs.keys.has("Escape")||(e.inputs.keys.add("Escape"),e.cancel(),t.focus());return;default:if(areShortcutsDisabled(e))return}let o={type:"keyboard",name:r.repeat?"key_repeat":"key_down",key:r.key,code:r.code,shiftKey:r.shiftKey,altKey:r.altKey,ctrlKey:r.metaKey||r.ctrlKey,metaKey:r.metaKey,accelKey:(0,m.q)(r)};e.dispatch(o)},handleKeyUp=t=>{if(t.isKilled||(t.isKilled=!0,areShortcutsDisabled(e)||","===t.key))return;let n={type:"keyboard",name:"key_up",key:t.key,code:t.code,shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,metaKey:t.metaKey,accelKey:(0,m.q)(t)};e.dispatch(n)};function handleTouchStart(n){if(t.contains(n.target)){let t=n.touches[0].pageX,r=n.touches[0].radiusX||0;(t-r<10||t+r>e.getViewportScreenBounds().width-10)&&(n.target?.tagName==="BUTTON"&&n.target?.click(),(0,g.PF)(n))}}let handleWheel=e=>{t.contains(e.target)&&(e.ctrlKey||e.metaKey)&&(0,g.PF)(e)};return t.addEventListener("touchstart",handleTouchStart,{passive:!1}),t.addEventListener("wheel",handleWheel,{passive:!1}),document.addEventListener("gesturestart",g.PF),document.addEventListener("gesturechange",g.PF),document.addEventListener("gestureend",g.PF),t.addEventListener("keydown",handleKeyDown),t.addEventListener("keyup",handleKeyUp),()=>{t.removeEventListener("touchstart",handleTouchStart),t.removeEventListener("wheel",handleWheel),document.removeEventListener("gesturestart",g.PF),document.removeEventListener("gesturechange",g.PF),document.removeEventListener("gestureend",g.PF),t.removeEventListener("keydown",handleKeyDown),t.removeEventListener("keyup",handleKeyUp)}},[e,t,r,n])}(),function(){let e=(0,p.jE)();(0,c.useEffect)(()=>{let t=e.getInstanceState().isCoarsePointer,handlePointerDown=n=>{let r="mouse"!==n.pointerType;t!==r&&(t=r,e.updateInstanceState({isCoarsePointer:r}))};window.addEventListener("pointerdown",handlePointerDown,{capture:!0});let n=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),r=u.a.isFirefox&&!u.a.isAndroid&&!u.a.isIos,handleMediaQueryChange=()=>{let i=!r&&n.matches;t===i&&(t=i,e.updateInstanceState({isCoarsePointer:i}))};return n&&(n.addEventListener("change",handleMediaQueryChange),handleMediaQueryChange()),()=>{window.removeEventListener("pointerdown",handlePointerDown,{capture:!0}),n&&n.removeEventListener("change",handleMediaQueryChange)}},[e])}(),function(e){let t=(0,p.jE)(),n=c.useMemo(()=>{let n="not sure",r=1,i=1,o=0,a=new z.B,l=new z.B,updatePinchState=e=>{if(e&&(n="zooming"),"zooming"===n)return;let t=Math.abs(o-r),i=z.B.Dist(a,l);switch(n){case"not sure":t>24?n="zooming":i>16&&(n="panning");break;case"panning":t>64&&(n="zooming")}};return{onWheel:({event:e})=>{if(!t.getInstanceState().isFocused||(n="not sure",isWheelEndEvent(Date.now())))return;let r=t.getEditingShapeId();if(r){let e=t.getShape(r);if(e){let n=t.getShapeUtil(e);if(n.canScroll(e)){let e=t.getShapePageBounds(r);if(e?.containsPoint(t.inputs.currentPagePoint))return}}}(0,g.PF)(e),(0,g.be)(e);let i=(0,$.f)(e);if(0===i.x&&0===i.y)return;let o={type:"wheel",name:"wheel",delta:i,point:new z.B(e.clientX,e.clientY),shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:(0,m.q)(e)};t.dispatch(o)},onPinchStart:o=>{let d=e.current;n="not sure";let{event:c,origin:u,da:h}=o;!(c instanceof WheelEvent)&&(c.target===d||d?.contains(c.target))&&(l.x=u[0],l.y=u[1],a.x=u[0],a.y=u[1],r=h[0],i=t.getZoomLevel(),t.dispatch({type:"pinch",name:"pinch_start",point:{x:u[0],y:u[1],z:t.getZoomLevel()},delta:{x:0,y:0},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:(0,m.q)(c)}))},onPinchEnd:r=>{let i=e.current,{event:o,origin:a,offset:l}=r;if(o instanceof WheelEvent||!(o.target===i||i?.contains(o.target)))return;let d=l[0]**t.getCameraOptions().zoomSpeed;n="not sure",t.timers.requestAnimationFrame(()=>{t.dispatch({type:"pinch",name:"pinch_end",point:{x:a[0],y:a[1],z:d},delta:{x:a[0],y:a[1]},shiftKey:o.shiftKey,altKey:o.altKey,ctrlKey:o.metaKey||o.ctrlKey,metaKey:o.metaKey,accelKey:(0,m.q)(o)})})},onPinch:r=>{let a=e.current,{event:d,origin:c,offset:u,da:h}=r;if(d instanceof WheelEvent||!(d.target===a||a?.contains(d.target)))return;let p="gesturechange"===r.type||"gestureend"===r.type;o=h[0];let f=c[0]-l.x,g=c[1]-l.y;switch(l.x=c[0],l.y=c[1],updatePinchState(p),n){case"zooming":{let e=u[0]**t.getCameraOptions().zoomSpeed;t.dispatch({type:"pinch",name:"pinch",point:{x:c[0],y:c[1],z:e},delta:{x:f,y:g},shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey,metaKey:d.metaKey,accelKey:(0,m.q)(d)});break}case"panning":t.dispatch({type:"pinch",name:"pinch",point:{x:c[0],y:c[1],z:i},delta:{x:f,y:g},shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey,metaKey:d.metaKey,accelKey:(0,m.q)(d)})}}}},[t,e]);G(n,{target:e,eventOptions:{passive:!1},pinch:{from:()=>{let{zoomSpeed:e}=t.getCameraOptions(),n=t.getZoomLevel()**(1/e);return[n,0]},scaleBounds:()=>{let e=t.getBaseZoom(),{zoomSteps:n,zoomSpeed:r}=t.getCameraOptions(),i=n[0]*e,o=n[n.length-1]*e;return{max:o**(1/r),min:i**(1/r)}}}})}(v),function(e){let t=(0,p.jE)();(0,c.useEffect)(()=>{let n=e.current;if(!n)return;let handleEvent=e=>{if(e instanceof PointerEvent&&"pen"===e.pointerType){e.isKilled=!0;let{target:n}=e;b.includes(n.tagName?.toLocaleLowerCase())||n.isContentEditable||t.isIn("select.editing_shape")||(0,g.PF)(e)}};return n.addEventListener("touchstart",handleEvent),n.addEventListener("touchend",handleEvent),()=>{n.removeEventListener("touchstart",handleEvent),n.removeEventListener("touchend",handleEvent)}},[t,e])}(v);let E=(0,c.useRef)({lodDisableTextOutline:!1,allowTextOutline:!0});(0,a.BK)("position layers",function(){let{x:e,y:n,z:r}=t.getCamera();if(E.current.allowTextOutline&&u.a.isSafari&&(C.style.setProperty("--tl-text-outline","none"),E.current.allowTextOutline=!1),E.current.allowTextOutline&&r<t.options.textShadowLod!==E.current.lodDisableTextOutline){let e=r<t.options.textShadowLod;C.style.setProperty("--tl-text-outline",e?"none":"var(--tl-text-outline-reference)"),E.current.lodDisableTextOutline=e}let i=r>=1?(0,l.vm)(r,[1,8],[.125,.5],!0):(0,l.vm)(r,[.1,1],[-2,.125],!0),o=`scale(${(0,Y.$Z)(r)}) translate(${(0,Y.$Z)(e+i)}px,${(0,Y.$Z)(n+i)}px)`;(0,g.U0)(k.current,"transform",o),(0,g.U0)(_.current,"transform",o)},[t,C]);let M=(0,h.I)(),P=(0,a.Hg)("shapeSvgDefs",()=>{let e=new Map;for(let n of(0,l.UM)(t.shapeUtils)){if(!n)return;let t=n.getCanvasSvgDefs();for(let{key:n,component:r}of t)e.has(n)||e.set(n,(0,i.jsx)(r,{},n))}return[...e.values()]},[t]),A=(0,a.Hg)("debug_shapes",()=>X.hR.hideShapes.get(),[X.hR]),j=(0,a.Hg)("debug_svg",()=>X.hR.debugSvg.get(),[X.hR]),D=(0,a.Hg)("debug_geometry",()=>X.hR.debugGeometry.get(),[X.hR]),B=(0,a.Hg)("isEditingAnything",()=>null!==t.getEditingShapeId(),[t]),F=(0,a.Hg)("isSelectingAnything",()=>!!t.getSelectedShapeIds().length,[t]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{ref:v,draggable:!1,"data-iseditinganything":B,"data-isselectinganything":F,className:d("tl-canvas",e),"data-testid":"canvas",...M,children:[(0,i.jsx)("svg",{className:"tl-svg-context","aria-hidden":"true",children:(0,i.jsxs)("defs",{children:[P,(0,i.jsx)(CursorDef,{}),(0,i.jsx)(CollaboratorHintDef,{}),o&&(0,i.jsx)(o,{})]})}),r&&(0,i.jsx)("div",{className:"tl-background__wrapper",children:(0,i.jsx)(r,{})}),(0,i.jsx)(GridWrapper,{}),(0,i.jsxs)("div",{ref:k,className:"tl-html-layer tl-shapes",draggable:!1,children:[(0,i.jsx)(OnTheCanvasWrapper,{}),n&&(0,i.jsx)(SelectionBackgroundWrapper,{}),A?null:j?(0,i.jsx)(ShapesWithSVGs,{}):(0,i.jsx)(ShapesToDisplay,{})]}),(0,i.jsx)("div",{className:"tl-overlays",children:(0,i.jsxs)("div",{ref:_,className:"tl-html-layer",children:[D?(0,i.jsx)(ee,{}):null,(0,i.jsx)(BrushWrapper,{}),(0,i.jsx)(ScribbleWrapper,{}),(0,i.jsx)(ZoomBrushWrapper,{}),S&&(0,i.jsx)(S,{}),(0,i.jsx)(HintedShapeIndicator,{}),(0,i.jsx)(SnapIndicatorWrapper,{}),(0,i.jsx)(SelectionForegroundWrapper,{}),(0,i.jsx)(HandlesWrapper,{}),(0,i.jsx)(OverlaysWrapper,{}),(0,i.jsx)(er,{})]})}),(0,i.jsx)(MovingCameraHitTestBlocker,{})]}),(0,i.jsx)(ea.L,{}),(0,i.jsx)(InFrontOfTheCanvasWrapper,{})]})}function InFrontOfTheCanvasWrapper(){let{InFrontOfTheCanvas:e}=(0,y.o)();return e?(0,i.jsx)(e,{}):null}function GridWrapper(){let e=(0,p.jE)(),t=(0,a.Hg)("gridSize",()=>e.getDocumentSettings().gridSize,[e]),{x:n,y:r,z:o}=(0,a.Hg)("camera",()=>e.getCamera(),[e]),l=(0,a.Hg)("isGridMode",()=>e.getInstanceState().isGridMode,[e]),{Grid:d}=(0,y.o)();return d&&l?(0,i.jsx)(d,{x:n,y:r,z:o,size:t}):null}function ScribbleWrapper(){let e=(0,p.jE)(),t=(0,a.Hg)("scribbles",()=>e.getInstanceState().scribbles,[e]),n=(0,a.Hg)("zoomLevel",()=>e.getZoomLevel(),[e]),{Scribble:r}=(0,y.o)();return r&&t.length?t.map(e=>(0,i.jsx)(r,{className:"tl-user-scribble",scribble:e,zoom:n},e.id)):null}function BrushWrapper(){let e=(0,p.jE)(),t=(0,a.Hg)("brush",()=>e.getInstanceState().brush,[e]),{Brush:n}=(0,y.o)();return n&&t?(0,i.jsx)(n,{className:"tl-user-brush",brush:t}):null}function ZoomBrushWrapper(){let e=(0,p.jE)(),t=(0,a.Hg)("zoomBrush",()=>e.getInstanceState().zoomBrush,[e]),{ZoomBrush:n}=(0,y.o)();return n&&t?(0,i.jsx)(n,{className:"tl-user-brush tl-zoom-brush",brush:t}):null}function SnapIndicatorWrapper(){let e=(0,p.jE)(),t=(0,a.Hg)("snapLines",()=>e.snaps.getIndicators(),[e]),n=(0,a.Hg)("zoomLevel",()=>e.getZoomLevel(),[e]),{SnapIndicator:r}=(0,y.o)();return r&&t.length>0?t.map(e=>(0,i.jsx)(r,{className:"tl-user-snapline",line:e,zoom:n},e.id)):null}function HandlesWrapper(){let e=(0,p.jE)(),t=(0,a.Hg)("handles shapeIdWithHandles",()=>{let{isReadonly:t,isChangingStyle:n}=e.getInstanceState();if(t||n)return!1;let r=e.getOnlySelectedShape();if(!r)return!1;let i=e.getShapeHandles(r);return!!i&&r.id},[e]);return t?(0,i.jsx)(HandlesWrapperInner,{shapeId:t}):null}function HandlesWrapperInner({shapeId:e}){let t=(0,p.jE)(),{Handles:n}=(0,y.o)(),r=(0,a.Hg)("zoomLevel",()=>t.getZoomLevel(),[t]),o=(0,a.Hg)("coarse pointer",()=>t.getInstanceState().isCoarsePointer,[t]),l=(0,a.Hg)("handles transform",()=>t.getShapePageTransform(e),[t,e]),d=(0,a.Hg)("handles",()=>{let n=t.getShapeHandles(e);if(!n)return null;let i=(o?t.options.coarseHandleRadius:t.options.handleRadius)/r*2;return n.filter(e=>"virtual"!==e.type||!n.some(t=>t!==e&&"vertex"===t.type&&z.B.Dist(e,t)<i)).sort(e=>"vertex"===e.type?1:-1)},[t,r,o,e]),c=(0,a.Hg)("isHidden",()=>t.isShapeHidden(e),[t,e]);return n&&d&&l&&!c?(0,i.jsx)(n,{children:(0,i.jsx)("g",{transform:q._.toCssString(l),children:d.map(t=>(0,i.jsx)(HandleWrapper,{shapeId:e,handle:t,zoom:r,isCoarse:o},t.id))})}):null}function HandleWrapper({shapeId:e,handle:t,zoom:n,isCoarse:r}){let o=function(e,t){let n=(0,p.jE)();return c.useMemo(()=>{let r,i;return{onPointerDown:r=>{if(r.isKilled)return;let i=(0,g.Te)(r.currentTarget);(0,g.I5)(i,r);let{shape:o,handle:a}=getHandle(n,e,t);a&&n.dispatch({type:"pointer",target:"handle",handle:a,shape:o,name:"pointer_down",...(0,W.Y)(r)})},onPointerMove:o=>{if(o.isKilled||o.clientX===r&&o.clientY===i)return;r=o.clientX,i=o.clientY;let{shape:a,handle:l}=getHandle(n,e,t);l&&n.dispatch({type:"pointer",target:"handle",handle:l,shape:a,name:"pointer_move",...(0,W.Y)(o)})},onPointerUp:r=>{if(r.isKilled)return;let i=(0,g.Te)(r.currentTarget);(0,g.XE)(i,r);let{shape:o,handle:a}=getHandle(n,e,t);a&&n.dispatch({type:"pointer",target:"handle",handle:a,shape:o,name:"pointer_up",...(0,W.Y)(r)})}}},[n,e,t])}(e,t.id),{Handle:a}=(0,y.o)();return a?(0,i.jsx)("g",{role:"button","aria-label":t.label||"handle",transform:`translate(${t.x}, ${t.y})`,...o,children:(0,i.jsx)(a,{shapeId:e,handle:t,zoom:n,isCoarse:r})}):null}function OverlaysWrapper(){let{Overlays:e}=(0,y.o)();return e?(0,i.jsx)("div",{className:"tl-custom-overlays tl-overlays__item",children:(0,i.jsx)(e,{})}):null}function ShapesWithSVGs(){let e=(0,p.jE)(),t=(0,a.Hg)("rendering shapes",()=>e.getRenderingShapes(),[e]),n=(0,a.Hg)("dpr multiple",()=>nearestMultiple(Math.floor(100*e.getInstanceState().devicePixelRatio)/100),[e]);return t.map(e=>(0,i.jsxs)(c.Fragment,{children:[(0,i.jsx)(es.bn,{...e,dprMultiple:n}),(0,i.jsx)(DebugSvgCopy,{id:e.id,mode:"iframe"})]},e.id+"_fragment"))}function ReflowIfNeeded(){let e=(0,p.jE)(),t=(0,c.useRef)(new Set);return(0,a.BK)("reflow for culled shapes",()=>{let n=e.getCulledShapes();if(t.current.size===n.size&&[...n].every(e=>t.current.has(e)))return;t.current=n;let r=document.getElementsByClassName("tl-canvas");0!==r.length&&r[0].offsetHeight},[e]),null}function ShapesToDisplay(){let e=(0,p.jE)(),t=(0,a.Hg)("rendering shapes",()=>e.getRenderingShapes(),[e]),n=(0,a.Hg)("dpr multiple",()=>nearestMultiple(Math.floor(100*e.getInstanceState().devicePixelRatio)/100),[e]);return(0,i.jsxs)(i.Fragment,{children:[t.map(e=>(0,i.jsx)(es.bn,{...e,dprMultiple:n},e.id+"_shape")),u.a.isSafari&&(0,i.jsx)(ReflowIfNeeded,{})]})}function HintedShapeIndicator(){let e=(0,p.jE)(),{ShapeIndicator:t}=(0,y.o)(),n=(0,a.Hg)("hinting shape ids",()=>(0,l.D8)(e.getHintingShapeIds()),[e]);return n.length&&t?n.map(e=>(0,i.jsx)(t,{className:"tl-user-indicator__hint",shapeId:e},e+"_hinting")):null}function CursorDef(){return(0,i.jsxs)("g",{id:(0,Z.Ws)("cursor"),children:[(0,i.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[(0,i.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,i.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,i.jsxs)("g",{fill:"white",transform:"translate(-12,-12)",children:[(0,i.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,i.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,i.jsxs)("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[(0,i.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,i.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function CollaboratorHintDef(){let e=(0,Z.Ws)("cursor_hint");return(0,i.jsx)("path",{id:e,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function DebugSvgCopy({id:e,mode:t}){let n=(0,p.jE)(),[r,l]=(0,c.useState)(null),d=(0,a.Hg)("is in root",()=>{let t=n.getShape(e);return t?.parentId===n.getCurrentPageId()},[n,e]);return((0,c.useEffect)(()=>{if(!d)return;let t=null,r=(0,o.Ym)("shape to svg",async()=>{let r=Math.random();t=r;let i=n.isShapeOfType(e,"frame"),o=i?0:10,a=n.getShapePageBounds(e);if(!a)return;a=a.clone().expandBy(o);let d=await n.getSvgString([e],{padding:o});if(t!==r||!d)return;let c=`data:image/svg+xml;utf8,${encodeURIComponent(d.svg)}`;l({src:c,bounds:a})});return()=>{t=null,r()}},[n,e,d]),d&&r)?"iframe"===t?(0,i.jsx)("iframe",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):(0,i.jsx)("img",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):null}function SelectionForegroundWrapper(){let e=(0,p.jE)(),t=(0,a.Hg)("selection rotation",function(){return e.getSelectionRotation()},[e]),n=(0,a.Hg)("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionForeground:r}=(0,y.o)();return n&&r?(0,i.jsx)(r,{bounds:n,rotation:t}):null}function SelectionBackgroundWrapper(){let e=(0,p.jE)(),t=(0,a.Hg)("selection rotation",()=>e.getSelectionRotation(),[e]),n=(0,a.Hg)("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionBackground:r}=(0,y.o)();return n&&r?(0,i.jsx)(r,{bounds:n,rotation:t}):null}function OnTheCanvasWrapper(){let{OnTheCanvas:e}=(0,y.o)();return e?(0,i.jsx)(e,{}):null}function MovingCameraHitTestBlocker(){let e=(0,p.jE)(),t=(0,a.Hg)("camera state",()=>e.getCameraState(),[e]);return(0,i.jsx)("div",{className:d("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":"idle"===t})})}},40787:function(e,t,n){"use strict";n.d(t,{Y:function(){return DefaultCollaboratorHint}});var r=n(57437),i=n(42744),o=n(2265),a=n(91496),l=n(68576),d=n(14204),c=n(46166);function DefaultCollaboratorHint({className:e,zoom:t,point:n,color:u,viewport:h,opacity:p=1}){let f=(0,o.useRef)(null);(0,l.H)(f,(0,c.uZ)(n.x,h.minX+5/t,h.maxX-5/t),(0,c.uZ)(n.y,h.minY+5/t,h.maxY-5/t),1/t,d.B.Angle(h.center,n));let g=(0,a.Ws)("cursor_hint");return(0,r.jsxs)("svg",{ref:f,className:i("tl-overlays__item",e),"aria-hidden":"true",children:[(0,r.jsx)("use",{href:`#${g}`,color:u,strokeWidth:3,stroke:"var(--color-background)"}),(0,r.jsx)("use",{href:`#${g}`,color:u,opacity:p})]})}},38917:function(e,t,n){"use strict";n.d(t,{T:function(){return d}});var r=n(57437),i=n(42744),o=n(2265),a=n(91496),l=n(68576);let d=(0,o.memo)(function({className:e,zoom:t,point:n,color:d,name:c,chatMessage:u}){let h=(0,o.useRef)(null);(0,l.H)(h,n?.x,n?.y,1/t);let p=(0,a.Ws)("cursor");return n?(0,r.jsxs)("div",{ref:h,className:i("tl-overlays__item",e),children:[(0,r.jsx)("svg",{className:"tl-cursor","aria-hidden":"true",children:(0,r.jsx)("use",{href:`#${p}`,color:d})}),u?(0,r.jsxs)(r.Fragment,{children:[c&&(0,r.jsx)("div",{className:"tl-nametag-title",style:{color:d},children:c}),(0,r.jsx)("div",{className:"tl-nametag-chat",style:{backgroundColor:d},children:u})]}):c&&(0,r.jsx)("div",{className:"tl-nametag",style:{backgroundColor:d},children:c})]}):null})},47328:function(e,t,n){"use strict";n.d(t,{d:function(){return DefaultErrorFallback}});var r=n(57437),i=n(30742),o=n(70938),a=n(42744),l=n(2265),d=n(3373),c=n(76413),u=n(73432),h=n(50590),p=n(24519);let DefaultErrorFallback=({error:e,editor:t})=>{let n=(0,l.useRef)(null),[f,g]=(0,l.useState)(!1),[m,y]=(0,l.useState)(!1),[b,S]=(0,l.useState)(!1),v=null;try{let e=(0,c.o)();v=e.Canvas??null}catch{}let k=e instanceof Error?e.message:String(e),_=e instanceof Error?e.stack:null,C=(0,i.Hg)("isDarkMode",()=>{try{if(t)return t.user.getIsDarkMode()}catch{}return null},[t]),[E,M]=(0,l.useState)(null);(0,l.useLayoutEffect)(()=>{null!==C&&M(C);let e=n.current?.parentElement,t=!1;for(;e;){if(e.classList.contains("tl-theme__dark")||e.classList.contains("tl-theme__light")){t=!0;break}e=e.parentElement}if(t){M(null);return}"undefined"!=typeof window&&"matchMedia"in window&&M(window.matchMedia("(prefers-color-scheme: dark)").matches)},[C]),(0,l.useEffect)(()=>{if(m){let e=t?.timers.setTimeout(()=>{y(!1)},2e3);return()=>clearTimeout(e)}},[m,t]);let resetLocalState=async()=>{(0,u.W)()},P=new URL("https://github.com/tldraw/tldraw/issues/new");return P.searchParams.set("title",k),P.searchParams.set("labels","bug"),P.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${_??k}
\`\`\`

My browser: ${navigator.userAgent}`),(0,r.jsxs)("div",{ref:n,className:a("tl-container tl-error-boundary",null===E?"":E?"tl-theme__dark":"tl-theme__light"),children:[(0,r.jsx)("div",{className:"tl-error-boundary__overlay"}),t&&(0,r.jsx)(p.S,{onError:o.ZT,fallback:()=>null,children:(0,r.jsx)(d.KU,{editor:t,children:(0,r.jsx)("div",{className:"tl-overlay tl-error-boundary__canvas",children:v?(0,r.jsx)(v,{}):null})})}),(0,r.jsx)("div",{className:a("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":f&&!b}),children:b?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{children:"Are you sure?"}),(0,r.jsx)("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),(0,r.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,r.jsx)("button",{className:"tlui-button",onClick:()=>S(!1),children:"Cancel"}),(0,r.jsx)("button",{className:"tlui-button tl-error-boundary__reset",onClick:resetLocalState,children:"Reset data"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{children:"Something went wrong"}),(0,r.jsx)("p",{children:"Please refresh your browser."}),(0,r.jsx)("p",{children:"If the issue continues after refreshing, you may need to reset the tldraw data stored on your device."}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Note:"})," Resetting will erase your current project and any unsaved work."]}),!1,f&&(0,r.jsxs)(r.Fragment,{children:["Message:",(0,r.jsx)("h4",{children:(0,r.jsx)("code",{children:k})}),"Stack trace:",(0,r.jsxs)("div",{className:"tl-error-boundary__content__error",children:[(0,r.jsx)("pre",{children:(0,r.jsx)("code",{children:_??k})}),(0,r.jsx)("button",{className:"tlui-button",onClick:()=>{let e=document.createElement("textarea");e.value=_??k,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),y(!0)},children:m?"Copied!":"Copy"})]})]}),(0,r.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,r.jsx)("button",{className:"tlui-button",onClick:()=>g(!f),children:f?"Hide details":"Show details"}),(0,r.jsxs)("div",{className:"tl-error-boundary__content__actions__group",children:[(0,r.jsx)("button",{className:"tlui-button tl-error-boundary__reset",onClick:()=>S(!0),children:"Reset data"}),(0,r.jsx)("button",{className:"tlui-button tl-error-boundary__refresh",onClick:()=>{(0,h.Z)()},children:"Refresh Page"})]})]})]})})]})}},86251:function(e,t,n){"use strict";n.d(t,{y:function(){return DefaultGrid}});var r=n(57437),i=n(70938),o=n(3373),a=n(91496);function DefaultGrid({x:e,y:t,z:n,size:l}){let d=(0,a.Gj)("grid"),c=(0,o.jE)(),{gridSteps:u}=c.options;return(0,r.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[(0,r.jsx)("defs",{children:u.map(({min:o,mid:c,step:u},h)=>{let p=u*l*n,f=.5+e*n,g=.5+t*n,m=n<c?(0,i.vm)(n,[o,c],[0,1]):1;return(0,r.jsx)("pattern",{id:(0,a.mq)(d,`${u}`),width:p,height:p,patternUnits:"userSpaceOnUse",children:(0,r.jsx)("circle",{className:"tl-grid-dot",cx:f>0?f%p:p+f%p,cy:g>0?g%p:p+g%p,r:1,opacity:m})},h)})}),u.map(({step:e},t)=>(0,r.jsx)("rect",{width:"100%",height:"100%",fill:`url(#${d}_${e})`},t))]})}},85704:function(e,t,n){"use strict";n.d(t,{C:function(){return DefaultHandle}});var r=n(57437),i=n(42744),o=n(57655),a=n(3373);function DefaultHandle({handle:e,isCoarse:t,className:n,zoom:l}){let d=(0,a.jE)(),c=(t?d.options.coarseHandleRadius:d.options.handleRadius)/l;if("clone"===e.type){let t=3/l,a=`M0,${-t} A${t},${t} 0 0,1 0,${t}`,d=o.Fd.indexOf(e.id);return(0,r.jsxs)("g",{className:i(`tl-handle tl-handle__${e.type}`,n),children:[(0,r.jsx)("circle",{className:"tl-handle__bg",r:c}),(0,r.jsx)("path",{className:"tl-handle__fg",d:a,transform:`rotate(${-90+90*d})`})]})}let u=("create"===e.type&&t?3:4)/Math.max(l,.25);return(0,r.jsxs)("g",{className:i(`tl-handle tl-handle__${e.type}`,n),children:[(0,r.jsx)("circle",{className:"tl-handle__bg",r:c}),(0,r.jsx)("circle",{className:"tl-handle__fg",r:u})]})}},93572:function(e,t,n){"use strict";n.d(t,{Q:function(){return DefaultHandles}});var r=n(57437);let DefaultHandles=({children:e})=>(0,r.jsx)("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:e})},37453:function(e,t,n){"use strict";n.d(t,{l:function(){return DefaultScribble}});var r=n(57437),i=n(42744),o=n(65852);function DefaultScribble({scribble:e,zoom:t,color:n,opacity:a,className:l}){return e.points.length?(0,r.jsx)("svg",{className:l?i("tl-overlays__item",l):l,children:(0,r.jsx)("path",{className:"tl-scribble",d:(0,o.R)(e.points,!1),stroke:n??`var(--color-${e.color})`,fill:"none",strokeWidth:8/t,opacity:a??e.opacity})}):null}},14203:function(e,t,n){"use strict";n.d(t,{u:function(){return DefaultSelectionForeground}});var r=n(57437),i=n(30742),o=n(42744),a=n(2265),l=n(3373),d=n(68576),c=n(30696),u=n(46166);function DefaultSelectionForeground({bounds:e,rotation:t}){let n=(0,l.jE)(),h=(0,a.useRef)(null),p=(0,i.Hg)("only selected shape",()=>n.getOnlySelectedShape(),[n]),f=p?n.getShapeUtil(p).expandSelectionOutlinePx(p):0;return(0,d.H)(h,e?.x,e?.y,1,t,{x:-f,y:-f}),e=f instanceof c.xu?e.clone().expand(f).zeroFix():e.clone().expandBy(f).zeroFix(),(0,r.jsx)("svg",{ref:h,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,r.jsx)("rect",{className:o("tl-selection__fg__outline"),width:(0,u.$Z)(e.width),height:(0,u.$Z)(e.height)})})}},67677:function(e,t,n){"use strict";n.d(t,{v:function(){return p}});var r=n(57437),i=n(30742),o=n(42744),a=n(2265),l=n(3373),d=n(76413),c=n(24519);let u=(0,a.memo)(({shape:e,util:t})=>(0,i.uC)("Indicator: "+e.type,()=>t.indicator(t.editor.store.unsafeGetWithoutCapture(e.id))),(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta),h=(0,a.memo)(({editor:e,id:t})=>{let n=(0,i.Hg)("shape for indicator",()=>e.store.get(t),[e,t]),{ShapeIndicatorErrorFallback:o}=(0,d.o)();return!n||n.isLocked?null:(0,r.jsx)(c.e,{fallback:o,onError:t=>e.annotateError(t,{origin:"react.shapeIndicator",willCrashApp:!1}),children:(0,r.jsx)(u,{shape:n,util:e.getShapeUtil(n)},n.id)})}),p=(0,a.memo)(function({shapeId:e,className:t,color:n,hidden:d,opacity:c}){let u=(0,l.jE)(),p=(0,a.useRef)(null);return(0,i.BK)("indicator transform",()=>{if(d)return;let t=p.current;if(!t)return;let n=u.getShapePageTransform(e);n&&t.style.setProperty("transform",n.toCssString())},[u,e,d]),(0,a.useLayoutEffect)(()=>{let e=p.current;e&&e.style.setProperty("display",d?"none":"block")},[d]),(0,r.jsx)("svg",{ref:p,className:o("tl-overlays__item",t),"aria-hidden":"true",children:(0,r.jsx)("g",{className:"tl-shape-indicator",stroke:n??"var(--color-selected)",opacity:c,children:(0,r.jsx)(h,{editor:u,id:e})})})})},30865:function(e,t,n){"use strict";n.d(t,{N:function(){return d}});var r=n(57437),i=n(30742),o=n(2265),a=n(3373),l=n(76413);let d=(0,o.memo)(function({hideAll:e,showAll:t}){let n=(0,a.jE)();if(e&&t)throw Error("You cannot set both hideAll and showAll props to true, cmon now");let d=(0,o.useRef)(new Set),c=(0,i.Hg)("should display selected ids",()=>{let e=d.current,t=new Set,r=n.getInstanceState(),i=r.isChangingStyle,o=n.isInAny("select.idle","select.editing_shape"),a=n.isInAny("select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","select.pointing_handle");if(i||!(o||a))return d.current=t,t;for(let e of n.getSelectedShapeIds())t.add(e);if(o&&r.isHoveringCanvas&&!r.isCoarsePointer){let e=n.getHoveredShapeId();e&&t.add(e)}if(e.size!==t.size)return d.current=t,t;for(let n of t)if(!e.has(n))return d.current=t,t;return e},[n]),u=(0,i.Hg)("rendering shapes",()=>n.getRenderingShapes(),[n]),{ShapeIndicator:h}=(0,l.o)();return h?u.map(({id:n})=>(0,r.jsx)(h,{shapeId:n,hidden:!t&&(e||!c.has(n))},n+"_indicator")):null})},7611:function(e,t,n){"use strict";n.d(t,{m:function(){return DefaultSnapIndicator}});var r=n(57437),i=n(42744),o=n(2265),a=n(46166);function PointsSnapIndicator({points:e,zoom:t}){let n,i,o,a;let l=2.5/t,d=e.reduce((e,t)=>Math.min(e,t.x),1/0),c=e.reduce((e,t)=>Math.max(e,t.x),-1/0),u=e.reduce((e,t)=>Math.min(e,t.y),1/0),h=e.reduce((e,t)=>Math.max(e,t.y),-1/0),p=e.some(e=>e.x===d&&e.y===u);return p?(n=d,i=u,o=c,a=h):(n=d,i=h,o=c,a=u),(0,r.jsxs)("g",{className:"tl-snap-indicator",stroke:"lime",children:[(0,r.jsx)("line",{x1:n,y1:i,x2:o,y2:a}),e.map((e,t)=>(0,r.jsx)("g",{transform:`translate(${e.x},${e.y})`,children:(0,r.jsx)("path",{className:"tl-snap-point",d:`M ${-l},${-l} L ${l},${l} M ${-l},${l} L ${l},${-l}`})},t))]})}function GapsSnapIndicator({gaps:e,direction:t,zoom:n}){let i=3.5/n,l=[-1/0,1/0],d=null,c="horizontal"===t;for(let t of e)(d=(0,a.mW)(l[0],l[1],c?t.startEdge[0].y:t.startEdge[0].x,c?t.startEdge[1].y:t.startEdge[1].x))&&(l=d,(d=(0,a.mW)(l[0],l[1],c?t.endEdge[0].y:t.endEdge[0].x,c?t.endEdge[1].y:t.endEdge[1].x))&&(l=d));if(null===l)return null;let u=(l[0]+l[1])/2;return(0,r.jsx)("g",{className:"tl-snap-indicator",stroke:"cyan",children:e.map(({startEdge:e,endEdge:t},n)=>(0,r.jsx)(o.Fragment,{children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("line",{x1:e[0].x,y1:u-2*i,x2:e[1].x,y2:u+2*i}),(0,r.jsx)("line",{x1:t[0].x,y1:u-2*i,x2:t[1].x,y2:u+2*i}),(0,r.jsx)("line",{x1:e[0].x,y1:u,x2:t[0].x,y2:u}),(0,r.jsx)("line",{x1:(e[0].x+t[0].x)/2,y1:u-i,x2:(e[0].x+t[0].x)/2,y2:u+i})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("line",{x1:u-2*i,y1:e[0].y,x2:u+2*i,y2:e[1].y}),(0,r.jsx)("line",{x1:u-2*i,y1:t[0].y,x2:u+2*i,y2:t[1].y}),(0,r.jsx)("line",{x1:u,y1:e[0].y,x2:u,y2:t[0].y}),(0,r.jsx)("line",{x1:u-i,y1:(e[0].y+t[0].y)/2,x2:u+i,y2:(e[0].y+t[0].y)/2})]})},n))})}function DefaultSnapIndicator({className:e,line:t,zoom:n}){return(0,r.jsx)("svg",{className:i("tl-overlays__item",e),"aria-hidden":"true",children:"points"===t.type?(0,r.jsx)(PointsSnapIndicator,{...t,zoom:n}):"gaps"===t.type?(0,r.jsx)(GapsSnapIndicator,{...t,zoom:n}):null})}},87717:function(e,t,n){"use strict";n.d(t,{q:function(){return DefaultSpinner}});var r=n(57437),i=n(42744);function DefaultSpinner(e){return(0,r.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16","aria-hidden":"false",...e,className:i("tl-spinner",e.className),children:(0,r.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,r.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,r.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor"})]})})}},30126:function(e,t,n){"use strict";n.d(t,{K:function(){return DefaultSvgDefs}});let DefaultSvgDefs=()=>null},84995:function(e,t,n){"use strict";n.d(t,{v:function(){return getSnapshot},w:function(){return loadSnapshot}});var r=n(43001),i=n(70938),o=n(21834);function loadSnapshot(e,t,n){let l={};if("store"in t){let n=e.schema.migrateStoreSnapshot(t);if("success"!==n.type)throw Error("Failed to migrate store snapshot: "+n.reason);l.document={schema:e.schema.serialize(),store:(0,i.H4)(n.value,(t,{typeName:n})=>e.scopedTypes.document.has(n))}}else l=t;let d=(0,r.Tc)(e.get(r.PQ)),c=a.get(e,o.fU).get();e.atomic(()=>{l.document&&e.loadStoreSnapshot(l.document),d&&e.update(r.PQ,e=>({...e,...d})),c&&(0,o.SB)(e,c),l.session&&(0,o.SB)(e,l.session,{forceOverwrite:n?.forceOverwriteSessionState})})}let a=new i.kM;function getSnapshot(e){let t=a.get(e,o.fU),n=t.get();if(!n)throw Error("Session state is not ready yet");return{document:e.getStoreSnapshot(),session:n}}},21834:function(e,t,n){"use strict";n.d(t,{$5:function(){return u},SB:function(){return loadSessionStateSnapshotIntoStore},fU:function(){return createSessionStateSnapshotSignal},wz:function(){return extractSessionStateFromLegacySnapshot}});var r=n(31316),i=n(43001),o=n(70938),a=n(45958),l=n(49894);let d="TLDRAW_TAB_ID_v2",c=globalThis.window,u=c?c[d]??(0,o.Kk)(d)??"TLDRAW_INSTANCE_STATE_V1_"+(0,o.EL)():"<error>";c&&(c[d]=u,c&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(c.navigator.platform)||l.a.isDarwin&&"ontouchend"in document)?(0,o.sn)(d,u):(0,o.F_)(d)),c?.addEventListener("beforeunload",()=>{o.sn(d,u)});let h={Initial:0},p=Math.max(...Object.values(h)),f=a.T.object({version:a.T.number,currentPageId:i.CF.optional(),isFocusMode:a.T.boolean.optional(),exportBackground:a.T.boolean.optional(),isDebugMode:a.T.boolean.optional(),isToolLocked:a.T.boolean.optional(),isGridMode:a.T.boolean.optional(),pageStates:a.T.arrayOf(a.T.object({pageId:i.CF,camera:a.T.object({x:a.T.number,y:a.T.number,z:a.T.number}).optional(),selectedShapeIds:a.T.arrayOf(i.u5).optional(),focusedGroupId:i.u5.nullable().optional()})).optional()});function createSessionStateSnapshotSignal(e){let t=e.query.ids("page");return(0,r.Fl)("sessionStateSnapshot",()=>{let n=e.get(i.PQ);if(!n)return null;let r=[...t.get()];return{version:p,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(t=>{let n=e.get(i.iS.createId(t)),r=e.get(i.AN.createId(t));return{pageId:t,camera:{x:r?.x??0,y:r?.y??0,z:r?.z??1},selectedShapeIds:n?.selectedShapeIds??[],focusedGroupId:n?.focusedGroupId??null}})}},{isEqual:o.Xy})}function loadSessionStateSnapshotIntoStore(e,t,n){let r=function(e){if(!e||"object"!=typeof e)return console.warn("Invalid instance state"),null;if(!("version"in e)||"number"!=typeof e.version)return console.warn("No version in instance state"),null;if(e.version!==p){var t;(t=e=(0,o.v4)(e)).version,h.Initial,t.version=p}try{return f.validate(e)}catch(e){return console.warn(e),null}}(t);if(!r)return;let a=(0,i.Tc)(e.get(i.PQ)),l=n?.forceOverwrite?r:a,d=n?.forceOverwrite?a:r,c=e.schema.types.instance.create({id:i.PQ,...a,currentPageId:r.currentPageId,isDebugMode:l?.isDebugMode??d?.isDebugMode,isFocusMode:l?.isFocusMode??d?.isFocusMode,isToolLocked:l?.isToolLocked??d?.isToolLocked,isGridMode:l?.isGridMode??d?.isGridMode,exportBackground:l?.exportBackground??d?.exportBackground});e.atomic(()=>{for(let t of r.pageStates??[]){if(!e.has(t.pageId))continue;let n=i.AN.createId(t.pageId),r=i.iS.createId(t.pageId),o=e.get(n),a=e.get(r);e.put([i.AN.create({id:n,x:t.camera?.x??o?.x,y:t.camera?.y??o?.y,z:t.camera?.z??o?.z}),i.iS.create({id:r,pageId:t.pageId,selectedShapeIds:t.selectedShapeIds??a?.selectedShapeIds,focusedGroupId:t.focusedGroupId??a?.focusedGroupId})])}e.put([c]),e.ensureStoreIsUsable()})}function extractSessionStateFromLegacySnapshot(e){let t=[];for(let n of Object.values(e))n.typeName?.match(/^(instance.*|pointer|camera)$/)&&t.push(n);let n=t.filter(e=>"instance"===e.typeName&&e.id!==i.PQ)[0];if(!n)return null;let r={version:p,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:t.filter(e=>"instance_page_state"===e.typeName&&e.instanceId===n.id).map(t=>{let n=e[t.cameraId]??{x:0,y:0,z:1};return{pageId:t.pageId,camera:{x:n.x,y:n.y,z:n.z},selectedShapeIds:t.selectedShapeIds,focusedGroupId:t.focusedGroupId}})};try{return f.validate(r),r}catch{return null}}},45894:function(e,t,n){"use strict";n.d(t,{A6:function(){return h},F9:function(){return d},JM:function(){return getUserPreferences},MO:function(){return getFreshUserPreferences},ks:function(){return p},yu:function(){return setUserPreferences}});var r=n(31316),i=n(43001),o=n(70938),a=n(45958);n(25566);let l="TLDRAW_USER_DATA_v3",d=a.T.object({id:a.T.string,name:a.T.string.nullable().optional(),color:a.T.string.nullable().optional(),locale:a.T.string.nullable().optional(),animationSpeed:a.T.number.nullable().optional(),areKeyboardShortcutsEnabled:a.T.boolean.nullable().optional(),edgeScrollSpeed:a.T.number.nullable().optional(),colorScheme:a.T.literalEnum("light","dark","system").optional(),isSnapMode:a.T.boolean.nullable().optional(),isWrapMode:a.T.boolean.nullable().optional(),isDynamicSizeMode:a.T.boolean.nullable().optional(),isPasteAtCursorMode:a.T.boolean.nullable().optional()}),c={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8,AddKeyboardShortcuts:9},u=Math.max(...Object.values(c)),h=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function getRandomColor(){return h[Math.floor(Math.random()*h.length)]}let p=Object.freeze({name:"",locale:(0,i.Bz)(),color:getRandomColor(),edgeScrollSpeed:1,animationSpeed:"undefined"!=typeof window&&"matchMedia"in window&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches?0:1,areKeyboardShortcutsEnabled:!0,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"light"});function getFreshUserPreferences(){return{id:(0,o.EL)(),color:getRandomColor()}}function migrateUserPreferences(e){if(null===e||"object"!=typeof e||!("version"in e)||!("user"in e)||"number"!=typeof e.version)return getFreshUserPreferences();let t=(0,o.v4)(e);t.version<c.AddAnimationSpeed&&(t.user.animationSpeed=1),t.version<c.AddIsSnapMode&&(t.user.isSnapMode=!1),t.version,c.MakeFieldsNullable,t.version<c.AddEdgeScrollSpeed&&(t.user.edgeScrollSpeed=1),t.version<c.AddExcalidrawSelectMode&&(t.user.isWrapMode=!1),t.version<c.AllowSystemColorScheme&&(!0===t.user.isDarkMode?t.user.colorScheme="dark":!1===t.user.isDarkMode&&(t.user.colorScheme="light"),delete t.user.isDarkMode),t.version<c.AddDynamicSizeMode&&(t.user.isDynamicSizeMode=!1),t.version<c.AddPasteAtCursor&&(t.user.isPasteAtCursorMode=!1),t.version<c.AddKeyboardShortcuts&&(t.user.areKeyboardShortcutsEnabled=!0),t.version=u;try{return d.validate(t.user)}catch{return getFreshUserPreferences()}}let f=(0,r.cn)("globalUserData",null);function setUserPreferences(e){d.validate(e),f.set(e),(0,o._m)(l,JSON.stringify({version:u,user:f.get()})),g?.postMessage({type:y,origin:getBroadcastOrigin(),data:{user:getUserPreferences(),version:u}})}let g="undefined"==typeof BroadcastChannel?null:new BroadcastChannel("tldraw-user-sync");g?.addEventListener("message",e=>{let t=e.data;t?.type===y&&t?.origin!==getBroadcastOrigin()&&f.set(migrateUserPreferences(t.data))});let m=null;function getBroadcastOrigin(){return null===m&&(m=(0,o.EL)()),m}let y="tldraw-user-preferences-change";function getUserPreferences(){let e=f.get();return e||setUserPreferences(e=function(){let e=JSON.parse((0,o.fp)(l)||"null")??null;return migrateUserPreferences(e)}()),e}},95478:function(e,t,n){"use strict";n.d(t,{F_:function(){return createTLSchemaFromUtils},jx:function(){return createTLStore},uj:function(){return u}});var r=n(63134),i=n(43001),o=n(70938),a=n(80418),l=n(84995),d=n(46072),c=n(29968);let defaultAssetResolve=e=>e.props.src,u={upload:async(e,t)=>({src:await o.P6.blobToDataUrl(t)})};function createTLSchemaFromUtils(e){return"schema"in e&&e.schema?e.schema:(0,i.HH)({shapes:"shapeUtils"in e&&e.shapeUtils?utilsToMap((0,c.m)(e.shapeUtils)):void 0,bindings:"bindingUtils"in e&&e.bindingUtils?utilsToMap((0,d.c)(e.bindingUtils)):void 0,migrations:"migrations"in e?e.migrations:void 0})}function createTLStore({initialData:e,defaultName:t="",id:n,assets:i=u,onMount:d,collaboration:c,...h}={}){let p=createTLSchemaFromUtils(h),f=new r.yh({id:n,schema:p,initialData:e,props:{defaultName:t,assets:{upload:i.upload,resolve:i.resolve??defaultAssetResolve,remove:i.remove??(()=>Promise.resolve())},onMount:e=>{(0,o.hu)(e instanceof a.M),d?.(e)},collaboration:c}});if(h.snapshot){if(e)throw Error("Cannot provide both initialData and snapshot");(0,l.w)(f,h.snapshot,{forceOverwriteSessionState:!0})}return f}function utilsToMap(e){return Object.fromEntries(e.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}},7217:function(e,t,n){"use strict";n.d(t,{L:function(){return createTLUser},z:function(){return useTldrawUser}});var r=n(31316),i=n(30742),o=n(2265),a=n(60180),l=n(45894);let d=(0,r.Fl)("defaultLocalStorageUserPrefs",()=>(0,l.JM)());function createTLUser(e={}){return{userPreferences:e.userPreferences??d,setUserPreferences:e.setUserPreferences??l.yu}}function useTldrawUser(e){let t=(0,a.S)(e.userPreferences??d),n=(0,i.KO)("userAtom",t);return(0,o.useEffect)(()=>{n.set(t)},[t,n]),(0,o.useMemo)(()=>createTLUser({userPreferences:(0,r.Fl)("userPreferences",()=>{let e=n.get();return(0,r.$Z)(e)?e.get():e}),setUserPreferences:e.setUserPreferences}),[n,e.setUserPreferences])}},46072:function(e,t,n){"use strict";function checkBindings(e){let t=[],n=new Set;for(let r of e){if(n.has(r.type))throw Error(`Binding type "${r.type}" is defined more than once`);t.push(r),n.add(r.type)}return t}n.d(t,{c:function(){return checkBindings}})},29968:function(e,t,n){"use strict";n.d(t,{m:function(){return checkShapesAndAddCore},u:function(){return i}});var r=n(31738);let i=[r.Q],o=new Set(i.map(e=>e.type));function checkShapesAndAddCore(e){let t=[...i],n=new Set;for(let r of e){if(o.has(r.type))throw Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw Error(`Shape type "${r.type}" is defined more than once`);t.push(r),n.add(r.type)}return t}},57655:function(e,t,n){"use strict";n.d(t,{B8:function(){return i},CK:function(){return a},Fd:function(){return l},Hs:function(){return c},QN:function(){return d},TP:function(){return p},Xy:function(){return o},an:function(){return h},sz:function(){return u}});var r=n(31986);let i={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.05,.1,.25,.5,1,2,4,8]},o={duration:0,easing:r.L.easeInOutCubic},a={CAMERA_MOVE:-10},l=["top","right","bottom","left"],d=0,c=2,u=1,h=5,p=128},79334:function(e,t,n){"use strict";n.d(t,{f:function(){return bindingsIndex}});var r=n(31316),i=n(70938);function fromScratch(e){let t=e.get(),n=new Map;for(let e of t){let{fromId:t,toId:r}=e,i=n.get(t);i?i.push(e):n.set(t,[e]);let o=n.get(r);o?o.push(e):n.set(r,[e])}return n}let bindingsIndex=e=>{let{store:t}=e,n=t.query.filterHistory("binding"),o=t.query.records("binding");return(0,r.Fl)("arrowBindingsIndex",(e,t)=>{let a;if((0,r.e1)(e))return fromScratch(o);let l=n.getDiffSince(t);if(l===r.SB)return fromScratch(o);function removingBinding(t){a??=new Map(e);let n=a.get(t.fromId),r=n?.filter(e=>e.id!==t.id);r?.length?a.set(t.fromId,r):a.delete(t.fromId);let i=a.get(t.toId),o=i?.filter(e=>e.id!==t.id);o?.length?a.set(t.toId,o):a.delete(t.toId)}function ensureNewArray(t){let n=(a??=new Map(e)).get(t);return n?n===e.get(t)&&(n=n.slice(0),a.set(t,n)):(n=[],a.set(t,n)),n}function addBinding(e){ensureNewArray(e.fromId).push(e),ensureNewArray(e.toId).push(e)}for(let e of l){for(let t of(0,i.UM)(e.added))addBinding(t);for(let[t,n]of(0,i.UM)(e.updated))removingBinding(t),addBinding(n);for(let t of(0,i.UM)(e.removed))removingBinding(t)}return a??e})}},43067:function(e,t,n){"use strict";n.d(t,{A:function(){return notVisibleShapes}});var r=n(31316);function notVisibleShapes(e){return(0,r.Fl)("notVisibleShapes",function(t){let n=function(e){let t=e.getCurrentPageShapeIds(),n=e.getViewportPageBounds(),r=new Set;return t.forEach(t=>{let i=e.getShapePageBounds(t);void 0!==i&&n.includes(i)||r.add(t)}),r}(e);if((0,r.e1)(t)||t.size!==n.size)return n;for(let e of t)if(!n.has(e))return n;return t})}},69078:function(e,t,n){"use strict";n.d(t,{s:function(){return parentsToChildren}});var r=n(31316),i=n(43001),o=n(70938);function fromScratch(e,t){let n={},r=e.get(),i=Array(r.size);return r.forEach(e=>i.push(t.get(e))),i.sort(o.hl),i.forEach(e=>{n[e.parentId]||(n[e.parentId]=[]),n[e.parentId].push(e.id)}),n}let parentsToChildren=e=>{let t=e.query.ids("shape"),n=e.query.filterHistory("shape");return(0,r.Fl)("parentsToChildrenWithIndexes",(a,l)=>{let d;if((0,r.e1)(a))return fromScratch(t,e);let c=n.getDiffSince(l);if(c===r.SB)return fromScratch(t,e);if(0===c.length)return a;let u=null,ensureNewArray=e=>{u||(u={...a}),u[e]?u[e]===a[e]&&(u[e]=[...u[e]]):u[e]=[]},h=new Set;for(let e=0,t=c.length;e<t;e++){for(let t of Object.values((d=c[e]).added))(0,i.VV)(t)&&(ensureNewArray(t.parentId),u[t.parentId].push(t.id),h.add(u[t.parentId]));for(let[e,t]of Object.values(d.updated))if((0,i.VV)(t)&&(0,i.VV)(e)){if(e.parentId!==t.parentId)ensureNewArray(e.parentId),ensureNewArray(t.parentId),u[e.parentId].splice(u[e.parentId].indexOf(t.id),1),u[t.parentId].push(t.id),h.add(u[t.parentId]);else if(e.index!==t.index){ensureNewArray(t.parentId);let e=u[t.parentId].indexOf(t.id);u[t.parentId][e]=t.id,h.add(u[t.parentId])}}for(let e of Object.values(d.removed))(0,i.VV)(e)&&(ensureNewArray(e.parentId),u[e.parentId].splice(u[e.parentId].indexOf(e.id),1))}for(let t of h){let n=(0,o.oA)(t.map(t=>e.get(t)));n.sort(o.hl),t.splice(0,t.length,...n.map(e=>e.id))}return u??a})}},94211:function(e,t,n){"use strict";n.d(t,{Q:function(){return deriveShapeIdsInCurrentPage}});var r=n(31316),i=n(63134),o=n(43001);let isShapeInPage=(e,t,n)=>{for(;!(0,o.r5)(n.parentId);){let t=e.get(n.parentId);if(!t)return!1;n=t}return n.parentId===t},deriveShapeIdsInCurrentPage=(e,t)=>{let n=e.query.ids("shape"),a=null;function fromScratch(){let r=t();return a=r,new Set([...n.get()].filter(t=>isShapeInPage(e,r,e.get(t))))}return(0,r.Fl)("_shapeIdsInCurrentPage",(n,l)=>{if((0,r.e1)(n))return fromScratch();let d=t();if(d!==a)return fromScratch();let c=e.history.getDiffSince(l);if(c===r.SB)return fromScratch();let u=new i.mW(n);for(let t of c){for(let n of Object.values(t.added))(0,o.VV)(n)&&isShapeInPage(e,d,n)&&u.add(n.id);for(let[n,r]of Object.values(t.updated))(0,o.VV)(r)&&(isShapeInPage(e,d,r)?u.add(r.id):u.remove(r.id));for(let e of Object.keys(t.removed))(0,o.YT)(e)&&u.remove(e)}let h=u.get();return h?(0,r.qo)(h.value,h.diff):n})}},75650:function(e,t,n){"use strict";n.d(t,{o:function(){return ClickManager}});var r,i,o,a=n(70938),l=n(14204),d=Object.create,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,__knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,n)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__name=(e,t)=>c(e,"name",{value:t,configurable:!0}),h=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=e=>void 0!==e&&"function"!=typeof e?__typeError("Function expected"):e,__decoratorContext=(e,t,n,r,i)=>({kind:h[e],name:t,metadata:r,addInitializer:e=>n._?__typeError("Already initialized"):i.push(__expectFn(e||null))}),__decoratorMetadata=(e,t)=>__defNormalProp(t,__knownSymbol("metadata"),e[3]),__runInitializers=(e,t,n,r)=>{for(var i=0,o=e[t>>1],a=o&&o.length;i<a;i++)1&t?o[i].call(n):r=o[i].call(n,r);return r},__decorateElement=(e,t,n,r,i,o)=>{var a,l,d,p,f,g=7&t,m=!!(8&t),y=!!(16&t),b=g>3?e.length+1:g?m?1:2:0,S=h[g+5],v=g>3&&(e[b-1]=[]),k=e[b]||(e[b]=[]),_=g&&(y||m||(i=i.prototype),g<5&&(g>3||!y)&&u(g<4?i:{get[n](){return __privateGet(this,o)},set[n](x){return __privateSet(this,o,x)}},n));g?y&&g<4&&__name(o,(g>2?"set ":g>1?"get ":"")+n):__name(i,n);for(var C=r.length-1;C>=0;C--)p=__decoratorContext(g,n,d={},e[3],k),g&&(p.static=m,p.private=y,f=p.access={has:y?e=>__privateIn(i,e):e=>n in e},3^g&&(f.get=y?e=>(1^g?__privateGet:__privateMethod)(e,i,4^g?o:_.get):e=>e[n]),g>2&&(f.set=y?(e,t)=>__privateSet(e,i,t,4^g?o:_.set):(e,t)=>e[n]=t)),l=(0,r[C])(g?g<4?y?o:_[S]:g>4?void 0:{get:_.get,set:_.set}:i,p),d._=1,4^g||void 0===l?__expectFn(l)&&(g>4?v.unshift(l):g?y?o=l:_[S]=l:i=l):"object"!=typeof l||null===l?__typeError("Object expected"):(__expectFn(a=l.get)&&(_.get=a),__expectFn(a=l.set)&&(_.set=a),__expectFn(a=l.init)&&v.unshift(a));return g||__decoratorMetadata(e,i),_&&c(i,n,_),y?4^g?o:_:i},__publicField=(e,t,n)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),__accessCheck=(e,t,n)=>t.has(e)||__typeError("Cannot "+n),__privateIn=(e,t)=>Object(t)!==t?__typeError('Cannot use the "in" operator on this value'):e.has(t),__privateGet=(e,t,n)=>(__accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),__privateSet=(e,t,n,r)=>(__accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),__privateMethod=(e,t,n)=>(__accessCheck(e,t,"access private method"),n);i=[a.ak],r=[a.ak];let ClickManager=class ClickManager{constructor(e){this.editor=e,__runInitializers(o,5,this),__publicField(this,"_clickId",""),__publicField(this,"_clickTimeout"),__publicField(this,"_clickScreenPoint"),__publicField(this,"_previousScreenPoint"),__publicField(this,"_clickState","idle"),__publicField(this,"lastPointerInfo",{})}_getClickTimeout(e,t=(0,a.EL)()){this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break;case"pendingQuadruple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break;case"pendingOverflow":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"})}this._clickState="idle"}},"idle"===e||"pendingDouble"===e?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(e){switch(e.name){case"pointer_down":if(!this._clickState)break;switch(this._clickScreenPoint=l.B.From(e.point),this._previousScreenPoint&&l.B.Dist2(this._previousScreenPoint,this._clickScreenPoint)>1600&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":this._clickState="pendingDouble";break;case"pendingOverflow":this._clickState="overflow"}this._clickTimeout=this._getClickTimeout(this._clickState);break;case"pointer_up":if(!this._clickState)break;switch(this._clickScreenPoint=l.B.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}break;case"pointer_move":"idle"!==this._clickState&&this._clickScreenPoint&&l.B.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout()}return e}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}};__decorateElement(o=[,,,d((void 0)??null)],1,"_getClickTimeout",i,ClickManager),__decorateElement(o,1,"cancelDoubleClickTimeout",r,ClickManager),__decoratorMetadata(o,ClickManager)},22784:function(e,t,n){"use strict";n.d(t,{O:function(){return EdgeScrollManager}});var r=n(14204),i=n(31986);let EdgeScrollManager=class EdgeScrollManager{constructor(e){this.editor=e}_isEdgeScrolling=!1;_edgeScrollDuration=-1;updateEdgeScrolling(e){let{editor:t}=this,n=this.getEdgeScroll();if(0===n.x&&0===n.y)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){let e=t.options.edgeScrollEaseDuration>0?i.L.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:n.x*e,y:n.y*e})}}getEdgeProximityFactors(e,t,n,r,i){let{editor:o}=this,a=o.options.edgeScrollDistance,l=n?o.options.coarsePointerWidth:0,d=e-l,c=e+l,u=r?0:a,h=i?t:t-a;return d<u?Math.min(1,(u-d)/a):c>h?-Math.min(1,(c-h)/a):0}getEdgeScroll(){let{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:n}}}=e,r=e.getViewportScreenBounds(),{isCoarsePointer:i,insets:[o,a,l,d]}=e.getInstanceState(),c=this.getEdgeProximityFactors(t,r.w,i,d,a),u=this.getEdgeProximityFactors(n,r.h,i,o,l);return{x:c,y:u}}moveCameraWhenCloseToEdge(e){let{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked||0===e.x&&0===e.y)return;let n=t.getViewportScreenBounds(),i=n.w<1e3?.612:1,o=n.h<1e3?.612:1,a=t.getZoomLevel(),l=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,d=l*e.x*i/a,c=l*e.y*o/a,{x:u,y:h,z:p}=t.getCamera();t.setCamera(new r.B(u+d,h+c,p))}}},85241:function(e,t,n){"use strict";n.d(t,{I:function(){return FocusManager}});let FocusManager=class FocusManager{constructor(e,t){this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(e,t)=>{e.isFocused!==t.isFocused&&this.updateContainerClass()});let n=e.getInstanceState().isFocused;t!==n&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass(),document.body.addEventListener("keydown",this.handleKeyDown.bind(this)),document.body.addEventListener("mousedown",this.handleMouseDown.bind(this))}disposeSideEffectListener;updateContainerClass(){let e=this.editor.getContainer(),t=this.editor.getInstanceState();t.isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused"),e.classList.add("tl-container__no-focus-ring")}handleKeyDown(e){let t=this.editor.getContainer();!this.editor.isIn("select.editing_shape")&&(document.activeElement!==t||!(this.editor.getSelectedShapeIds().length>0))&&["Tab","ArrowUp","ArrowDown"].includes(e.key)&&t.classList.remove("tl-container__no-focus-ring")}handleMouseDown(){let e=this.editor.getContainer();e.classList.add("tl-container__no-focus-ring")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){document.body.removeEventListener("keydown",this.handleKeyDown.bind(this)),document.body.removeEventListener("mousedown",this.handleMouseDown.bind(this)),this.disposeSideEffectListener?.()}}},36290:function(e,t,n){"use strict";n.d(t,{Q:function(){return FontManager}});var r=n(31316),i=n(63134),o=n(70938);let FontManager=class FontManager{constructor(e,t){this.editor=e,this.assetUrls=t,this.shapeFontFacesCache=e.store.createComputedCache("shape font faces",e=>{let t=this.editor.getShapeUtil(e);return t.getFontFaces(e)},{areResultsEqual:o.E8,areRecordsEqual:(e,t)=>e.props===t.props&&e.meta===t.meta}),this.shapeFontLoadStateCache=e.store.createCache(e=>{let t=(0,r.Fl)("font faces",()=>this.getShapeFontFaces(e));return(0,r.Fl)("font load state",()=>{let e=t.get().map(e=>this.getFontState(e));return e},{isEqual:o.E8})})}shapeFontFacesCache;shapeFontLoadStateCache;getShapeFontFaces(e){let t="string"==typeof e?e:e.id;return this.shapeFontFacesCache.get(t)??r.LZ}trackFontsForShape(e){let t="string"==typeof e?e:e.id;this.shapeFontLoadStateCache.get(t)}async loadRequiredFontsForCurrentPage(e=1/0){let t=new Set;for(let e of this.editor.getCurrentPageShapeIds())for(let n of this.getShapeFontFaces(this.editor.getShape(e)))t.add(n);if(t.size>e)return;let n=Array.from(t,e=>this.ensureFontIsLoaded(e));await Promise.all(n)}fontStates=new i.X0("font states");getFontState(e){return this.fontStates.get(e)??null}ensureFontIsLoaded(e){let t=this.getFontState(e);if(t)return t.loadingPromise;let n=this.findOrCreateFontFace(e),r={state:"loading",instance:n,loadingPromise:n.load().then(()=>{document.fonts.add(n),this.fontStates.update(e,e=>({...e,state:"ready"}))}).catch(t=>{console.error(t),this.fontStates.update(e,e=>({...e,state:"error"}))})};return this.fontStates.set(e,r),r.loadingPromise}fontsToLoad=new Set;requestFonts(e){for(let t of(this.fontsToLoad.size||queueMicrotask(()=>{if(this.editor.isDisposed)return;let e=this.fontsToLoad;this.fontsToLoad=new Set,(0,r.ay)(()=>{for(let t of e)this.ensureFontIsLoaded(t)})}),e))this.fontsToLoad.add(t)}findOrCreateFontFace(e){for(let t of document.fonts)if(t.family===e.family&&(0,o.EP)(a).every(([n,r])=>t[n]===(e[n]??r)))return t;let t=this.assetUrls?.[e.src.url]??e.src.url,n=new FontFace(e.family,`url(${JSON.stringify(t)})`,{...(0,o.Fm)(a,t=>e[t]),display:"swap"});return document.fonts.add(n),n}async toEmbeddedCssDeclaration(e){let t=this.assetUrls?.[e.src.url]??e.src.url,n=await o.P6.urlToDataUrl(t),r=(0,o.oA)([`url("${n}")`,e.src.format?`format(${e.src.format})`:null,e.src.tech?`tech(${e.src.tech})`:null]).join(" ");return(0,o.oA)(["@font-face {",`  font-family: "${e.family}";`,e.ascentOverride?`  ascent-override: ${e.ascentOverride};`:null,e.descentOverride?`  descent-override: ${e.descentOverride};`:null,e.stretch?`  font-stretch: ${e.stretch};`:null,e.style?`  font-style: ${e.style};`:null,e.weight?`  font-weight: ${e.weight};`:null,e.featureSettings?`  font-feature-settings: ${e.featureSettings};`:null,e.lineGapOverride?`  line-gap-override: ${e.lineGapOverride};`:null,e.unicodeRange?`  unicode-range: ${e.unicodeRange};`:null,`  src: ${r};`,"}"]).join("\n")}};let a={style:"normal",weight:"normal",stretch:"normal",unicodeRange:"U+0-10FFFF",featureSettings:"normal",ascentOverride:"normal",descentOverride:"normal",lineGapOverride:"normal"}},42072:function(e,t,n){"use strict";n.d(t,{E:function(){return HistoryManager}});var r,i=n(31316),o=n(63134),a=n(70938),l=((r=l||{}).Recording="recording",r.RecordingPreserveRedoStack="recordingPreserveRedoStack",r.Paused="paused",r);let HistoryManager=class HistoryManager{store;dispose;state="recording";pendingDiff=new PendingDiff;stacks=(0,i.cn)("HistoryManager.stacks",{undos:stack(),redos:stack()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos});annotateError;constructor(e){this.store=e.store,this.annotateError=e.annotateError??a.ZT,this.dispose=this.store.addHistoryInterceptor((e,t)=>{if("user"===t)switch(this.state){case"recording":this.pendingDiff.apply(e.changes),this.stacks.update(({undos:e})=>({undos:e,redos:stack()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(e.changes);break;case"paused":break;default:(0,a.iP)(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;let e=this.pendingDiff.clear();this.stacks.update(({undos:t,redos:n})=>({undos:t.push({type:"diff",diff:e}),redos:n}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}_isInBatch=!1;batch(e,t){let n=this.state;"paused"!==n&&t?.history&&(this.state=d[t.history]);try{if(this._isInBatch)return(0,i.ay)(e),this;this._isInBatch=!0;try{(0,i.ay)(e)}catch(e){throw this.annotateError(e),e}finally{this._isInBatch=!1}return this}finally{this.state=n}}_undo({pushToRedoStack:e,toMark:t}){let n=this.state;this.state="paused";try{let{undos:n,redos:r}=this.stacks.get(),i=this.pendingDiff.clear(),l=(0,o.B4)(i),d=(0,o.kJ)(i);e&&!l&&(r=r.push({type:"diff",diff:i}));let c=!1;if(l)for(;n.head?.type==="stop";){let i=n.head;if(n=n.tail,e&&(r=r.push(i)),i.id===t){c=!0;break}}if(!c)t:for(;n.head;){let i=n.head;switch(n=n.tail,e&&(r=r.push(i)),i.type){case"diff":(0,o.Ce)(d,[(0,o.kJ)(i.diff)]);break;case"stop":if(!t)break t;if(i.id===t){c=!0;break t}break;default:(0,a.iP)(i)}}if(!c&&t)return this;this.store.applyDiff(d,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:n,redos:r})}finally{this.state=n}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){let e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:e,redos:t}=this.stacks.get();if(0===t.length)return this;for(;t.head?.type==="stop";)e=e.push(t.head),t=t.tail;let n=(0,o.YD)();for(;t.head;){let r=t.head;if(e=e.push(r),t=t.tail,"diff"===r.type)(0,o.Ce)(n,[r.diff]);else break}this.store.applyDiff(n,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:e,redos:t})}finally{this.state=e}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(e){return e&&this._undo({pushToRedoStack:!1,toMark:e}),this}squashToMark(e){let t=this.stacks.get().undos,n=[];for(;t.head&&!("stop"===t.head.type&&t.head.id===e);)"diff"===t.head.type&&n.push(t.head.diff),t=t.tail;if(!t.head||t.head?.id!==e)return console.error("Could not find mark to squash to: ",e),this;if(0===n.length)return this;let r=(0,o.YD)();return(0,o.Ce)(r,n.reverse()),this.stacks.update(({redos:e})=>({undos:t.push({type:"diff",diff:r}),redos:e})),this}_mark(e){(0,i.ay)(()=>{this.flushPendingDiff(),this.stacks.update(({undos:t,redos:n})=>({undos:t.push({type:"stop",id:e}),redos:n}))})}clear(){this.stacks.set({undos:stack(),redos:stack()}),this.pendingDiff.clear()}getMarkIdMatching(e){let t=this.stacks.get().undos;for(;t.head;){if("stop"===t.head.type&&t.head.id.includes(e))return t.head.id;t=t.tail}return null}debug(){let{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}};let d={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};let PendingDiff=class PendingDiff{diff=(0,o.YD)();isEmptyAtom=(0,i.cn)("PendingDiff.isEmpty",!0);clear(){let e=this.diff;return this.diff=(0,o.YD)(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){(0,o.Ce)(this.diff,[e]),this.isEmptyAtom.set((0,o.B4)(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}};function stack(e){if(e){let t=c;for(;e.length;)t=t.push(e.pop());return t}return c}let EmptyStackItem=class EmptyStackItem{length=0;head=null;tail=this;push(e){return new StackItem(e,this)}toArray(){return i.LZ}[Symbol.iterator](){return{next:()=>({value:void 0,done:!0})}}};let c=new EmptyStackItem;let StackItem=class StackItem{constructor(e,t){this.head=e,this.tail=t,this.length=t.length+1}length;push(e){return new StackItem(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(!e.length)return{value:void 0,done:!0};{let t=e.head;return e=e.tail,{value:t,done:!1}}}}}}},12275:function(e,t,n){"use strict";n.d(t,{o:function(){return ScribbleManager}});var r=n(70938),i=n(14204);let ScribbleManager=class ScribbleManager{constructor(e){this.editor=e}scribbleItems=new Map;state="paused";addScribble(e,t=(0,r.EL)()){let n={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,n),n}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(e){let t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t}addPoint(e,t,n,r=.5){let o=this.scribbleItems.get(e);if(!o)throw Error(`Scribble with id ${e} not found`);let{prev:a}=o,l={x:t,y:n,z:r};return(!a||i.B.Dist(a,l)>=1)&&(o.next=l),o}tick(e){0!==this.scribbleItems.size&&this.editor.run(()=>{this.scribbleItems.forEach(t=>{if("starting"===t.scribble.state){let{next:e,prev:n}=t;e&&e!==n&&(t.prev=e,t.scribble.points.push(e)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);let{delayRemaining:n,timeoutMs:r,prev:i,next:o,scribble:a}=t;switch(a.state){case"active":o&&o!==i?(t.prev=o,a.points.push(o),0===n&&a.points.length>8&&a.points.shift()):0===r&&(a.points.length>1?a.points.shift():t.delayRemaining=a.delay);break;case"stopping":if(0===t.delayRemaining&&0===r){if(1===a.points.length){this.scribbleItems.delete(t.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:e})=>({...e,points:[...e.points]})).slice(-5)})})}}},51071:function(e,t,n){"use strict";n.d(t,{J:function(){return BoundsSnaps}});var r,i,o,a,l,d=n(31316),c=n(70938),u=n(30696),h=n(45404),p=n(14204),f=n(46166),g=Object.create,m=Object.defineProperty,y=Object.getOwnPropertyDescriptor,__knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,n)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__name=(e,t)=>m(e,"name",{value:t,configurable:!0}),b=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=e=>void 0!==e&&"function"!=typeof e?__typeError("Function expected"):e,__decoratorContext=(e,t,n,r,i)=>({kind:b[e],name:t,metadata:r,addInitializer:e=>n._?__typeError("Already initialized"):i.push(__expectFn(e||null))}),__decoratorMetadata=(e,t)=>__defNormalProp(t,__knownSymbol("metadata"),e[3]),__runInitializers=(e,t,n,r)=>{for(var i=0,o=e[t>>1],a=o&&o.length;i<a;i++)1&t?o[i].call(n):r=o[i].call(n,r);return r},__decorateElement=(e,t,n,r,i,o)=>{var a,l,d,c,u,h=7&t,p=!!(8&t),f=!!(16&t),g=h>3?e.length+1:h?p?1:2:0,S=b[h+5],v=h>3&&(e[g-1]=[]),k=e[g]||(e[g]=[]),_=h&&(f||p||(i=i.prototype),h<5&&(h>3||!f)&&y(h<4?i:{get[n](){return __privateGet(this,o)},set[n](x){return __privateSet(this,o,x)}},n));h?f&&h<4&&__name(o,(h>2?"set ":h>1?"get ":"")+n):__name(i,n);for(var C=r.length-1;C>=0;C--)c=__decoratorContext(h,n,d={},e[3],k),h&&(c.static=p,c.private=f,u=c.access={has:f?e=>__privateIn(i,e):e=>n in e},3^h&&(u.get=f?e=>(1^h?__privateGet:__privateMethod)(e,i,4^h?o:_.get):e=>e[n]),h>2&&(u.set=f?(e,t)=>__privateSet(e,i,t,4^h?o:_.set):(e,t)=>e[n]=t)),l=(0,r[C])(h?h<4?f?o:_[S]:h>4?void 0:{get:_.get,set:_.set}:i,c),d._=1,4^h||void 0===l?__expectFn(l)&&(h>4?v.unshift(l):h?f?o=l:_[S]=l:i=l):"object"!=typeof l||null===l?__typeError("Object expected"):(__expectFn(a=l.get)&&(_.get=a),__expectFn(a=l.set)&&(_.set=a),__expectFn(a=l.init)&&v.unshift(a));return h||__decoratorMetadata(e,i),_&&m(i,n,_),f?4^h?o:_:i},__publicField=(e,t,n)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),__accessCheck=(e,t,n)=>t.has(e)||__typeError("Cannot "+n),__privateIn=(e,t)=>Object(t)!==t?__typeError('Cannot use the "in" operator on this value'):e.has(t),__privateGet=(e,t,n)=>(__accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),__privateSet=(e,t,n,r)=>(__accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),__privateMethod=(e,t,n)=>(__accessCheck(e,t,"access private method"),n);let round=e=>Math.round(1e8*e)/1e8;function findAdjacentGaps(e,t,n,r,i){let o=e.filter(e=>("forward"===r?e.startNode.id===t:e.endNode.id===t)&&round(e.length)===round(n)&&(0,f.mW)(e.breadthIntersection[0],e.breadthIntersection[1],i[0],i[1]));if(0===o.length)return[];let a=new Set;return o.forEach(t=>{let l="forward"===r?t.endNode.id:t.startNode.id;if(!a.has(l)){a.add(l);let d=findAdjacentGaps(e,l,n,r,(0,f.mW)(t.breadthIntersection[0],t.breadthIntersection[1],i[0],i[1]));o.push(...d)}}),o}a=[d.Fl],o=[d.Fl],i=[d.Fl],r=[d.Fl];let BoundsSnaps=class BoundsSnaps{constructor(e){this.manager=e,__runInitializers(l,5,this),__publicField(this,"editor"),this.editor=e.editor}getSnapPointsCache(){let{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{let n=e.getShapePageTransform(t.id);if(!n)return;let r=e.getShapeUtil(t).getBoundsSnapGeometry(t),i=r.points??e.getShapeGeometry(t).bounds.cornersAndCenter;if(n&&i)return i.map((e,r)=>{let{x:i,y:o}=h._.applyToPoint(n,e);return{x:i,y:o,id:`${t.id}:${r}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){let e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),n=[];for(let r of t){let t=e.get(r);t&&n.push(...t)}return n}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:(0,c.kP)(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){let e,t;let n=[],r=[],i=this.getSnappableGapNodes().sort((e,t)=>e.pageBounds.minX-t.pageBounds.minX);for(let r=0;r<i.length;r++){e=i[r];for(let o=r+1;o<i.length;o++)t=i[o],e.pageBounds.maxX<t.pageBounds.minX&&(0,f.ep)(e.pageBounds.minY,e.pageBounds.maxY,t.pageBounds.minY,t.pageBounds.maxY)&&n.push({startNode:e,endNode:t,startEdge:[new p.B(e.pageBounds.maxX,e.pageBounds.minY),new p.B(e.pageBounds.maxX,e.pageBounds.maxY)],endEdge:[new p.B(t.pageBounds.minX,t.pageBounds.minY),new p.B(t.pageBounds.minX,t.pageBounds.maxY)],length:t.pageBounds.minX-e.pageBounds.maxX,breadthIntersection:(0,f.mW)(e.pageBounds.minY,e.pageBounds.maxY,t.pageBounds.minY,t.pageBounds.maxY)})}let o=i.sort((e,t)=>e.pageBounds.minY-t.pageBounds.minY);for(let n=0;n<o.length;n++){e=o[n];for(let i=n+1;i<o.length;i++)t=o[i],e.pageBounds.maxY<t.pageBounds.minY&&(0,f.ep)(e.pageBounds.minX,e.pageBounds.maxX,t.pageBounds.minX,t.pageBounds.maxX)&&r.push({startNode:e,endNode:t,startEdge:[new p.B(e.pageBounds.minX,e.pageBounds.maxY),new p.B(e.pageBounds.maxX,e.pageBounds.maxY)],endEdge:[new p.B(t.pageBounds.minX,t.pageBounds.minY),new p.B(t.pageBounds.maxX,t.pageBounds.minY)],length:t.pageBounds.minY-e.pageBounds.maxY,breadthIntersection:(0,f.mW)(e.pageBounds.minX,e.pageBounds.maxX,t.pageBounds.minX,t.pageBounds.maxX)})}return{horizontal:n,vertical:r}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:n,dragDelta:r}){let i=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),a=t.clone().translate(r),l=n.map(({x:e,y:t},n)=>({id:"selection:"+n,x:e+r.x,y:t+r.y})),d=[],c=[],u=new p.B(i,i);this.collectPointSnaps({minOffset:u,nearestSnapsX:d,nearestSnapsY:c,otherNodeSnapPoints:o,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:c,minOffset:u});let h=new p.B("x"===e?0:d[0]?.nudge??0,"y"===e?0:c[0]?.nudge??0);u.x=0,u.y=0,d.length=0,c.length=0,l.forEach(e=>{e.x+=h.x,e.y+=h.y}),a.translate(h),this.collectPointSnaps({minOffset:u,nearestSnapsX:d,nearestSnapsY:c,otherNodeSnapPoints:o,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:c,minOffset:u});let f=this.getPointSnapLines({nearestSnapsX:d,nearestSnapsY:c}),g=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:c});return this.manager.setIndicators([...g,...f]),{nudge:h}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:n,isAspectRatioLocked:r,isResizingFromCenter:i}){let o=this.manager.getSnapThreshold(),{box:a,scaleX:l,scaleY:d}=u.xu.Resize(e,n,i?2*t.x:t.x,i?2*t.y:t.y,r),c=n;l<0&&(c=(0,u.Ee)(c)),d<0&&(c=(0,u.Op)(c)),i&&(a.center=e.center);let h="top"===c||"bottom"===c,f="left"===c||"right"===c,g=getResizeSnapPointsForHandle(c,a),m=this.getSnappablePoints(),y=[],b=[],S=new p.B(o,o);this.collectPointSnaps({minOffset:S,nearestSnapsX:y,nearestSnapsY:b,otherNodeSnapPoints:m,selectionSnapPoints:g});let v=new p.B(h?0:y[0]?.nudge??0,f?0:b[0]?.nudge??0);if(r&&(0,u.m3)(c)&&0!==v.len()){let t=y.length&&b.length?Math.abs(v.x)<Math.abs(v.y)?"x":"y":y.length?"x":"y",n=e.aspectRatio;"x"===t?(b.length=0,v.y=v.x/n,("bottom_left"===c||"top_right"===c)&&(v.y=-v.y)):(y.length=0,v.x=v.y*n,("bottom_left"===c||"top_right"===c)&&(v.x=-v.x))}let k=p.B.Add(t,v),{box:_}=u.xu.Resize(e,n,i?2*k.x:k.x,i?2*k.y:k.y,r);i&&(_.center=e.center);let C=getResizeSnapPointsForHandle("any",_);y.length=0,b.length=0,S.x=0,S.y=0,this.collectPointSnaps({minOffset:S,nearestSnapsX:y,nearestSnapsY:b,otherNodeSnapPoints:m,selectionSnapPoints:C});let E=this.getPointSnapLines({nearestSnapsX:y,nearestSnapsY:b});return this.manager.setIndicators([...E]),{nudge:v}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:n,nearestSnapsX:r,nearestSnapsY:i}){for(let o of e)for(let e of t){let t=p.B.Sub(o,e),a=Math.abs(t.x),l=Math.abs(t.y);round(a)<=round(n.x)&&(round(a)<round(n.x)&&(r.length=0),r.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.x-o.x}),n.x=a),round(l)<=round(n.y)&&(round(l)<round(n.y)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.y-o.y}),n.y=l)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:n,nearestSnapsY:r}){let{horizontal:i,vertical:o}=this.getVisibleGaps();for(let r of i){if(!(0,f.ep)(r.breadthIntersection[0],r.breadthIntersection[1],e.minY,e.maxY))continue;let i=r.startEdge[0].x+r.length/2,o=i-e.center.x,a=r.length>e.width;if(a&&round(Math.abs(o))<=round(t.x)){round(Math.abs(o))<round(t.x)&&(n.length=0),t.x=Math.abs(o);let e={type:"gap_center",gap:r,nudge:o},i=n.find(({type:e})=>"gap_center"===e),a=i&&(0,f.mW)(r.breadthIntersection[0],r.breadthIntersection[1],i.gap.breadthIntersection[0],i.gap.breadthIntersection[1]);i&&i.gap.length>r.length&&a?n[n.indexOf(i)]=e:i&&a||n.push(e)}let l=r.startNode.pageBounds.minX-r.length,d=e.maxX,c=l-d;round(Math.abs(c))<=round(t.x)&&(round(Math.abs(c))<round(t.x)&&(n.length=0),t.x=Math.abs(c),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"left",nudge:c}));let u=r.endNode.pageBounds.maxX+r.length,h=e.minX,p=u-h;round(Math.abs(p))<=round(t.x)&&(round(Math.abs(p))<round(t.x)&&(n.length=0),t.x=Math.abs(p),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"right",nudge:p}))}for(let n of o){if(!(0,f.ep)(n.breadthIntersection[0],n.breadthIntersection[1],e.minX,e.maxX))continue;let i=n.startEdge[0].y+n.length/2,o=i-e.center.y,a=n.length>e.height;if(a&&round(Math.abs(o))<=round(t.y)){round(Math.abs(o))<round(t.y)&&(r.length=0),t.y=Math.abs(o);let e={type:"gap_center",gap:n,nudge:o},i=r.find(({type:e})=>"gap_center"===e),a=i&&(0,f.ep)(i.gap.breadthIntersection[0],i.gap.breadthIntersection[1],n.breadthIntersection[0],n.breadthIntersection[1]);i&&i.gap.length>n.length&&a?r[r.indexOf(i)]=e:i&&a||r.push(e);continue}let l=n.startNode.pageBounds.minY-n.length,d=e.maxY,c=l-d;round(Math.abs(c))<=round(t.y)&&(round(Math.abs(c))<round(t.y)&&(r.length=0),t.y=Math.abs(c),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"top",nudge:c}));let u=n.endNode.pageBounds.maxY+n.length,h=e.minY,p=u-h;round(Math.abs(p))<=round(t.y)&&(round(Math.abs(p))<round(t.y)&&(r.length=0),t.y=Math.abs(p),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"bottom",nudge:p}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){let n={},r={};if(e.length>0){for(let t of e)if("points"===t.type){let e=round(t.points.otherPoint.x);n[e]||(n[e]=[]),n[e].push(t.points)}}if(t.length>0){for(let e of t)if("points"===e.type){let t=round(e.points.otherPoint.y);r[t]||(r[t]=[]),r[t].push(e.points)}}return Object.values(n).concat(Object.values(r)).map(e=>({id:(0,c.EL)(),type:"points",points:(0,c.D8)(e.map(e=>p.B.From(e.otherPoint)).concat(e.map(e=>p.B.From(e.thisPoint))),(e,t)=>e.equals(t))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:n}){let{vertical:r,horizontal:i}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(let n of t){if("points"===n.type)continue;let{gap:{breadthIntersection:t,startEdge:r,startNode:l,endNode:d,length:u,endEdge:h}}=n;switch(n.type){case"gap_center":{let n=(u-e.width)/2,p=(0,f.mW)(t[0],t[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:(0,c.EL)(),gaps:[...findAdjacentGaps(i,l.id,n,"backward",p),{startEdge:r,endEdge:o.left},{startEdge:o.right,endEdge:h},...findAdjacentGaps(i,d.id,n,"forward",p)]});break}case"gap_duplicate":{let p=(0,f.mW)(t[0],t[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:(0,c.EL)(),gaps:"left"===n.protrusionDirection?[{startEdge:o.right,endEdge:r.map(e=>e.clone().addXY(-l.pageBounds.width,0))},{startEdge:r,endEdge:h},...findAdjacentGaps(i,d.id,u,"forward",p)]:[...findAdjacentGaps(i,l.id,u,"backward",p),{startEdge:r,endEdge:h},{startEdge:h.map(e=>e.clone().addXY(n.gap.endNode.pageBounds.width,0)),endEdge:o.left}]})}}}if(n.length>0)for(let t of n){if("points"===t.type)continue;let{gap:{breadthIntersection:n,startEdge:i,startNode:l,endNode:d,length:u,endEdge:h}}=t;switch(t.type){case"gap_center":{let d=(u-e.height)/2,p=(0,f.mW)(n[0],n[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:(0,c.EL)(),gaps:[...findAdjacentGaps(r,l.id,d,"backward",p),{startEdge:i,endEdge:o.top},{startEdge:o.bottom,endEdge:h},...findAdjacentGaps(r,t.gap.endNode.id,d,"forward",p)]});break}case"gap_duplicate":{let p=(0,f.mW)(n[0],n[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:(0,c.EL)(),gaps:"top"===t.protrusionDirection?[{startEdge:o.bottom,endEdge:i.map(e=>e.clone().addXY(0,-l.pageBounds.height))},{startEdge:i,endEdge:h},...findAdjacentGaps(r,d.id,u,"forward",p)]:[...findAdjacentGaps(r,l.id,u,"backward",p),{startEdge:i,endEdge:h},{startEdge:h.map(e=>e.clone().addXY(0,d.pageBounds.height)),endEdge:o.top}]})}}}return!function(e){e.sort((e,t)=>t.gaps.length-e.gaps.length);for(let t=e.length-1;t>0;t--){let n=e[t];for(let r=t-1;r>=0;r--){let i=e[r];if(i.direction===n.direction&&n.gaps.every(e=>i.gaps.some(t=>round(e.startEdge[0].x)===round(t.startEdge[0].x)&&round(e.startEdge[0].y)===round(t.startEdge[0].y)&&round(e.startEdge[1].x)===round(t.startEdge[1].x)&&round(e.startEdge[1].y)===round(t.startEdge[1].y))&&i.gaps.some(t=>round(e.endEdge[0].x)===round(t.endEdge[0].x)&&round(e.endEdge[0].y)===round(t.endEdge[0].y)&&round(e.endEdge[1].x)===round(t.endEdge[1].x)&&round(e.endEdge[1].y)===round(t.endEdge[1].y)))){e.splice(t,1);break}}}}(a),a}};function getResizeSnapPointsForHandle(e,t){let{minX:n,maxX:r,minY:i,maxY:o}=t,a=[];switch(e){case"top":case"left":case"top_left":case"any":a.push({id:"top_left",handle:"top_left",x:n,y:i})}switch(e){case"top":case"right":case"top_right":case"any":a.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(e){case"bottom":case"right":case"bottom_right":case"any":a.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(e){case"bottom":case"left":case"bottom_left":case"any":a.push({id:"bottom_left",handle:"bottom_left",x:n,y:o})}return a}__decorateElement(l=[,,,g((void 0)??null)],1,"getSnapPointsCache",a,BoundsSnaps),__decorateElement(l,1,"getSnappablePoints",o,BoundsSnaps),__decorateElement(l,1,"getSnappableGapNodes",i,BoundsSnaps),__decorateElement(l,1,"getVisibleGaps",r,BoundsSnaps),__decoratorMetadata(l,BoundsSnaps)},49161:function(e,t,n){"use strict";n.d(t,{O:function(){return HandleSnaps}});var r,i,o=n(31316),a=n(70938),l=n(14204),d=Object.create,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,__knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,n)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__name=(e,t)=>c(e,"name",{value:t,configurable:!0}),h=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=e=>void 0!==e&&"function"!=typeof e?__typeError("Function expected"):e,__decoratorContext=(e,t,n,r,i)=>({kind:h[e],name:t,metadata:r,addInitializer:e=>n._?__typeError("Already initialized"):i.push(__expectFn(e||null))}),__decoratorMetadata=(e,t)=>__defNormalProp(t,__knownSymbol("metadata"),e[3]),__runInitializers=(e,t,n,r)=>{for(var i=0,o=e[t>>1],a=o&&o.length;i<a;i++)1&t?o[i].call(n):r=o[i].call(n,r);return r},__publicField=(e,t,n)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),__accessCheck=(e,t,n)=>t.has(e)||__typeError("Cannot "+n),__privateIn=(e,t)=>Object(t)!==t?__typeError('Cannot use the "in" operator on this value'):e.has(t),__privateGet=(e,t,n)=>(__accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),__privateSet=(e,t,n,r)=>(__accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),__privateMethod=(e,t,n)=>(__accessCheck(e,t,"access private method"),n);let defaultGetSelfSnapOutline=()=>null,defaultGetSelfSnapPoints=()=>[];r=[o.Fl];let HandleSnaps=class HandleSnaps{constructor(e){this.manager=e,__runInitializers(i,5,this),__publicField(this,"editor"),this.editor=e.editor}getSnapGeometryCache(){let{editor:e}=this;return e.store.createComputedCache("handle snap geometry",t=>{let n=e.getShapeUtil(t).getHandleSnapGeometry(t),r=n.getSelfSnapOutline?n.getSelfSnapOutline.bind(n):defaultGetSelfSnapOutline,i=n.getSelfSnapPoints?n.getSelfSnapPoints.bind(n):defaultGetSelfSnapPoints;return{outline:void 0===n.outline?e.getShapeGeometry(t):n.outline,points:n.points??[],getSelfSnapOutline:r,getSelfSnapPoints:i}})}*iterateSnapPointsInPageSpace(e,t){let n=this.getSnapGeometryCache().get(e)?.getSelfSnapPoints(t);if(n&&n.length){let t=(0,a.kP)(this.editor.getShapePageTransform(e));for(let e of n)yield t.applyToPoint(e)}for(let t of this.manager.getSnappableShapes()){if(t===e)continue;let n=this.getSnapGeometryCache().get(t)?.points;if(!n||!n.length)continue;let r=(0,a.kP)(this.editor.getShapePageTransform(t));for(let e of n)yield r.applyToPoint(e)}}*iterateSnapOutlines(e,t){let n=this.getSnapGeometryCache().get(e)?.getSelfSnapOutline(t);for(let t of(n&&(yield{shapeId:e,outline:n}),this.manager.getSnappableShapes())){if(t===e)continue;let n=this.getSnapGeometryCache().get(t)?.outline;n&&(yield{shapeId:t,outline:n})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:n}){let r=this.manager.getSnapThreshold(),i=r,o=null;for(let r of this.iterateSnapPointsInPageSpace(e,t))l.B.DistMin(n,r,i)&&(i=l.B.Dist(n,r),o=r);if(o)return o;let d=r,c=null;for(let{shapeId:r,outline:i}of this.iterateSnapOutlines(e,t)){let e=(0,a.kP)(this.editor.getShapePageTransform(r)),t=this.editor.getPointInShapeSpace(r,n),o=i.nearestPoint(t),u=e.applyToPoint(o);l.B.DistMin(n,u,d)&&(d=l.B.Dist(n,u),c=u)}return c||null}snapHandle({currentShapeId:e,handle:t}){let n=(0,a.kP)(this.editor.getShapePageTransform(e)),r=n.applyToPoint(t),i=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:r});return i?(this.manager.setIndicators([{id:(0,a.EL)(),type:"points",points:[i]}]),{nudge:l.B.Sub(i,r)}):null}};((e,t,n,r,i,o)=>{var a,l,d,p,f,g=7&t,m=!!(8&t),y=!!(16&t),b=g>3?e.length+1:g?m?1:2:0,S=h[g+5],v=g>3&&(e[b-1]=[]),k=e[b]||(e[b]=[]),_=g&&(y||m||(i=i.prototype),g<5&&(g>3||!y)&&u(g<4?i:{get[n](){return __privateGet(this,o)},set[n](x){return __privateSet(this,o,x)}},n));g?y&&g<4&&__name(o,(g>2?"set ":g>1?"get ":"")+n):__name(i,n);for(var C=r.length-1;C>=0;C--)p=__decoratorContext(g,n,d={},e[3],k),g&&(p.static=m,p.private=y,f=p.access={has:y?e=>__privateIn(i,e):e=>n in e},3^g&&(f.get=y?e=>(1^g?__privateGet:__privateMethod)(e,i,4^g?o:_.get):e=>e[n]),g>2&&(f.set=y?(e,t)=>__privateSet(e,i,t,4^g?o:_.set):(e,t)=>e[n]=t)),l=(0,r[C])(g?g<4?y?o:_[S]:g>4?void 0:{get:_.get,set:_.set}:i,p),d._=1,4^g||void 0===l?__expectFn(l)&&(g>4?v.unshift(l):g?y?o=l:_[S]=l:i=l):"object"!=typeof l||null===l?__typeError("Object expected"):(__expectFn(a=l.get)&&(_.get=a),__expectFn(a=l.set)&&(_.set=a),__expectFn(a=l.init)&&v.unshift(a));return g||__decoratorMetadata(e,i),_&&c(i,n,_),y?4^g?o:_:i})(i=[,,,d((void 0)??null)],1,"getSnapGeometryCache",r,HandleSnaps),__decoratorMetadata(i,HandleSnaps)},57258:function(e,t,n){"use strict";n.d(t,{f:function(){return SnapManager}});var r,i,o,a,l=n(31316),d=n(43001),c=n(51071),u=n(49161),h=Object.create,p=Object.defineProperty,f=Object.getOwnPropertyDescriptor,__knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,n)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__name=(e,t)=>p(e,"name",{value:t,configurable:!0}),g=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=e=>void 0!==e&&"function"!=typeof e?__typeError("Function expected"):e,__decoratorContext=(e,t,n,r,i)=>({kind:g[e],name:t,metadata:r,addInitializer:e=>n._?__typeError("Already initialized"):i.push(__expectFn(e||null))}),__decoratorMetadata=(e,t)=>__defNormalProp(t,__knownSymbol("metadata"),e[3]),__runInitializers=(e,t,n,r)=>{for(var i=0,o=e[t>>1],a=o&&o.length;i<a;i++)1&t?o[i].call(n):r=o[i].call(n,r);return r},__decorateElement=(e,t,n,r,i,o)=>{var a,l,d,c,u,h=7&t,m=!!(8&t),y=!!(16&t),b=h>3?e.length+1:h?m?1:2:0,S=g[h+5],v=h>3&&(e[b-1]=[]),k=e[b]||(e[b]=[]),_=h&&(y||m||(i=i.prototype),h<5&&(h>3||!y)&&f(h<4?i:{get[n](){return __privateGet(this,o)},set[n](x){return __privateSet(this,o,x)}},n));h?y&&h<4&&__name(o,(h>2?"set ":h>1?"get ":"")+n):__name(i,n);for(var C=r.length-1;C>=0;C--)c=__decoratorContext(h,n,d={},e[3],k),h&&(c.static=m,c.private=y,u=c.access={has:y?e=>__privateIn(i,e):e=>n in e},3^h&&(u.get=y?e=>(1^h?__privateGet:__privateMethod)(e,i,4^h?o:_.get):e=>e[n]),h>2&&(u.set=y?(e,t)=>__privateSet(e,i,t,4^h?o:_.set):(e,t)=>e[n]=t)),l=(0,r[C])(h?h<4?y?o:_[S]:h>4?void 0:{get:_.get,set:_.set}:i,c),d._=1,4^h||void 0===l?__expectFn(l)&&(h>4?v.unshift(l):h?y?o=l:_[S]=l:i=l):"object"!=typeof l||null===l?__typeError("Object expected"):(__expectFn(a=l.get)&&(_.get=a),__expectFn(a=l.set)&&(_.set=a),__expectFn(a=l.init)&&v.unshift(a));return h||__decoratorMetadata(e,i),_&&p(i,n,_),y?4^h?o:_:i},__publicField=(e,t,n)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),__accessCheck=(e,t,n)=>t.has(e)||__typeError("Cannot "+n),__privateIn=(e,t)=>Object(t)!==t?__typeError('Cannot use the "in" operator on this value'):e.has(t),__privateGet=(e,t,n)=>(__accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),__privateSet=(e,t,n,r)=>(__accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),__privateMethod=(e,t,n)=>(__accessCheck(e,t,"access private method"),n);o=[l.Fl],i=[l.Fl],r=[l.Fl];let SnapManager=class SnapManager{constructor(e){this.editor=e,__runInitializers(a,5,this),__publicField(this,"shapeBounds"),__publicField(this,"handles"),__publicField(this,"_snapIndicators",(0,l.cn)("snapLines",void 0)),this.shapeBounds=new c.J(this),this.handles=new u.O(this)}getIndicators(){return this._snapIndicators.get()??l.LZ}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){let{editor:e}=this,t=e.getViewportPageBounds(),n=e.getSelectedShapeIds(),r=new Set,collectSnappableShapesFromParent=i=>{if((0,d.YT)(i)){let t=e.getShape(i);t&&e.isShapeOfType(t,"frame")&&r.add(i)}let o=e.getSortedChildIdsForParent(i);for(let i of o){if(n.includes(i))continue;let o=e.getShape(i);if(!o)continue;let a=e.getShapeUtil(o);if(!a.canSnap(o))continue;let l=e.getShapePageBounds(i);if(l&&t.includes(l)){if(e.isShapeOfType(o,"group")){collectSnappableShapesFromParent(i);continue}r.add(i)}}};return collectSnappableShapesFromParent(this.getCurrentCommonAncestor()??e.getCurrentPageId()),r}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}};__decorateElement(a=[,,,h((void 0)??null)],1,"getSnapThreshold",o,SnapManager),__decorateElement(a,1,"getSnappableShapes",i,SnapManager),__decorateElement(a,1,"getCurrentCommonAncestor",r,SnapManager),__decoratorMetadata(a,SnapManager)},48568:function(e,t,n){"use strict";n.d(t,{R:function(){return TextManager}});var r=n(70938);let i=/\r?\n|\r/g;function normalizeTextForDom(e){return e.replace(i,"\n").split("\n").map(e=>e||" ").join("\n")}let o={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},a=/\s/,l=Object.freeze({"overflow-wrap":"break-word","word-break":"auto",width:null,height:null,"max-width":null,"min-width":null});let TextManager=class TextManager{constructor(e){this.editor=e;let t=document.createElement("div");for(let e of(t.classList.add("tl-text"),t.classList.add("tl-text-measure"),t.setAttribute("dir","auto"),t.tabIndex=-1,this.editor.getContainer().appendChild(t),this.elm=t,(0,r.GH)(l)))t.style.setProperty(e,l[e])}elm;setElementStyles(e){let t={};for(let n of(0,r.GH)(e))if("string"==typeof e[n]){let r=this.elm.style.getPropertyValue(n);if(r===e[n])continue;t[n]=r,this.elm.style.setProperty(n,e[n])}return()=>{for(let e of(0,r.GH)(t))this.elm.style.setProperty(e,t[e])}}dispose(){return this.elm.remove()}measureText(e,t){let n=document.createElement("div");return n.textContent=normalizeTextForDom(e),this.measureHtml(n.innerHTML,t)}measureHtml(e,t){let{elm:n}=this,r={"font-family":t.fontFamily,"font-style":t.fontStyle,"font-weight":t.fontWeight,"font-size":t.fontSize+"px","line-height":t.lineHeight.toString(),padding:t.padding,"max-width":t.maxWidth?t.maxWidth+"px":void 0,"min-width":t.minWidth?t.minWidth+"px":void 0,"overflow-wrap":t.disableOverflowWrapBreaking?"normal":void 0,...t.otherStyles},i=this.setElementStyles(r);try{n.innerHTML=e;let r=t.measureScrollWidth?n.scrollWidth:0,i=n.getBoundingClientRect();return{x:0,y:0,w:i.width,h:i.height,scrollWidth:r}}finally{i()}}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){let n=[],r=e.getBoundingClientRect(),i=-r.left,o=-r.top,l=new Range,d=e.childNodes[0],c=0,u=null,h=null,p=0,f=0,g=!1;for(let r of e.childNodes)if(r.nodeType===Node.TEXT_NODE)for(let e of r.textContent??""){l.setStart(d,c),l.setEnd(d,c+e.length);let r=l.getClientRects(),m=r[r.length-1],y=m.top+o,b=m.left+i,S=m.right+i,v=b<f,k=a.test(e);if(k===h&&y===p&&u)v&&(u.box.x=b),u.box.w=v?u.box.w+m.width:S-u.box.x,u.text+=e;else{if(u){if(t&&y!==p){g=!0;break}n.push(u)}u={box:{x:b,y:y,w:m.width,h:m.height},text:e},f=b}"\n"===e&&(f=0),h=k,p=y,c+=e.length}return u&&n.push(u),{spans:n,didTruncate:g}}measureTextSpans(e,t){if(""===e)return[];let{elm:n}=this,r="truncate-ellipsis"===t.overflow||"truncate-clip"===t.overflow,i=Math.ceil(t.width-2*t.padding),a={"font-family":t.fontFamily,"font-style":t.fontStyle,"font-weight":t.fontWeight,"font-size":t.fontSize+"px","line-height":t.lineHeight.toString(),width:`${i}px`,height:"min-content","text-align":o[t.textAlign],"overflow-wrap":r?"anywhere":void 0,"word-break":r?"break-all":void 0,...t.otherStyles},l=this.setElementStyles(a);try{let o=normalizeTextForDom(e);n.textContent=o;let{spans:a,didTruncate:l}=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:r});if("truncate-ellipsis"===t.overflow&&l){n.textContent="";let e=Math.ceil(this.measureElementTextNodeSpans(n).spans[0].box.w);n.style.setProperty("width",`${i-e}px`),n.textContent=o;let r=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:!0}).spans,a=r[r.length-1];return r.push({text:"",box:{x:Math.min(a.box.x+a.box.w,t.width-t.padding-e),y:a.box.y,w:e,h:a.box.h}}),r}return a}finally{l()}}}},8728:function(e,t,n){"use strict";n.d(t,{r:function(){return TickManager}});var r,i,o,a=n(70938),l=n(14204);n(25566);var d=Object.create,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,__knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,n)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__name=(e,t)=>c(e,"name",{value:t,configurable:!0}),h=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=e=>void 0!==e&&"function"!=typeof e?__typeError("Function expected"):e,__decoratorContext=(e,t,n,r,i)=>({kind:h[e],name:t,metadata:r,addInitializer:e=>n._?__typeError("Already initialized"):i.push(__expectFn(e||null))}),__decoratorMetadata=(e,t)=>__defNormalProp(t,__knownSymbol("metadata"),e[3]),__runInitializers=(e,t,n,r)=>{for(var i=0,o=e[t>>1],a=o&&o.length;i<a;i++)1&t?o[i].call(n):r=o[i].call(n,r);return r},__decorateElement=(e,t,n,r,i,o)=>{var a,l,d,p,f,g=7&t,m=!!(8&t),y=!!(16&t),b=g>3?e.length+1:g?m?1:2:0,S=h[g+5],v=g>3&&(e[b-1]=[]),k=e[b]||(e[b]=[]),_=g&&(y||m||(i=i.prototype),g<5&&(g>3||!y)&&u(g<4?i:{get[n](){return __privateGet(this,o)},set[n](x){return __privateSet(this,o,x)}},n));g?y&&g<4&&__name(o,(g>2?"set ":g>1?"get ":"")+n):__name(i,n);for(var C=r.length-1;C>=0;C--)p=__decoratorContext(g,n,d={},e[3],k),g&&(p.static=m,p.private=y,f=p.access={has:y?e=>__privateIn(i,e):e=>n in e},3^g&&(f.get=y?e=>(1^g?__privateGet:__privateMethod)(e,i,4^g?o:_.get):e=>e[n]),g>2&&(f.set=y?(e,t)=>__privateSet(e,i,t,4^g?o:_.set):(e,t)=>e[n]=t)),l=(0,r[C])(g?g<4?y?o:_[S]:g>4?void 0:{get:_.get,set:_.set}:i,p),d._=1,4^g||void 0===l?__expectFn(l)&&(g>4?v.unshift(l):g?y?o=l:_[S]=l:i=l):"object"!=typeof l||null===l?__typeError("Object expected"):(__expectFn(a=l.get)&&(_.get=a),__expectFn(a=l.set)&&(_.set=a),__expectFn(a=l.init)&&v.unshift(a));return g||__decoratorMetadata(e,i),_&&c(i,n,_),y?4^g?o:_:i},__publicField=(e,t,n)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),__accessCheck=(e,t,n)=>t.has(e)||__typeError("Cannot "+n),__privateIn=(e,t)=>Object(t)!==t?__typeError('Cannot use the "in" operator on this value'):e.has(t),__privateGet=(e,t,n)=>(__accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),__privateSet=(e,t,n,r)=>(__accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),__privateMethod=(e,t,n)=>(__accessCheck(e,t,"access private method"),n);let p=a.Gf;i=[a.ak],r=[a.ak];let TickManager=class TickManager{constructor(e){this.editor=e,__runInitializers(o,5,this),__publicField(this,"cancelRaf"),__publicField(this,"isPaused",!0),__publicField(this,"now",0),__publicField(this,"prevPoint",new l.B),this.editor.disposables.add(this.dispose),this.start()}start(){this.isPaused=!1,this.cancelRaf?.(),this.cancelRaf=p(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;let e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=p(this.tick)}dispose(){this.isPaused=!0,this.cancelRaf?.()}updatePointerVelocity(e){let{prevPoint:t,editor:{inputs:{currentScreenPoint:n,pointerVelocity:r}}}=this;if(0===e)return;let i=l.B.Sub(n,t);this.prevPoint=n.clone();let o=i.len(),a=o?i.div(o):new l.B(0,0),d=r.clone().lrp(a.mul(o/e),.5);.01>Math.abs(d.x)&&(d.x=0),.01>Math.abs(d.y)&&(d.y=0),r.equals(d)||(this.editor.inputs.pointerVelocity=d)}};__decorateElement(o=[,,,d((void 0)??null)],1,"tick",i,TickManager),__decorateElement(o,1,"dispose",r,TickManager),__decoratorMetadata(o,TickManager)},5462:function(e,t,n){"use strict";n.d(t,{K:function(){return UserPreferencesManager}});var r,i,o,a,l,d,c,u,h,p,f,g,m,y,b=n(31316),S=n(45894),v=Object.create,k=Object.defineProperty,_=Object.getOwnPropertyDescriptor,__knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,n)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__name=(e,t)=>k(e,"name",{value:t,configurable:!0}),C=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=e=>void 0!==e&&"function"!=typeof e?__typeError("Function expected"):e,__decoratorContext=(e,t,n,r,i)=>({kind:C[e],name:t,metadata:r,addInitializer:e=>n._?__typeError("Already initialized"):i.push(__expectFn(e||null))}),__decoratorMetadata=(e,t)=>__defNormalProp(t,__knownSymbol("metadata"),e[3]),__runInitializers=(e,t,n,r)=>{for(var i=0,o=e[t>>1],a=o&&o.length;i<a;i++)1&t?o[i].call(n):r=o[i].call(n,r);return r},__decorateElement=(e,t,n,r,i,o)=>{var a,l,d,c,u,h=7&t,p=!!(8&t),f=!!(16&t),g=h>3?e.length+1:h?p?1:2:0,m=C[h+5],y=h>3&&(e[g-1]=[]),b=e[g]||(e[g]=[]),S=h&&(f||p||(i=i.prototype),h<5&&(h>3||!f)&&_(h<4?i:{get[n](){return __privateGet(this,o)},set[n](x){return __privateSet(this,o,x)}},n));h?f&&h<4&&__name(o,(h>2?"set ":h>1?"get ":"")+n):__name(i,n);for(var v=r.length-1;v>=0;v--)c=__decoratorContext(h,n,d={},e[3],b),h&&(c.static=p,c.private=f,u=c.access={has:f?e=>__privateIn(i,e):e=>n in e},3^h&&(u.get=f?e=>(1^h?__privateGet:__privateMethod)(e,i,4^h?o:S.get):e=>e[n]),h>2&&(u.set=f?(e,t)=>__privateSet(e,i,t,4^h?o:S.set):(e,t)=>e[n]=t)),l=(0,r[v])(h?h<4?f?o:S[m]:h>4?void 0:{get:S.get,set:S.set}:i,c),d._=1,4^h||void 0===l?__expectFn(l)&&(h>4?y.unshift(l):h?f?o=l:S[m]=l:i=l):"object"!=typeof l||null===l?__typeError("Object expected"):(__expectFn(a=l.get)&&(S.get=a),__expectFn(a=l.set)&&(S.set=a),__expectFn(a=l.init)&&y.unshift(a));return h||__decoratorMetadata(e,i),S&&k(i,n,S),f?4^h?o:S:i},__publicField=(e,t,n)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),__accessCheck=(e,t,n)=>t.has(e)||__typeError("Cannot "+n),__privateIn=(e,t)=>Object(t)!==t?__typeError('Cannot use the "in" operator on this value'):e.has(t),__privateGet=(e,t,n)=>(__accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),__privateSet=(e,t,n,r)=>(__accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),__privateMethod=(e,t,n)=>(__accessCheck(e,t,"access private method"),n);m=[b.Fl],g=[b.Fl],f=[b.Fl],p=[b.Fl],h=[b.Fl],u=[b.Fl],c=[b.Fl],d=[b.Fl],l=[b.Fl],a=[b.Fl],o=[b.Fl],i=[b.Fl],r=[b.Fl];let UserPreferencesManager=class UserPreferencesManager{constructor(e,t){if(this.user=e,this.inferDarkMode=t,__runInitializers(y,5,this),__publicField(this,"systemColorScheme",(0,b.cn)("systemColorScheme","light")),__publicField(this,"disposables",new Set),"undefined"==typeof window||!("matchMedia"in window))return;let n=window.matchMedia("(prefers-color-scheme: dark)");n?.matches&&this.systemColorScheme.set("dark");let handleChange=e=>{e.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")};n?.addEventListener("change",handleChange),this.disposables.add(()=>n?.removeEventListener("change",handleChange))}dispose(){this.disposables.forEach(e=>e())}updateUserPreferences(e){this.user.setUserPreferences({...this.user.userPreferences.get(),...e})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),areKeyboardShortcutsEnabled:this.getAreKeyboardShortcutsEnabled(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return"dark"===this.systemColorScheme.get();default:return!!this.inferDarkMode&&"dark"===this.systemColorScheme.get()}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??S.ks.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??S.ks.animationSpeed}getAreKeyboardShortcutsEnabled(){return this.user.userPreferences.get().areKeyboardShortcutsEnabled??S.ks.areKeyboardShortcutsEnabled}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name?.trim()??S.ks.name}getLocale(){return this.user.userPreferences.get().locale??S.ks.locale}getColor(){return this.user.userPreferences.get().color??S.ks.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??S.ks.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??S.ks.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??S.ks.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??S.ks.isPasteAtCursorMode}};__decorateElement(y=[,,,v((void 0)??null)],1,"getUserPreferences",m,UserPreferencesManager),__decorateElement(y,1,"getIsDarkMode",g,UserPreferencesManager),__decorateElement(y,1,"getEdgeScrollSpeed",f,UserPreferencesManager),__decorateElement(y,1,"getAnimationSpeed",p,UserPreferencesManager),__decorateElement(y,1,"getAreKeyboardShortcutsEnabled",h,UserPreferencesManager),__decorateElement(y,1,"getId",u,UserPreferencesManager),__decorateElement(y,1,"getName",c,UserPreferencesManager),__decorateElement(y,1,"getLocale",d,UserPreferencesManager),__decorateElement(y,1,"getColor",l,UserPreferencesManager),__decorateElement(y,1,"getIsSnapMode",a,UserPreferencesManager),__decorateElement(y,1,"getIsWrapMode",o,UserPreferencesManager),__decorateElement(y,1,"getIsDynamicResizeMode",i,UserPreferencesManager),__decorateElement(y,1,"getIsPasteAtCursorMode",r,UserPreferencesManager),__decoratorMetadata(y,UserPreferencesManager)},25859:function(e,t,n){"use strict";n.d(t,{E:function(){return ShapeUtil}});var r=n(31316);let ShapeUtil=class ShapeUtil{constructor(e){this.editor=e}static configure(e){return class extends this{options={...this.options,...e}}}options={};static props;static migrations;static type;getFontFaces(e){return r.LZ}canSnap(e){return!0}canTabTo(e){return!0}canScroll(e){return!1}canBind(e){return!0}canEdit(e){return!1}canResize(e){return!0}canResizeChildren(e){return!0}canEditInReadonly(e){return!1}canCrop(e){return!1}canBeLaidOut(e,t){return!0}providesBackgroundForChildren(e){return!1}hideResizeHandles(e){return!1}hideRotateHandle(e){return!1}hideSelectionBoundsBg(e){return!1}hideSelectionBoundsFg(e){return!1}isAspectRatioLocked(e){return!1}canReceiveNewChildrenOfType(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}getText(e){}getAriaDescriptor(e){}}},31738:function(e,t,n){"use strict";n.d(t,{Q:function(){return GroupShapeUtil}});var r=n(57437),i=n(43001),o=n(17295),a=n(87684),l=n(29234),d=n(25859),c=n(30742),u=n(3373),h=n(67370);function DashedOutlineBox({bounds:e,className:t}){let n=(0,u.jE)(),i=(0,c.Hg)("zoom level",()=>n.getZoomLevel(),[n]);return(0,r.jsx)("g",{className:t,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:e.sides.map((e,t)=>{let{strokeDasharray:n,strokeDashoffset:o}=(0,h.H)(e[0].dist(e[1]),1/i,{style:"dashed",lengthRatio:4});return(0,r.jsx)("line",{x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y,strokeDasharray:n,strokeDashoffset:o},t)})})}let GroupShapeUtil=class GroupShapeUtil extends d.E{static type="group";static props=i.A7;static migrations=i.c4;hideSelectionBoundsFg(){return!0}canBind(){return!1}canResize(){return!0}canResizeChildren(){return!0}getDefaultProps(){return{}}getGeometry(e){let t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?new l.z({width:1,height:1,isFilled:!1}):new a.m({children:t.map(e=>{let t=this.editor.getShape(e);return this.editor.getShapeGeometry(e).transform(this.editor.getShapeLocalTransform(t),{isLabel:!1})})})}component(e){let t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:n}=this.editor.getCurrentPageState(),i=n.length>0&&n.some(t=>t!==e.id&&this.editor.isShapeOfType(this.editor.getShape(t),"group")),a=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(a||i))return null;let l=this.editor.getShapeGeometry(e).bounds;return(0,r.jsx)(o.g,{children:(0,r.jsx)(DashedOutlineBox,{className:"tl-group",bounds:l})})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds;return(0,r.jsx)(DashedOutlineBox,{className:"",bounds:t})}onChildrenChange(e){let t=this.editor.getSortedChildIdsForParent(e.id);if(0===t.length){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}if(1===t.length){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}}},67370:function(e,t,n){"use strict";function getPerfectDashProps(e,t,n={}){let{closed:r=!1,snap:i=1,start:o="outset",end:a="outset",lengthRatio:l=2,style:d="dashed",forceSolid:c=!1}=n,u=0,h=0,p=1,f=0,g=0;if(c)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(d){case"dashed":p=1,u=Math.min(t*l,e/4);break;case"dotted":u=t/(p=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||("outset"===o?(e+=u/2,g+=u/2):"skip"===o&&(e-=u,g-=u),"outset"===a?e+=u/2:"skip"!==a||(e-=u)),h=Math.floor(e/u/(2*p)),(h-=h%i)<3&&"dashed"===d?e/t<4?(u=e,h=1,f=0):(u=e*(1/3),f=e*(1/3)):(u=e/h/(2*p),r?(g=u/2,f=(e-h*u)/h):f=(e-h*u)/Math.max(1,h-1)),{strokeDasharray:[u,f].join(" "),strokeDashoffset:g.toString()}}n.d(t,{H:function(){return getPerfectDashProps}})},59040:function(e,t,n){"use strict";n.d(t,{m:function(){return RootState}});var r=n(22797);let RootState=class RootState extends r.n{static id="root";static initial="";static children(){return[]}onKeyDown(e){if("KeyZ"===e.code&&!(e.shiftKey||e.ctrlKey)){let t=this.getCurrent();t&&t.getCurrent()?.id==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:t.id})}}}},22797:function(e,t,n){"use strict";n.d(t,{n:function(){return StateNode}});var r=n(31316),i=n(70938),o=n(16384),a=n(40521);let l=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];let StateNode=class StateNode{constructor(e,t){this.editor=e;let{id:n,children:o,initial:a,isLockable:l,useCoalescedEvents:d}=this.constructor;this.id=n,this._isActive=(0,r.cn)("toolIsActive"+this.id,!1),this._current=(0,r.cn)("toolState"+this.id,void 0),this._path=(0,r.Fl)("toolPath"+this.id,()=>{let e=this.getCurrent();return this.id+(e?`.${e.getPath()}`:"")}),this.parent=t??{},t?o&&a?(this.type="branch",this.initial=a,this.children=Object.fromEntries(o().map(e=>[e.id,new e(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",o&&a&&(this.initial=a,this.children=Object.fromEntries(o().map(e=>[e.id,new e(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=l,this.useCoalescedEvents=d,this.performanceTracker=new i.aF}performanceTracker;static id;static initial;static children;static isLockable=!0;static useCoalescedEvents=!1;id;type;shapeType;initial;children;isLockable;useCoalescedEvents;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition(e,t={}){let n=e.split("."),r=this;for(let e=0;e<n.length;e++){let i=n[e],o=r.getCurrent(),a=r.children?.[i];if(!a)throw Error(`${r.id} - no child state exists with the id ${i}.`);if(o?.id!==a.id&&(o?.exit(t,i),r._current.set(a),a.enter(t,o?.id||"initial"),!a.getIsActive()))break;r=a}return this}handleEvent(e){let t=a.J[e.name],n=this._current.__unsafe__getWithoutCapture();this[t]?.(e),this._isActive.__unsafe__getWithoutCapture()&&n&&n===this._current.__unsafe__getWithoutCapture()&&n.handleEvent(e)}enter(e,t){if(o.hR.measurePerformance.get()&&l.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),this.onEnter?.(e,t),this.children&&this.initial&&this.getIsActive()){let n=this.children[this.initial];this._current.set(n),n.enter(e,t)}}exit(e,t){o.hR.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),this.onExit?.(e,t),this.getIsActive()||this.getCurrent()?.exit(e,t)}_currentToolIdMask=(0,r.cn)("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}addChild(e){if("leaf"===this.type)throw Error("StateNode.addChild: cannot add child to a leaf node");this.children||(this.children={});let t=new e(this.editor,this);if(this.children[t.id])throw Error(`StateNode.addChild: a child with id '${t.id}' already exists`);return this.children[t.id]=t,this}}},62461:function(e,t,n){"use strict";n.d(t,{OR:function(){return useDelaySvgExport},l8:function(){return useSvgExportContext},xU:function(){return SvgExportContextProvider}});var r=n(57437),i=n(70938),o=n(2265),a=n(45827),l=n(3373),d=n(18560);let c=(0,o.createContext)(null);function SvgExportContextProvider({context:e,editor:t,children:n}){let i=t.options.exportProvider;return(0,r.jsx)(l.KU,{editor:t,children:(0,r.jsx)(a.jm,{container:t.getContainer(),children:(0,r.jsx)(c.Provider,{value:e,children:(0,r.jsx)(i,{children:n})})})})}function useSvgExportContext(){return(0,o.useContext)(c)}function useDelaySvgExport(){let e=(0,o.useContext)(c),[t]=(0,o.useState)(i.un);return(0,o.useEffect)(()=>(e?.waitUntil(t),()=>{t.resolve()}),[t,e]),(0,d.z)(()=>{t.resolve()})}},40521:function(e,t,n){"use strict";n.d(t,{J:function(){return r}});let r={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"}},49140:function(e,t,n){"use strict";let r;n.d(t,{$:function(){return exportToSvg}});var i,o,a,l,d=n(70938),c=n(54887),u=n(34040);function fetchCache(e,t){let n=new Map;return async function(r){let i=n.get(r);if(i)return i;let o=(async()=>{try{let n=await (0,d.he)(r,t);return(0,d.hu)(n.ok),await e(n)}catch(e){return console.error(e),null}})();return n.set(r,o),o}}let h=fetchCache(async e=>await d.P6.blobToDataUrl(await e.blob())),p=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,f=/@font-face\s*{([^}]+)}/gi,g=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,m=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function parseCssFontFaces(e,t){return Array.from(e.matchAll(f),e=>{let n=e[1],r=Array.from(n.matchAll(g),e=>{let n=e[1]||e[2]||e[3];return{original:n,resolved:d.Ad(n,t)?.href??null}}),i=new Set(Array.from(n.matchAll(m),e=>(e[1]||e[2]||e[3]).toLowerCase()));return{fontFace:n,urls:r,fontFamilies:i}})}function shouldIncludeCssProperty(e){return!(e.startsWith("-")||e.startsWith("animation")||e.startsWith("transition"))&&"cursor"!==e&&"pointer-events"!==e&&"user-select"!==e&&"touch-action"!==e}var y=Object.create,b=Object.defineProperty,S=Object.getOwnPropertyDescriptor,__knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,n)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__name=(e,t)=>b(e,"name",{value:t,configurable:!0}),v=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=e=>void 0!==e&&"function"!=typeof e?__typeError("Function expected"):e,__decoratorContext=(e,t,n,r,i)=>({kind:v[e],name:t,metadata:r,addInitializer:e=>n._?__typeError("Already initialized"):i.push(__expectFn(e||null))}),__decoratorMetadata=(e,t)=>__defNormalProp(t,__knownSymbol("metadata"),e[3]),__runInitializers=(e,t,n,r)=>{for(var i=0,o=e[t>>1],a=o&&o.length;i<a;i++)1&t?o[i].call(n):r=o[i].call(n,r);return r},__publicField=(e,t,n)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),__accessCheck=(e,t,n)=>t.has(e)||__typeError("Cannot "+n),__privateIn=(e,t)=>Object(t)!==t?__typeError('Cannot use the "in" operator on this value'):e.has(t),__privateGet=(e,t,n)=>(__accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),__privateSet=(e,t,n,r)=>(__accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),__privateMethod=(e,t,n)=>(__accessCheck(e,t,"access private method"),n);let k="tldraw-svg-export";i=[d.ak];let FontEmbedder=class FontEmbedder{constructor(){__runInitializers(o,5,this),__publicField(this,"fontFacesPromise",null),__publicField(this,"foundFontNames",new Set),__publicField(this,"fontFacesToEmbed",new Set),__publicField(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){(0,d.hu)(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=getCurrentDocumentFontFaces()}onFontFamilyValue(e){(0,d.hu)(this.fontFacesPromise,"FontEmbedder not started");let t=function(e){let t=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,n=/\s*,\s*/gi,r=new Set;for(;;){let i=t.exec(e);if(!i)break;let o=i[1]||i[2]||i[3];r.add(o.toLowerCase()),n.lastIndex=t.lastIndex;let a=n.exec(e);if(!a)break;t.lastIndex=n.lastIndex}return r}(e);for(let e of t){if(this.foundFontNames.has(e))return;this.foundFontNames.add(e),this.pendingPromises.push(this.fontFacesPromise.then(t=>{let n=t.filter(t=>t.fontFamilies.has(e));for(let e of n)if(!this.fontFacesToEmbed.has(e))for(let t of(this.fontFacesToEmbed.add(e),e.urls))t.resolved&&!t.embedded&&(t.embedded=h(t.resolved))}))}}async createCss(){await Promise.all(this.pendingPromises);let e="";for(let t of this.fontFacesToEmbed){let n=`@font-face {${t.fontFace}}`;for(let e of t.urls){if(!e.embedded)continue;let t=await e.embedded;t&&(n=n.replace(e.original,t))}e+=n}return e}};async function getCurrentDocumentFontFaces(){let e=[],t=Array.from(document.styleSheets).filter(e=>!e.ownerNode?.closest(`.${k}`));for(let n of t){let t;try{t=n.cssRules}catch{}if(t){for(let t of n.cssRules)if(t instanceof CSSFontFaceRule)e.push(parseCssFontFaces(t.cssText,n.href??document.baseURI));else if(t instanceof CSSImportRule){let n=new URL(t.href,t.parentStyleSheet?.href??document.baseURI);e.push(_(n.href))}}else n.href&&e.push(_(n.href))}return(0,d.oA)(await Promise.all(e)).flat()}((e,t,n,r,i,o)=>{var a,l,d,c,u,h=7&t,p=!!(8&t),f=!!(16&t),g=h>3?e.length+1:h?p?1:2:0,m=v[h+5],y=h>3&&(e[g-1]=[]),k=e[g]||(e[g]=[]),_=h&&(f||p||(i=i.prototype),h<5&&(h>3||!f)&&S(h<4?i:{get[n](){return __privateGet(this,o)},set[n](x){return __privateSet(this,o,x)}},n));h?f&&h<4&&__name(o,(h>2?"set ":h>1?"get ":"")+n):__name(i,n);for(var C=r.length-1;C>=0;C--)c=__decoratorContext(h,n,d={},e[3],k),h&&(c.static=p,c.private=f,u=c.access={has:f?e=>__privateIn(i,e):e=>n in e},3^h&&(u.get=f?e=>(1^h?__privateGet:__privateMethod)(e,i,4^h?o:_.get):e=>e[n]),h>2&&(u.set=f?(e,t)=>__privateSet(e,i,t,4^h?o:_.set):(e,t)=>e[n]=t)),l=(0,r[C])(h?h<4?f?o:_[m]:h>4?void 0:{get:_.get,set:_.set}:i,c),d._=1,4^h||void 0===l?__expectFn(l)&&(h>4?y.unshift(l):h?f?o=l:_[m]=l:i=l):"object"!=typeof l||null===l?__typeError("Object expected"):(__expectFn(a=l.get)&&(_.get=a),__expectFn(a=l.set)&&(_.set=a),__expectFn(a=l.init)&&y.unshift(a));return h||__decoratorMetadata(e,i),_&&b(i,n,_),f?4^h?o:_:i})(o=[,,,y((void 0)??null)],1,"onFontFamilyValue",i,FontEmbedder),__decoratorMetadata(o,FontEmbedder);let _=fetchCache(async e=>{var t,n;let r=(t=await e.text(),n=e.url,{imports:Array.from(t.matchAll(p),e=>({url:e[1]||e[2]||e[3]||e[4]||e[5],extras:e[6]})),fontFaces:parseCssFontFaces(t,n)}),i=await Promise.all(r.imports.map(({url:t})=>_(new URL(t,e.url).href)));return[...r.fontFaces,...(0,d.oA)(i).flat()]}),isCoveredByCurrentColor=(e,t,{currentColor:n})=>"currentColor"===e||e===n,isInherited=(e,t,{parentStyles:n})=>n[t]===e,isExcludedBorder=e=>(t,n,{getStyle:r})=>{let i=r(`border-${e}-width`),o=r(`border-${e}-style`);return"0px"===i||"none"===o},C={"border-block-end-color":isCoveredByCurrentColor,"border-block-start-color":isCoveredByCurrentColor,"border-bottom-color":isCoveredByCurrentColor,"border-inline-end-color":isCoveredByCurrentColor,"border-inline-start-color":isCoveredByCurrentColor,"border-left-color":isCoveredByCurrentColor,"border-right-color":isCoveredByCurrentColor,"border-top-color":isCoveredByCurrentColor,"caret-color":isCoveredByCurrentColor,"column-rule-color":isCoveredByCurrentColor,"outline-color":isCoveredByCurrentColor,"text-decoration":(e,t,{currentColor:n})=>"none solid currentColor"===e||e==="none solid "+n,"text-decoration-color":isCoveredByCurrentColor,"text-emphasis-color":isCoveredByCurrentColor,"border-collapse":isInherited,"border-spacing":isInherited,"caption-side":isInherited,cursor:isInherited,direction:isInherited,"empty-cells":isInherited,"font-family":isInherited,"font-size":isInherited,"font-style":isInherited,"font-variant":isInherited,"font-weight":isInherited,"font-size-adjust":isInherited,"font-stretch":isInherited,font:isInherited,"letter-spacing":isInherited,"line-height":isInherited,"list-style-image":isInherited,"list-style-position":isInherited,"list-style-type":isInherited,"list-style":isInherited,orphans:isInherited,"overflow-wrap":isInherited,quotes:isInherited,"stroke-linecap":isInherited,"stroke-linejoin":isInherited,"tab-size":isInherited,"text-align":isInherited,"text-align-last":isInherited,"text-indent":isInherited,"text-justify":isInherited,"text-shadow":isInherited,"text-transform":isInherited,visibility:isInherited,"white-space":isInherited,"white-space-collapse":isInherited,widows:isInherited,"word-break":isInherited,"word-spacing":isInherited,"word-wrap":isInherited,"border-top":isExcludedBorder("top"),"border-right":isExcludedBorder("right"),"border-bottom":isExcludedBorder("bottom"),"border-left":isExcludedBorder("left"),"border-block-end":isExcludedBorder("block-end"),"border-block-start":isExcludedBorder("block-start"),"border-inline-end":isExcludedBorder("inline-end"),"border-inline-start":isExcludedBorder("inline-start"),"border-top-style":isExcludedBorder("top"),"border-right-style":isExcludedBorder("right"),"border-bottom-style":isExcludedBorder("bottom"),"border-left-style":isExcludedBorder("left"),"border-block-end-style":isExcludedBorder("block-end"),"border-block-start-style":isExcludedBorder("block-start"),"border-inline-end-style":isExcludedBorder("inline-end"),"border-inline-start-style":isExcludedBorder("inline-start"),"border-top-width":isExcludedBorder("top"),"border-right-width":isExcludedBorder("right"),"border-bottom-width":isExcludedBorder("bottom"),"border-left-width":isExcludedBorder("left"),"border-block-end-width":isExcludedBorder("block-end"),"border-block-start-width":isExcludedBorder("block-start"),"border-inline-end-width":isExcludedBorder("inline-end")};function getRenderedChildNodes(e){var t,n;if(e.shadowRoot)return e.shadowRoot.childNodes;if("getRootNode"in(t=e)&&(n=t.getRootNode())instanceof getWindow(n).ShadowRoot&&t instanceof getWindow(t).HTMLSlotElement){let t=e.assignedNodes();if(t?.length)return t}return e.childNodes}function*getRenderedChildren(e){for(let t of getRenderedChildNodes(e))t instanceof getWindow(t).Element&&(yield t)}function getWindow(e){return e.ownerDocument?.defaultView??globalThis}function getComputedStyle(e,t){return getWindow(e).getComputedStyle(e,t)}let E={};let StyleEmbedder=class StyleEmbedder{constructor(e){this.root=e}styles=new Map;fonts=new FontEmbedder;readRootElementStyles(e){this.readElementStyles(e,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});let t=Array.from(getRenderedChildren(e));for(;t.length;){let e=t.pop();t.push(...getRenderedChildren(e)),this.readElementStyles(e,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(e,{shouldRespectDefaults:t=!0,shouldSkipInheritedParentStyles:n=!0}){let i=t?function(e){let t=M[e];if(!t){let{foreignObject:n,document:i}=function(){if(!r){let e=document.createElement("iframe");e.style.display="none",document.body.appendChild(e);let t=(0,d.kP)(e.contentDocument,"frame must have a document"),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");n.appendChild(i),t.body.appendChild(n),r={iframe:e,foreignObject:i,document:t}}return r}(),o=i.createElement(e);n.appendChild(o),t=o.computedStyleMap?styleFromComputedStyleMap(o.computedStyleMap(),P):styleFromComputedStyle(getComputedStyle(o),P),n.removeChild(o),M[e]=t}return t}(e.tagName.toLowerCase()):E,o=Object.assign({},E);if(n){let t=e.parentElement;for(;t;){let e=this.styles.get(t)?.self;for(let t in e)o[t]||(o[t]=e[t]);t=t.parentElement}}let a={self:function(e,{defaultStyles:t,parentStyles:n}){return e.computedStyleMap?styleFromComputedStyleMap(e.computedStyleMap(),{defaultStyles:t,parentStyles:n}):styleFromComputedStyle(getComputedStyle(e),{defaultStyles:t,parentStyles:n})}(e,{defaultStyles:i,parentStyles:o}),before:styleFromPseudoElement(e,"::before"),after:styleFromPseudoElement(e,"::after")};this.styles.set(e,a)}fetchResources(){let e=[];for(let t of this.styles.values())for(let n of(0,d.UM)(t))if(n)for(let[t,r]of Object.entries(n)){if(!r)continue;"font-family"===t&&this.fonts.onFontFamilyValue(r);let i=Array.from(r.matchAll(g),e=>({original:e[0],url:e[1]||e[2]||e[3]}));0!==i.length&&e.push(...i.map(async({url:e,original:i})=>{let o=await h(e)??"data:";n[t]=r.replace(i,`url("${o}")`)}))}return Promise.all(e)}unwrapCustomElements(){let e=new Set,visit=(t,n)=>{if(e.has(t))return;e.add(t);let r=t.shadowRoot;if(r){let e=document.createElement("div");for(let i of(this.styles.set(e,this.styles.get(t)),e.setAttribute("data-tl-custom-element",t.tagName),(n??t.parentElement).appendChild(e),r.childNodes))i instanceof Element?visit(i,e):e.appendChild(i.cloneNode(!0));t.remove()}else if(n){if("style"===t.tagName.toLowerCase())return;let e=t.cloneNode(!1);for(let r of(this.styles.set(e,this.styles.get(t)),n.appendChild(e),getRenderedChildNodes(t)))r instanceof Element?visit(r,e):e.appendChild(r.cloneNode(!0))}};for(let e of this.styles.keys())visit(e,null)}embedStyles(){let e="";for(let[t,n]of this.styles){if(n.after||n.before){let r=`pseudo-${(0,d.EL)()}`;t.classList.add(r),n.before&&(e+=`.${r}::before {${formatCss(n.before)}}
`),n.after&&(e+=`.${r}::after {${formatCss(n.after)}}
`)}let r=t.style;for(let[e,t]of Object.entries(n.self))t&&r.setProperty(e,t);"auto"===r.fontKerning&&(r.fontKerning="normal")}return e}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){r&&(document.body.removeChild(r.iframe),r=void 0)}};function styleFromPseudoElement(e,t){let n=getComputedStyle(e,t),r=n.getPropertyValue("content");if(""!==r&&"none"!==r)return styleFromComputedStyle(n,{defaultStyles:E,parentStyles:E})}function styleFromComputedStyleMap(e,{defaultStyles:t,parentStyles:n}){let r={},i=e.get("color")?.toString()||"",o={currentColor:i,parentStyles:n,defaultStyles:t,getStyle:t=>e.get(t)?.toString()??""};for(let n of e.keys()){if(!shouldIncludeCssProperty(n))continue;let i=e.get(n).toString();if(t[n]===i)continue;let a=(0,d.eg)(C,n);a&&a(i,n,o)||(r[n]=i)}return r}function styleFromComputedStyle(e,{defaultStyles:t,parentStyles:n}){let r={},i=e.color,o={currentColor:i,parentStyles:n,defaultStyles:t,getStyle:t=>e.getPropertyValue(t)};for(let n in e){if(!shouldIncludeCssProperty(n))continue;let i=e.getPropertyValue(n);if(t[n]===i)continue;let a=(0,d.eg)(C,n);a&&a(i,n,o)||(r[n]=i)}return r}function formatCss(e){let t="";for(let[n,r]of Object.entries(e))t+=`${n}: ${r};`;return t}let M={},P={defaultStyles:E,parentStyles:E};function replace(e,t){return e.replaceWith(t),t}async function createImage(e,t){let n=document.createElement("img");t&&function(e,t){let n=Array.from(e.attributes);n.forEach(e=>{t.setAttribute(e.name,e.value)})}(t,n),n.setAttribute("src",e??"data:"),n.setAttribute("decoding","sync"),n.setAttribute("loading","eager");try{await n.decode()}catch{}return n}async function getCanvasReplacement(e){try{let t=e.toDataURL();return await createImage(t,e)}catch{return await createImage(null,e)}}async function getVideoReplacement(e){try{let t=await d.xe.getVideoFrameAsDataUrl(e);return createImage(t,e)}catch(e){console.error("Could not get video frame",e)}if(e.poster){let t=await h(e.poster);return createImage(t,e)}return createImage(null,e)}async function embedMedia(e){if(e instanceof HTMLCanvasElement)return replace(e,await getCanvasReplacement(e));if(e instanceof HTMLVideoElement)return replace(e,await getVideoReplacement(e));if(e instanceof HTMLImageElement){let t=e.currentSrc||e.src,n=await h(t);e.setAttribute("src",n??"data:"),e.setAttribute("decoding","sync"),e.setAttribute("loading","eager");try{await e.decode()}catch{}return e}e instanceof HTMLInputElement?e.setAttribute("value",e.value):e instanceof HTMLTextAreaElement&&(e.textContent=e.value),await Promise.all(Array.from(getRenderedChildren(e),e=>embedMedia(e)))}var A=n(57437),j=n(30742),D=n(43001),B=n(2265),F=n(24519),O=n(62673),R=n(62461),L=n(3373),N=n(18560),z=n(91496),$=n(45404),G=Object.create,W=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,ExportDelay_knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),ExportDelay_typeError=e=>{throw TypeError(e)},ExportDelay_defNormalProp=(e,t,n)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ExportDelay_name=(e,t)=>W(e,"name",{value:t,configurable:!0}),q=["class","method","getter","setter","accessor","field","value","get","set"],ExportDelay_expectFn=e=>void 0!==e&&"function"!=typeof e?ExportDelay_typeError("Function expected"):e,ExportDelay_decoratorContext=(e,t,n,r,i)=>({kind:q[e],name:t,metadata:r,addInitializer:e=>n._?ExportDelay_typeError("Already initialized"):i.push(ExportDelay_expectFn(e||null))}),ExportDelay_decoratorMetadata=(e,t)=>ExportDelay_defNormalProp(t,ExportDelay_knownSymbol("metadata"),e[3]),ExportDelay_runInitializers=(e,t,n,r)=>{for(var i=0,o=e[t>>1],a=o&&o.length;i<a;i++)1&t?o[i].call(n):r=o[i].call(n,r);return r},ExportDelay_publicField=(e,t,n)=>ExportDelay_defNormalProp(e,"symbol"!=typeof t?t+"":t,n),ExportDelay_accessCheck=(e,t,n)=>t.has(e)||ExportDelay_typeError("Cannot "+n),ExportDelay_privateIn=(e,t)=>Object(t)!==t?ExportDelay_typeError('Cannot use the "in" operator on this value'):e.has(t),ExportDelay_privateGet=(e,t,n)=>(ExportDelay_accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),ExportDelay_privateSet=(e,t,n,r)=>(ExportDelay_accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),ExportDelay_privateMethod=(e,t,n)=>(ExportDelay_accessCheck(e,t,"access private method"),n);a=[d.ak];let ExportDelay=class ExportDelay{constructor(e){this.maxDelayTimeMs=e,ExportDelay_runInitializers(l,5,this),ExportDelay_publicField(this,"isResolved",!1),ExportDelay_publicField(this,"promisesToWaitFor",[])}waitUntil(e){if(this.isResolved)throw Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(e.catch(e=>console.error("Error while waiting for export:",e)))}async resolvePromises(){let e=null;for(;this.promisesToWaitFor.length!==e;)e=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await (0,d._v)(0)}async resolve(){let e=(0,d._v)(this.maxDelayTimeMs).then(()=>"timeout"),t=this.resolvePromises().then(()=>"resolved"),n=await Promise.race([e,t]);"timeout"===n&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}};function SvgExport({editor:e,preserveAspectRatio:t,scale:n,pixelRatio:r,bbox:i,background:o,singleFrameShapeId:a,isDarkMode:l,renderingShapes:u,onMount:h,waitUntil:p}){let f=(0,z.Gj)(),g=(0,D.y6)({isDarkMode:l}),m=(0,j.KO)("export state",{defsById:{},shapeElements:null}),{defsById:y,shapeElements:b}=(0,j.Hg)(m),S=(0,N.z)(e=>{m.update(t=>{if((0,d.nr)(t.defsById,e.key))return t;let n=Promise.resolve(e.getElement());return p(n.then(t=>{m.update(n=>({...n,defsById:{...n.defsById,[e.key]:{pending:!1,element:t}}}))})),{...t,defsById:{...t.defsById,[e.key]:{pending:!0,element:n}}}})}),v=(0,B.useMemo)(()=>({isDarkMode:l,waitUntil:p,addExportDef:S,scale:n,pixelRatio:r,async resolveAssetUrl(t,i){let o=e.getAsset(t);return o&&("image"===o.type||"video"===o.type)?await e.resolveAssetUrl(t,{screenScale:n*(i/o.props.w),shouldResolveToOriginal:null===r,dpr:r??void 0}):null}}),[l,p,S,n,r,e]),k=(0,B.useRef)(!1);(0,B.useLayoutEffect)(()=>{if(k.current)throw Error("SvgExport should only render once - do not use with react strict mode");k.current=!0,(async()=>{let t={},n=u.map(async({id:n,opacity:r,index:o,backgroundIndex:l})=>{if(n===a)return[];let d=e.getShape(n);if(e.isShapeOfType(d,"group"))return[];let c=[],u=e.getShapeUtil(d);if(u.toSvg||u.toBackgroundSvg){let[n,i]=await Promise.all([u.toSvg?.(d,v),u.toBackgroundSvg?.(d,v)]),a=e.getShapePageTransform(d),h=a.toCssString(),p=1;"scale"in d.props&&1!==d.props.scale&&(p=d.props.scale,h=`${h} scale(${d.props.scale}, ${d.props.scale})`);let g=e.getShapeMask(d.id),m=g?$._.From($._.Inverse(a)).applyToPoints(g):null,y=(0,z.mq)(f,d.id);m&&(t[y]={pending:!1,element:(0,A.jsx)("clipPath",{id:y,children:(0,A.jsx)("path",{d:`M${m.map(({x:e,y:t})=>`${e/p},${t/p}`).join("L")}Z`})})}),n&&c.push({zIndex:o,element:(0,A.jsx)("g",{transform:h,opacity:r,clipPath:g?`url(#${y})`:void 0,children:n},`fg_${d.id}`)}),i&&c.push({zIndex:l,element:(0,A.jsx)("g",{transform:h,opacity:r,clipPath:g?`url(#${y})`:void 0,children:i},`bg_${d.id}`)})}else c.push({zIndex:o,element:(0,A.jsx)(ForeignObjectShape,{shape:d,util:u,component:O.cv,className:"tl-shape",bbox:i,opacity:r},`fg_${d.id}`)}),u.backgroundComponent&&c.push({zIndex:l,element:(0,A.jsx)(ForeignObjectShape,{shape:d,util:u,component:O.t8,className:"tl-shape tl-shape-background",bbox:i,opacity:r},`bg_${d.id}`)});return c}),r=(await Promise.all(n)).flat();(0,c.flushSync)(()=>{m.update(e=>({...e,shapeElements:r.sort((e,t)=>e.zIndex-t.zIndex).map(({element:e})=>e),defsById:{...e.defsById,...t}}))})})()},[i,e,v,f,u,a,m]),(0,B.useEffect)(()=>{let t=new Set;for(let{id:n}of u)for(let r of e.fonts.getShapeFontFaces(n))t.add(r);for(let n of t)S({key:(0,d.EL)(),getElement:async()=>{let t=await e.fonts.toEmbeddedCssDeclaration(n);return(0,A.jsx)("style",{nonce:e.options.nonce,children:t})}})},[e,u,S]),(0,B.useEffect)(()=>{null!==b&&h()},[h,b]);let _=o?g.background:"transparent";if(a&&o){let t=e.getShapeUtil("frame");if(t?.options.showColors){let t=e.getShape(a),n=g[t.props.color];_=n.frame.fill}else _=g.solid}return(0,A.jsx)(R.xU,{editor:e,context:v,children:(0,A.jsxs)("svg",{preserveAspectRatio:t,direction:"ltr",width:i.width*n,height:i.height*n,viewBox:`${i.minX} ${i.minY} ${i.width} ${i.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:_},"data-color-mode":l?"dark":"light",className:`tl-container tl-theme__force-sRGB ${l?"tl-theme__dark":"tl-theme__light"}`,children:[(0,A.jsx)("defs",{children:Object.entries(y).map(([e,t])=>t.pending?null:(0,A.jsx)(B.Fragment,{children:t.element},e))}),b]})})}function ForeignObjectShape({shape:e,util:t,className:n,component:r,bbox:i,opacity:o}){let a=(0,L.jE)(),l=$._.Translate(-i.minX,-i.minY).multiply(a.getShapePageTransform(e.id)),d=a.getShapeGeometry(e.id).bounds,c=Math.max(d.width,1),u=Math.max(d.height,1);return(0,A.jsx)(F.S,{fallback:()=>null,children:(0,A.jsx)("foreignObject",{x:i.minX,y:i.minY,width:i.w,height:i.h,className:"tl-shape-foreign-object tl-export-embed-styles",children:(0,A.jsx)("div",{className:n,"data-shape-type":e.type,style:{clipPath:a.getShapeClipPath(e.id),transform:l.toCssString(),width:c,height:u,opacity:o},children:(0,A.jsx)(r,{shape:e,util:t})})})})}((e,t,n,r,i,o)=>{var a,l,d,c,u,h=7&t,p=!!(8&t),f=!!(16&t),g=h>3?e.length+1:h?p?1:2:0,m=q[h+5],y=h>3&&(e[g-1]=[]),b=e[g]||(e[g]=[]),S=h&&(f||p||(i=i.prototype),h<5&&(h>3||!f)&&Z(h<4?i:{get[n](){return ExportDelay_privateGet(this,o)},set[n](x){return ExportDelay_privateSet(this,o,x)}},n));h?f&&h<4&&ExportDelay_name(o,(h>2?"set ":h>1?"get ":"")+n):ExportDelay_name(i,n);for(var v=r.length-1;v>=0;v--)c=ExportDelay_decoratorContext(h,n,d={},e[3],b),h&&(c.static=p,c.private=f,u=c.access={has:f?e=>ExportDelay_privateIn(i,e):e=>n in e},3^h&&(u.get=f?e=>(1^h?ExportDelay_privateGet:ExportDelay_privateMethod)(e,i,4^h?o:S.get):e=>e[n]),h>2&&(u.set=f?(e,t)=>ExportDelay_privateSet(e,i,t,4^h?o:S.set):(e,t)=>e[n]=t)),l=(0,r[v])(h?h<4?f?o:S[m]:h>4?void 0:{get:S.get,set:S.set}:i,c),d._=1,4^h||void 0===l?ExportDelay_expectFn(l)&&(h>4?y.unshift(l):h?f?o=l:S[m]=l:i=l):"object"!=typeof l||null===l?ExportDelay_typeError("Object expected"):(ExportDelay_expectFn(a=l.get)&&(S.get=a),ExportDelay_expectFn(a=l.set)&&(S.set=a),ExportDelay_expectFn(a=l.init)&&y.unshift(a));return h||ExportDelay_decoratorMetadata(e,i),S&&W(i,n,S),f?4^h?o:S:i})(l=[,,,G((void 0)??null)],1,"waitUntil",a,ExportDelay),ExportDelay_decoratorMetadata(l,ExportDelay);let Y=1;async function exportToSvg(e,t,n={}){let r=function(e,t,n={}){if(!window.document)throw Error("No document");let{scale:r=1,background:i=e.getInstanceState().exportBackground,padding:o=e.options.defaultSvgPadding,preserveAspectRatio:a}=n,l=n.darkMode??e.user.getIsDarkMode(),c=e.getShapeAndDescendantIds(t),u=e.getUnorderedRenderingShapes(!1).filter(({id:e})=>c.has(e)),h=null;if(n.bounds)h=n.bounds;else for(let{id:t}of u){let n=e.getShapeMaskedPageBounds(t);n&&(h?h.union(n):h=n.clone())}if(!h)return;let p=1===t.length&&e.isShapeOfType(e.getShape(t[0]),"frame")?t[0]:null;p||h.expandBy(o);let f=h.width*r,g=h.height*r;try{document.body.focus?.()}catch{}let m=new ExportDelay(e.options.maxExportDelayMs),y=(0,d.un)();m.waitUntil(y);let b=(0,A.jsx)(SvgExport,{editor:e,preserveAspectRatio:a,scale:r,pixelRatio:n.pixelRatio??null,bbox:h,background:i,singleFrameShapeId:p,isDarkMode:l,renderingShapes:u,onMount:y.resolve,waitUntil:m.waitUntil});return{jsx:b,width:f,height:g,exportDelay:m}}(e,t,n);if(!r)return;let i=e.getContainer(),o=document.createElement("div");o.className=k,o.inert=!0,o.tabIndex=-1,Object.assign(o.style,{position:"absolute",top:"0px",left:"0px",width:r.width+"px",height:r.height+"px",pointerEvents:"none",opacity:0}),i.appendChild(o);let a=(0,u.createRoot)(o,{identifierPrefix:`export_${Y++}_`});try{await Promise.resolve(),(0,c.flushSync)(()=>{a.render(r.jsx)}),await r.exportDelay.resolve();let e=o.firstElementChild;return(0,d.hu)(e instanceof SVGSVGElement,"Expected an SVG element"),await applyChangesToForeignObjects(e),{svg:e,width:r.width,height:r.height}}finally{setTimeout(()=>{a.unmount(),i.removeChild(o)},0)}}async function applyChangesToForeignObjects(e){let t=[...e.querySelectorAll("foreignObject.tl-export-embed-styles > *")];if(!t.length)return;let n=new StyleEmbedder(e);try{for(let e of(n.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(t.map(e=>embedMedia(e))),t))n.readRootElementStyles(e);await n.fetchResources();let r=await n.getFontFaceCss();n.unwrapCustomElements();let i=n.embedStyles();if(r||i){let t=document.createElementNS("http://www.w3.org/2000/svg","style");t.textContent=`${r}
${i}`,e.prepend(t)}}finally{n.dispose()}}},12968:function(e,t,n){"use strict";n.d(t,{u:function(){return getSvgAsImage}});var r=n(70938),i=n(49894),o=n(32764),a=n(16384);async function getSvgAsImage(e,t){let{type:n,width:l,height:d,quality:c=1,pixelRatio:u=2}=t,[h,p]=(0,o.E)(l*u,d*u);h=Math.floor(h),p=Math.floor(p);let f=h/l,g=await r.P6.blobToDataUrl(new Blob([e],{type:"image/svg+xml"})),m=await new Promise(e=>{let t=(0,r.Ee)();t.crossOrigin="anonymous",t.onload=async()=>{i.a.isSafari&&await (0,r._v)(250);let n=document.createElement("canvas"),o=n.getContext("2d");n.width=h,n.height=p,o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(t,0,0,h,p),URL.revokeObjectURL(g),e(n)},t.onerror=()=>{e(null)},t.src=g});if(!m)return null;let y=await new Promise(e=>m.toBlob(t=>{(!t||a.hR.throwToBlob.get())&&e(null),e(t)},"image/"+n,c));if(!y)return null;if("png"!==n)return y;{let e=new DataView(await y.arrayBuffer());return r.bM.setPhysChunk(e,f,{type:"image/"+n})}}},49894:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});let r={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isWebview:!1,isDarwin:!1,hasCanvasSupport:!1};"undefined"!=typeof window&&"navigator"in window&&(r.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),r.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),r.isFirefox=/firefox/i.test(navigator.userAgent),r.isAndroid=/android/i.test(navigator.userAgent),r.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,r.hasCanvasSupport="undefined"!=typeof window&&"Promise"in window&&"HTMLCanvasElement"in window)},18817:function(e,t,n){"use strict";n.d(t,{h:function(){return i}});var r=n(31316);let i={menus:(0,r.cn)("open menus",[]),getOpenMenus(e){return e?this.menus.get().filter(t=>t.endsWith("-"+e)):this.menus.get()},addOpenMenu(e,t=""){let n=t?`${e}-${t}`:e,r=new Set(this.menus.get());r.has(n)||(r.add(n),this.menus.set([...r]))},deleteOpenMenu(e,t=""){let n=t?`${e}-${t}`:e,r=new Set(this.menus.get());r.has(n)&&(r.delete(n),this.menus.set([...r]))},clearOpenMenus(e){this.menus.set(e?this.menus.get().filter(t=>!t.endsWith("-"+e)):[])},_hiddenMenus:[],hideOpenMenus(e){if(this._hiddenMenus=[...this.getOpenMenus(e)],0!==this._hiddenMenus.length)for(let t of this._hiddenMenus)this.deleteOpenMenu(t,e)},showOpenMenus(e){if(0!==this._hiddenMenus.length){for(let t of this._hiddenMenus)this.addOpenMenu(t,e);this._hiddenMenus=[]}},isMenuOpen(e,t){return this.getOpenMenus(t).includes(e)},hasOpenMenus(e){return this.getOpenMenus(e).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(e){return{getOpenMenus:()=>this.getOpenMenus(e),addOpenMenu:t=>this.addOpenMenu(t,e),deleteOpenMenu:t=>this.deleteOpenMenu(t,e),clearOpenMenus:()=>this.clearOpenMenus(e),isMenuOpen:t=>this.isMenuOpen(t,e),hasOpenMenus:()=>this.hasOpenMenus(e),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}}},90975:function(e,t,n){"use strict";n.d(t,{r:function(){return i}});var r=n(70938);let i=new r._N},17910:function(e,t,n){"use strict";n.d(t,{I:function(){return useCanvasEvents}});var r=n(30742),i=n(2265),o=n(57655),a=n(77700),l=n(49065),d=n(3373);function useCanvasEvents(){let e=(0,d.jE)(),t=(0,r.Hg)("current tool",()=>e.getCurrentTool(),[e]),n=(0,i.useMemo)(function(){let n,r;return{onPointerDown:function(t){if(!t.isKilled){if(t.button===o.Hs){e.dispatch({type:"pointer",target:"canvas",name:"right_click",...(0,l.Y)(t)});return}(0===t.button||1===t.button||5===t.button)&&((0,a.I5)(t.currentTarget,t),e.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...(0,l.Y)(t)}))}},onPointerMove:function(i){if(i.isKilled||i.clientX===n&&i.clientY===r)return;n=i.clientX,r=i.clientY;let o=t.useCoalescedEvents&&i.nativeEvent.getCoalescedEvents?i.nativeEvent.getCoalescedEvents():[i];for(let t of o)e.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...(0,l.Y)(t)})},onPointerUp:function(t){t.isKilled||0!==t.button&&1!==t.button&&2!==t.button&&5!==t.button||(n=t.clientX,r=t.clientY,(0,a.XE)(t.currentTarget,t),e.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...(0,l.Y)(t)}))},onPointerEnter:function(t){if(t.isKilled||e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;let n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!!n||null})},onPointerLeave:function(t){if(t.isKilled||e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;let n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!n&&null})},onDragOver:function(e){(0,a.PF)(e)},onDrop:async function(t){if((0,a.PF)(t),(0,a.be)(t),t.dataTransfer?.files?.length){let n=Array.from(t.dataTransfer.files);await e.putExternalContent({type:"files",files:n,point:e.screenToPage({x:t.clientX,y:t.clientY})});return}let n=t.dataTransfer.getData("url");if(n){await e.putExternalContent({type:"url",url:n,point:e.screenToPage({x:t.clientX,y:t.clientY})});return}},onTouchStart:function(e){e.isKilled=!0,(0,a.PF)(e)},onTouchEnd:function(t){t.isKilled=!0,t.target instanceof HTMLElement&&"A"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&!t.target.isContentEditable&&!(e.getEditingShape()&&t.target.className.includes("tl-text-content"))&&(0,a.PF)(t)},onClick:function(e){(0,a.be)(e)}}},[e,t]);return n}},45827:function(e,t,n){"use strict";n.d(t,{jm:function(){return ContainerProvider},mc:function(){return useContainerIfExists},uK:function(){return useContainer}});var r=n(57437),i=n(70938),o=n(2265);let a=(0,o.createContext)(null);function ContainerProvider({container:e,children:t}){return(0,r.jsx)(a.Provider,{value:e,children:t})}function useContainer(){return(0,i.kP)((0,o.useContext)(a),"useContainer used outside of <Tldraw />")}function useContainerIfExists(){return(0,o.useContext)(a)}},3231:function(e,t,n){"use strict";n.d(t,{L:function(){return getCursor},j:function(){return useCursor}});var r=n(30742),i=n(46166),o=n(45827),a=n(3373),l=n(75053);let d="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",c="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",u='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function getCursorCss(e,t,n,r,o,a=16,l=16){let d=(-n-t)*(i.PI/180),c=Math.sin(d),u=Math.cos(d);return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${o};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${1*u-1*c}' dy='${1*c+1*u}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${t+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+e.replaceAll('"',"'")+`</g></svg>") ${a} ${l}, pointer`}let h=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],p={none:()=>"none","ew-resize":(e,t,n)=>getCursorCss(c,e,0,t,n),"ns-resize":(e,t,n)=>getCursorCss(c,e,90,t,n),"nesw-resize":(e,t,n)=>getCursorCss(d,e,0,t,n),"nwse-resize":(e,t,n)=>getCursorCss(d,e,90,t,n),"nwse-rotate":(e,t,n)=>getCursorCss(u,e,0,t,n),"nesw-rotate":(e,t,n)=>getCursorCss(u,e,90,t,n),"senw-rotate":(e,t,n)=>getCursorCss(u,e,180,t,n),"swne-rotate":(e,t,n)=>getCursorCss(u,e,270,t,n)};function getCursor(e,t=0,n="black"){return p[e]((0,i.vi)(t),!1,n)}function useCursor(){let e=(0,a.jE)(),t=(0,o.uK)(),n=(0,l.G)();(0,r.BK)("useCursor",()=>{let{type:r,rotation:i}=e.getInstanceState().cursor;if(h.includes(r)){t.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}t.style.setProperty("--tl-cursor",getCursor(r,i,n?"white":"black"))},[e,t,n])}},3373:function(e,t,n){"use strict";n.d(t,{KU:function(){return EditorProvider},Z2:function(){return useMaybeEditor},jE:function(){return useEditor},rU:function(){return a}});var r=n(57437),i=n(2265),o=n(91496);let a=(0,i.createContext)(null);function useEditor(){let e=i.useContext(a);if(!e)throw Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return e}function useMaybeEditor(){return i.useContext(a)}function EditorProvider({editor:e,children:t}){return(0,r.jsx)(a.Provider,{value:e,children:(0,r.jsx)(o.vc,{children:t})})}},76413:function(e,t,n){"use strict";n.d(t,{I:function(){return EditorComponentsProvider},o:function(){return useEditorComponents}});var r=n(57437),i=n(2265),o=n(40255),a=n(36067),l=n(79548),d=n(40787),c=n(38917),u=n(47328),h=n(86251),p=n(85704),f=n(93572),g=n(9354);let DefaultLoadingScreen=()=>{let{Spinner:e}=useEditorComponents();return(0,r.jsx)(g.a_,{children:e?(0,r.jsx)(e,{}):null})};var m=n(37453),y=n(14203);let DefaultShapeErrorFallback=()=>(0,r.jsx)("div",{className:"tl-shape-error-boundary"});var b=n(67677);let DefaultShapeIndicatorErrorFallback=()=>(0,r.jsx)("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});var S=n(30865),v=n(7611),k=n(87717),_=n(30126),C=n(60180);let E=(0,i.createContext)(null);function EditorComponentsProvider({overrides:e={},children:t}){let n=(0,C.S)(e),g=(0,i.useMemo)(()=>({Background:o.d,Brush:a.o,Canvas:l.o,CollaboratorBrush:a.o,CollaboratorCursor:c.T,CollaboratorHint:d.Y,CollaboratorScribble:m.l,CollaboratorShapeIndicator:b.v,Cursor:c.T,Grid:h.y,Handle:p.C,Handles:f.Q,InFrontOfTheCanvas:null,LoadingScreen:DefaultLoadingScreen,OnTheCanvas:null,Overlays:null,Scribble:m.l,SelectionBackground:null,SelectionForeground:y.u,ShapeIndicator:b.v,ShapeIndicators:S.N,SnapIndicator:v.m,Spinner:k.q,SvgDefs:_.K,ZoomBrush:a.o,ErrorFallback:u.d,ShapeErrorFallback:DefaultShapeErrorFallback,ShapeIndicatorErrorFallback:DefaultShapeIndicatorErrorFallback,...n}),[n]);return(0,r.jsx)(E.Provider,{value:g,children:t})}function useEditorComponents(){let e=(0,i.useContext)(E);if(!e)throw Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return e}},18560:function(e,t,n){"use strict";n.d(t,{K:function(){return useReactiveEvent},z:function(){return useEvent}});var r=n(30742),i=n(70938),o=n(2265);function useEvent(e){let t=(0,o.useRef)();return(0,o.useLayoutEffect)(()=>{t.current=e}),(0,o.useDebugValue)(e),(0,o.useCallback)((...e)=>{let n=t.current;return(0,i.hu)(n,"fn does not exist"),n(...e)},[])}function useReactiveEvent(e){let t=(0,r.KO)("useReactiveEvent",()=>e);return(0,o.useLayoutEffect)(()=>{t.set(e)}),(0,o.useDebugValue)(e),(0,o.useCallback)((...e)=>{let n=t.get();return(0,i.hu)(n,"fn does not exist"),n(...e)},[t])}},60180:function(e,t,n){"use strict";n.d(t,{S:function(){return useShallowObjectIdentity},T:function(){return useShallowArrayIdentity}});var r=n(70938),i=n(2265);function useIdentity(e,t){let n=(0,i.useRef)(e);return t(e,n.current)?n.current:(n.current=e,e)}let areNullableArraysShallowEqual=(e,t)=>(e??=null)===(t??=null)||!!e&&!!t&&(0,r.E8)(e,t);function useShallowArrayIdentity(e){return useIdentity(e,areNullableArraysShallowEqual)}let areNullableObjectsShallowEqual=(e,t)=>(e??=null)===(t??=null)||!!e&&!!t&&(0,r.dn)(e,t);function useShallowObjectIdentity(e){return useIdentity(e,areNullableObjectsShallowEqual)}},75053:function(e,t,n){"use strict";n.d(t,{G:function(){return useIsDarkMode}});var r=n(30742),i=n(62461),o=n(3373);function useIsDarkMode(){let e=(0,o.jE)(),t=(0,i.l8)();return(0,r.Hg)("isDarkMode",()=>t?.isDarkMode??e.user.getIsDarkMode(),[t,e])}},83480:function(e,t,n){"use strict";n.d(t,{h:function(){return useLocalStore}});var r=n(70938),i=n(2265),o=n(95478),a=n(31316),l=n(63134),d=n(21834),c=n(76737);let u=Symbol("UPDATE_INSTANCE_STATE"),msg=e=>e,h="undefined"==typeof BroadcastChannel?class{onmessage;constructor(e){}postMessage(e){}close(){}}:BroadcastChannel;let TLLocalSyncClient=class TLLocalSyncClient{constructor(e,{persistenceKey:t,sessionId:n=d.$5,onLoad:r,onLoadError:i},o=new h(`tldraw-tab-sync-${t}`)){this.store=e,this.channel=o,"undefined"!=typeof window&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=n,this.db=new c.xh(t),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=(0,d.fU)(this.store),this.disposables.add(e.listen(({changes:e})=>{this.diffQueue.push(e),this.channel.postMessage(msg({type:"diff",storeId:this.store.id,changes:e,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(u),this.schedulePersist()},{scope:"session"})),this.connect(r,i),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;db;initTime=Date.now();debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){let n;this.debug("connecting");try{n=await this.db.load({sessionId:this.sessionId})}catch(e){t(e),window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`);return}if(this.debug("loaded data from store",n,"didDispose",this.didDispose),!this.didDispose)try{if(n){let e=Object.fromEntries(n.records.map(e=>[e.id,e])),r=n.sessionStateSnapshot??(0,d.wz)(e),i=this.store.schema.migrateStoreSnapshot({store:e,schema:n.schema??this.store.schema.serializeEarliestVersion()});if("error"===i.type){console.error("failed to migrate store",i),t(Error(`Failed to migrate store: ${i.reason}`));return}let o=Object.values(i.value).filter(e=>this.documentTypes.has(e.typeName));o.length>0&&this.store.mergeRemoteChanges(()=>{this.store.put(o,"initialize")}),r&&(0,d.SB)(this.store,r,{forceOverwrite:!0})}this.channel.onmessage=({data:e})=>{this.debug("got message",e);let n=this.store.schema.getMigrationsSince(e.schema);if(n.ok){if(n.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{let e=Date.now()-this.initTime;if(e<5e3){t(Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,window?.location?.reload?.();return}"diff"===e.type&&(this.debug("applying diff"),(0,a.ay)(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(e.changes)})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(e){if(this.debug("error loading data from store",e),this.didDispose)return;t(e);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||this.store.isPossiblyCorrupted()||!this.shouldDoFullDBWrite&&!(this.diffQueue.length>0)||this.doPersist()}async doPersist(){if((0,r.hu)(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");let e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{let t=(0,l.bs)(e.filter(e=>e!==u));await this.db.storeChanges({changes:t,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(e){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",e),window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`),"undefined"!=typeof window&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}};var p=n(60180),f=n(22890);function useLocalStore(e){let[t,n]=(0,f.r)({status:"loading"});return e=(0,p.S)(e),(0,i.useEffect)(()=>{let{persistenceKey:t,sessionId:i,...a}=e;if(!t){n({status:"not-synced",store:(0,o.jx)(a)});return}n({status:"loading"});let l=new r.kM,d={upload:async(e,t)=>(await h.db.storeAsset(e.id,t),{src:e.id}),resolve:async e=>e.props.src?e.props.src.startsWith("asset:")?await l.get(e,async()=>{let t=await h.db.getAsset(e.id);return t?URL.createObjectURL(t):null}):e.props.src:null,remove:async e=>{await h.db.removeAssets(e)},...a.assets},c=(0,o.jx)({...a,assets:d}),u=!1,h=new TLLocalSyncClient(c,{sessionId:i,persistenceKey:t,onLoad(){u||n({store:c,status:"synced-local"})},onLoadError(e){u||n({status:"error",error:e})}});return()=>{u=!0,h.close()}},[e,n]),t}},5932:function(e,t,n){"use strict";n.d(t,{O:function(){return usePassThroughWheelEvents}});var r=n(2265),i=n(77700),o=n(45827);function usePassThroughWheelEvents(e){if(!e)throw Error("usePassThroughWheelEvents must be passed a ref");let t=(0,o.uK)();(0,r.useEffect)(()=>{function onWheel(n){if(n.isSpecialRedispatchedEvent)return;let r=e.current;if(r&&r.scrollHeight>r.clientHeight)return;(0,i.PF)(n);let o=t.querySelector(".tl-canvas");if(!o)return;let a=new WheelEvent("wheel",n);a.isSpecialRedispatchedEvent=!0,o.dispatchEvent(a)}let n=e.current;if(n)return n.addEventListener("wheel",onWheel,{passive:!1}),()=>{n.removeEventListener("wheel",onWheel)}},[t,e])}},27359:function(e,t,n){"use strict";n.d(t,{k:function(){return usePeerIds}});var r=n(30742),i=n(71743),o=n(3373);function usePeerIds(){let e=(0,o.jE)(),t=(0,r.vc)("userIds",()=>(0,i.j)(e.getCollaborators().map(e=>e.userId)).sort(),{isEqual:(e,t)=>e.join(",")===t.join?.(",")},[e]);return(0,r.Hg)(t)}},80730:function(e,t,n){"use strict";n.d(t,{o:function(){return usePresence}});var r=n(30742),i=n(3373);function usePresence(e){let t=(0,i.jE)(),n=(0,r.Hg)(`latestPresence:${e}`,()=>t.getCollaborators().find(t=>t.userId===e),[t,e]);return n??null}},22890:function(e,t,n){"use strict";n.d(t,{r:function(){return useRefState}});var r=n(2265);function useRefState(e){let t=(0,r.useRef)(e),[n,i]=(0,r.useState)(e);n!==t.current&&i(t.current);let o=(0,r.useCallback)(e=>{"function"==typeof e?t.current=e(t.current):t.current=e,i(t.current)},[]);return[n,o]}},91496:function(e,t,n){"use strict";n.d(t,{Gj:function(){return useUniqueSafeId},Vx:function(){return sanitizeId},Ws:function(){return useSharedSafeId},mq:function(){return suffixSafeId},vc:function(){return IdProvider}});var r=n(57437),i=n(70938),o=n(2265);function suffixSafeId(e,t){return sanitizeId(`${e}_${t}`)}function useUniqueSafeId(e){return sanitizeId(`${(0,o.useId)()}${e??""}`)}function useSharedSafeId(e){let t=(0,i.kP)((0,o.useContext)(a));return sanitizeId(`${t}_${e}`)}function sanitizeId(e){return e.replace(/:/g,"_")}let a=(0,o.createContext)(null);function IdProvider({children:e}){let t=useUniqueSafeId();return(0,r.jsx)(a.Provider,{value:t,children:e})}},68576:function(e,t,n){"use strict";n.d(t,{H:function(){return useTransform}});var r=n(2265);function useTransform(e,t,n,i,o,a){(0,r.useLayoutEffect)(()=>{let r=e.current;if(!r||void 0===t)return;let l=`translate(${t}px, ${n}px)`;void 0!==i&&(l+=` scale(${i})`),void 0!==o&&(l+=` rotate(${o}rad)`),a&&(l+=` translate(${a.x}px, ${a.y}px)`),r.style.transform=l})}},39138:function(e,t,n){"use strict";n.d(t,{WN:function(){return LicenseManager}});var r=n(31316),i=n(70938),o=n(12011),a=n(50280);function str2ab(e){let t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0,r=e.length;t<r;t++)n[t]=e.charCodeAt(t);return t}let l={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8},d=Math.max(...Object.values(l)),c={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},u=Object.keys(c).length,h="sales@tldraw.com",p=`${(0,a.M)()}/watermarks/watermark-track.svg`;let LicenseManager=class LicenseManager{publicKey="MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ";isDevelopment;isTest;isCryptoAvailable;state=(0,r.cn)("license state","pending");verbose=!0;constructor(e,t,n){this.isTest=!1,this.isDevelopment=this.getIsDevelopment(n),this.publicKey=t||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(e).then(e=>{let t=function(e){if(!e.isLicenseParseable||!e.isDomainValid&&!e.isDevelopment)return!0;if(e.isPerpetualLicenseExpired||e.isAnnualLicenseExpired){if(e.isInternalLicense)throw Error("License: Internal license expired.");return!0}return!1}(e);!this.isDevelopment&&t&&(0,i.he)(p),t?this.state.set("unlicensed"):e.isLicensedWithWatermark?this.state.set("licensed-with-watermark"):this.state.set("licensed")})}getIsDevelopment(e){return"development"===e||"production"!==e&&(!["https:","vscode-webview:"].includes(window.location.protocol)||"localhost"===window.location.hostname)}async extractLicenseKey(e){let t,n;let[r,i]=e.split("."),[o,a]=r.split("/");if(!o.startsWith("tldraw-"))throw Error(`Unsupported prefix '${o}'`);let l=await function(e){let t=atob(e),n=str2ab(t);return crypto.subtle.importKey("spki",new Uint8Array(n),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}(this.publicKey);try{t=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},l,new Uint8Array(str2ab(atob(i))),new Uint8Array(str2ab(atob(a))))}catch(e){throw console.error(e),Error("Could not perform signature validation")}if(!t)throw Error("Invalid signature");try{n=JSON.parse(atob(a))}catch{throw Error("Could not parse object")}return n.length>u&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:n[c.ID],hosts:n[c.HOSTS],flags:n[c.FLAGS],expiryDate:n[c.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let t=e.replace(/[\u200B-\u200D\uFEFF]/g,"");t=t.replace(/\r?\n|\r/g,"");try{let e=await this.extractLicenseKey(t),n=new Date(e.expiryDate),r=this.isFlagEnabled(e.flags,l.ANNUAL_LICENSE),i=this.isFlagEnabled(e.flags,l.PERPETUAL_LICENSE),o={license:e,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(e),expiryDate:n,isAnnualLicense:r,isAnnualLicenseExpired:r&&this.isAnnualLicenseExpired(n),isPerpetualLicense:i,isPerpetualLicenseExpired:i&&this.isPerpetualLicenseExpired(n),isInternalLicense:this.isFlagEnabled(e.flags,l.INTERNAL_LICENSE),isLicensedWithWatermark:this.isFlagEnabled(e.flags,l.WITH_WATERMARK)};return this.outputLicenseInfoIfNeeded(o),o}catch(e){return this.outputInvalidLicenseKey(e.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){let t=window.location.hostname.toLowerCase();return e.hosts.some(e=>{let n=e.toLowerCase().trim();if(n===t||`www.${n}`===t||n===`www.${t}`||"*"===e)return!0;if(e.includes("*")){let n=new RegExp(e.replace(/\*/g,".*?"));return n.test(t)||n.test(`www.${t}`)}if("vscode-webview:"===window.location.protocol){let e=new URL(window.location.href),t=e.searchParams.get("extensionId");if(n===t)return!0}return!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+5+1)}isAnnualLicenseExpired(e){let t=this.getExpirationDateWithGracePeriod(e),n=new Date>=t;return!n&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${h} if you would like to renew your license.`]),n}isPerpetualLicenseExpired(e){let t=this.getExpirationDateWithGracePeriod(e),n={major:new Date(o.R.major),minor:new Date(o.R.minor)};return n.major>=t||n.minor>=t}isFlagEnabled(e,t){return(e&t)===t}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${h} to renew.`]),e.isDomainValid||e.isDevelopment||this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${h} if you would like to use tldraw on other domains.`]),e.license.flags>=2*d&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest&&this.verbose){for(let t of(this.outputDelimiter(),e))console.log(`%c${t}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}static className="tl-watermark_SEE-LICENSE"}},25485:function(e,t,n){"use strict";n.d(t,{a:function(){return i}});var r=n(2265);let i={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:r.Fragment,enableToolbarKeyboardShortcuts:!0,maxFontsToLoadBeforeRender:1/0,nonce:void 0}},30696:function(e,t,n){"use strict";n.d(t,{Ee:function(){return flipSelectionHandleX},Op:function(){return flipSelectionHandleY},dC:function(){return rotateSelectionHandle},m3:function(){return isSelectionCorner},rf:function(){return a},xu:function(){return Box}});var r=n(14204),i=n(46166);let Box=class Box{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.w=n,this.h=r}x=0;y=0;w=0;h=0;get point(){return new r.B(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get left(){return this.x}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get right(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get top(){return this.y}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get bottom(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new r.B(this.x+this.w/2,this.y+this.h/2)}set center(e){this.x=e.x-this.w/2,this.y=e.y-this.h/2}get corners(){return[new r.B(this.x,this.y),new r.B(this.x+this.w,this.y),new r.B(this.x+this.w,this.y+this.h),new r.B(this.x,this.y+this.h)]}get cornersAndCenter(){return[new r.B(this.x,this.y),new r.B(this.x+this.w,this.y),new r.B(this.x+this.w,this.y+this.h),new r.B(this.x,this.y+this.h),new r.B(this.x+this.w/2,this.y+this.h/2)]}get sides(){let{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new r.B(this.w,this.h)}toFixed(){return this.x=(0,i.Zd)(this.x),this.y=(0,i.Zd)(this.y),this.w=(0,i.Zd)(this.w),this.h=(0,i.Zd)(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,n=0,r=0){return this.x=e,this.y=t,this.w=n,this.h=r,this}expand(e){let t=Math.min(this.x,e.x),n=Math.min(this.y,e.y),r=Math.max(this.x+this.w,e.x+e.w),i=Math.max(this.y+this.h,e.y+e.h);return this.x=t,this.y=n,this.w=r-t,this.h=i-n,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=2*e,this.h+=2*e,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){let{x:e,y:t,w:n,h:r}=this;return new Box(e,t,n,r)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){let t=Math.round(this.x/e)*e,n=Math.round(this.y/e)*e,r=Math.round((this.x+this.w)/e)*e,i=Math.round((this.y+this.h)/e)*e;this.minX=t,this.minY=n,this.width=Math.max(1,r-t),this.height=Math.max(1,i-n)}collides(e){return Box.Collides(this,e)}contains(e){return Box.Contains(this,e)}includes(e){return Box.Includes(this,e)}containsPoint(e,t=0){return Box.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new r.B(this.x,this.y);case"top_right":return new r.B(this.x+this.w,this.y);case"bottom_left":return new r.B(this.x,this.y+this.h);case"bottom_right":return new r.B(this.x+this.w,this.y+this.h);case"top":return new r.B(this.x+this.w/2,this.y);case"right":return new r.B(this.x+this.w,this.y+this.h/2);case"bottom":return new r.B(this.x+this.w/2,this.y+this.h);case"left":return new r.B(this.x,this.y+this.h/2)}}toJson(){return{x:this.x,y:this.y,w:this.w,h:this.h}}resize(e,t,n){let{minX:r,minY:i,maxX:o,maxY:a}=this,{minX:l,minY:d,maxX:c,maxY:u}=this;switch(e){case"left":case"top_left":case"bottom_left":l+=t;break;case"right":case"top_right":case"bottom_right":c+=t}switch(e){case"top":case"top_left":case"top_right":d+=n;break;case"bottom":case"bottom_left":case"bottom_right":u+=n}let h=(c-l)/(o-r),p=(u-d)/(a-i);if(h<0){let e=c;c=l,l=e}if(p<0){let e=u;u=d,d=e}this.minX=l,this.minY=d,this.width=Math.abs(c-l),this.height=Math.abs(u-d)}union(e){let t=Math.min(this.x,e.x),n=Math.min(this.y,e.y),r=Math.max(this.x+this.w,e.x+e.w),i=Math.max(this.y+this.h,e.y+e.h);return this.x=t,this.y=n,this.width=r-t,this.height=i-n,this}static From(e){return new Box(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new Box(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){let t;if(0===e.length)return new Box;let n=1/0,r=1/0,i=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a++)n=Math.min((t=e[a]).x,n),r=Math.min(t.y,r),i=Math.max(t.x,i),o=Math.max(t.y,o);return new Box(n,r,i-n,o-r)}static Expand(e,t){let n=Math.min(t.minX,e.minX),r=Math.min(t.minY,e.minY),i=Math.max(t.maxX,e.maxX),o=Math.max(t.maxY,e.maxY);return new Box(n,r,i-n,o-r)}static ExpandBy(e,t){return new Box(e.minX-t,e.minY-t,e.width+2*t,e.height+2*t)}static Collides(e,t){return!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)}static Contains(e,t){return e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX}static Includes(e,t){return Box.Collides(e,t)||Box.Contains(e,t)}static ContainsPoint(e,t,n=0){return!(t.x<e.minX-n||t.y<e.minY-n||t.x>e.maxX+n||t.y>e.maxY+n)}static Common(e){let t=1/0,n=1/0,r=-1/0,i=-1/0;for(let o=0;o<e.length;o++){let a=e[o];t=Math.min(t,a.minX),n=Math.min(n,a.minY),r=Math.max(r,a.maxX),i=Math.max(i,a.maxY)}return new Box(t,n,r-t,i-n)}static Sides(e,t=0){let{corners:n}=e;return[[n[0],n[1]],[n[1],n[2]],[n[2],n[3]],[n[3],n[0]]]}static Resize(e,t,n,r,i=!1){let{minX:o,minY:a,maxX:l,maxY:d}=e,{minX:c,minY:u,maxX:h,maxY:p}=e;switch(t){case"left":case"top_left":case"bottom_left":c+=n;break;case"right":case"top_right":case"bottom_right":h+=n}switch(t){case"top":case"top_left":case"top_right":u+=r;break;case"bottom":case"bottom_left":case"bottom_right":p+=r}let f=(h-c)/(l-o),g=(p-u)/(d-a);if(i){let e=(l-o)/(d-a),n=Math.abs(h-c),r=Math.abs(p-u),i=n*(g<0?1:-1)*(1/e),m=r*(f<0?1:-1)*e,y=e<n/r;switch(t){case"top_left":y?u=p+i:c=h+m;break;case"top_right":y?u=p+i:h=c-m;break;case"bottom_right":y?p=u-i:h=c-m;break;case"bottom_left":y?p=u-i:c=h+m;break;case"bottom":case"top":{let t=(c+h)/2,n=r*e;c=t-n/2,h=t+n/2;break}case"left":case"right":{let t=(u+p)/2,r=n/e;u=t-r/2,p=t+r/2}}}if(f<0){let e=h;h=c,c=e}if(g<0){let e=p;p=u,u=e}let m=new Box(c,u,Math.abs(h-c),Math.abs(p-u));return{box:m,scaleX:+(m.width/e.width*(f>0?1:-1)).toFixed(5),scaleY:+(m.height/e.height*(g>0?1:-1)).toFixed(5)}}equals(e){return Box.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new Box(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}};function flipSelectionHandleY(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return e}}function flipSelectionHandleX(e){switch(e){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return e}}let o=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function rotateSelectionHandle(e,t){t%=i.yo;let n=Math.round(t/(i.PI/4)),r=o.indexOf(e);return o[(r+n)%o.length]}function isSelectionCorner(e){return"top_left"===e||"top_right"===e||"bottom_right"===e||"bottom_left"===e}let a={top_left_rotate:"top_left",top_right_rotate:"top_right",bottom_right_rotate:"bottom_right",bottom_left_rotate:"bottom_left",mobile_rotate:"top_left"}},45404:function(e,t,n){"use strict";n.d(t,{_:function(){return Mat}});var r=n(30696),i=n(46166),o=n(14204);let Mat=class Mat{constructor(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=o}a=1;b=0;c=0;d=1;e=0;f=0;equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){let{a:t,b:n,c:r,d:i,e:o,f:a}=this;return this.a=t*e.a+r*e.b,this.c=t*e.c+r*e.d,this.e=t*e.e+r*e.f+o,this.b=n*e.a+i*e.b,this.d=n*e.c+i*e.d,this.f=n*e.e+i*e.f+a,this}rotate(e,t,n){return 0===e?this:void 0===t?this.multiply(Mat.Rotate(e)):this.translate(t,n).multiply(Mat.Rotate(e)).translate(-t,-n)}translate(e,t){return this.multiply(Mat.Translate(e,t))}scale(e,t){return this.multiply(Mat.Scale(e,t))}invert(){let{a:e,b:t,c:n,d:r,e:i,f:o}=this,a=e*r-t*n;return this.a=r/a,this.b=-(t/a),this.c=-(n/a),this.d=e/a,this.e=-((r*i-n*o)/a),this.f=(t*i-e*o)/a,this}applyToPoint(e){return Mat.applyToPoint(this,e)}applyToPoints(e){return Mat.applyToPoints(this,e)}rotation(){return Mat.Rotation(this)}point(){return Mat.Point(this)}decomposed(){return Mat.Decompose(this)}toCssString(){return Mat.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return Mat.Decompose(this)}clone(){return new Mat(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new Mat(1,0,0,1,0,0)}static Translate(e,t){return new Mat(1,0,0,1,e,t)}static Rotate(e,t,n){if(0===e)return Mat.Identity();let r=Math.cos(e),i=Math.sin(e),o=new Mat(r,i,-i,r,0,0);return void 0===t?o:Mat.Compose(Mat.Translate(t,n),o,Mat.Translate(-t,-n))}static Scale(e,t,n,r){let i=new Mat(e,0,0,t,0,0);return void 0===n?i:Mat.Translate(n,r).multiply(i).translate(-n,-r)}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:-((e.d*e.e-e.c*e.f)/t),f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:-((e.b*e.e-e.a*e.f)/t)}}static Compose(...e){let t=Mat.Identity();for(let n=0,r=e.length;n<r;n++)t.multiply(e[n]);return t}static Point(e){return new o.B(e.e,e.f)}static Rotation(e){let t;if(0!==e.a||0!==e.c){let n=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/n)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let n=(e.b*e.b+e.d*e.d)**.5;t=i.pj+Math.acos(e.b/n)*(e.d>0?-1:1)}else t=0;return(0,i.Ci)(t)}static Decompose(e){let t,n,r;if(0!==e.a||0!==e.c){let i=(e.a*e.a+e.c*e.c)**.5;t=i,n=(e.a*e.d-e.b*e.c)/i,r=Math.acos(e.a/i)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let o=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/o,n=o,r=i.pj+Math.acos(e.b/o)*(e.d>0?-1:1)}else t=0,n=0,r=0;return{x:e.e,y:e.f,scaleX:t,scaleY:n,rotation:(0,i.Ci)(r)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${(0,i.$Z)(e.a)}, ${(0,i.$Z)(e.b)}, ${(0,i.$Z)(e.c)}, ${(0,i.$Z)(e.d)}, ${(0,i.$Z)(e.e)}, ${(0,i.$Z)(e.f)})`}static applyToPoint(e,t){return new o.B(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,n){return[e.a*t+e.c*n+e.e,e.b*t+e.d*n+e.f]}static applyToPoints(e,t){return t.map(t=>new o.B(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z))}static applyToBounds(e,t){return new r.xu(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new Mat(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof Mat?e:Mat.From(e)}}},14204:function(e,t,n){"use strict";n.d(t,{B:function(){return Vec}});var r=n(31986),i=n(46166);let Vec=class Vec{constructor(e=0,t=0,n=1){this.x=e,this.y=t,this.z=n}get pressure(){return this.z}set(e=this.x,t=this.y,n=this.z){return this.x=e,this.y=t,this.z=n,this}setTo({x:e=0,y:t=0,z:n=1}){return this.x=e,this.y=t,this.z=n,this}rot(e){if(0===e)return this;let{x:t,y:n}=this,r=Math.sin(e),i=Math.cos(e);return this.x=t*i-n*r,this.y=t*r+n*i,this}rotWith(e,t){if(0===t)return this;let n=this.x-e.x,r=this.y-e.y,i=Math.sin(t),o=Math.cos(t);return this.x=e.x+(n*o-r*i),this.y=e.y+(n*i+r*o),this}clone(){let{x:e,y:t,z:n}=this;return new Vec(e,t,n)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),void 0!==t&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){let n=Vec.Tan(e,this);return this.add(n.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return Vec.Dpr(this,e)}cpr(e){return Vec.Cpr(this,e)}len2(){return Vec.Len2(this)}len(){return Vec.Len(this)}pry(e){return Vec.Pry(this,e)}per(){let{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){let e=this.len();return 0===e||(this.x/=e,this.y/=e),this}tan(e){return this.sub(e).uni()}dist(e){return Vec.Dist(this,e)}distanceToLineSegment(e,t){return Vec.DistanceToLineSegment(e,t,this)}slope(e){return Vec.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return Vec.Angle(this,e)}toAngle(){return Vec.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return Vec.Equals(this,e)}equalsXY(e,t){return Vec.EqualsXY(this,e,t)}norm(){return this.uni()}toFixed(){return this.x=(0,i.FH)(this.x),this.y=(0,i.FH)(this.y),this}toString(){return Vec.ToString(Vec.ToFixed(this))}toJson(){return Vec.ToJson(this)}toArray(){return Vec.ToArray(this)}static Add(e,t){return new Vec(e.x+t.x,e.y+t.y)}static AddXY(e,t,n){return new Vec(e.x+t,e.y+n)}static Sub(e,t){return new Vec(e.x-t.x,e.y-t.y)}static SubXY(e,t,n){return new Vec(e.x-t,e.y-n)}static AddScalar(e,t){return new Vec(e.x+t,e.y+t)}static SubScalar(e,t){return new Vec(e.x-t,e.y-t)}static Div(e,t){return new Vec(e.x/t,e.y/t)}static Mul(e,t){return new Vec(e.x*t,e.y*t)}static DivV(e,t){return new Vec(e.x/t.x,e.y/t.y)}static MulV(e,t){return new Vec(e.x*t.x,e.y*t.y)}static Neg(e){return new Vec(-e.x,-e.y)}static Per(e){return new Vec(e.y,-e.x)}static Abs(e){return new Vec(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static ManhattanDist(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}static DistMin(e,t,n){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<n**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new Vec(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return Vec.Dpr(e,t)/Vec.Len(t)}static Uni(e){let t=Vec.Len(e);return new Vec(0===t?0:e.x/t,0===t?0:e.y/t)}static Tan(e,t){return Vec.Uni(Vec.Sub(e,t))}static Min(e,t){return new Vec(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new Vec(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:n=1}){return new Vec(e,t,n)}static FromArray(e){return new Vec(e[0],e[1])}static Rot(e,t=0){let n=Math.sin(t),r=Math.cos(t);return new Vec(e.x*r-e.y*n,e.x*n+e.y*r)}static RotWith(e,t,n){let r=e.x-t.x,i=e.y-t.y,o=Math.sin(n),a=Math.cos(n);return new Vec(t.x+(r*a-i*o),t.y+(r*o+i*a))}static NearestPointOnLineThroughPoint(e,t,n){return Vec.Mul(t,Vec.Sub(n,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,n,r=!0){if(Vec.Equals(e,n)||Vec.Equals(t,n))return Vec.From(n);let i=Vec.Tan(t,e),o=Vec.Add(e,Vec.Mul(i,Vec.Sub(n,e).pry(i)));if(r){if(o.x<Math.min(e.x,t.x))return Vec.Cast(e.x<t.x?e:t);if(o.x>Math.max(e.x,t.x))return Vec.Cast(e.x>t.x?e:t);if(o.y<Math.min(e.y,t.y))return Vec.Cast(e.y<t.y?e:t);if(o.y>Math.max(e.y,t.y))return Vec.Cast(e.y>t.y?e:t)}return o}static DistanceToLineThroughPoint(e,t,n){return Vec.Dist(n,Vec.NearestPointOnLineThroughPoint(e,t,n))}static DistanceToLineSegment(e,t,n,r=!0){return Vec.Dist(n,Vec.NearestPointOnLineSegment(e,t,n,r))}static Snap(e,t=1){return new Vec(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof Vec?e:Vec.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static AngleBetween(e,t){let n=e.x*t.x+e.y*t.y,r=Math.sqrt((Math.pow(e.x,2)+Math.pow(e.y,2))*(Math.pow(t.x,2)+Math.pow(t.y,2))),o=e.x*t.y-e.y*t.x<0?-1:1,a=o*Math.acos((0,i.uZ)(n/r,-1,1));return a}static Lrp(e,t,n){return Vec.Sub(t,e).mul(n).add(e)}static Med(e,t){return new Vec((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return 1e-4>Math.abs(e.x-t.x)&&1e-4>Math.abs(e.y-t.y)}static EqualsXY(e,t,n){return e.x===t&&e.y===n}static Clockwise(e,t,n){return(n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y)<0}static Rescale(e,t){let n=Vec.Len(e);return new Vec(t*e.x/n,t*e.y/n)}static ScaleWithOrigin(e,t,n){return Vec.Sub(e,n).mul(t).add(n)}static ToFixed(e){return new Vec((0,i.FH)(e.x),(0,i.FH)(e.y))}static ToInt(e){return new Vec(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,t,n){return Vec.Add(e,Vec.Tan(t,e).mul(n))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=2*Math.PI),t}static FromAngle(e,t=1){return new Vec(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){let{x:t,y:n,z:r}=e;return{x:t,y:n,z:r}}static Average(e){let t=e.length,n=new Vec(0,0);if(0===t)return n;for(let r=0;r<t;r++)n.add(e[r]);return n.div(t)}static Clamp(e,t,n){return void 0===n?new Vec(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new Vec(Math.min(Math.max(e.x,t),n),Math.min(Math.max(e.y,t),n))}static PointsBetween(e,t,n=6){let i=[];for(let o=0;o<n;o++){let a=r.L.easeInQuad(o/(n-1)),l=Vec.Lrp(e,t,a);l.z=Math.min(1,.5+.65*Math.abs(.5-ease(a))),i.push(l)}return i}static SnapToGrid(e,t=8){return new Vec(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}};let ease=e=>e<.5?2*e*e:-1+(4-2*e)*e},31986:function(e,t,n){"use strict";n.d(t,{L:function(){return r}});let r={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e*e:-1+(4-2*e)*e,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1+--e*e*e*e*e,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e<=0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e>=1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e<=0?0:e>=1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}},84137:function(e,t,n){"use strict";n.d(t,{W:function(){return Edge2d}});var r=n(14204),i=n(74519);let Edge2d=class Edge2d extends i.l${_start;_end;_d;_u;_ul;constructor(e){super({...e,isClosed:!1,isFilled:!1});let{start:t,end:n}=e;this._start=t,this._end=n,this._d=t.clone().sub(n),this._u=this._d.clone().uni(),this._ul=this._u.len()}getLength(){return this._d.len()}getVertices(){return[this._start,this._end]}nearestPoint(e){let{_start:t,_end:n,_d:i,_u:o,_ul:a}=this;if(0===i.len()||0===a)return t;let l=r.B.Sub(e,t).dpr(o)/a,d=t.x+o.x*l;if(d<Math.min(t.x,n.x))return t.x<n.x?t:n;if(d>Math.max(t.x,n.x))return t.x>n.x?t:n;let c=t.y+o.y*l;return c<Math.min(t.y,n.y)?t.y<n.y?t:n:c>Math.max(t.y,n.y)?t.y>n.y?t:n:new r.B(d,c)}getSvgPathData(e=!0){let{_start:t,_end:n}=this;return`${e?`M${t.toFixed()}`:""} L${n.toFixed()}`}}},74519:function(e,t,n){"use strict";n.d(t,{Dn:function(){return c},Lf:function(){return TransformedGeometry2d},l$:function(){return Geometry2d}});var r=n(70938),i=n(30696),o=n(45404),a=n(14204),l=n(30224),d=n(46166);let c={EXCLUDE_NON_STANDARD:{includeLabels:!1,includeInternal:!1},INCLUDE_ALL:{includeLabels:!0,includeInternal:!0},EXCLUDE_LABELS:{includeLabels:!1,includeInternal:!0},EXCLUDE_INTERNAL:{includeLabels:!0,includeInternal:!1}};let Geometry2d=class Geometry2d{isFilled=!1;isClosed=!0;isLabel=!1;isEmptyLabel=!1;isInternal=!1;debugColor;ignore;constructor(e){let{isLabel:t=!1,isEmptyLabel:n=!1,isInternal:r=!1}=e;this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.debugColor=e.debugColor,this.ignore=e.ignore,this.isLabel=t,this.isEmptyLabel=n,this.isInternal=r}isExcludedByFilter(e){return!!e&&(!!this.isLabel&&!e.includeLabels||!!this.isInternal&&!e.includeInternal)}hitTestPoint(e,t=0,n=!1,r){return!!(this.isClosed&&(this.isFilled||n)&&(0,d.Of)(e,this.vertices))||a.B.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e,t=!1,n){return a.B.Dist(e,this.nearestPoint(e,n))*(this.isClosed&&(this.isFilled||t)&&(0,d.Of)(e,this.vertices)?-1:1)}distanceToLineSegment(e,t,n){let r,i,o,c;if(a.B.Equals(e,t))return this.distanceToPoint(e,!1,n);let{vertices:u}=this,h=1/0,p=this.isClosed?u.length:u.length-1;for(let n=0;n<u.length;n++){if(o=u[n],n<p){let r=u[(n+1)%u.length];if((0,l.cB)(e,t,o,r))return 0}c=a.B.NearestPointOnLineSegment(e,t,o,!0),(i=a.B.Dist2(o,c))<h&&(h=i,r=c)}if(!r)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&(0,d.Of)(r,this.vertices)?-h:h}hitTestLineSegment(e,t,n=0,r){return this.distanceToLineSegment(e,t,r)<=n}intersectLineSegment(e,t,n){let r=this.isClosed?(0,l.qZ)(e,t,this.vertices):(0,l.Gc)(e,t,this.vertices);return r??[]}intersectCircle(e,t,n){let r=this.isClosed?(0,l.h9)(e,t,this.vertices):(0,l.XS)(e,t,this.vertices);return r??[]}intersectPolygon(e,t){return(0,l.fm)(e,this.vertices,!0,this.isClosed)}intersectPolyline(e,t){return(0,l.fm)(e,this.vertices,!1,this.isClosed)}interpolateAlongEdge(e,t){let{vertices:n}=this;if(e<=0)return n[0];let i=e*this.length,o=0;for(let e=0;e<(this.isClosed?n.length:n.length-1);e++){let t=n[e],l=n[(e+1)%n.length],d=a.B.Dist(t,l),c=o+d;if(c>=i){let e=a.B.Lrp(t,l,(0,r.VN)(o,c,i));return e}o=c}return this.isClosed?n[0]:n[n.length-1]}uninterpolateAlongEdge(e,t){let{vertices:n,length:i}=this,o=null,l=1/0,d=0;for(let t=0;t<(this.isClosed?n.length:n.length-1);t++){let r=n[t],i=n[(t+1)%n.length],c=a.B.NearestPointOnLineSegment(r,i,e,!0),u=a.B.Dist(c,e);u<l&&(l=u,o={start:r,end:i,nearestPoint:c,distanceToStart:d}),d+=a.B.Dist(r,i)}(0,r.hu)(o);let c=o.distanceToStart+a.B.Dist(o.start,o.nearestPoint);return c/i}nearestPointOnLineSegment(e,t){let n,r,i,o;let{vertices:l}=this,d=1/0;for(let c=0;c<l.length;c++)i=l[c],o=a.B.NearestPointOnLineSegment(e,t,i,!0),(r=a.B.Dist2(i,o))<d&&(d=r,n=o);if(!n)throw Error("nearest point not found");return n}isPointInBounds(e,t=0){let{bounds:n}=this;return!(e.x<n.minX-t||e.y<n.minY-t||e.x>n.maxX+t||e.y>n.maxY+t)}transform(e,t){return new TransformedGeometry2d(this,e,t)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices(c.EXCLUDE_LABELS)),this._vertices}getBounds(){return i.xu.FromPoints(this.vertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;let{vertices:e}=this,t=0;for(let n=0,r=e.length;n<r;n++){let i=e[n],o=e[(n+1)%r];t+=i.x*o.y-o.x*i.y}return t/2}toSimpleSvgPath(){let e="",{vertices:t}=this,n=t.length;if(0===n)return e;e+=`M${t[0].x},${t[0].y}`;for(let r=1;r<n;r++)e+=`L${t[r].x},${t[r].y}`;return this.isClosed&&(e+="Z"),e}_length;get length(){return this._length||(this._length=this.getLength(c.EXCLUDE_LABELS)),this._length}getLength(e){let t=this.getVertices(e??c.EXCLUDE_LABELS);if(0===t.length)return 0;let n=t[0],r=0;for(let e=1;e<t.length;e++){let i=t[e];r+=a.B.Dist(n,i),n=i}return this.isClosed&&(r+=a.B.Dist(t[t.length-1],t[0])),r}};let TransformedGeometry2d=class TransformedGeometry2d extends Geometry2d{constructor(e,t,n){super(e),this.geometry=e,this.matrix=t,this.inverse=o._.Inverse(t),this.decomposed=o._.Decompose(t),n&&(null!=n.isLabel&&(this.isLabel=n.isLabel),null!=n.isInternal&&(this.isInternal=n.isInternal),null!=n.debugColor&&(this.debugColor=n.debugColor),null!=n.ignore&&(this.ignore=n.ignore)),(0,r.hu)((0,d.C2)(this.decomposed.scaleX,this.decomposed.scaleY),"non-uniform scaling is not yet supported")}inverse;decomposed;getVertices(e){return this.geometry.getVertices(e).map(e=>o._.applyToPoint(this.matrix,e))}nearestPoint(e,t){return o._.applyToPoint(this.matrix,this.geometry.nearestPoint(o._.applyToPoint(this.inverse,e),t))}hitTestPoint(e,t=0,n,r){return this.geometry.hitTestPoint(o._.applyToPoint(this.inverse,e),t/this.decomposed.scaleX,n,r)}distanceToPoint(e,t=!1,n){return this.geometry.distanceToPoint(o._.applyToPoint(this.inverse,e),t,n)*this.decomposed.scaleX}distanceToLineSegment(e,t,n){return this.geometry.distanceToLineSegment(o._.applyToPoint(this.inverse,e),o._.applyToPoint(this.inverse,t),n)*this.decomposed.scaleX}hitTestLineSegment(e,t,n=0,r){return this.geometry.hitTestLineSegment(o._.applyToPoint(this.inverse,e),o._.applyToPoint(this.inverse,t),n/this.decomposed.scaleX,r)}intersectLineSegment(e,t,n){return o._.applyToPoints(this.matrix,this.geometry.intersectLineSegment(o._.applyToPoint(this.inverse,e),o._.applyToPoint(this.inverse,t),n))}intersectCircle(e,t,n){return o._.applyToPoints(this.matrix,this.geometry.intersectCircle(o._.applyToPoint(this.inverse,e),t/this.decomposed.scaleX,n))}intersectPolygon(e,t){return o._.applyToPoints(this.matrix,this.geometry.intersectPolygon(o._.applyToPoints(this.inverse,e),t))}intersectPolyline(e,t){return o._.applyToPoints(this.matrix,this.geometry.intersectPolyline(o._.applyToPoints(this.inverse,e),t))}transform(e,t){return new TransformedGeometry2d(this.geometry,o._.Multiply(e,this.matrix),{isLabel:t?.isLabel??this.isLabel,isInternal:t?.isInternal??this.isInternal,debugColor:t?.debugColor??this.debugColor,ignore:t?.ignore??this.ignore})}getSvgPathData(){throw Error("Cannot get SVG path data for transformed geometry.")}}},87684:function(e,t,n){"use strict";n.d(t,{m:function(){return Group2d}});var r=n(31316),i=n(70938),o=n(30696),a=n(14204),l=n(74519);let Group2d=class Group2d extends l.l${children=[];ignoredChildren=[];constructor(e){super({...e,isClosed:!0,isFilled:!1});let addChildren=e=>{for(let t of e)t instanceof Group2d?addChildren(t.children):t.ignore?this.ignoredChildren.push(t):this.children.push(t)};if(addChildren(e.children),0===this.children.length)throw Error("Group2d must have at least one child")}getVertices(e){return this.isExcludedByFilter(e)?[]:this.children.filter(t=>!t.isExcludedByFilter(e)).flatMap(t=>t.getVertices(e))}nearestPoint(e,t){let n,r,i,o=1/0,{children:l}=this;if(0===l.length)throw Error("no children");for(let d of l)!d.isExcludedByFilter(t)&&(r=d.nearestPoint(e,t),(i=a.B.Dist2(r,e))<o&&(o=i,n=r));if(!n)throw Error("nearest point not found");return n}distanceToPoint(e,t=!1,n){let r=1/0;for(let i of this.children){if(i.isExcludedByFilter(n))continue;let o=i.distanceToPoint(e,t,n);o<r&&(r=o)}return r}hitTestPoint(e,t,n,r=l.Dn.EXCLUDE_LABELS){return!!this.children.filter(e=>!e.isExcludedByFilter(r)).find(r=>r.hitTestPoint(e,t,n))}hitTestLineSegment(e,t,n,r=l.Dn.EXCLUDE_LABELS){return!!this.children.filter(e=>!e.isExcludedByFilter(r)).find(r=>r.hitTestLineSegment(e,t,n))}intersectLineSegment(e,t,n){return this.children.flatMap(i=>i.isExcludedByFilter(n)?r.LZ:i.intersectLineSegment(e,t,n))}intersectCircle(e,t,n){return this.children.flatMap(i=>i.isExcludedByFilter(n)?r.LZ:i.intersectCircle(e,t,n))}intersectPolygon(e,t){return this.children.flatMap(n=>n.isExcludedByFilter(t)?r.LZ:n.intersectPolygon(e,t))}intersectPolyline(e,t){return this.children.flatMap(n=>n.isExcludedByFilter(t)?r.LZ:n.intersectPolyline(e,t))}interpolateAlongEdge(e,t){let n=this.getLength(t),r=e*n,o=0;for(let e of this.children){if(e.isExcludedByFilter(t))continue;let n=e.length,a=o+n;if(a>=r)return e.interpolateAlongEdge((0,i.VN)(o,a,r),t);o=a}return this.children[this.children.length-1].interpolateAlongEdge(1,t)}uninterpolateAlongEdge(e,t){let n=this.getLength(t),r=null,o=1/0,a=0;for(let n of this.children){if(n.isExcludedByFilter(t))continue;let i=n.getLength(t),l=a+i,d=n.distanceToPoint(e,!1,t);d<o&&(o=d,r={startLength:a,endLength:l,child:n}),a=l}(0,i.hu)(r);let l=r.child.uninterpolateAlongEdge(e,t),d=(0,i.t7)(r.startLength,r.endLength,l);return d/n}transform(e){return new Group2d({children:this.children.map(t=>t.transform(e)),isLabel:this.isLabel,debugColor:this.debugColor,ignore:this.ignore})}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(let t of this.children)e+=t.toSimpleSvgPath();let t=o.xu.FromPoints(this.vertices).corners;for(let n=0,r=t.length;n<r;n++){let i=t[n],o=t[(n-1+r)%r],a=i.dist(o),l=t[(n+1)%r],d=i.dist(l),c=i.clone().lrp(o,4/a),u=i.clone().lrp(l,4/d);e+=`M${c.x},${c.y} L${i.x},${i.y} L${u.x},${u.y} `}return e}getLength(e){let t=0;for(let n of this.children)n.isExcludedByFilter(e)||(t+=n.length);return t}getSvgPathData(){return this.children.map((e,t)=>e.isLabel?"":e.getSvgPathData(0===t)).join(" ")}}},92042:function(e,t,n){"use strict";n.d(t,{w:function(){return Polygon2d}});var r=n(86368);let Polygon2d=class Polygon2d extends r.q{constructor(e){if(super({...e}),this.isClosed=!0,e.points.length<3)throw Error("Polygon2d: points must be an array of at least 3 points")}}},86368:function(e,t,n){"use strict";n.d(t,{q:function(){return Polyline2d}});var r=n(14204),i=n(84137),o=n(74519);let Polyline2d=class Polyline2d extends o.l${_points;_segments;constructor(e){super({isClosed:!1,isFilled:!1,...e});let{points:t}=e;if(this._points=t,t.length<2)throw Error("Polyline2d: points must be an array of at least 2 points")}get segments(){if(!this._segments){this._segments=[];let{vertices:e}=this;for(let t=0,n=e.length-1;t<n;t++){let n=e[t],r=e[t+1];this._segments.push(new i.W({start:n,end:r}))}this.isClosed&&this._segments.push(new i.W({start:e[e.length-1],end:e[0]}))}return this._segments}getLength(){return this.segments.reduce((e,t)=>e+t.length,0)}getVertices(){return this._points}nearestPoint(e){let t,n;let{segments:i}=this,o=this._points[0],a=1/0;for(let l=0;l<i.length;l++)t=i[l].nearestPoint(e),(n=r.B.Dist2(t,e))<a&&(o=t,a=n);if(!o)throw Error("nearest point not found");return o}hitTestLineSegment(e,t,n=0){let{segments:r}=this;for(let i=0,o=r.length;i<o;i++)if(r[i].hitTestLineSegment(e,t,n))return!0;return!1}getSvgPathData(){let{vertices:e}=this;return e.length<2?"":e.reduce((e,t,n)=>0===n?`M ${t.x} ${t.y}`:`${e} L ${t.x} ${t.y}`,"")}}},29234:function(e,t,n){"use strict";n.d(t,{z:function(){return Rectangle2d}});var r=n(30696),i=n(14204),o=n(92042);let Rectangle2d=class Rectangle2d extends o.w{_x;_y;_w;_h;constructor(e){let{x:t=0,y:n=0,width:r,height:o}=e;super({...e,points:[new i.B(t,n),new i.B(t+r,n),new i.B(t+r,n+o),new i.B(t,n+o)]}),this._x=t,this._y=n,this._w=r,this._h=o}getBounds(){return new r.xu(this._x,this._y,this._w,this._h)}getSvgPathData(){let{_x:e,_y:t,_w:n,_h:r}=this;return this.negativeZeroFix(),`M${e},${t} h${n} v${r} h${-n}z`}negativeZeroFix(){this._x=zeroFix(this._x),this._y=zeroFix(this._y),this._w=zeroFix(this._w),this._h=zeroFix(this._h)}};function zeroFix(e){return Object.is(e,-0)?0:e}},30224:function(e,t,n){"use strict";n.d(t,{Gc:function(){return intersectLineSegmentPolyline},S3:function(){return intersectPolygonBounds},T9:function(){return intersectLineSegmentLineSegment},TD:function(){return polygonIntersectsPolyline},UQ:function(){return polygonsIntersect},XS:function(){return intersectCirclePolyline},ZM:function(){return intersectLineSegmentCircle},bO:function(){return intersectCircleCircle},cB:function(){return linesIntersect},fm:function(){return intersectPolys},h9:function(){return intersectCirclePolygon},qZ:function(){return intersectLineSegmentPolygon},tY:function(){return intersectPolygonPolygon}});var r=n(46166),i=n(14204);function intersectLineSegmentLineSegment(e,t,n,o,a=1e-10){let l=e.x-n.x,d=e.y-n.y,c=o.x-n.x,u=o.y-n.y,h=t.x-e.x,p=t.y-e.y,f=c*d-u*l,g=h*d-p*l,m=u*h-c*p;if((0,r.C2)(f,0,a)||(0,r.C2)(g,0,a)||(0,r.C2)(m,0,a))return null;if(0!==m){let t=f/m,n=g/m;if((0,r.KV)(0,t,a)&&(0,r.KV)(t,1,a)&&(0,r.KV)(0,n,a)&&(0,r.KV)(n,1,a))return i.B.AddXY(e,t*h,t*p)}return null}function intersectLineSegmentCircle(e,t,n,r){let o=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),a=2*((t.x-e.x)*(e.x-n.x)+(t.y-e.y)*(e.y-n.y)),l=n.x*n.x+n.y*n.y+e.x*e.x+e.y*e.y-2*(n.x*e.x+n.y*e.y)-r*r,d=a*a-4*o*l;if(d<0||0===d)return null;let c=Math.sqrt(d),u=(-a+c)/(2*o),h=(-a-c)/(2*o);if((u<0||u>1)&&(h<0||h>1))return null;let p=[];return(0<=u&&u<=1&&p.push(i.B.Lrp(e,t,u)),0<=h&&h<=1&&p.push(i.B.Lrp(e,t,h)),0===p.length)?null:p}function intersectLineSegmentPolyline(e,t,n){let r;let i=[];for(let o=0,a=n.length-1;o<a;o++)(r=intersectLineSegmentLineSegment(e,t,n[o],n[o+1]))&&i.push(r);return 0===i.length?null:i}function intersectLineSegmentPolygon(e,t,n){let r;let i=[];for(let o=1,a=n.length;o<a+1;o++)(r=intersectLineSegmentLineSegment(e,t,n[o-1],n[o%n.length]))&&i.push(r);return 0===i.length?null:i}function intersectCircleCircle(e,t,n,r){let o=n.x-e.x,a=n.y-e.y,l=Math.sqrt(o*o+a*a),d=(l*l-r*r+t*t)/(2*l),c=Math.sqrt(t*t-d*d);return o/=l,a/=l,[new i.B(e.x+o*d-a*c,e.y+a*d+o*c),new i.B(e.x+o*d+a*c,e.y+a*d-o*c)]}function intersectCirclePolygon(e,t,n){let r;let i=[];for(let o=0,a=n.length;o<a;o++)(r=intersectLineSegmentCircle(n[o],n[(o+1)%n.length],e,t))&&i.push(...r);return 0===i.length?null:i}function intersectCirclePolyline(e,t,n){let r;let i=[];for(let o=1,a=n.length;o<a;o++)(r=intersectLineSegmentCircle(n[o-1],n[o],e,t))&&i.push(...r);return 0===i.length?null:i}function intersectPolygonBounds(e,t){let n;let r=[];for(let i of t.sides)(n=intersectLineSegmentPolygon(i[0],i[1],e))&&r.push(...n);return 0===r.length?null:r}function ccw(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function linesIntersect(e,t,n,r){return ccw(e,n,r)!==ccw(t,n,r)&&ccw(e,t,n)!==ccw(e,t,r)}function intersectPolygonPolygon(e,t){let n,o,a,l;let d=new Map;for(let i=0,o=e.length;i<o;i++)if(n=e[i],(0,r.Of)(n,t)){let e=getPointId(n);d.has(e)||d.set(e,n)}for(let i=0,o=t.length;i<o;i++)if(n=t[i],(0,r.Of)(n,e)){let e=getPointId(n);d.has(e)||d.set(e,n)}for(let r=0,i=e.length;r<i;r++){n=e[r],o=e[(r+1)%e.length];for(let e=0,r=t.length;e<r;e++){a=t[e],l=t[(e+1)%t.length];let r=intersectLineSegmentLineSegment(n,o,a,l);if(null!==r){let e=getPointId(r);d.has(e)||d.set(e,r)}}}return 0===d.size?null:function(e){let t=i.B.Average(e);return e.sort((e,n)=>i.B.Angle(t,e)-i.B.Angle(t,n))}([...d.values()])}function intersectPolys(e,t,n,r){let i=new Map;for(let o=0,a=n?e.length:e.length-1;o<a;o++){let n=e[o],a=e[(o+1)%e.length];for(let e=0,o=r?t.length:t.length-1;e<o;e++){let r=t[e],o=t[(e+1)%t.length],l=intersectLineSegmentLineSegment(n,a,r,o);if(null!==l){let e=getPointId(l);i.has(e)||i.set(e,l)}}}return[...i.values()]}function getPointId(e){return`${e.x},${e.y}`}function polygonsIntersect(e,t){let n,r;for(let i=0,o=e.length;i<o;i++){n=e[i],r=e[(i+1)%o];for(let e=0,i=t.length;e<i;e++)if(linesIntersect(n,r,t[e],t[(e+1)%i]))return!0}return!1}function polygonIntersectsPolyline(e,t){let n,r;for(let i=0,o=e.length;i<o;i++){n=e[i],r=e[(i+1)%o];for(let e=1,i=t.length;e<i;e++)if(linesIntersect(n,r,t[e-1],t[e]))return!0}return!1}},46166:function(e,t,n){"use strict";n.d(t,{$Z:function(){return toDomPrecision},AV:function(){return isSafeFloat},C2:function(){return approximately},Ci:function(){return clampRadians},D4:function(){return getArcMeasure},FH:function(){return toFixed},Ht:function(){return degreesToRadians},KV:function(){return approximatelyLte},Oe:function(){return getPolygonVertices},Of:function(){return pointInPolygon},PI:function(){return i},Rp:function(){return perimeterOfEllipse},VK:function(){return clockwiseAngleDist},XD:function(){return getPointOnCircle},Y8:function(){return average},Yk:function(){return precise},Z7:function(){return shortAngleDist},Zd:function(){return toPrecision},_G:function(){return areAnglesCompatible},dv:function(){return l},ep:function(){return rangesOverlap},f5:function(){return canonicalizeRotation},fn:function(){return centerOfCircleFromThreePoints},jV:function(){return getPointsOnArc},mR:function(){return angleDistance},mW:function(){return rangeIntersection},nD:function(){return snapAngle},pc:function(){return counterClockwiseAngleDist},pj:function(){return o},rW:function(){return getPointInArcT},uZ:function(){return clamp},vi:function(){return radiansToDegrees},yo:function(){return a}});var r=n(14204);function precise(e){return`${toDomPrecision(e.x)},${toDomPrecision(e.y)} `}function average(e,t){return`${toDomPrecision((e.x+t.x)/2)},${toDomPrecision((e.y+t.y)/2)} `}let i=Math.PI,o=i/2,a=2*i,l=Math.sin;function clamp(e,t,n){return Math.max(t,void 0!==n?Math.min(e,n):e)}function toPrecision(e,t=1e10){return e?Math.round(e*t)/t:0}function approximately(e,t,n=1e-6){return Math.abs(e-t)<=n}function approximatelyLte(e,t,n=1e-6){return e<t||approximately(e,t,n)}function perimeterOfEllipse(e,t){let n=Math.pow(e-t,2)/Math.pow(e+t,2);return i*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}function canonicalizeRotation(e){return(e%=a)<0?e+=a:0===e&&(e=0),e}function clockwiseAngleDist(e,t){return(e=canonicalizeRotation(e))>(t=canonicalizeRotation(t))&&(t+=a),t-e}function counterClockwiseAngleDist(e,t){return a-clockwiseAngleDist(e,t)}function shortAngleDist(e,t){let n=(t-e)%a;return 2*n%a-n}function clampRadians(e){return(a+e)%a}function snapAngle(e,t){let n=a/t,r=Math.floor((clampRadians(e)+n/2)/n)*n%a;return r<i&&(r+=a),r>i&&(r-=a),r}function areAnglesCompatible(e,t){return e===t||approximately(e%(Math.PI/2)-t%(Math.PI/2),0)}function degreesToRadians(e){return e*i/180}function radiansToDegrees(e){return 180*e/i}function getPointOnCircle(e,t,n){return new r.B(e.x,e.y).add(r.B.FromAngle(n,t))}function getPolygonVertices(e,t,n){let i=e/2,l=t/2,d=[],c=1/0,u=-1/0,h=1/0,p=-1/0;for(let e=0;e<n;e++){let t=a/n,f=-o+e*t,g=i+i*Math.cos(f),m=l+l*Math.sin(f);g<c&&(c=g),m<h&&(h=m),g>u&&(u=g),m>p&&(p=m),d.push(new r.B(g,m))}let f=u-c,g=p-h;if(0!=e-f||0!=t-g)for(let n=0;n<d.length;n++){let r=d[n];r.x=(r.x-c)/f*e,r.y=(r.y-h)/g*t}return d}function rangesOverlap(e,t,n,r){return e<r&&n<t}function rangeIntersection(e,t,n,r){let i=Math.max(e,n),o=Math.min(t,r);return i<=o?[i,o]:null}function cross(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function pointInPolygon(e,t){let n,i,o=0;for(let a=0;a<t.length;a++){if((n=t[a]).x===e.x&&n.y===e.y||(i=t[(a+1)%t.length],r.B.Dist(e,n)+r.B.Dist(e,i)===r.B.Dist(n,i)))return!0;n.y<=e.y?i.y>e.y&&cross(n,i,e)>0&&(o+=1):i.y<=e.y&&0>cross(n,i,e)&&(o-=1)}return 0!==o}function toDomPrecision(e){return Math.round(1e4*e)/1e4}function toFixed(e){return Math.round(100*e)/100}let isSafeFloat=e=>Math.abs(e)<Number.MAX_SAFE_INTEGER;function angleDistance(e,t,n){let r=n<0?clockwiseAngleDist(e,t):counterClockwiseAngleDist(e,t);return r}function getPointInArcT(e,t,n,r){let o;if(Math.abs(e)>i){o=shortAngleDist(t,r);let i=shortAngleDist(r,n);return Math.abs(o)<Math.abs(i)?o/e:(e-i)/e}{o=shortAngleDist(t,r);let n=o/e;return Math.sign(o)!==Math.sign(e)?Math.abs(n)>.5?1:0:n}}function getArcMeasure(e,t,n,r){let i=2*((t-e)%a)%a-(t-e)%a;return r?(a-Math.abs(i))*(n?1:-1):i}function centerOfCircleFromThreePoints(e,t,n){let i=-2*(e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y),o=((e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y))/i,a=((e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x))/i;return Number.isFinite(o)&&Number.isFinite(a)?new r.B(o,a):null}function getPointsOnArc(e,t,n,i,o){if(null===n)return[r.B.From(e),r.B.From(t)];let a=[],l=r.B.Angle(n,e),d=r.B.Angle(n,t),c=clockwiseAngleDist(l,d);for(let e=0;e<o;e++){let t=e/(o-1),r=l+c*t,d=getPointOnCircle(n,i,r);a.push(d)}return a}},9006:function(e,t,n){"use strict";n.d(t,{_:function(){return ReadonlySharedStyleMap},o:function(){return SharedStyleMap}});var r=n(70938);function sharedStyleEquals(e,t){if(!t)return!1;switch(e.type){case"mixed":return"mixed"===t.type;case"shared":return"shared"===t.type&&e.value===t.value;default:throw(0,r.iP)(e)}}let ReadonlySharedStyleMap=class ReadonlySharedStyleMap{map;constructor(e){this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){let t=this.get(e);if(t&&"mixed"!==t.type)return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;let t=new Set;for(let[n,r]of this){if(!sharedStyleEquals(r,e.get(n)))return!1;t.add(n)}for(let[n,r]of e)if(!t.has(n)&&!sharedStyleEquals(r,this.get(n)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}};let SharedStyleMap=class SharedStyleMap extends ReadonlySharedStyleMap{set(e,t){this.map.set(e,t)}applyValue(e,t){let n=this.get(e);if(!n){this.set(e,{type:"shared",value:t});return}switch(n.type){case"mixed":return;case"shared":n.value!==t&&this.set(e,{type:"mixed"});return;default:(0,r.iP)(n,"type")}}}},20047:function(e,t,n){"use strict";n.d(t,{e:function(){return areShapesContentEqual}});let areShapesContentEqual=(e,t)=>e.props===t.props&&e.meta===t.meta},50280:function(e,t,n){"use strict";n.d(t,{B:function(){return dataUrlToFile},M:function(){return getDefaultCdnBaseUrl}});var r=n(70938),i=n(12011);function dataUrlToFile(e,t,n){return(0,r.he)(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:n})})}function getDefaultCdnBaseUrl(){return`https://cdn.tldraw.com/${i.i}`}},32764:function(e,t,n){"use strict";n.d(t,{E:function(){return clampToBrowserMaxCanvasSize}});let r=null,i={area:[16384,14188,11402,11180,10836,8192,4096],height:[8388607,65535,32767,16384,8192,4096],width:[4194303,65535,32767,16384,8192,4096]};function getCanvasSize(e){let t=document.createElement("canvas");t.width=1,t.height=1;let n=t.getContext("2d");for(let r of i[e]){let i="height"===e?1:r,o="width"===e?1:r,a=document.createElement("canvas");a.width=i,a.height=o;let l=a.getContext("2d");l.fillRect(i-1,o-1,1,1),n.drawImage(a,i-1,o-1,1,1,0,0,1,1);let d=0!==n.getImageData(0,0,1,1).data[3];if(a.width=0,a.height=0,d){if(t.width=0,t.height=0,"area"===e)return r*r;return r}}throw t.width=0,t.height=0,Error("Failed to determine maximum canvas dimension")}function clampToBrowserMaxCanvasSize(e,t){if(e<=8192&&t<=8192&&e*t<=16777216)return[e,t];let{maxWidth:n,maxHeight:i,maxArea:o}=(r||(r={maxWidth:getCanvasSize("width"),maxHeight:getCanvasSize("height"),maxArea:getCanvasSize("area")}),r),a=e/t;if(e>n&&(t=(e=n)/a),t>i&&(e=(t=i)*a),e*t>o){let n=Math.sqrt(o/(e*t));e*=n,t*=n}return[e,t]}},16384:function(e,t,n){"use strict";n.d(t,{J1:function(){return l},VH:function(){return a},hR:function(){return d}});var r=n(31316),i=n(70938),o=n(25566);let a={},l=createDebugValue("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),d={logPreventDefaults:createDebugValue("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:createDebugValue("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:createDebugValue("logElementRemoves",{defaults:{all:!1}}),debugSvg:createDebugValue("debugSvg",{defaults:{all:!1}}),showFps:createDebugValue("showFps",{defaults:{all:!1}}),measurePerformance:createDebugValue("measurePerformance",{defaults:{all:!1}}),throwToBlob:createDebugValue("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:createDebugValue("reconnectOnPing",{defaults:{all:!1}}),debugCursors:createDebugValue("debugCursors",{defaults:{all:!1}}),forceSrgb:createDebugValue("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:createDebugValue("debugGeometry",{defaults:{all:!1}}),hideShapes:createDebugValue("hideShapes",{defaults:{all:!1}}),editOnType:createDebugValue("editOnType",{defaults:{all:!1}}),a11y:createDebugValue("a11y",{defaults:{all:!1}}),debugElbowArrows:createDebugValue("debugElbowArrows",{defaults:{all:!1}})};if("undefined"!=typeof Element){let e=Element.prototype.removeChild;(0,r.Ym)("element removal logging",()=>{d.logElementRemoves.get()?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),e.call(this,t)}:Element.prototype.removeChild=e})}function createDebugValue(e,{defaults:t,shouldStoreForSession:n=!0}){return function(e){let t=function(e){let t=readEnv(()=>o.env.TLDRAW_ENV)??readEnv(()=>o.env.VERCEL_PUBLIC_TLDRAW_ENV)??readEnv(()=>o.env.NEXT_PUBLIC_TLDRAW_ENV)??"production";switch(t){case"production":return e.defaults.production??e.defaults.all;case"preview":case"staging":return e.defaults.staging??e.defaults.all;default:return e.defaults.development??e.defaults.all}}(e),n=e.shouldStoreForSession?function(e){try{return JSON.parse((0,i.Kk)(`tldraw_debug:${e}`)??"null")}catch{return null}}(e.name):null,a=(0,r.cn)(`debug:${e.name}`,n??t);return"undefined"!=typeof window&&(e.shouldStoreForSession&&(0,r.Ym)(`debug:${e.name}`,()=>{let n=a.get();n===t?(0,i.F_)(`tldraw_debug:${e.name}`):(0,i.sn)(`tldraw_debug:${e.name}`,JSON.stringify(n))}),Object.defineProperty(window,`tldraw${e.name.replace(/^[a-z]/,e=>e.toUpperCase())}`,{get:()=>a.get(),set(e){a.set(e)},configurable:!0})),Object.assign(a,e,{reset:()=>a.set(t)})}({name:e,defaults:t,shouldStoreForSession:n})}function readEnv(e){try{return e()}catch{return null}}},10966:function(e,t,n){"use strict";n.d(t,{Y:function(){return parseDeepLinkString},y:function(){return createDeepLinkString}});var r=n(43001),i=n(70938),o=n(30696);function createDeepLinkString(e){switch(e.type){case"shapes":{let t=e.shapeIds.map(e=>encodeId(e.slice(6)));return`s${t.join(".")}`}case"page":return"p"+encodeId(r.ez.parseId(e.pageId));case"viewport":{let{bounds:t,pageId:n}=e,i=`v${Math.round(t.x)}.${Math.round(t.y)}.${Math.round(t.w)}.${Math.round(t.h)}`;return n&&(i+="."+encodeId(r.ez.parseId(n))),i}default:(0,i.iP)(e)}}function parseDeepLinkString(e){let t=e[0];switch(t){case"s":{let t=e.slice(1).split(".").filter(Boolean).map(e=>(0,r.F1)(decodeURIComponent(e)));return{type:"shapes",shapeIds:t}}case"p":{let t=r.ez.createId(decodeURIComponent(e.slice(1)));return{type:"page",pageId:t}}case"v":{let[t,n,i,a,l]=e.slice(1).split(".");return{type:"viewport",bounds:new o.xu(Number(t),Number(n),Number(i),Number(a)),pageId:l?r.ez.createId(decodeURIComponent(l)):void 0}}default:throw Error("Invalid deep link string")}}function encodeId(e){return encodeURIComponent(e).replace(/\./g,"%2E")}},77700:function(e,t,n){"use strict";n.d(t,{I5:function(){return setPointerCapture},PF:function(){return preventDefault},Te:function(){return function loopToHtmlElement(e){if(e.nodeType===Node.ELEMENT_NODE)return e;if(e.parentElement)return loopToHtmlElement(e.parentElement);throw Error("Could not find a parent element of an HTML type!")}},U0:function(){return setStyleProperty},XE:function(){return releasePointerCapture},be:function(){return stopEventPropagation},hZ:function(){return activeElementShouldCaptureKeys}});var r=n(16384);function preventDefault(e){e.preventDefault(),r.hR.logPreventDefaults.get()&&console.warn("preventDefault called on event:",e)}function setPointerCapture(e,t){if(e.setPointerCapture(t.pointerId),r.hR.logPointerCaptures.get()){let n=r.J1.get();n.set(e,(n.get(e)??0)+1),console.warn("setPointerCapture called on element:",e,t)}}function releasePointerCapture(e,t){if(e.hasPointerCapture(t.pointerId)&&(e.releasePointerCapture(t.pointerId),r.hR.logPointerCaptures.get())){let n=r.J1.get();1===n.get(e)?n.delete(e):n.has(e)?n.set(e,n.get(e)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",e,t)}}let stopEventPropagation=e=>e.stopPropagation(),setStyleProperty=(e,t,n)=>{e&&e.style.setProperty(t,n)};function activeElementShouldCaptureKeys(e=!1){let{activeElement:t}=document;return!!(t&&(t.isContentEditable||(e?["input","textarea"]:["input","select","button","textarea"]).indexOf(t.tagName.toLowerCase())>-1||t.classList.contains("tlui-slider__thumb")))}},41605:function(e,t,n){"use strict";function getIncrementedName(e,t){let n=e,r=new Set(t);for(;r.has(n);)n=/^.*(\d+)$/.exec(n)?.[1]?n.replace(/(\d+)(?=\D?)$/,e=>(+e+1).toString()):`${n} 1`;return n}n.d(t,{u:function(){return getIncrementedName}})},49065:function(e,t,n){"use strict";n.d(t,{Y:function(){return getPointerInfo}});var r=n(25689);function getPointerInfo(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:(0,r.q)(e),pointerId:e.pointerId,button:e.button,isPen:"pen"===e.pointerType}}},65852:function(e,t,n){"use strict";n.d(t,{R:function(){return getSvgPathFromPoints}});var r=n(46166);function getSvgPathFromPoints(e,t=!0){let n=e.length;if(n<2)return"";let i=e[0],o=e[1];if(2===n)return`M${(0,r.Yk)(i)}L${(0,r.Yk)(o)}`;let a="";for(let t=2,l=n-1;t<l;t++)i=e[t],o=e[t+1],a+=(0,r.Y8)(i,o);return t?`M${(0,r.Y8)(e[0],e[1])}Q${(0,r.Yk)(e[1])}${(0,r.Y8)(e[1],e[2])}T${a}${(0,r.Y8)(e[n-1],e[0])}${(0,r.Y8)(e[0],e[1])}Z`:`M${(0,r.Yk)(e[0])}Q${(0,r.Yk)(e[1])}${(0,r.Y8)(e[1],e[2])}${e.length>3?"T":""}${a}L${(0,r.Yk)(e[n-1])}`}},73432:function(e,t,n){"use strict";n.d(t,{W:function(){return hardResetEditor}});var r=n(29261);function hardResetEditor(){r.G.hardReset()}},25689:function(e,t,n){"use strict";n.d(t,{q:function(){return isAccelKey}});var r=n(49894);let isAccelKey=e=>r.a.isDarwin?e.metaKey:e.ctrlKey||e.metaKey},77744:function(e,t,n){"use strict";n.d(t,{f:function(){return normalizeWheel}});let r=/Mac|iPod|iPhone|iPad/.test("undefined"==typeof window?"node":window.navigator.platform);function normalizeWheel(e){let{deltaY:t,deltaX:n}=e,i=0;return e.ctrlKey||e.altKey||e.metaKey?i=(Math.abs(t)>10?10*Math.sign(t):t)/100:e.shiftKey&&!r&&(n=t,t=0),{x:-n,y:-t,z:-i}}},50590:function(e,t,n){"use strict";n.d(t,{Z:function(){return refreshPage}});var r=n(29261);function refreshPage(){r.G.refreshPage()}},10853:function(e,t,n){"use strict";n.d(t,{B:function(){return getReorderingShapesChanges}});var r=n(70938);function getReorderingShapesChanges(e,t,n,i){if(0===n.length)return[];let o=new Map;for(let t of(0,r.oA)(n.map(t=>e.getShape(t)))){let{parentId:n}=t;o.has(n)||o.set(n,{children:(0,r.oA)(e.getSortedChildIdsForParent(n).map(t=>e.getShape(t))),moving:new Set}),o.get(n).moving.add(t)}let a=[];switch(t){case"toBack":o.forEach(({moving:e,children:t})=>(function(e,t,n){let i,o;let a=t.length;if(e.size!==a){for(let n=0;n<a;n++){let r=t[n];if(e.has(r))i=r.index,e.delete(r);else{o=r.index;break}}if(0===e.size)return;{let t=(0,r.Xv)(i,o,e.size);n.push(...Array.from(e.values()).sort(r.hl).map((e,n)=>({...e,index:t[n]})))}}})(e,t,a));break;case"toFront":o.forEach(({moving:e,children:t})=>(function(e,t,n){let i,o;let a=t.length;if(e.size!==a){for(let n=a-1;n>-1;n--){let r=t[n];if(e.has(r))o=r.index,e.delete(r);else{i=r.index;break}}if(0===e.size)return;{let t=(0,r.Xv)(i,o,e.size);n.push(...Array.from(e.values()).sort(r.hl).map((e,n)=>({...e,index:t[n]})))}}})(e,t,a));break;case"forward":o.forEach(({moving:t,children:n})=>(function(e,t,n,i,o){let a=getOverlapChecker(e,t),l=n.length;if(t.size===l)return;let d={name:"skipping"};for(let e=0;e<l;e++){let l=t.has(n[e]);switch(d.name){case"skipping":if(!l)continue;d={name:"selecting",selectIndex:e};break;case"selecting":{if(l||!o?.considerAllShapes&&!a(n[e]))continue;let{selectIndex:c}=d;(0,r.Xv)(n[e].index,n[e+1]?.index,e-c).forEach((e,r)=>{let o=n[c+r];t.has(o)&&i.push({...o,index:e})}),d={name:"skipping"}}}}})(e,t,n,a,i));break;case"backward":o.forEach(({moving:t,children:n})=>(function(e,t,n,i,o){let a=getOverlapChecker(e,t),l=n.length;if(t.size===l)return;let d={name:"skipping"};for(let e=l-1;e>-1;e--){let l=t.has(n[e]);switch(d.name){case"skipping":if(!l)continue;d={name:"selecting",selectIndex:e};break;case"selecting":if(l||!o?.considerAllShapes&&!a(n[e]))continue;(0,r.Xv)(n[e-1]?.index,n[e].index,d.selectIndex-e).forEach((r,o)=>{let a=n[e+o+1];t.has(a)&&i.push({...a,index:r})}),d={name:"skipping"}}}})(e,t,n,a,i))}return a}function getOverlapChecker(e,t){let n=(0,r.oA)(Array.from(t).map(t=>{let n=e.getShapePageBounds(t);return n?{shape:t,bounds:n}:null}));return t=>{let r=e.getShapePageBounds(t);return!!r&&n.some(e=>e.bounds.includes(r))}}},17556:function(e,t,n){"use strict";n.d(t,{Z:function(){return applyRotationToSnapshotShapes},o:function(){return getRotationSnapshot}});var r=n(43001),i=n(70938),o=n(45404),a=n(46166),l=n(14204);function getRotationSnapshot({editor:e,ids:t}){let n=(0,i.oA)(t.map(t=>e.getShape(t))),r=e.getShapesSharedRotation(t),o=e.getShapesRotatedPageBounds(t);if(!o)return null;let a=o.center.clone().rotWith(o.point,r);return{initialPageCenter:a,initialCursorAngle:a.angle(e.inputs.originPagePoint),initialShapesRotation:r,shapeSnapshots:n.map(t=>({shape:t,initialPagePoint:e.getShapePageTransform(t.id).point()}))}}function applyRotationToSnapshotShapes({delta:e,editor:t,snapshot:n,stage:i,centerOverride:d}){let{initialPageCenter:c,shapeSnapshots:u}=n;t.updateShapes(u.map(({shape:n,initialPagePoint:i})=>{let u=(0,r.YT)(n.parentId)?t.getShapePageTransform(n.parentId):o._.Identity(),h=l.B.RotWith(i,d??c,e),p=o._.applyToPoint(o._.Inverse(u),h),f=(0,a.f5)(n.rotation+e);return{id:n.id,type:n.type,x:p.x,y:p.y,rotation:f}}));let h=[];u.forEach(({shape:e})=>{let n=t.getShape(e.id);if(!n)return;let r=t.getShapeUtil(e);if("start"===i||"one-off"===i){let t=r.onRotateStart?.(e);t&&h.push(t)}let o=r.onRotate?.(e,n);if(o&&h.push(o),"end"===i||"one-off"===i){let t=r.onRotateEnd?.(e,n);t&&h.push(t)}}),h.length>0&&t.updateShapes(h)}},29261:function(e,t,n){"use strict";n.d(t,{G:function(){return r},e:function(){return setRuntimeOverrides}});let r={openWindow(e,t){window.open(e,t,"noopener noreferrer")},refreshPage(){window.location.reload()},hardReset:async()=>await window.__tldraw__hardReset?.()};function setRuntimeOverrides(e){Object.assign(r,e)}},76737:function(e,t,n){"use strict";n.d(t,{Hy:function(){return getAllIndexDbNames},iA:function(){return a},xh:function(){return LocalIndexedDb}});var r=n(70938),i=n(98542);let o="TLDRAW_DB_NAME_INDEX_v2",a={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function openLocalDb(e){let t="TLDRAW_DOCUMENT_v2"+e;return function(e){let t=new Set(getAllIndexDbNames());t.add(e),(0,r._m)(o,JSON.stringify([...t]))}(t),await (0,i.openDB)(t,4,{upgrade(e){e.objectStoreNames.contains(a.Records)||e.createObjectStore(a.Records),e.objectStoreNames.contains(a.Schema)||e.createObjectStore(a.Schema),e.objectStoreNames.contains(a.SessionState)||e.createObjectStore(a.SessionState),e.objectStoreNames.contains(a.Assets)||e.createObjectStore(a.Assets)}})}async function migrateLegacyAssetDbIfNeeded(e){let t=window.indexedDB.databases?(await window.indexedDB.databases()).map(e=>e.name):getAllIndexDbNames(),n="TLDRAW_ASSET_STORE_v1"+e,r=t.find(e=>e===n);if(!r)return;let o=await (0,i.openDB)(n,1,{upgrade(e){e.objectStoreNames.contains("assets")||e.createObjectStore("assets")}});if(!o.objectStoreNames.contains("assets"))return;let l=o.transaction(["assets"],"readonly"),d=l.objectStore("assets"),c=await d.getAllKeys(),u=await Promise.all(c.map(async e=>[e,await d.get(e)]));await l.done;let h=await openLocalDb(e),p=h.transaction([a.Assets],"readwrite"),f=p.objectStore(a.Assets);for(let[e,t]of u)f.put(t,e);await p.done,o.close(),h.close(),await (0,i.deleteDB)(n)}let LocalIndexedDb=class LocalIndexedDb{getDbPromise;isClosed=!1;pendingTransactionSet=new Set;static connectedInstances=new Set;constructor(e){LocalIndexedDb.connectedInstances.add(this),this.getDbPromise=(async()=>(await migrateLegacyAssetDbIfNeeded(e),await openLocalDb(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(r.ZT)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),LocalIndexedDb.connectedInstances.delete(this))}tx(e,t,n){let i=(async()=>{(0,r.hu)(!this.isClosed,"db is closed");let i=await this.getDb(),o=i.transaction(t,e),a=o.done.catch(e=>{if(!this.isClosed)throw e});try{return await n(o)}finally{this.isClosed?o.abort():await a}})();return this.pendingTransactionSet.add(i),i.finally(()=>this.pendingTransactionSet.delete(i)),i}async load({sessionId:e}={}){return await this.tx("readonly",[a.Records,a.Schema,a.SessionState],async t=>{let n=t.objectStore(a.Records),r=t.objectStore(a.Schema),i=t.objectStore(a.SessionState),o=e?(await i.get(e))?.snapshot:null;if(!o){let e=await i.getAll();o=e.sort((e,t)=>e.updatedAt-t.updatedAt).pop()?.snapshot}let l={records:await n.getAll(),schema:await r.get(a.Schema),sessionStateSnapshot:o};return l})}async storeChanges({schema:e,changes:t,sessionId:n,sessionStateSnapshot:r}){await this.tx("readwrite",[a.Records,a.Schema,a.SessionState],async i=>{let o=i.objectStore(a.Records),l=i.objectStore(a.Schema),d=i.objectStore(a.SessionState);for(let[e,n]of Object.entries(t.added))await o.put(n,e);for(let[e,n]of Object.values(t.updated))await o.put(n,n.id);for(let e of Object.keys(t.removed))await o.delete(e);l.put(e.serialize(),a.Schema),r&&n?d.put({snapshot:r,updatedAt:Date.now(),id:n},n):(r||n)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:t,sessionId:n,sessionStateSnapshot:r}){await this.tx("readwrite",[a.Records,a.Schema,a.SessionState],async i=>{let o=i.objectStore(a.Records),l=i.objectStore(a.Schema),d=i.objectStore(a.SessionState);for(let[e,n]of(await o.clear(),Object.entries(t)))await o.put(n,e);l.put(e.serialize(),a.Schema),r&&n?d.put({snapshot:r,updatedAt:Date.now(),id:n},n):(r||n)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[a.SessionState],async e=>{let t=e.objectStore(a.SessionState),n=(await t.getAll()).sort((e,t)=>e.updatedAt-t.updatedAt);if(n.length<10){await e.done;return}let r=n.slice(0,n.length-10);for(let{id:e}of r)await t.delete(e)})}async getAsset(e){return await this.tx("readonly",[a.Assets],async t=>{let n=t.objectStore(a.Assets);return await n.get(e)})}async storeAsset(e,t){await this.tx("readwrite",[a.Assets],async n=>{let r=n.objectStore(a.Assets);await r.put(t,e)})}async removeAssets(e){await this.tx("readwrite",[a.Assets],async t=>{let n=t.objectStore(a.Assets);for(let t of e)await n.delete(t)})}};function getAllIndexDbNames(){let e=JSON.parse((0,r.fp)(o)||"[]")??[];return Array.isArray(e)?e:[]}},71743:function(e,t,n){"use strict";n.d(t,{j:function(){return uniq}});var r=n(70938);function uniq(e){return(0,r.jj)(e)}},12011:function(e,t,n){"use strict";n.d(t,{R:function(){return i},i:function(){return r}});let r="3.15.4",i={major:"2024-09-13T14:36:29.063Z",minor:"2025-07-30T09:07:27.887Z",patch:"2025-08-28T08:59:06.034Z"}},30742:function(e,t,n){"use strict";n.d(t,{j:function(){return track},KO:function(){return useAtom},vc:function(){return useComputed},BK:function(){return useQuickReactor},vC:function(){return useReactor},uC:function(){return useStateTracking},Hg:function(){return useValue}});var r=n(70938),i=n(2265),o=n(31316);function useStateTracking(e,t,n=[]){let r=i.useRef(t);r.current=t;let[a,l,d]=i.useMemo(()=>{let t=null,n=new o.R0(`useStateTracking(${e})`,()=>r.current?.(),{scheduleEffect(){t?.()}});return[n,e=>(t=e,()=>{t=null}),()=>n.scheduleCount]},[e,...n]);return i.useSyncExternalStore(l,d,d),i.useEffect(()=>(a.attach(),a.maybeScheduleEffect(),()=>{a.detach()}),[a]),a.execute()}let a={apply:(e,t,n)=>useStateTracking(e.displayName??e.name??"tracked(???)",()=>e.apply(t,n))},l=Symbol.for("react.memo"),d=Symbol.for("react.forward_ref");function track(e){let t=null,n=e.$$typeof;return(n===l&&(t=(e=e.type).compare),n===d)?(0,i.memo)((0,i.forwardRef)(new Proxy(e.render,a))):(0,i.memo)(new Proxy(e,a),t)}function useAtom(e,t,n){return(0,i.useState)(()=>{let r="function"==typeof t?t():t;return(0,o.cn)(`useAtom(${e})`,r,n)})[0]}function useComputed(){let e=arguments[0],t=arguments[1],n=3==arguments.length?void 0:arguments[2],r=3==arguments.length?arguments[2]:arguments[3];return(0,i.useMemo)(()=>(0,o.Fl)(`useComputed(${e})`,t,n),r)}function useQuickReactor(e,t,n=o.LZ){(0,i.useEffect)(()=>{let n=new o.R0(e,t);return n.attach(),n.execute(),()=>{n.detach()}},n)}function useReactor(e,t,n=[]){(0,i.useEffect)(()=>{let n;let i=new o.R0(e,t,{scheduleEffect:e=>{n=(0,r.Gf)(e)}});return i.attach(),i.execute(),()=>{i.detach(),n?.()}},n)}function useValue(){let e=arguments,t=3===e.length?e[2]:[e[0]],n=3===e.length?e[0]:`useValue(${e[0].name})`,{$val:r,subscribe:a,getSnapshot:l}=(0,i.useMemo)(()=>{let t=1===e.length?e[0]:(0,o.Fl)(n,e[1]);return{$val:t,subscribe:e=>(0,o.Ym)(`useValue(${n})`,()=>{try{t.get()}catch{}e()}),getSnapshot:()=>t.lastChangedEpoch}},t);return(0,i.useSyncExternalStore)(a,l,l),r.__unsafe__getWithoutCapture()}(0,r.x2)("@tldraw/state-react","3.15.4","esm")},31316:function(e,t,n){"use strict";n.d(t,{Ip:function(){return ArraySet},LZ:function(){return i},R0:function(){return a},SB:function(){return o},Z1:function(){return c},cn:function(){return atom},Fl:function(){return computed},V0:function(){return deferAsyncEffects},Z6:function(){return getComputedInstance},J8:function(){return isAtom},$Z:function(){return isSignal},e1:function(){return isUninitialized},Ym:function(){return react},zH:function(){return reactor},ay:function(){return transact},PS:function(){return transaction},dy:function(){return unsafe__withoutCapture},iJ:function(){return whyAmIRunning},qo:function(){return withDiff}});var r=n(70938);function isChild(e){return e&&"object"==typeof e&&"parents"in e}function haveParentsChanged(e){for(let t=0,n=e.parents.length;t<n;t++)if(e.parents[t].__unsafe__getWithoutCapture(!0),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}function detach(e,t){if(e.children.remove(t)&&e.children.isEmpty&&isChild(e))for(let t=0,n=e.parents.length;t<n;t++)detach(e.parents[t],e)}function attach(e,t){if(e.children.add(t)&&isChild(e))for(let t=0,n=e.parents.length;t<n;t++)attach(e.parents[t],e)}function equals(e,t){let n=e===t||Object.is(e,t)||!!(e&&t&&"function"==typeof e.equals&&e.equals(t));return n}function singleton(e,t){let n=Symbol.for(`com.tldraw.state/${e}`),r=globalThis;return r[n]??=t(),r[n]}let i=singleton("empty_array",()=>Object.freeze([]));let ArraySet=class ArraySet{arraySize=0;array=Array(8);set=null;get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw Error("no set or array")}add(e){if(this.array){let t=this.array.indexOf(e);return -1===t&&(this.arraySize<8?(this.array[this.arraySize]=e,this.arraySize++):(this.set=new Set(this.array),this.array=null,this.set.add(e)),!0)}if(this.set)return!this.set.has(e)&&(this.set.add(e),!0);throw Error("no set or array")}remove(e){if(this.array){let t=this.array.indexOf(e);return -1!==t&&(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(e)&&(this.set.delete(e),!0);throw Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){let n=this.array[t];void 0!==n&&e(n)}return}if(this.set){this.set.forEach(e);return}throw Error("no set or array")}*[Symbol.iterator](){if(this.array)for(let e=0;e<this.arraySize;e++){let t=this.array[e];void 0!==t&&(yield t)}else if(this.set)yield*this.set;else throw Error("no set or array")}has(e){return this.array?-1!==this.array.indexOf(e):this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}};let o=Symbol.for("com.tldraw.state/RESET_VALUE");let HistoryBuffer=class HistoryBuffer{constructor(e){this.capacity=e,this.buffer=Array(e)}index=0;buffer;pushEntry(e,t,n){if(void 0!==n){if(n===o){this.clear();return}this.buffer[this.index]=[e,t,n],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){let{index:t,capacity:n,buffer:r}=this;for(let i=0;i<n;i++){let o=(t-1+n-i)%n,a=r[o];if(!a)break;let[l,d]=a;if(0===i&&e>=d)return[];if(l<=e&&e<d){let e=i+1,t=Array(e);for(let i=0;i<e;i++)t[i]=r[(o+i)%n][2];return t}}return o}};let __EffectScheduler__=class __EffectScheduler__{constructor(e,t,n){this.name=e,this.runEffect=t,this._scheduleEffect=n?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=-1;lastReactedEpoch=-1;_scheduleCount=0;__debug_ancestor_epochs__=null;get scheduleCount(){return this._scheduleCount}parentSet=new ArraySet;parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==getGlobalEpoch()){if(this.parents.length&&!haveParentsChanged(this)){this.lastReactedEpoch=getGlobalEpoch();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)attach(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)detach(this.parents[e],this)}execute(){try{startCapturingParents(this);let e=getGlobalEpoch(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{stopCapturingParents()}}};let a=singleton("EffectScheduler",()=>__EffectScheduler__);function react(e,t,n){let r=new a(e,t,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function reactor(e,t,n){let r=new a(e,t,n);return{scheduler:r,start:e=>{let t=e?.force??!1;r.attach(),t?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}let Transaction=class Transaction{constructor(e,t){this.parent=e,this.isSync=t}asyncProcessCount=0;initialAtomValues=new Map;get isRoot(){return null===this.parent}commit(){if(l.globalIsReacting)for(let e of this.initialAtomValues.keys())traverseAtomForCleanup(e);else this.isRoot?flushChanges(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){l.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{t.set(e),t.historyBuffer?.clear()}),this.commit()}};let l=singleton("transactions",()=>({globalEpoch:0,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:0}));function getGlobalEpoch(){return l.globalEpoch}function traverse(e,t){t.lastTraversedEpoch!==l.globalEpoch&&(t.lastTraversedEpoch=l.globalEpoch,t instanceof a?e.add(t):t.children.visit(t=>traverse(e,t)))}function flushChanges(e){if(l.globalIsReacting)throw Error("flushChanges cannot be called during a reaction");let t=l.currentTransaction;try{l.currentTransaction=null,l.globalIsReacting=!0,l.reactionEpoch=l.globalEpoch;let t=new Set;for(let n of e)n.children.visit(e=>traverse(t,e));for(let e of t)e.maybeScheduleEffect();let n=0;for(;l.cleanupReactors?.size;){if(n++>1e3)throw Error("Reaction update depth limit exceeded");let e=l.cleanupReactors;for(let t of(l.cleanupReactors=null,e))t.maybeScheduleEffect()}}finally{l.cleanupReactors=null,l.globalIsReacting=!1,l.currentTransaction=t}}function traverseAtomForCleanup(e){let t=l.cleanupReactors??=new Set;e.children.visit(e=>traverse(t,e))}function transaction(e){let t=new Transaction(l.currentTransaction,!0);l.currentTransaction=t;try{let n;let r=!1;try{n=e(()=>r=!0)}catch(e){throw t.abort(),e}if(l.currentTransaction!==t)throw Error("Transaction boundaries overlap");return r?t.abort():t.commit(),n}finally{l.currentTransaction=t.parent}}function transact(e){return l.currentTransaction?e():transaction(e)}async function deferAsyncEffects(e){let t,n;if(l.currentTransaction?.isSync)throw Error("deferAsyncEffects cannot be called during a sync transaction");for(;l.globalIsReacting;)await new Promise(e=>queueMicrotask(()=>e(null)));let r=l.currentTransaction??new Transaction(null,!1);if(r.isSync)throw Error("deferAsyncEffects cannot be called during a sync transaction");l.currentTransaction=r,r.asyncProcessCount++;try{t=await e()}catch(e){n=e??null}if(--r.asyncProcessCount>0){if(void 0===n)return t;throw n}if(l.currentTransaction=null,void 0===n)return r.commit(),t;throw r.abort(),n}let d=!1,c=Symbol.for("com.tldraw.state/UNINITIALIZED");function isUninitialized(e){return e===c}let u=singleton("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function withDiff(e,t){return new u(e,t)}let __UNSAFE__Computed=class __UNSAFE__Computed{constructor(e,t,n){this.name=e,this.derive=t,n?.historyLength&&(this.historyBuffer=new HistoryBuffer(n.historyLength)),this.computeDiff=n?.computeDiff,this.isEqual=n?.isEqual??equals}lastChangedEpoch=-1;lastTraversedEpoch=-1;__debug_ancestor_epochs__=null;lastCheckedEpoch=-1;parentSet=new ArraySet;parents=[];parentEpochs=[];children=new ArraySet;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=c;error=null;computeDiff;isEqual;__unsafe__getWithoutCapture(e){let t=-1===this.lastChangedEpoch,n=getGlobalEpoch();if(!t&&(this.lastCheckedEpoch===n||this.isActivelyListening&&l.globalIsReacting&&this.lastTraversedEpoch<l.reactionEpoch||!haveParentsChanged(this))){if(this.lastCheckedEpoch=n,!this.error||e)return this.state;throw this.error.thrownValue}try{startCapturingParents(this);let e=this.derive(this.state,this.lastCheckedEpoch),t=e instanceof u?e.value:e,n=this.state===c;if(n||!this.isEqual(t,this.state)){if(this.historyBuffer&&!n){let n=e instanceof u?e.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,getGlobalEpoch(),n??this.computeDiff?.(this.state,t,this.lastCheckedEpoch,getGlobalEpoch())??o)}this.lastChangedEpoch=getGlobalEpoch(),this.state=t}return this.error=null,this.lastCheckedEpoch=getGlobalEpoch(),this.state}catch(t){if(this.state!==c&&(this.state=c,this.lastChangedEpoch=getGlobalEpoch()),this.lastCheckedEpoch=getGlobalEpoch(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:t},!e)throw t;return this.state}finally{stopCapturingParents()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{maybeCaptureParent(this)}}getDiffSince(e){return(this.__unsafe__getWithoutCapture(!0),maybeCaptureParent(this),e>=this.lastChangedEpoch)?i:this.historyBuffer?.getChangesSince(e)??o}};let h=singleton("Computed",()=>__UNSAFE__Computed);function computedDecorator(e={},t){if(2===t.length){let[n,i]=t;return function(e,t,n){(0,r.hu)("method"===n.kind,"@computed can only be used on methods");let i=Symbol.for("__@tldraw/state__computed__"+String(n.name)),fn=function(){let r=this[i];return r||Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:r=new h(String(n.name),t.bind(this),e)}),r.get()};return fn[p]=!0,fn}(e,n,i)}{let[n,r,i]=t;return i.get?(d||(d=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`)),function(e={},t,n,r){let i=r.get,o=Symbol.for("__@tldraw/state__computed__"+n);return r.get=function(){let t=this[o];return t||Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:t=new h(n,i.bind(this),e)}),t.get()},r}(e,0,r,i)):function(e={},t,n,r){let i=r.value,o=Symbol.for("__@tldraw/state__computed__"+n);return r.value=function(){let t=this[o];return t||Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:t=new h(n,i.bind(this),e)}),t.get()},r.value[p]=!0,r}(e,0,r,i)}}let p="@@__isComputedMethod__@@";function getComputedInstance(e,t){let n=Symbol.for("__@tldraw/state__computed__"+t.toString()),r=e[n];if(!r){let i=e[t];"function"==typeof i&&i[p]&&i.call(e),r=e[n]}return r}function computed(){if(1==arguments.length){let e=arguments[0];return(...t)=>computedDecorator(e,t)}return"string"==typeof arguments[0]?new h(arguments[0],arguments[1],arguments[2]):computedDecorator(void 0,arguments)}function isComputed(e){return e&&e instanceof h}let CaptureStackFrame=class CaptureStackFrame{constructor(e,t){this.below=e,this.child=t}offset=0;maybeRemoved};let f=singleton("capture",()=>({stack:null}));function unsafe__withoutCapture(e){let t=f.stack;f.stack=null;try{return e()}finally{f.stack=t}}function startCapturingParents(e){if(f.stack=new CaptureStackFrame(f.stack,e),e.__debug_ancestor_epochs__){let t=e.__debug_ancestor_epochs__;for(let t of(e.__debug_ancestor_epochs__=null,e.parents))t.__unsafe__getWithoutCapture(!0);!function(e,t){let n=function collectChangedAncestors(e,t){let n={};for(let r=0;r<e.parents.length;r++){let i=e.parents[r];if(!t.has(i))continue;let o=t.get(i),a=i.lastChangedEpoch;a!==o&&(isComputed(i)?n[i.name]=collectChangedAncestors(i,t):n[i.name]=null)}return n}(e,t);if(0===Object.keys(n).length){console.log(`Effect(${e.name}) was executed manually.`);return}let r=isComputed(e)?`Computed(${e.name}) is recomputing because:`:`Effect(${e.name}) is executing because:`;!function logParent(e,t){let n="\n"+" ".repeat(t)+" ";for(let[i,o]of Object.entries(e))o?(r+=`${n}Computed(${i}) changed`,logParent(o,t+2)):r+=`${n}Atom(${i}) changed`}(n,1),console.log(r)}(e,t)}e.parentSet.clear()}function stopCapturingParents(){let e=f.stack;if(f.stack=e.below,e.offset<e.child.parents.length){for(let t=e.offset;t<e.child.parents.length;t++){let n=e.child.parents[t];e.child.parentSet.has(n)||detach(n,e.child)}e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset}if(e.maybeRemoved)for(let t=0;t<e.maybeRemoved.length;t++){let n=e.maybeRemoved[t];e.child.parentSet.has(n)||detach(n,e.child)}e.child.__debug_ancestor_epochs__&&function captureAncestorEpochs(e,t){for(let n=0;n<e.parents.length;n++){let r=e.parents[n],i=e.parentEpochs[n];t.set(r,i),isComputed(r)&&captureAncestorEpochs(r,t)}return t}(e.child,e.child.__debug_ancestor_epochs__)}function maybeCaptureParent(e){if(f.stack){let t=f.stack.child.parentSet.has(e);if(!t){if(f.stack.child.parentSet.add(e),f.stack.child.isActivelyListening&&attach(e,f.stack.child),f.stack.offset<f.stack.child.parents.length){let t=f.stack.child.parents[f.stack.offset];t!==e&&(f.stack.maybeRemoved?f.stack.maybeRemoved.push(t):f.stack.maybeRemoved=[t])}f.stack.child.parents[f.stack.offset]=e,f.stack.child.parentEpochs[f.stack.offset]=e.lastChangedEpoch,f.stack.offset++}}}function whyAmIRunning(){let e=f.stack?.child;if(!e)throw Error("whyAmIRunning() called outside of a reactive context");e.__debug_ancestor_epochs__=new Map}let __Atom__=class __Atom__{constructor(e,t,n){if(this.name=e,this.current=t,this.isEqual=n?.isEqual??null,!n)return;n.historyLength&&(this.historyBuffer=new HistoryBuffer(n.historyLength)),this.computeDiff=n.computeDiff}isEqual;computeDiff;lastChangedEpoch=getGlobalEpoch();children=new ArraySet;historyBuffer;__unsafe__getWithoutCapture(e){return this.current}get(){return maybeCaptureParent(this),this.current}set(e,t){if(this.isEqual?.(this.current,e)??equals(this.current,e))return this.current;l.globalEpoch++,this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,getGlobalEpoch(),t??this.computeDiff?.(this.current,e,this.lastChangedEpoch,getGlobalEpoch())??o),this.lastChangedEpoch=getGlobalEpoch();let n=this.current;return this.current=e,l.currentTransaction?l.currentTransaction.initialAtomValues.has(this)||l.currentTransaction.initialAtomValues.set(this,n):l.globalIsReacting?traverseAtomForCleanup(this):flushChanges([this]),e}update(e){return this.set(e(this.current))}getDiffSince(e){return(maybeCaptureParent(this),e>=this.lastChangedEpoch)?i:this.historyBuffer?.getChangesSince(e)??o}};let g=singleton("Atom",()=>__Atom__);function atom(e,t,n){return new g(e,t,n)}function isAtom(e){return e instanceof g}function isSignal(e){return e instanceof g||e instanceof h}let m=singleton("apiVersion",()=>1);if(1!==m)throw Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");(0,r.x2)("@tldraw/state","3.15.4","esm")},63134:function(e,t,n){"use strict";let r;n.d(t,{X0:function(){return AtomMap},mW:function(){return IncrementalSetConstructor},qx:function(){return M},oX:function(){return RecordType},yh:function(){return Store},Vz:function(){return StoreQueries},sS:function(){return StoreSchema},FH:function(){return StoreSideEffects},lS:function(){return assertIdType},mV:function(){return createComputedCache},YD:function(){return createEmptyRecordsDiff},uj:function(){return createMigrationIds},w8:function(){return createMigrationSequence},AV:function(){return createRecordMigrationSequence},ju:function(){return createRecordType},zn:function(){return defineMigrations},ZV:function(){return devFreeze},B4:function(){return isRecordsDiffEmpty},xf:function(){return parseMigrationId},kJ:function(){return reverseRecordsDiff},bs:function(){return squashRecordDiffs},Ce:function(){return squashRecordDiffsMutable}});var i,o=n(70938),a=n(31316);/*!
 * This file was lovingly and delicately extracted from Immutable.js
 * MIT License: https://github.com/immutable-js/immutable-js/blob/main/LICENSE
 * Copyright (c) 2014-present, Lee Byron and other contributors.
 */function smi(e){return e>>>1&1073741824|3221225471&e}let l=Object.prototype.valueOf;function hash(e){if(null==e)return hashNullish(e);if("function"==typeof e.hashCode)return smi(e.hashCode(e));let t=e.valueOf!==l&&"function"==typeof e.valueOf?e.valueOf(e):e;if(null==t)return hashNullish(t);switch(typeof t){case"boolean":return t?1108378657:1108378656;case"number":return function(e){if(e!=e||e===1/0)return 0;let t=0|e;for(t!==e&&(t^=4294967295*e);e>4294967295;)e/=4294967295,t^=e;return smi(t)}(t);case"string":let n;return t.length>h?(void 0===(n=g[t])&&(n=hashString(t),f===p&&(f=0,g={}),f++,g[t]=n),n):hashString(t);case"object":case"function":let r;return void 0!==(r=d.get(t))||(r=nextHash(),d.set(t,r)),r;case"symbol":let i;return void 0!==(i=c[t])||(i=nextHash(),c[t]=i),i;default:if("function"==typeof t.toString)return hashString(t.toString());throw Error("Value type "+typeof t+" cannot be hashed.")}}function hashNullish(e){return null===e?1108378658:1108378659}function hashString(e){let t=0;for(let n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return smi(t)}function nextHash(){let e=++u;return 1073741824&u&&(u=0),e}let d=new WeakMap,c=Object.create(null),u=0,h=16,p=255,f=0,g={},m={};function MakeRef(){return{value:!1}}function SetRef(e){e&&(e.value=!0)}function arrCopy(e,t){t=t||0;let n=Math.max(0,e.length-t),r=Array(n);for(let i=0;i<n;i++)r[i]=e[i+t];return r}let y=Object.is;let OwnerID=class OwnerID{};let ImmutableMap=class ImmutableMap{_root;size;__ownerID;__hash;__altered;constructor(e){return null==e?emptyMap():e instanceof ImmutableMap?e:emptyMap().withMutations(t=>{for(let[n,r]of e)t.set(n,r)})}get(e,t){return this._root?this._root.get(0,void 0,e,t):t}set(e,t){return updateMap(this,e,t)}delete(e){return updateMap(this,e,m)}deleteAll(e){return this.withMutations(t=>{for(let n of e)t.delete(n)})}__ensureOwner(e){return e===this.__ownerID?this:e?makeMap(this.size,this._root,e,this.__hash):0===this.size?emptyMap():(this.__ownerID=e,this.__altered=!1,this)}withMutations(e){let t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}wasAltered(){return this.__altered}asMutable(){return this.__ownerID?this:this.__ensureOwner(new OwnerID)}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}entries(){return new MapIterator(this,v,!1)}keys(){return new MapIterator(this,b,!1)}values(){return new MapIterator(this,S,!1)}};let ArrayMapNode=class ArrayMapNode{constructor(e,t){this.ownerID=e,this.entries=t}get(e,t,n,r){let i=this.entries;for(let e=0,t=i.length;e<t;e++)if(y(n,i[e][0]))return i[e][1];return r}update(e,t,n,r,i,o,a){let l=i===m,d=this.entries,c=0,u=d.length;for(;c<u&&!y(r,d[c][0]);c++);let h=c<u;if(h?d[c][1]===i:l)return this;if(SetRef(a),(l||!h)&&SetRef(o),l&&1===d.length)return;if(!h&&!l&&d.length>=k)return function(e,t,n,r){e||(e=new OwnerID);let i=new ValueNode(e,hash(n),[n,r]);for(let n=0;n<t.length;n++){let r=t[n];i=i.update(e,0,void 0,r[0],r[1])}return i}(e,d,r,i);let p=e&&e===this.ownerID,f=p?d:arrCopy(d);return(h?l?c===u-1?f.pop():f[c]=f.pop():f[c]=[r,i]:f.push([r,i]),p)?(this.entries=f,this):new ArrayMapNode(e,f)}};let BitmapIndexedNode=class BitmapIndexedNode{constructor(e,t,n){this.ownerID=e,this.bitmap=t,this.nodes=n}get(e,t,n,r){void 0===t&&(t=hash(n));let i=1<<((0===e?t:t>>>e)&31),o=this.bitmap;return(o&i)==0?r:this.nodes[popCount(o&i-1)].get(e+5,t,n,r)}update(e,t,n,r,i,o,a){void 0===n&&(n=hash(r));let l=(0===t?n:n>>>t)&31,d=1<<l,c=this.bitmap,u=(c&d)!=0;if(!u&&i===m)return this;let h=popCount(c&d-1),p=this.nodes,f=u?p[h]:void 0,g=updateNode(f,e,t+5,n,r,i,o,a);if(g===f)return this;if(!u&&g&&p.length>=_)return function(e,t,n,r,i){let o=0,a=Array(32);for(let e=0;0!==n;e++,n>>>=1)a[e]=1&n?t[o++]:void 0;return a[r]=i,new HashArrayMapNode(e,o+1,a)}(e,p,c,l,g);if(u&&!g&&2===p.length&&isLeafNode(p[1^h]))return p[1^h];if(u&&g&&1===p.length&&isLeafNode(g))return g;let y=e&&e===this.ownerID,b=u?g?c:c^d:c|d,S=u?g?setAt(p,h,g,y):function(e,t,n){let r=e.length-1;if(n&&t===r)return e.pop(),e;let i=Array(r),o=0;for(let n=0;n<r;n++)n===t&&(o=1),i[n]=e[n+o];return i}(p,h,y):function(e,t,n,r){let i=e.length+1;if(r&&t+1===i)return e[t]=n,e;let o=Array(i),a=0;for(let r=0;r<i;r++)r===t?(o[r]=n,a=-1):o[r]=e[r+a];return o}(p,h,g,y);return y?(this.bitmap=b,this.nodes=S,this):new BitmapIndexedNode(e,b,S)}};let HashArrayMapNode=class HashArrayMapNode{constructor(e,t,n){this.ownerID=e,this.count=t,this.nodes=n}get(e,t,n,r){void 0===t&&(t=hash(n));let i=(0===e?t:t>>>e)&31,o=this.nodes[i];return o?o.get(e+5,t,n,r):r}update(e,t,n,r,i,o,a){void 0===n&&(n=hash(r));let l=(0===t?n:n>>>t)&31,d=i===m,c=this.nodes,u=c[l];if(d&&!u)return this;let h=updateNode(u,e,t+5,n,r,i,o,a);if(h===u)return this;let p=this.count;if(u){if(!h&&--p<C)return function(e,t,n,r){let i=0,o=0,a=Array(n);for(let e=0,n=1,l=t.length;e<l;e++,n<<=1){let l=t[e];void 0!==l&&e!==r&&(i|=n,a[o++]=l)}return new BitmapIndexedNode(e,i,a)}(e,c,p,l)}else p++;let f=e&&e===this.ownerID,g=setAt(c,l,h,f);return f?(this.count=p,this.nodes=g,this):new HashArrayMapNode(e,p,g)}};let HashCollisionNode=class HashCollisionNode{constructor(e,t,n){this.ownerID=e,this.keyHash=t,this.entries=n}get(e,t,n,r){let i=this.entries;for(let e=0,t=i.length;e<t;e++)if(y(n,i[e][0]))return i[e][1];return r}update(e,t,n,r,i,o,a){void 0===n&&(n=hash(r));let l=i===m;if(n!==this.keyHash)return l?this:(SetRef(a),SetRef(o),mergeIntoNode(this,e,t,n,[r,i]));let d=this.entries,c=0,u=d.length;for(;c<u&&!y(r,d[c][0]);c++);let h=c<u;if(h?d[c][1]===i:l)return this;if(SetRef(a),(l||!h)&&SetRef(o),l&&2===u)return new ValueNode(e,this.keyHash,d[1^c]);let p=e&&e===this.ownerID,f=p?d:arrCopy(d);return(h?l?c===u-1?f.pop():f[c]=f.pop():f[c]=[r,i]:f.push([r,i]),p)?(this.entries=f,this):new HashCollisionNode(e,this.keyHash,f)}};let ValueNode=class ValueNode{constructor(e,t,n){this.ownerID=e,this.keyHash=t,this.entry=n}get(e,t,n,r){return y(n,this.entry[0])?this.entry[1]:r}update(e,t,n,r,i,o,a){let l=i===m,d=y(r,this.entry[0]);if(d?i===this.entry[1]:l)return this;if(SetRef(a),l){SetRef(o);return}return d?e&&e===this.ownerID?(this.entry[1]=i,this):new ValueNode(e,this.keyHash,[r,i]):(SetRef(o),mergeIntoNode(this,e,t,hash(r),[r,i]))}};let MapIterator=class MapIterator{constructor(e,t,n){this._type=t,this._reverse=n,this._stack=e._root&&mapIteratorFrame(e._root)}_stack;[Symbol.iterator](){return this}next(){let e=this._type,t=this._stack;for(;t;){let n;let r=t.node,i=t.index++;if(r.entry){if(0===i)return mapIteratorValue(e,r.entry)}else if("entries"in r&&r.entries){if(i<=(n=r.entries.length-1))return mapIteratorValue(e,r.entries[this._reverse?n-i:i])}else if(i<=(n=r.nodes.length-1)){let o=r.nodes[this._reverse?n-i:i];if(o){if(o.entry)return mapIteratorValue(e,o.entry);t=this._stack=mapIteratorFrame(o,t)}continue}t=this._stack=this._stack.__prev}return{value:void 0,done:!0}}};function mapIteratorValue(e,t){return function(e,t,n,r){let i=e===b?t:e===S?n:[t,n];return r?r.value=i:r={value:i,done:!1},r}(e,t[0],t[1])}function mapIteratorFrame(e,t){return{node:e,index:0,__prev:t}}let b=0,S=1,v=2;function makeMap(e,t,n,r){let i=Object.create(ImmutableMap.prototype);return i.size=e,i._root=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function emptyMap(){return r||(r=makeMap(0))}function updateMap(e,t,n){let r,i;if(e._root){let o=MakeRef(),a=MakeRef();if(r=updateNode(e._root,e.__ownerID,0,void 0,t,n,o,a),!a.value)return e;i=e.size+(o.value?n===m?-1:1:0)}else{if(n===m)return e;i=1,r=new ArrayMapNode(e.__ownerID,[[t,n]])}return e.__ownerID?(e.size=i,e._root=r,e.__hash=void 0,e.__altered=!0,e):r?makeMap(i,r):emptyMap()}function updateNode(e,t,n,r,i,o,a,l){return e?e.update(t,n,r,i,o,a,l):o===m?e:(SetRef(l),SetRef(a),new ValueNode(t,r,[i,o]))}function isLeafNode(e){return e.constructor===ValueNode||e.constructor===HashCollisionNode}function mergeIntoNode(e,t,n,r,i){let o;if(e.keyHash===r)return new HashCollisionNode(t,r,[e.entry,i]);let a=(0===n?e.keyHash:e.keyHash>>>n)&31,l=(0===n?r:r>>>n)&31,d=a===l?[mergeIntoNode(e,t,n+5,r,i)]:(o=new ValueNode(t,r,i),a<l?[e,o]:[o,e]);return new BitmapIndexedNode(t,1<<a|1<<l,d)}function popCount(e){return e-=e>>1&1431655765,e=(e=(858993459&e)+(e>>2&858993459))+(e>>4)&252645135,e+=e>>8,127&(e+=e>>16)}function setAt(e,t,n,r){let i=r?e:arrCopy(e);return i[t]=n,i}let k=8,_=16,C=8;let AtomMap=class AtomMap{constructor(e,t){this.name=e;let n=emptyMap();t&&(n=n.withMutations(n=>{for(let[r,i]of t)n.set(r,(0,a.cn)(`${e}:${String(r)}`,i))})),this.atoms=(0,a.cn)(`${e}:atoms`,n)}atoms;getAtom(e){let t=this.atoms.__unsafe__getWithoutCapture().get(e);if(!t){this.atoms.get();return}return t}get(e){let t=this.getAtom(e)?.get();return(0,o.hu)(t!==a.Z1),t}__unsafe__getWithoutCapture(e){let t=this.atoms.__unsafe__getWithoutCapture().get(e);if(!t)return;let n=t.__unsafe__getWithoutCapture();return(0,o.hu)(n!==a.Z1),n}has(e){let t=this.getAtom(e);return!!t&&t.get()!==a.Z1}__unsafe__hasWithoutCapture(e){let t=this.atoms.__unsafe__getWithoutCapture().get(e);return!!t&&((0,o.hu)(t.__unsafe__getWithoutCapture()!==a.Z1),!0)}set(e,t){let n=this.atoms.__unsafe__getWithoutCapture().get(e);return n?n.set(t):this.atoms.update(n=>n.set(e,(0,a.cn)(`${this.name}:${String(e)}`,t))),this}update(e,t){let n=this.atoms.__unsafe__getWithoutCapture().get(e);if(!n)throw Error(`AtomMap: key ${e} not found`);let r=n.__unsafe__getWithoutCapture();(0,o.hu)(r!==a.Z1),n.set(t(r))}delete(e){let t=this.atoms.__unsafe__getWithoutCapture().get(e);return!!t&&((0,a.ay)(()=>{t.set(a.Z1),this.atoms.update(t=>t.delete(e))}),!0)}deleteMany(e){return(0,a.ay)(()=>{let t=[],n=this.atoms.get().withMutations(n=>{for(let r of e){let e=n.get(r);if(!e)continue;let i=e.get();(0,o.hu)(i!==a.Z1),t.push([r,i]),n.delete(r),e.set(a.Z1)}});return t.length&&this.atoms.set(n),t})}clear(){return(0,a.ay)(()=>{for(let e of this.atoms.__unsafe__getWithoutCapture().values())e.set(a.Z1);this.atoms.set(emptyMap())})}*entries(){for(let[e,t]of this.atoms.get()){let n=t.get();(0,o.hu)(n!==a.Z1),yield[e,n]}}*keys(){for(let e of this.atoms.get().keys())yield e}*values(){for(let e of this.atoms.get().values()){let t=e.get();(0,o.hu)(t!==a.Z1),yield t}}get size(){return this.atoms.get().size}forEach(e,t){for(let[n,r]of this.entries())e.call(t,r,n,this)}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="AtomMap"};function devFreeze(e){return e}let IncrementalSetConstructor=class IncrementalSetConstructor{constructor(e){this.previousValue=e}nextValue;diff;get(){let e=this.diff?.removed?.size??0,t=this.diff?.added?.size??0;if(0!==e||0!==t)return{value:this.nextValue,diff:this.diff}}_add(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.add(e),this.diff??={},t?this.diff.removed?.delete(e):(this.diff.added??=new Set,this.diff.added.add(e))}add(e){let t=this.previousValue.has(e);if(t){let n=this.diff?.removed?.has(e);if(!n)return;return this._add(e,t)}let n=this.nextValue?.has(e);n||this._add(e,t)}_remove(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(e),this.diff??={},t?(this.diff.removed??=new Set,this.diff.removed.add(e)):this.diff.added?.delete(e)}remove(e){let t=this.previousValue.has(e);if(!t){let n=this.diff?.added?.has(e);if(!n)return;return this._remove(e,t)}let n=this.diff?.removed?.has(e);n||this._remove(e,t)}};let E=!1;function defineMigrations(e){let{currentVersion:t,firstVersion:n,migrators:r={},subTypeKey:i,subTypeMigrations:o}=e;if(E||(console.warn("The 'defineMigrations' function is deprecated and will be removed in a future release. Use the new migrations API instead. See the migration guide for more info: https://tldraw.dev/docs/persistence#Updating-legacy-shape-migrations-defineMigrations"),E=!0),"number"==typeof t&&"number"==typeof n){if(t===n)throw Error("Current version is equal to initial version.");if(t<n)throw Error("Current version is lower than initial version.")}return{firstVersion:n??0,currentVersion:t??0,migrators:r,subTypeKey:i,subTypeMigrations:o}}function createMigrationSequence({sequence:e,sequenceId:t,retroactive:n=!0}){let r={sequenceId:t,retroactive:n,sequence:function(e){let t=[];for(let n=e.length-1;n>=0;n--){let r=e[n];if("id"in r)t.unshift(r);else{let e=r.dependsOn,n=t[0];n&&(t[0]={...n,dependsOn:e.concat(n.dependsOn??[])})}}return t}(e)};return validateMigrations(r),r}function createMigrationIds(e,t){return Object.fromEntries((0,o.EP)(t).map(([t,n])=>[t,`${e}/${n}`]))}function createRecordMigrationSequence(e){let t=e.sequenceId;return createMigrationSequence({sequenceId:t,retroactive:e.retroactive??!0,sequence:e.sequence.map(t=>"id"in t?{...t,scope:"record",filter:n=>n.typeName===e.recordType&&(t.filter?.(n)??!0)&&(e.filter?.(n)??!0)}:t)})}function parseMigrationId(e){let[t,n]=e.split("/");return{sequenceId:t,version:parseInt(n)}}function validateMigrationId(e,t){t&&(0,o.hu)(e.startsWith(t+"/"),`Every migration in sequence '${t}' must have an id starting with '${t}/'. Got invalid id: '${e}'`),(0,o.hu)(e.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${e}'`)}function validateMigrations(e){if((0,o.hu)(!e.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${e.sequenceId}`),(0,o.hu)(e.sequenceId.length,"sequenceId must be a non-empty string"),0===e.sequence.length)return;validateMigrationId(e.sequence[0].id,e.sequenceId);let t=parseMigrationId(e.sequence[0].id).version;(0,o.hu)(1===t,`Expected the first migrationId to be '${e.sequenceId}/1' but got '${e.sequence[0].id}'`);for(let n=1;n<e.sequence.length;n++){let r=e.sequence[n].id;validateMigrationId(r,e.sequenceId);let i=parseMigrationId(r).version;(0,o.hu)(i===t+1,`Migration id numbers must increase in increments of 1, expected ${e.sequenceId}/${t+1} but got '${e.sequence[n].id}'`),t=i}}var M=((i=M||{}).IncompatibleSubtype="incompatible-subtype",i.UnknownType="unknown-type",i.TargetVersionTooNew="target-version-too-new",i.TargetVersionTooOld="target-version-too-old",i.MigrationError="migration-error",i.UnrecognizedSubtype="unrecognized-subtype",i);function createEmptyRecordsDiff(){return{added:{},updated:{},removed:{}}}function reverseRecordsDiff(e){let t={added:e.removed,removed:e.added,updated:{}};for(let[n,r]of Object.values(e.updated))t.updated[n.id]=[r,n];return t}function isRecordsDiffEmpty(e){return 0===Object.keys(e.added).length&&0===Object.keys(e.updated).length&&0===Object.keys(e.removed).length}function squashRecordDiffs(e){let t={added:{},removed:{},updated:{}};return squashRecordDiffsMutable(t,e),t}function squashRecordDiffsMutable(e,t){for(let n of t){for(let[t,r]of(0,o.EP)(n.added))if(e.removed[t]){let n=e.removed[t];delete e.removed[t],n!==r&&(e.updated[t]=[n,r])}else e.added[t]=r;for(let[t,[r,i]]of(0,o.EP)(n.updated)){if(e.added[t]){e.added[t]=i,delete e.updated[t],delete e.removed[t];continue}if(e.updated[t]){e.updated[t]=[e.updated[t][0],i],delete e.removed[t];continue}e.updated[t]=n.updated[t],delete e.removed[t]}for(let[t,r]of(0,o.EP)(n.removed))e.added[t]?delete e.added[t]:e.updated[t]?(e.removed[t]=e.updated[t][0],delete e.updated[t]):e.removed[t]=r}}let RecordType=class RecordType{constructor(e,t){this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=t.validator??{validate:e=>e},this.scope=t.scope??"document",this.ephemeralKeys=t.ephemeralKeys;let n=new Set;if(t.ephemeralKeys)for(let[e,r]of(0,o.EP)(t.ephemeralKeys))r&&n.add(e);this.ephemeralKeySet=n}createDefaultProperties;validator;ephemeralKeys;ephemeralKeySet;scope;create(e){let t={...this.createDefaultProperties(),id:"id"in e?e.id:this.createId()};for(let[n,r]of Object.entries(e))void 0!==r&&(t[n]=r);return t.typeName=this.typeName,t}clone(e){return{...(0,o.v4)(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??(0,o.EL)())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance(e){return e?.typeName===this.typeName}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return":"===e[this.typeName.length]}withDefaultProperties(e){return new RecordType(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}};function createRecordType(e,t){return new RecordType(e,{createDefaultProperties:()=>({}),validator:t.validator,scope:t.scope,ephemeralKeys:t.ephemeralKeys})}function assertIdType(e,t){if(!e||!t.isId(e))throw Error(`string ${JSON.stringify(e)} is not a valid ${t.typeName} id`)}function objectMatchesQuery(e,t){for(let[n,r]of Object.entries(e)){let e=t[n];if("eq"in r&&e!==r.eq||"neq"in r&&e===r.neq||"gt"in r&&("number"!=typeof e||e<=r.gt))return!1}return!0}function executeQuery(e,t,n){let r=Object.fromEntries(Object.keys(n).map(e=>[e,new Set]));for(let[i,o]of Object.entries(n))if("eq"in o){let n=e.index(t,i),a=n.get().get(o.eq);if(a)for(let e of a)r[i].add(e)}else if("neq"in o){let n=e.index(t,i);for(let[e,t]of n.get())if(e!==o.neq)for(let e of t)r[i].add(e)}else if("gt"in o){let n=e.index(t,i);for(let[e,t]of n.get())if(e>o.gt)for(let e of t)r[i].add(e)}return function(e){if(0===e.length)return new Set;let t=e[0],n=e.slice(1),r=new Set;for(let e of t)n.every(t=>t.has(e))&&r.add(e);return r}(Object.values(r))}let StoreQueries=class StoreQueries{constructor(e,t){this.recordMap=e,this.history=t}indexCache=new Map;historyCache=new Map;filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);let t=(0,a.Fl)("filterHistory:"+e,(t,n)=>{if((0,a.e1)(t))return this.history.get();let r=this.history.getDiffSince(n);if(r===a.SB)return this.history.get();let i={added:{},removed:{},updated:{}},l=0,d=0,c=0;for(let t of r){for(let n of(0,o.UM)(t.added))if(n.typeName===e){if(i.removed[n.id]){let e=i.removed[n.id];delete i.removed[n.id],d--,e!==n&&(i.updated[n.id]=[e,n],c++)}else i.added[n.id]=n,l++}for(let[n,r]of(0,o.UM)(t.updated))r.typeName===e&&(i.added[r.id]?i.added[r.id]=r:i.updated[r.id]?i.updated[r.id]=[i.updated[r.id][0],r]:(i.updated[r.id]=[n,r],c++));for(let n of(0,o.UM)(t.removed))n.typeName===e&&(i.added[n.id]?(delete i.added[n.id],l--):(i.updated[n.id]?(i.removed[n.id]=i.updated[n.id][0],delete i.updated[n.id],c--):i.removed[n.id]=n,d++))}return l||d||c?(0,a.qo)(this.history.get(),i):t},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){let n=e+":"+t;if(this.indexCache.has(n))return this.indexCache.get(n);let r=this.__uncached_createIndex(e,t);return this.indexCache.set(n,r),r}__uncached_createIndex(e,t){let n=this.filterHistory(e),fromScratch=()=>{n.get();let r=new Map;for(let n of this.recordMap.values())if(n.typeName===e){let e=n[t];r.has(e)||r.set(e,new Set),r.get(e).add(n.id)}return r};return(0,a.Fl)("index:"+e+":"+t,(r,i)=>{let l,d;if((0,a.e1)(r))return fromScratch();let c=n.getDiffSince(i);if(c===a.SB)return fromScratch();let u=new Map,add=(e,t)=>{let n=u.get(e);n||(n=new IncrementalSetConstructor(r.get(e)??new Set)),n.add(t),u.set(e,n)},remove=(e,t)=>{let n=u.get(e);n||(n=new IncrementalSetConstructor(r.get(e)??new Set)),n.remove(t),u.set(e,n)};for(let n of c){for(let r of(0,o.UM)(n.added))if(r.typeName===e){let e=r[t];add(e,r.id)}for(let[r,i]of(0,o.UM)(n.updated))if(i.typeName===e){let e=r[t],n=i[t];e!==n&&(remove(e,i.id),add(n,i.id))}for(let r of(0,o.UM)(n.removed))if(r.typeName===e){let e=r[t];remove(e,r.id)}}for(let[e,t]of u){let n=t.get();n&&(l||(l=new Map(r)),d||(d=new Map),0===n.value.size?l.delete(e):l.set(e,n.value),d.set(e,n.diff))}return l&&d?(0,a.qo)(l,d):r},{historyLength:100})}record(e,t=()=>({}),n="record:"+e+(t?":"+t.toString():"")){let r=this.ids(e,t,n);return(0,a.Fl)(n,()=>{for(let e of r.get())return this.recordMap.get(e)})}records(e,t=()=>({}),n="records:"+e+(t?":"+t.toString():"")){let r=this.ids(e,t,"ids:"+n);return(0,a.Fl)(n,()=>Array.from(r.get(),e=>this.recordMap.get(e)),{isEqual:o.E8})}ids(e,t=()=>({}),n="ids:"+e+(t?":"+t.toString():"")){let r=this.filterHistory(e),fromScratch=()=>{r.get();let n=t();if(0===Object.keys(n).length){let t=new Set;for(let n of this.recordMap.values())n.typeName===e&&t.add(n.id);return t}return executeQuery(this,e,n)},fromScratchWithDiff=e=>{let t=fromScratch(),n=function(e,t){let n={};for(let r of t)e.has(r)||(n.added??=new Set,n.added.add(r));for(let r of e)t.has(r)||(n.removed??=new Set,n.removed.add(r));return n.added||n.removed?n:void 0}(e,t);return n?(0,a.qo)(t,n):e},i=(0,a.Fl)("ids_query:"+n,t,{isEqual:o.Xy});return(0,a.Fl)("query:"+n,(t,n)=>{let l=i.get();if((0,a.e1)(t))return fromScratch();if(n<i.lastChangedEpoch)return fromScratchWithDiff(t);let d=r.getDiffSince(n);if(d===a.SB)return fromScratchWithDiff(t);let c=new IncrementalSetConstructor(t);for(let t of d){for(let n of(0,o.UM)(t.added))n.typeName===e&&objectMatchesQuery(l,n)&&c.add(n.id);for(let[n,r]of(0,o.UM)(t.updated))r.typeName===e&&(objectMatchesQuery(l,r)?c.add(r.id):c.remove(r.id));for(let n of(0,o.UM)(t.removed))n.typeName===e&&c.remove(n.id)}let u=c.get();return u?(0,a.qo)(u.value,u.diff):t},{historyLength:50})}exec(e,t){let n=executeQuery(this,e,t);return 0===n.size?a.LZ:Array.from(n,e=>this.recordMap.get(e))}};let StoreSideEffects=class StoreSideEffects{constructor(e){this.store=e}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_operationCompleteHandlers=[];_isEnabled=!0;isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;let n=this._beforeCreateHandlers[e.typeName];if(n){let r=e;for(let e of n)r=e(r,t);return r}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;let n=this._afterCreateHandlers[e.typeName];if(n)for(let r of n)r(e,t)}handleBeforeChange(e,t,n){if(!this._isEnabled)return t;let r=this._beforeChangeHandlers[t.typeName];if(r){let i=t;for(let t of r)i=t(e,i,n);return i}return t}handleAfterChange(e,t,n){if(!this._isEnabled)return;let r=this._afterChangeHandlers[t.typeName];if(r)for(let i of r)i(e,t,n)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;let n=this._beforeDeleteHandlers[e.typeName];if(n){for(let r of n)if(!1===r(e,t))return!1}return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;let n=this._afterDeleteHandlers[e.typeName];if(n)for(let r of n)r(e,t)}handleOperationComplete(e){if(this._isEnabled)for(let t of this._operationCompleteHandlers)t(e)}register(e){let t=[];for(let[n,r]of Object.entries(e))r?.beforeCreate&&t.push(this.registerBeforeCreateHandler(n,r.beforeCreate)),r?.afterCreate&&t.push(this.registerAfterCreateHandler(n,r.afterCreate)),r?.beforeChange&&t.push(this.registerBeforeChangeHandler(n,r.beforeChange)),r?.afterChange&&t.push(this.registerAfterChangeHandler(n,r.afterChange)),r?.beforeDelete&&t.push(this.registerBeforeDeleteHandler(n,r.beforeDelete)),r?.afterDelete&&t.push(this.registerAfterDeleteHandler(n,r.afterDelete));return()=>{for(let e of t)e()}}registerBeforeCreateHandler(e,t){let n=this._beforeCreateHandlers[e];return n||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>remove(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){let n=this._afterCreateHandlers[e];return n||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>remove(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){let n=this._beforeChangeHandlers[e];return n||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>remove(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){let n=this._afterChangeHandlers[e];return n||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>remove(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){let n=this._beforeDeleteHandlers[e];return n||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>remove(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){let n=this._afterDeleteHandlers[e];return n||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>remove(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>remove(this._operationCompleteHandlers,e)}};function remove(e,t){let n=e.indexOf(t);n>=0&&e.splice(n,1)}let Store=class Store{id;records;history=(0,a.cn)("history",0,{historyLength:1e3});query;listeners=new Set;historyAccumulator=new HistoryAccumulator;historyReactor;cancelHistoryReactor(){}schema;props;scopedTypes;sideEffects=new StoreSideEffects(this);constructor(e){let{initialData:t,schema:n,id:r}=e;this.id=r??(0,o.EL)(),this.schema=n,this.props=e.props,t?this.records=new AtomMap("store",(0,o.EP)(t).map(([e,t])=>[e,this.schema.validateRecord(this,t,"initialize",null)])):this.records=new AtomMap("store"),this.query=new StoreQueries(this.records,this.history),this.historyReactor=(0,a.zH)("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:e=>this.cancelHistoryReactor=(0,o.Gf)(e)}),this.scopedTypes={document:new Set((0,o.UM)(this.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName)),session:new Set((0,o.UM)(this.schema.types).filter(e=>"session"===e.scope).map(e=>e.typeName)),presence:new Set((0,o.UM)(this.schema.types).filter(e=>"presence"===e.scope).map(e=>e.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){let e=this.historyAccumulator.flush();for(let{changes:t,source:n}of e){let e=null,r=null,i=null;for(let{onHistory:o,filters:a}of this.listeners)if("all"===a.source||a.source===n){if("all"!==a.scope){if("document"===a.scope){if(!(r??=this.filterChangesByScope(t,"document")))continue;o({changes:r,source:n})}else if("session"===a.scope){if(!(e??=this.filterChangesByScope(t,"session")))continue;o({changes:e,source:n})}else{if(!(i??=this.filterChangesByScope(t,"presence")))continue;o({changes:i,source:n})}}else o({changes:t,source:n})}}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){let n={added:(0,o.H4)(e.added,(e,n)=>this.scopedTypes[t].has(n.typeName)),updated:(0,o.H4)(e.updated,(e,n)=>this.scopedTypes[t].has(n[1].typeName)),removed:(0,o.H4)(e.removed,(e,n)=>this.scopedTypes[t].has(n.typeName))};return 0===Object.keys(n.added).length&&0===Object.keys(n.updated).length&&0===Object.keys(n.removed).length?null:n}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}put(e,t){this.atomic(()=>{let n;let r={},i={},o=!1,a=this.isMergingRemoteChanges?"remote":"user";for(let l=0,d=e.length;l<d;l++){n=e[l];let d=this.records.__unsafe__getWithoutCapture(n.id);if(d){n=this.sideEffects.handleBeforeChange(d,n,a);let e=this.schema.validateRecord(this,n,t??"updateRecord",d);if(e===d)continue;this.records.set(n.id,n),o=!0,r[n.id]=[d,n],this.addDiffForAfterEvent(d,n)}else n=this.sideEffects.handleBeforeCreate(n,a),o=!0,i[(n=n=this.schema.validateRecord(this,n,t??"createRecord",null)).id]=n,this.addDiffForAfterEvent(null,n),this.records.set(n.id,n)}o&&this.updateHistory({added:i,updated:r,removed:{}})})}remove(e){this.atomic(()=>{let t=new Set(e),n=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(let r of e){let e=this.records.__unsafe__getWithoutCapture(r);e&&!1===this.sideEffects.handleBeforeDelete(e,n)&&t.delete(r)}let r=this.records.deleteMany(t);if(0===r.length)return;let i={};for(let[e,t]of r)i[e]=t,this.addDiffForAfterEvent(t,null);this.updateHistory({added:{},updated:{},removed:i})})}get(e){return this.records.get(e)}unsafeGetWithoutCapture(e){return this.records.__unsafe__getWithoutCapture(e)}serialize(e="document"){let t={};for(let[n,r]of this.records)("all"===e||this.scopedTypes[e].has(r.typeName))&&(t[n]=r);return t}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);let n=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(n)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords(){return Array.from(this.records.values())}clear(){this.remove(Array.from(this.records.keys()))}update(e,t){let n=this.unsafeGetWithoutCapture(e);if(!n){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(n)])}has(e){return this.records.has(e)}listen(e,t){this._flushHistory();let n={onHistory:e,filters:{source:t?.source??"all",scope:t?.scope??"all"}};return this.historyReactor.scheduler.isActivelyListening||(this.historyReactor.start(),this.historyReactor.scheduler.execute()),this.listeners.add(n),()=>{this.listeners.delete(n),0===this.listeners.size&&this.historyReactor.stop()}}isMergingRemoteChanges=!1;mergeRemoteChanges(e){if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw Error("Cannot merge remote changes while in atomic operation");try{this.atomic(e,!0,!0)}finally{this.ensureStoreIsUsable()}}extractingChanges(e){let t=[],n=this.historyAccumulator.addInterceptor(e=>t.push(e.changes));try{return(0,a.ay)(e),squashRecordDiffs(t)}finally{n()}}applyDiff(e,{runCallbacks:t=!0,ignoreEphemeralKeys:n=!1}={}){this.atomic(()=>{let t=(0,o.UM)(e.added);for(let[r,i]of(0,o.UM)(e.updated)){let e=this.schema.getType(i.typeName);if(n&&e.ephemeralKeySet.size){let n=this.get(i.id);if(!n){t.push(i);continue}let r=null;for(let[t,a]of Object.entries(i))e.ephemeralKeySet.has(t)||Object.is(a,(0,o.eg)(n,t))||(r||(r={...n}),r[t]=a);r&&t.push(r)}else t.push(i)}let r=(0,o.GH)(e.removed);t.length&&this.put(t),r.length&&this.remove(r)},t)}createCache(e){let t=new o.kM;return{get:n=>{let r=this.records.getAtom(n);if(r)return t.get(r,()=>e(n,r)).get()}}}createComputedCache(e,t,n){return this.createCache((r,i)=>{let o=n?.areRecordsEqual?(0,a.Fl)(`${e}:${r}:isEqual`,()=>i.get(),{isEqual:n.areRecordsEqual}):i;return(0,a.Fl)(e+":"+r,()=>t(o.get()),{isEqual:n?.areResultsEqual})})}_integrityChecker;ensureStoreIsUsable(){this.atomic(()=>{this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()})}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}pendingAfterEvents=null;addDiffForAfterEvent(e,t){if((0,o.hu)(this.pendingAfterEvents,"must be in event operation"),e===t||(e&&t&&(0,o.hu)(e.id===t.id),!e&&!t))return;let n=(e||t).id,r=this.pendingAfterEvents.get(n);r?r.after=t:this.pendingAfterEvents.set(n,{before:e,after:t})}flushAtomicCallbacks(e){let t=0,n=e?"remote":"user";for(;this.pendingAfterEvents;){let e=this.pendingAfterEvents;if(this.pendingAfterEvents=null,this.sideEffects.isEnabled()){if(++t>100)throw Error("Maximum store update depth exceeded, bailing out");for(let{before:t,after:r}of e.values())t&&r&&t!==r&&!(0,o.Xy)(t,r)?this.sideEffects.handleAfterChange(t,r,n):t&&!r?this.sideEffects.handleAfterDelete(t,n):!t&&r&&this.sideEffects.handleAfterCreate(r,n);this.pendingAfterEvents?n="user":this.sideEffects.handleOperationComplete(n)}}}_isInAtomicOp=!1;atomic(e,t=!0,n=!1){return(0,a.ay)(()=>{if(this._isInAtomicOp){this.pendingAfterEvents||(this.pendingAfterEvents=new Map);let r=this.sideEffects.isEnabled();(0,o.hu)(!n,"cannot call mergeRemoteChanges while in atomic operation");try{return r&&!t&&this.sideEffects.setIsEnabled(!1),e()}finally{this.sideEffects.setIsEnabled(r)}}this.pendingAfterEvents=new Map;let r=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(t??r),this._isInAtomicOp=!0,n&&(this.isMergingRemoteChanges=!0);try{let t=e();return this.isMergingRemoteChanges=!1,this.flushAtomicCallbacks(n),t}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(r),this._isInAtomicOp=!1,this.isMergingRemoteChanges=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(t=>e(t,this.isMergingRemoteChanges?"remote":"user"))}};let HistoryAccumulator=class HistoryAccumulator{_history=[];_interceptors=new Set;addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){for(let t of(this._history.push(e),this._interceptors))t(e)}flush(){let e=function(e){let t;if(0===e.length)return[];let n=[],r=[e[0]];for(let i=1,o=e.length;i<o;i++)t=e[i],r[0].source!==t.source&&(n.push(r),r=[]),r.push(t);return n.push(r),n.map(e=>({source:e[0].source,changes:squashRecordDiffs(e.map(e=>e.changes))}))}(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}};function createComputedCache(e,t,n){let r=new o.kM;return{get(i,o){let a=r.get(i,()=>{let r=i instanceof Store?i:i.store;return r.createComputedCache(e,e=>t(i,e),n)});return a.get(o)}}}let StoreSchema=class StoreSchema{constructor(e,t){for(let n of(this.types=e,this.options=t,t.migrations??[]))(0,o.hu)(!this.migrations[n.sequenceId],`Duplicate migration sequenceId ${n.sequenceId}`),validateMigrations(n),this.migrations[n.sequenceId]=n;let n=Object.values(this.migrations).flatMap(e=>e.sequence);for(let e of(this.sortedMigrations=function(e){let t=new Map(e.map(e=>[e.id,e])),n=new Set,r=[];for(let e of t.values())!function process(e){(0,o.hu)(!n.has(e.id),`Circular dependency in migrations: ${e.id}`),n.add(e.id);let{version:i,sequenceId:a}=parseMigrationId(e.id),l=t.get(`${a}/${i-1}`);if(l&&process(l),e.dependsOn)for(let n of e.dependsOn){let e=t.get(n);e&&process(e)}t.delete(e.id),r.push(e)}(e);return r}(n),this.sortedMigrations))if(e.dependsOn?.length)for(let t of e.dependsOn){let r=n.find(e=>e.id===t);(0,o.hu)(r,`Migration '${e.id}' depends on missing migration '${t}'`)}}static create(e,t){return new StoreSchema(e,t??{})}migrations={};sortedMigrations;validateRecord(e,t,n,r){try{let e=(0,o.eg)(this.types,t.typeName);if(!e)throw Error(`Missing definition for record type ${t.typeName}`);return e.validate(t,r??void 0)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:n,recordBefore:r,error:i});throw i}}getMigrationsSince(e){let t=function(e){if(e.schemaVersion>2||e.schemaVersion<1)return o.x4.err("Bad schema version");if(2===e.schemaVersion)return o.x4.ok(e);let t={schemaVersion:2,sequences:{"com.tldraw.store":e.storeVersion}};for(let[n,r]of Object.entries(e.recordVersions))if(t.sequences[`com.tldraw.${n}`]=r.version,"subTypeKey"in r)for(let[e,i]of Object.entries(r.subTypeVersions))t.sequences[`com.tldraw.${n}.${e}`]=i;return o.x4.ok(t)}(e);if(!t.ok)return t;let n=t.value,r=new Set(Object.keys(n.sequences).filter(e=>this.migrations[e]));for(let e in this.migrations)void 0===n.sequences[e]&&this.migrations[e].retroactive&&r.add(e);if(0===r.size)return o.x4.ok([]);let i=new Set;for(let e of r){let t=n.sequences[e];if("number"!=typeof t&&this.migrations[e].retroactive||0===t){for(let t of this.migrations[e].sequence)i.add(t.id);continue}let r=`${e}/${t}`,a=this.migrations[e].sequence.findIndex(e=>e.id===r);if(-1===a)return o.x4.err("Incompatible schema?");for(let t of this.migrations[e].sequence.slice(a+1))i.add(t.id)}return o.x4.ok(this.sortedMigrations.filter(({id:e})=>i.has(e)))}migratePersistedRecord(e,t,n="up"){let r=this.getMigrationsSince(t);if(!r.ok)return console.error("Error migrating record",r.error),{type:"error",reason:M.MigrationError};let i=r.value;if(0===i.length)return{type:"success",value:e};if(i.some(e=>"store"===e.scope))return{type:"error",reason:"down"===n?M.TargetVersionTooOld:M.TargetVersionTooNew};if("down"===n){if(!i.every(e=>e.down))return{type:"error",reason:M.TargetVersionTooOld};i=i.slice().reverse()}e=(0,o.v4)(e);try{for(let t of i){if("store"===t.scope)throw Error();let r=!t.filter||t.filter(e);if(!r)continue;let i=t[n](e);i&&(e=(0,o.v4)(i))}}catch(e){return console.error("Error migrating record",e),{type:"error",reason:M.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:t}=e,n=this.getMigrationsSince(e.schema);if(!n.ok)return console.error("Error migrating store",n.error),{type:"error",reason:M.MigrationError};let r=n.value;if(0===r.length)return{type:"success",value:t};t=(0,o.v4)(t);try{for(let e of r)if("record"===e.scope)for(let[n,r]of Object.entries(t)){let i=!e.filter||e.filter(r);if(!i)continue;let a=e.up(r);a&&(t[n]=(0,o.v4)(a))}else if("store"===e.scope){let n=e.up(t);n&&(t=(0,o.v4)(n))}else(0,o.iP)(e)}catch(e){return console.error("Error migrating store",e),{type:"error",reason:M.MigrationError}}return{type:"success",value:t}}createIntegrityChecker(e){return this.options.createIntegrityChecker?.(e)??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:t})=>[e,t.length?parseMigrationId(t.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){let t=(0,o.eg)(this.types,e);return(0,o.hu)(t,"record type does not exists"),t}};(0,o.x2)("@tldraw/store","3.15.4","esm")},43001:function(e,t,n){"use strict";n.d(t,{ZJ:function(){return D},TA:function(){return j},dR:function(){return P},Yk:function(){return e$},AN:function(){return q},R_:function(){return S},qi:function(){return b},ci:function(){return k},pp:function(){return _},p6:function(){return E},Y8:function(){return C},Xo:function(){return e7},ST:function(){return M},lI:function(){return tk},HO:function(){return e8},_A:function(){return eM},U_:function(){return R},$I:function(){return EnumStyleProp},Zu:function(){return e9},GD:function(){return th},iS:function(){return em},AM:function(){return e_},a2:function(){return tO},t8:function(){return tm},ez:function(){return el},zh:function(){return ew},fV:function(){return StyleProp},G4:function(){return eP},PQ:function(){return eh},LV:function(){return eS},z:function(){return ee},_R:function(){return Y},$H:function(){return tF},hC:function(){return en},Vz:function(){return z},zn:function(){return L},Rw:function(){return N},Vm:function(){return O},si:function(){return B},S_:function(){return F},_3:function(){return o},TD:function(){return eH},$A:function(){return eN},pA:function(){return p},h9:function(){return eK},qU:function(){return eV},lz:function(){return l},MN:function(){return et},tL:function(){return createAssetValidator},vI:function(){return createBindingId},im:function(){return createBindingPropsMigrationIds},bY:function(){return createBindingPropsMigrationSequence},xc:function(){return createBindingValidator},GP:function(){return createPresenceStateDerivation},F1:function(){return createShapeId},T_:function(){return createShapePropsMigrationIds},af:function(){return createShapePropsMigrationSequence},JY:function(){return createShapeValidator},HH:function(){return createTLSchema},mP:function(){return tB},YQ:function(){return y},gS:function(){return tD},_l:function(){return eX},wu:function(){return eZ},BF:function(){return e2},DW:function(){return e0},gR:function(){return e4},k7:function(){return e3},P3:function(){return ti},eG:function(){return te},y6:function(){return getDefaultColorTheme},Bz:function(){return getDefaultTranslationLocale},k1:function(){return getDefaultUserPresence},DR:function(){return getShapePropKeysByStyle},c4:function(){return tl},A7:function(){return to},J1:function(){return tu},VW:function(){return td},yd:function(){return idValidator},y5:function(){return tg},Fc:function(){return tp},QA:function(){return isBinding},tO:function(){return isBindingId},qk:function(){return isDocument},r5:function(){return isPageId},VV:function(){return isShape},YT:function(){return isShapeId},FH:function(){return tw},BG:function(){return tb},C_:function(){return tT},m0:function(){return tS},jm:function(){return c},CF:function(){return ei},Mv:function(){return u},Tc:function(){return pluckPreservingValues},xn:function(){return e6},hK:function(){return f},cL:function(){return m},gw:function(){return er},u5:function(){return h},pL:function(){return tI},XB:function(){return t_},Ak:function(){return toRichText},AT:function(){return a},lY:function(){return tP},p$:function(){return tE}});var r=n(70938),i=n(45958);function idValidator(e){return i.T.string.refine(t=>{if(!t.startsWith(`${e}:`))throw Error(`${e} ID must start with "${e}:"`);return t})}let o=idValidator("asset");function createAssetValidator(e,t){return i.T.object({id:o,typeName:i.T.literal("asset"),type:i.T.literal(e),props:t,meta:i.T.jsonValue})}let a=i.T.object({x:i.T.number,y:i.T.number,z:i.T.number.optional()}),l=i.T.object({x:i.T.number,y:i.T.number,w:i.T.number,h:i.T.number});var d=n(63134);let c=i.T.number.check(e=>{if(e<0||e>1)throw new i.T.ValidationError("Opacity must be between 0 and 1")}),u=i.T.string.refine(e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw Error('Parent ID must start with "page:" or "shape:"');return e}),h=idValidator("shape");function createShapeValidator(e,t,n){return i.T.object({id:h,typeName:i.T.literal("shape"),x:i.T.number,y:i.T.number,rotation:i.T.number,index:i.T.indexKey,parentId:u,type:i.T.literal(e),isLocked:i.T.boolean,opacity:c,props:t?i.T.object(t):i.T.jsonValue,meta:n?i.T.object(n):i.T.jsonValue})}let p=idValidator("binding");function createBindingValidator(e,t,n){return i.T.object({id:p,typeName:i.T.literal("binding"),type:i.T.literal(e),fromId:h,toId:h,props:t?i.T.object(t):i.T.jsonValue,meta:n?i.T.object(n):i.T.jsonValue})}(0,d.uj)("com.tldraw.binding",{});let f=(0,d.AV)({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function isBinding(e){return!!e&&"binding"===e.typeName}function isBindingId(e){return!!e&&e.startsWith("binding:")}function createBindingId(e){return`binding:${e??(0,r.EL)()}`}function createBindingPropsMigrationSequence(e){return e}function createBindingPropsMigrationIds(e,t){return(0,r.Fm)(t,(t,n)=>`com.tldraw.binding.${e}/${n}`)}let StyleProp=class StyleProp{constructor(e,t,n){this.id=e,this.defaultValue=t,this.type=n}static define(e,t){let{defaultValue:n,type:r=i.T.any}=t;return new StyleProp(e,n,r)}static defineEnum(e,t){let{defaultValue:n,values:r}=t;return new EnumStyleProp(e,n,r)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}};let EnumStyleProp=class EnumStyleProp extends StyleProp{constructor(e,t,n){super(e,t,i.T.literalEnum(...n)),this.values=n}};let g=(0,d.uj)("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),m=(0,d.AV)({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:g.AddIsLocked,up:e=>{e.isLocked=!1},down:e=>{delete e.isLocked}},{id:g.HoistOpacity,up:e=>{e.opacity=Number(e.props.opacity??"1"),delete e.props.opacity},down:e=>{let t=e.opacity;delete e.opacity,e.props.opacity=t<.175?"0.1":t<.375?"0.25":t<.625?"0.5":t<.875?"0.75":"1"}},{id:g.AddMeta,up:e=>{e.meta={}}},{id:g.AddWhite,up:e=>{},down:e=>{"white"===e.props.color&&(e.props.color="black")}}]});function isShape(e){return!!e&&"shape"===e.typeName}function isShapeId(e){return!!e&&e.startsWith("shape:")}function createShapeId(e){return`shape:${e??(0,r.EL)()}`}function getShapePropKeysByStyle(e){let t=new Map;for(let[n,r]of Object.entries(e))if(r instanceof StyleProp){if(t.has(r))throw Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);t.set(r,n)}return t}function createShapePropsMigrationSequence(e){return e}function createShapePropsMigrationIds(e,t){return(0,r.Fm)(t,(t,n)=>`com.tldraw.shape.${e}/${n}`)}function processPropsMigrations(e,t){let n=[];for(let[i,{migrations:o}]of Object.entries(t)){let t=`com.tldraw.${e}.${i}`;o?"sequenceId"in o?((0,r.hu)(t===o.sequenceId,`sequenceId mismatch for ${i} ${d.oX} migrations. Expected '${t}', got '${o.sequenceId}'`),n.push(o)):"sequence"in o?n.push((0,d.w8)({sequenceId:t,retroactive:!0,sequence:o.sequence.map(t=>"id"in t?createPropsMigration(e,i,t):t)})):n.push((0,d.w8)({sequenceId:t,retroactive:!0,sequence:Object.keys(o.migrators).map(e=>Number(e)).sort((e,t)=>e-t).map(n=>({id:`${t}/${n}`,scope:"record",filter:t=>t.typeName===e&&t.type===i,up:e=>{let t=o.migrators[n].up(e);if(t)return t},down:e=>{let t=o.migrators[n].down(e);if(t)return t}}))})):n.push((0,d.w8)({sequenceId:t,retroactive:!0,sequence:[]}))}return n}function createPropsMigration(e,t,n){return{id:n.id,dependsOn:n.dependsOn,scope:"record",filter:n=>n.typeName===e&&n.type===t,up:e=>{let t=n.up(e.props);t&&(e.props=t)},down:"function"==typeof n.down?e=>{let t=n.down(e.props);t&&(e.props=t)}:void 0}}let y=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],b={lightMode:{id:"light",text:"#000000",background:"#f9fafb",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",frame:{headingStroke:"#717171",headingFill:"#ffffff",stroke:"#717171",fill:"#ffffff",text:"#000000"},note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8205 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",frame:{headingStroke:"#6681ec",headingFill:"#f9fafe",stroke:"#6681ec",fill:"#f9fafe",text:"#000000"},note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",frame:{headingStroke:"#37a684",headingFill:"#f8fcfa",stroke:"#37a684",fill:"#f8fcfa",text:"#000000"},note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",frame:{headingStroke:"#aaaaab",headingFill:"#fbfcfc",stroke:"#aaaaab",fill:"#fcfcfd",text:"#000000"},note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",frame:{headingStroke:"#6cb2f3",headingFill:"#f8fbfe",stroke:"#6cb2f3",fill:"#fafcff",text:"#000000"},note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",frame:{headingStroke:"#6dbe7c",headingFill:"#f8fcf9",stroke:"#6dbe7c",fill:"#fafdfa",text:"#000000"},note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",frame:{headingStroke:"#f89090",headingFill:"#fffafa",stroke:"#f89090",fill:"#fffbfb",text:"#000000"},note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",frame:{headingStroke:"#e59bf5",headingFill:"#fefaff",stroke:"#e59bf5",fill:"#fefbff",text:"#000000"},note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",frame:{headingStroke:"#e68544",headingFill:"#fef9f6",stroke:"#e68544",fill:"#fef9f6",text:"#000000"},note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",frame:{headingStroke:"#e55757",headingFill:"#fef7f7",stroke:"#e55757",fill:"#fef9f9",text:"#000000"},note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",frame:{headingStroke:"#bc62d3",headingFill:"#fcf7fd",stroke:"#bc62d3",fill:"#fdf9fd",text:"#000000"},note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",frame:{headingStroke:"#f3bb6c",headingFill:"#fefcf8",stroke:"#f3bb6c",fill:"#fffdfa",text:"#000000"},note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",frame:{headingStroke:"#7d7d7d",headingFill:"#ffffff",stroke:"#7d7d7d",fill:"#ffffff",text:"#000000"},note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",frame:{headingStroke:"#5c5c5c",headingFill:"#252525",stroke:"#5c5c5c",fill:"#0c0c0c",text:"#f2f2f2"},note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.6225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",frame:{headingStroke:"#384994",headingFill:"#1C2036",stroke:"#384994",fill:"#11141f",text:"#f2f2f2"},note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",frame:{headingStroke:"#10513C",headingFill:"#14241f",stroke:"#10513C",fill:"#0E1614",text:"#f2f2f2"},note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",frame:{headingStroke:"#42474D",headingFill:"#23262A",stroke:"#42474D",fill:"#151719",text:"#f2f2f2"},note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",frame:{headingStroke:"#075797",headingFill:"#142839",stroke:"#075797",fill:"#0B1823",text:"#f2f2f2"},note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",frame:{headingStroke:"#1C5427",headingFill:"#18251A",stroke:"#1C5427",fill:"#0F1911",text:"#f2f2f2"},note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",frame:{headingStroke:"#6f3232",headingFill:"#341818",stroke:"#6f3232",fill:"#181212",text:"#f2f2f2"},note:{fill:"#7a3333",text:"#f2f2f2"},semi:"#3c2b2b",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",frame:{headingStroke:"#6c367a",headingFill:"#2D2230",stroke:"#6c367a",fill:"#1C151E",text:"#f2f2f2"},note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",frame:{headingStroke:"#773a0e",headingFill:"#2f1d13",stroke:"#773a0e",fill:"#1c1512",text:"#f2f2f2"},note:{fill:"#7c3905",text:"#f2f2f2"},semi:"#3b2e27",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",frame:{headingStroke:"#701e1e",headingFill:"#301616",stroke:"#701e1e",fill:"#1b1313",text:"#f2f2f2"},note:{fill:"#7e201f",text:"#f2f2f2"},semi:"#382726",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",frame:{headingStroke:"#6d1583",headingFill:"#27152e",stroke:"#6d1583",fill:"#1b0f21",text:"#f2f2f2"},note:{fill:"#5f1c70",text:"#f2f2f2"},semi:"#342938",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",frame:{headingStroke:"#684e12",headingFill:"#2a2113",stroke:"#684e12",fill:"#1e1911",text:"#f2f2f2"},note:{fill:"#8a5e1c",text:"#f2f2f2"},semi:"#3b352b",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",frame:{headingStroke:"#ffffff",headingFill:"#ffffff",stroke:"#ffffff",fill:"#ffffff",text:"#000000"},note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function getDefaultColorTheme(e){return e.isDarkMode?b.darkMode:b.lightMode}let S=StyleProp.defineEnum("tldraw:color",{defaultValue:"black",values:y}),v=StyleProp.defineEnum("tldraw:labelColor",{defaultValue:"black",values:y}),k=StyleProp.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),_=StyleProp.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),C=StyleProp.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),E={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},M=StyleProp.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),P=StyleProp.defineEnum("tldraw:arrowKind",{defaultValue:"arc",values:["arc","elbow"]}),A=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],j=StyleProp.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:A}),D=StyleProp.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:A}),B={kind:P,labelColor:v,color:S,fill:_,dash:k,size:M,arrowheadStart:j,arrowheadEnd:D,font:C,start:a,end:a,bend:i.T.number,text:i.T.string,labelPosition:i.T.number,scale:i.T.nonZeroNumber,elbowMidPoint:i.T.number},F=createShapePropsMigrationIds("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5,AddElbow:6});function propsMigration(e){return createPropsMigration("shape","arrow",e)}let O=(0,d.w8)({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[propsMigration({id:F.AddLabelColor,up:e=>{e.labelColor="black"},down:"retired"}),propsMigration({id:F.AddIsPrecise,up:({start:e,end:t})=>{"binding"===e.type&&(e.isPrecise=!(.5===e.normalizedAnchor.x&&.5===e.normalizedAnchor.y)),"binding"===t.type&&(t.isPrecise=!(.5===t.normalizedAnchor.x&&.5===t.normalizedAnchor.y))},down:({start:e,end:t})=>{"binding"===e.type&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise),"binding"===t.type&&(t.isPrecise||(t.normalizedAnchor={x:.5,y:.5}),delete t.isPrecise)}}),propsMigration({id:F.AddLabelPosition,up:e=>{e.labelPosition=.5},down:e=>{delete e.labelPosition}}),{id:F.ExtractBindings,scope:"store",up:e=>{let t=Object.values(e).filter(e=>"shape"===e.typeName&&"arrow"===e.type);for(let n of t){let{start:t,end:r}=n.props;if("binding"===t.type){let r=createBindingId(),i={typeName:"binding",id:r,type:"arrow",fromId:n.id,toId:t.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:t.normalizedAnchor,isExact:t.isExact,isPrecise:t.isPrecise}};e[r]=i,n.props.start={x:0,y:0}}else delete n.props.start.type;if("binding"===r.type){let t=createBindingId(),i={typeName:"binding",id:t,type:"arrow",fromId:n.id,toId:r.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};e[t]=i,n.props.end={x:0,y:0}}else delete n.props.end.type}}},propsMigration({id:F.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}),propsMigration({id:F.AddElbow,up:e=>{e.kind="arc",e.elbowMidPoint=.5},down:e=>{delete e.kind,delete e.elbowMidPoint}})]}),R=i.T.literalEnum("center","edge-point","edge","none"),L={terminal:i.T.literalEnum("start","end"),normalizedAnchor:a,isExact:i.T.boolean,isPrecise:i.T.boolean,snap:R},N=createBindingPropsMigrationIds("arrow",{AddSnap:1}),z={sequence:[{dependsOn:[F.ExtractBindings]},{id:N.AddSnap,up:e=>{e.snap="none"},down:e=>{delete e.snap}}]};var $=n(31316);let G=i.T.model("camera",i.T.object({typeName:i.T.literal("camera"),id:idValidator("camera"),x:i.T.number,y:i.T.number,z:i.T.number,meta:i.T.jsonValue})),W=(0,d.uj)("com.tldraw.camera",{AddMeta:1}),Z=(0,d.AV)({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:W.AddMeta,up:e=>{e.meta={}}}]}),q=(0,d.ju)("camera",{validator:G,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),Y=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),X=i.T.setEnum(Y),Q=i.T.object({type:X,rotation:i.T.number}),ee=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),et=i.T.setEnum(ee),en=new Set(["starting","paused","active","stopping"]),er=i.T.object({id:i.T.string,points:i.T.arrayOf(a),size:i.T.positiveNumber,color:et,opacity:i.T.number,state:i.T.setEnum(en),delay:i.T.number,shrink:i.T.number,taper:i.T.boolean}),ei=idValidator("page"),eo=i.T.model("page",i.T.object({typeName:i.T.literal("page"),id:ei,name:i.T.string,index:i.T.indexKey,meta:i.T.jsonValue})),ea=(0,d.uj)("com.tldraw.page",{AddMeta:1}),es=(0,d.AV)({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:ea.AddMeta,up:e=>{e.meta={}}}]}),el=(0,d.ju)("page",{validator:eo,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function isPageId(e){return el.isId(e)}let ed={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function pluckPreservingValues(e){return e?(0,r.H4)(e,e=>ed[e]):null}idValidator("instance");let ec=(0,d.uj)("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),eu=(0,d.AV)({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:ec.AddTransparentExportBgs,up:e=>({...e,exportBackground:!0})},{id:ec.RemoveDialog,up:({dialog:e,...t})=>t},{id:ec.AddToolLockMode,up:e=>({...e,isToolLocked:!1})},{id:ec.RemoveExtraPropsForNextShape,up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:Object.fromEntries(Object.entries(e).filter(([e])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(e)))})},{id:ec.AddLabelColor,up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:{...e,labelColor:"black"}})},{id:ec.AddFollowingUserId,up:e=>({...e,followingUserId:null})},{id:ec.RemoveAlignJustify,up:e=>{let t=e.propsForNextShape.align;return"justify"===t&&(t="start"),{...e,propsForNextShape:{...e.propsForNextShape,align:t}}}},{id:ec.AddZoom,up:e=>({...e,zoomBrush:null})},{id:ec.AddVerticalAlign,up:e=>({...e,propsForNextShape:{...e.propsForNextShape,verticalAlign:"middle"}})},{id:ec.AddScribbleDelay,up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e}},{id:ec.RemoveUserId,up:({userId:e,...t})=>t},{id:ec.AddIsPenModeAndIsGridMode,up:e=>({...e,isPenMode:!1,isGridMode:!1})},{id:ec.HoistOpacity,up:({propsForNextShape:{opacity:e,...t},...n})=>({...n,opacityForNextShape:Number(e??"1"),propsForNextShape:t})},{id:ec.AddChat,up:e=>({...e,chatMessage:"",isChatting:!1})},{id:ec.AddHighlightedUserIds,up:e=>({...e,highlightedUserIds:[]})},{id:ec.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:e,...t})=>({...t,stylesForNextShape:{}})},{id:ec.AddMeta,up:e=>({...e,meta:{}})},{id:ec.RemoveCursorColor,up:e=>{let{color:t,...n}=e.cursor;return{...e,cursor:n}}},{id:ec.AddLonelyProperties,up:e=>({...e,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:ec.ReadOnlyReadonly,up:({isReadOnly:e,...t})=>({...t,isReadonly:e})},{id:ec.AddHoveringCanvas,up:e=>({...e,isHoveringCanvas:null})},{id:ec.AddScribbles,up:({scribble:e,...t})=>({...t,scribbles:[]})},{id:ec.AddInset,up:e=>({...e,insets:[!1,!1,!1,!1]}),down:({insets:e,...t})=>({...t})},{id:ec.AddDuplicateProps,up:e=>({...e,duplicateProps:null}),down:({duplicateProps:e,...t})=>({...t})},{id:ec.RemoveCanMoveCamera,up:({canMoveCamera:e,...t})=>({...t}),down:e=>({...e,canMoveCamera:!0})}]}),eh="instance:instance",ep=i.T.model("instance_page_state",i.T.object({typeName:i.T.literal("instance_page_state"),id:idValidator("instance_page_state"),pageId:ei,selectedShapeIds:i.T.arrayOf(h),hintingShapeIds:i.T.arrayOf(h),erasingShapeIds:i.T.arrayOf(h),hoveredShapeId:h.nullable(),editingShapeId:h.nullable(),croppingShapeId:h.nullable(),focusedGroupId:h.nullable(),meta:i.T.jsonValue})),ef=(0,d.uj)("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),eg=(0,d.AV)({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:ef.AddCroppingId,up(e){e.croppingShapeId=null}},{id:ef.RemoveInstanceIdAndCameraId,up(e){delete e.instanceId,delete e.cameraId}},{id:ef.AddMeta,up:e=>{e.meta={}}},{id:ef.RenameProperties,up:e=>{},down:e=>{}},{id:ef.RenamePropertiesAgain,up:e=>{e.selectedShapeIds=e.selectedIds,delete e.selectedIds,e.hintingShapeIds=e.hintingIds,delete e.hintingIds,e.erasingShapeIds=e.erasingIds,delete e.erasingIds,e.hoveredShapeId=e.hoveredId,delete e.hoveredId,e.editingShapeId=e.editingId,delete e.editingId,e.croppingShapeId=e.croppingShapeId??e.croppingId??null,delete e.croppingId,e.focusedGroupId=e.focusLayerId,delete e.focusLayerId},down:e=>{e.selectedIds=e.selectedShapeIds,delete e.selectedShapeIds,e.hintingIds=e.hintingShapeIds,delete e.hintingShapeIds,e.erasingIds=e.erasingShapeIds,delete e.erasingShapeIds,e.hoveredId=e.hoveredShapeId,delete e.hoveredShapeId,e.editingId=e.editingShapeId,delete e.editingShapeId,e.croppingId=e.croppingShapeId,delete e.croppingShapeId,e.focusLayerId=e.focusedGroupId,delete e.focusedGroupId}}]}),em=(0,d.ju)("instance_page_state",{validator:ep,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),ey=i.T.model("pointer",i.T.object({typeName:i.T.literal("pointer"),id:idValidator("pointer"),x:i.T.number,y:i.T.number,lastActivityTimestamp:i.T.number,meta:i.T.jsonValue})),eb=(0,d.uj)("com.tldraw.pointer",{AddMeta:1}),ex=(0,d.AV)({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:eb.AddMeta,up:e=>{e.meta={}}}]}),ew=(0,d.ju)("pointer",{validator:ey,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),eS=ew.createId("pointer"),ev=i.T.model("instance_presence",i.T.object({typeName:i.T.literal("instance_presence"),id:idValidator("instance_presence"),userId:i.T.string,userName:i.T.string,lastActivityTimestamp:i.T.number.nullable(),followingUserId:i.T.string.nullable(),cursor:i.T.object({x:i.T.number,y:i.T.number,type:X,rotation:i.T.number}).nullable(),color:i.T.string,camera:i.T.object({x:i.T.number,y:i.T.number,z:i.T.number}).nullable(),screenBounds:l.nullable(),selectedShapeIds:i.T.arrayOf(idValidator("shape")),currentPageId:idValidator("page"),brush:l.nullable(),scribbles:i.T.arrayOf(er),chatMessage:i.T.string,meta:i.T.jsonValue})),eT=(0,d.uj)("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5,NullableCameraCursor:6}),ek=(0,d.AV)({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:eT.AddScribbleDelay,up:e=>{null!==e.scribble&&(e.scribble.delay=0)}},{id:eT.RemoveInstanceId,up:e=>{delete e.instanceId}},{id:eT.AddChatMessage,up:e=>{e.chatMessage=""}},{id:eT.AddMeta,up:e=>{e.meta={}}},{id:eT.RenameSelectedShapeIds,up:e=>{}},{id:eT.NullableCameraCursor,up:e=>{},down:e=>{null===e.camera&&(e.camera={x:0,y:0,z:1}),null===e.lastActivityTimestamp&&(e.lastActivityTimestamp=0),null===e.cursor&&(e.cursor={type:"default",x:0,y:0,rotation:0}),null===e.screenBounds&&(e.screenBounds={x:0,y:0,w:1,h:1})}}]}),e_=(0,d.ju)("instance_presence",{validator:ev,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:null,followingUserId:null,color:"#FF0000",camera:null,cursor:null,screenBounds:null,selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}}));function createPresenceStateDerivation(e,t){return n=>(0,$.Fl)("instancePresence",()=>{let r=e.get();if(!r)return null;let i=getDefaultUserPresence(n,r);return i?e_.create({...i,id:t??e_.createId(n.id)}):null})}function getDefaultUserPresence(e,t){let n=e.get(eh),r=e.get(em.createId(n?.currentPageId)),i=e.get(q.createId(n?.currentPageId)),o=e.get(eS);return r&&n&&i&&o?{selectedShapeIds:r.selectedShapeIds,brush:n.brush,scribbles:n.scribbles,userId:t.id,userName:t.name??"",followingUserId:n.followingUserId,camera:{x:i.x,y:i.y,z:i.z},color:t.color??"#FF0000",currentPageId:n.currentPageId,cursor:{x:o.x,y:o.y,rotation:n.cursor.rotation,type:n.cursor.type},lastActivityTimestamp:o.lastActivityTimestamp,screenBounds:n.screenBounds,chatMessage:n.chatMessage,meta:{}}:null}let eC=i.T.model("document",i.T.object({typeName:i.T.literal("document"),id:i.T.literal("document:document"),gridSize:i.T.number,name:i.T.string,meta:i.T.jsonValue}));function isDocument(e){return!!e&&"document"===e.typeName}let eI=(0,d.uj)("com.tldraw.document",{AddName:1,AddMeta:2}),eE=(0,d.AV)({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:eI.AddName,up:e=>{e.name=""},down:e=>{delete e.name}},{id:eI.AddMeta,up:e=>{e.meta={}}}]}),eM=(0,d.ju)("document",{validator:eC,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),eP=eM.createId("document");function sortByIndex(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function redactRecordForErrorReporting(e){"asset"===e.typeName&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}function onValidationFailure({error:e,phase:t,record:n,recordBefore:i}){throw(0,r.lw)(e,{tags:{origin:"store.validateRecord",storePhase:t,isExistingValidationIssue:"initialize"===t},extras:{recordBefore:i?redactRecordForErrorReporting((0,r.v4)(i)):void 0,recordAfter:redactRecordForErrorReporting((0,r.v4)(n))}}),e}function createIntegrityChecker(e){let t=e.query.ids("page"),n=e.query.records("instance_page_state"),ensureStoreIsUsable=()=>{if(!e.has(eP))return e.put([eM.create({id:eP,name:e.props.defaultName})]),ensureStoreIsUsable();if(!e.has(eS))return e.put([ew.create({id:eS})]),ensureStoreIsUsable();let r=t.get();if(0===r.size)return e.put([el.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]),ensureStoreIsUsable();let i=e.get(eh);if(!i)return e.put([e.schema.types.instance.create({id:eh,currentPageId:[...r].map(t=>e.get(t)).sort(sortByIndex)[0].id,exportBackground:!0})]),ensureStoreIsUsable();if(!r.has(i.currentPageId))return e.put([{...i,currentPageId:[...r].map(t=>e.get(t)).sort(sortByIndex)[0].id}]),ensureStoreIsUsable();let o=new Set,a=new Set;for(let t of r){let n=em.createId(t),r=e.get(n);r||o.add(n);let i=q.createId(t);e.has(i)||a.add(i)}o.size>0&&e.put([...o].map(e=>em.create({id:e,pageId:em.parseId(e)}))),a.size>0&&e.put([...a].map(e=>q.create({id:e})));let l=n.get();for(let t of l){if(!r.has(t.pageId)){e.remove([t.id]);continue}if(t.croppingShapeId&&!e.has(t.croppingShapeId))return e.put([{...t,croppingShapeId:null}]),ensureStoreIsUsable();if(t.focusedGroupId&&!e.has(t.focusedGroupId))return e.put([{...t,focusedGroupId:null}]),ensureStoreIsUsable();if(t.hoveredShapeId&&!e.has(t.hoveredShapeId))return e.put([{...t,hoveredShapeId:null}]),ensureStoreIsUsable();let n=t.selectedShapeIds.filter(t=>e.has(t));if(n.length!==t.selectedShapeIds.length)return e.put([{...t,selectedShapeIds:n}]),ensureStoreIsUsable();let i=t.hintingShapeIds.filter(t=>e.has(t));if(i.length!==t.hintingShapeIds.length)return e.put([{...t,hintingShapeIds:i}]),ensureStoreIsUsable();let o=t.erasingShapeIds.filter(t=>e.has(t));if(o.length!==t.erasingShapeIds.length)return e.put([{...t,erasingShapeIds:o}]),ensureStoreIsUsable()}};return ensureStoreIsUsable}let eA=createAssetValidator("bookmark",i.T.object({title:i.T.string,description:i.T.string,image:i.T.string,favicon:i.T.string,src:i.T.srcUrl.nullable()})),ej=(0,d.uj)("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),eD=(0,d.AV)({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:e=>"bookmark"===e.type,sequence:[{id:ej.MakeUrlsValid,up:e=>{i.T.srcUrl.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:ej.AddFavicon,up:e=>{i.T.srcUrl.isValid(e.props.favicon)||(e.props.favicon="")},down:e=>{delete e.props.favicon}}]}),eB=createAssetValidator("image",i.T.object({w:i.T.number,h:i.T.number,name:i.T.string,isAnimated:i.T.boolean,mimeType:i.T.string.nullable(),src:i.T.srcUrl.nullable(),fileSize:i.T.nonZeroNumber.optional()})),eF=(0,d.uj)("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),eO=(0,d.AV)({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:e=>"image"===e.type,sequence:[{id:eF.AddIsAnimated,up:e=>{e.props.isAnimated=!1},down:e=>{delete e.props.isAnimated}},{id:eF.RenameWidthHeight,up:e=>{e.props.w=e.props.width,e.props.h=e.props.height,delete e.props.width,delete e.props.height},down:e=>{e.props.width=e.props.w,e.props.height=e.props.h,delete e.props.w,delete e.props.h}},{id:eF.MakeUrlsValid,up:e=>{i.T.srcUrl.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:eF.AddFileSize,up:e=>{e.props.fileSize=-1},down:e=>{delete e.props.fileSize}},{id:eF.MakeFileSizeOptional,up:e=>{-1===e.props.fileSize&&(e.props.fileSize=void 0)},down:e=>{void 0===e.props.fileSize&&(e.props.fileSize=-1)}}]}),eR=createAssetValidator("video",i.T.object({w:i.T.number,h:i.T.number,name:i.T.string,isAnimated:i.T.boolean,mimeType:i.T.string.nullable(),src:i.T.srcUrl.nullable(),fileSize:i.T.number.optional()})),eL=(0,d.uj)("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),eU=(0,d.AV)({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:e=>"video"===e.type,sequence:[{id:eL.AddIsAnimated,up:e=>{e.props.isAnimated=!1},down:e=>{delete e.props.isAnimated}},{id:eL.RenameWidthHeight,up:e=>{e.props.w=e.props.width,e.props.h=e.props.height,delete e.props.width,delete e.props.height},down:e=>{e.props.width=e.props.w,e.props.height=e.props.h,delete e.props.w,delete e.props.h}},{id:eL.MakeUrlsValid,up:e=>{i.T.srcUrl.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:eL.AddFileSize,up:e=>{e.props.fileSize=-1},down:e=>{delete e.props.fileSize}},{id:eL.MakeFileSizeOptional,up:e=>{-1===e.props.fileSize&&(e.props.fileSize=void 0)},down:e=>{void 0===e.props.fileSize&&(e.props.fileSize=-1)}}]}),eN=i.T.model("asset",i.T.union("type",{image:eB,video:eR,bookmark:eA})),ez=(0,d.uj)("com.tldraw.asset",{AddMeta:1}),eH=(0,d.AV)({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:ez.AddMeta,up:e=>{e.meta={}}}]}),e$=(0,d.ju)("asset",{validator:eN,scope:"document"}).withDefaultProperties(()=>({meta:{}})),eV={w:i.T.nonZeroNumber,h:i.T.nonZeroNumber,assetId:o.nullable(),url:i.T.linkUrl},eG=createShapePropsMigrationIds("bookmark",{NullAssetId:1,MakeUrlsValid:2}),eK={sequence:[{id:eG.NullAssetId,up:e=>{void 0===e.assetId&&(e.assetId=null)},down:"retired"},{id:eG.MakeUrlsValid,up:e=>{i.T.linkUrl.isValid(e.url)||(e.url="")},down:e=>{}}]},eW=i.T.object({type:i.T.literalEnum("free","straight"),points:i.T.arrayOf(a)}),eZ={color:S,fill:_,dash:k,size:M,segments:i.T.arrayOf(eW),isComplete:i.T.boolean,isClosed:i.T.boolean,isPen:i.T.boolean,scale:i.T.nonZeroNumber},eY=createShapePropsMigrationIds("draw",{AddInPen:1,AddScale:2}),eX={sequence:[{id:eY.AddInPen,up:e=>{let{points:t}=e.segments[0];if(0===t.length){e.isPen=!1;return}let n=!(0===t[0].z||.5===t[0].z);t[1]&&(n=n&&!(0===t[1].z||.5===t[1].z)),e.isPen=n},down:"retired"},{id:eY.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},eJ=/(^\/r\/[^/]+\/?$)/,eQ=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(t&&t.pathname.match(eJ))return e}},{hostnames:["figma.com"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(t&&t.pathname.match(/^\/embed\/?$/)){let e=t.searchParams.get("url");if(e)return e}}},{hostnames:["google.*"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(!t)return;let n=t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/);if(n&&t.searchParams.has("center")&&t.searchParams.get("zoom")){let e=t.searchParams.get("zoom"),[n,r]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${n},${r},${e}z`}}},{hostnames:["val.town"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e),n=t&&t.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(t){let[e,n,r]=t;return`https://codepen.io/${n}/pen/${r}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:e=>{let t=e.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(t){let[e,n]=t;return`https://scratch.mit.edu/projects/${n}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(!t)return;let n=t.hostname.replace(/^www./,"");if("youtube.com"===n){let e=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(e)return`https://www.youtube.com/watch?v=${e[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e),n=t?.searchParams.get("src");if(t?.pathname.match(/\/calendar\/embed/)&&n){t.pathname="/calendar/u/0";let e=Array.from(t.searchParams.keys());for(let n of e)t.searchParams.delete(n);return t.searchParams.set("cid",n),t.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/embed\/?$/)){t.pathname=t.pathname.replace(/\/embed$/,"/pub");let e=Array.from(t.searchParams.keys());for(let n of e)t.searchParams.delete(n);return t.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}}},{hostnames:["replit.com"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{hostnames:["felt.com"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(t&&"player.vimeo.com"===t.hostname){let e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(t&&t.hash.match(/#room=/))return e}},{hostnames:["observablehq.com"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);return t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","")}#cell-*`:t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`:void 0}},{hostnames:["desmos.com"],fromEmbedUrl:e=>{let t=(0,r.Ad)(e);if(t&&"www.desmos.com"===t.hostname&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===t.search&&""===t.hash)return e.replace("?embed","")}}],e0={w:i.T.nonZeroNumber,h:i.T.nonZeroNumber,url:i.T.string},e1=createShapePropsMigrationIds("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),e2={sequence:[{id:e1.GenOriginalUrlInEmbed,up:e=>{try{let t;let n=e.url,r=new URL(n).host.replace("www.","");for(let e of eQ)if(e.hostnames.includes(r))try{t=e.fromEmbedUrl(n)}catch(e){console.warn(e)}e.tmpOldUrl=e.url,e.url=t??""}catch{e.url="",e.tmpOldUrl=e.url}},down:"retired"},{id:e1.RemoveDoesResize,up:e=>{delete e.doesResize},down:"retired"},{id:e1.RemoveTmpOldUrl,up:e=>{delete e.tmpOldUrl},down:"retired"},{id:e1.RemovePermissionOverrides,up:e=>{delete e.overridePermissions},down:"retired"}]},e3={w:i.T.nonZeroNumber,h:i.T.nonZeroNumber,name:i.T.string,color:i.T.literalEnum(...S.values)},e5=createShapePropsMigrationIds("frame",{AddColorProp:1}),e4={sequence:[{id:e5.AddColorProp,up:e=>{e.color="black"},down:e=>{delete e.color}}]},e6=i.T.object({type:i.T.string,content:i.T.arrayOf(i.T.unknown)});function toRichText(e){let t=e.split("\n"),n=t.map(e=>e?{type:"paragraph",content:[{type:"text",text:e}]}:{type:"paragraph"});return{type:"doc",content:n}}let e7=StyleProp.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),e8=StyleProp.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),e9=StyleProp.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),te={geo:e9,dash:k,url:i.T.linkUrl,w:i.T.nonZeroNumber,h:i.T.nonZeroNumber,growY:i.T.positiveNumber,scale:i.T.nonZeroNumber,labelColor:v,color:S,fill:_,size:M,font:C,align:e7,verticalAlign:e8,richText:e6},tn=createShapePropsMigrationIds("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9,AddRichText:10}),ti={sequence:[{id:tn.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:tn.AddLabelColor,up:e=>{e.labelColor="black"},down:"retired"},{id:tn.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:tn.AddCheckBox,up:e=>{},down:"retired"},{id:tn.AddVerticalAlign,up:e=>{e.verticalAlign="middle"},down:"retired"},{id:tn.MigrateLegacyAlign,up:e=>{let t;switch(e.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}e.align=t},down:"retired"},{id:tn.AddCloud,up:e=>{},down:"retired"},{id:tn.MakeUrlsValid,up:e=>{i.T.linkUrl.isValid(e.url)||(e.url="")},down:e=>{}},{id:tn.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}},{id:tn.AddRichText,up:e=>{e.richText=toRichText(e.text),delete e.text}}]},to={},tl={sequence:[]},td={color:S,size:M,segments:i.T.arrayOf(eW),isComplete:i.T.boolean,isPen:i.T.boolean,scale:i.T.nonZeroNumber},tc=createShapePropsMigrationIds("highlight",{AddScale:1}),tu={sequence:[{id:tc.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},th=i.T.object({topLeft:a,bottomRight:a,isCircle:i.T.boolean.optional()}),tp={w:i.T.nonZeroNumber,h:i.T.nonZeroNumber,playing:i.T.boolean,url:i.T.linkUrl,assetId:o.nullable(),crop:th.nullable(),flipX:i.T.boolean,flipY:i.T.boolean,altText:i.T.string},tf=createShapePropsMigrationIds("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4,AddAltText:5}),tg={sequence:[{id:tf.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:tf.AddCropProp,up:e=>{e.crop=null},down:e=>{delete e.crop}},{id:tf.MakeUrlsValid,up:e=>{i.T.linkUrl.isValid(e.url)||(e.url="")},down:e=>{}},{id:tf.AddFlipProps,up:e=>{e.flipX=!1,e.flipY=!1},down:e=>{delete e.flipX,delete e.flipY}},{id:tf.AddAltText,up:e=>{e.altText=""},down:e=>{delete e.altText}}]},tm=StyleProp.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),ty=i.T.object({id:i.T.string,index:i.T.indexKey,x:i.T.number,y:i.T.number}),tb={color:S,dash:k,size:M,spline:tm,points:i.T.dict(i.T.string,ty),scale:i.T.nonZeroNumber},tx=createShapePropsMigrationIds("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),tw={sequence:[{id:tx.AddSnapHandles,up:e=>{for(let t of Object.values(e.handles))t.canSnap=!0},down:"retired"},{id:tx.RemoveExtraHandleProps,up:e=>{e.handles=(0,r.Ls)(Object.values(e.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:e=>{let t=Object.entries(e.handles).map(([e,t])=>({index:e,...t})).sort(r.hl);e.handles=Object.fromEntries(t.map((e,n)=>{let r=0===n?"start":n===t.length-1?"end":`handle:${e.index}`;return[r,{id:r,type:"vertex",canBind:!1,canSnap:!0,index:e.index,x:e.x,y:e.y}]}))}},{id:tx.HandlesToPoints,up:e=>{let t=Object.entries(e.handles).map(([e,{x:t,y:n}])=>({x:t,y:n,index:e})).sort(r.hl);e.points=t.map(({x:e,y:t})=>({x:e,y:t})),delete e.handles},down:e=>{let t=(0,r.H$)(e.points.length);e.handles=Object.fromEntries(e.points.map((e,n)=>{let r=t[n];return[r,{x:e.x,y:e.y}]})),delete e.points}},{id:tx.PointIndexIds,up:e=>{let t=(0,r.H$)(e.points.length);e.points=Object.fromEntries(e.points.map((e,n)=>{let r=t[n];return[r,{id:r,index:r,x:e.x,y:e.y}]}))},down:e=>{let t=Object.values(e.points).sort(r.hl);e.points=t.map(({x:e,y:t})=>({x:e,y:t}))}},{id:tx.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},tS={color:S,labelColor:v,size:M,font:C,fontSizeAdjustment:i.T.positiveNumber,align:e7,verticalAlign:e8,growY:i.T.positiveNumber,url:i.T.linkUrl,richText:e6,scale:i.T.nonZeroNumber},tv=createShapePropsMigrationIds("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8,AddRichText:9}),tT={sequence:[{id:tv.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:tv.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:tv.MigrateLegacyAlign,up:e=>{switch(e.align){case"start":e.align="start-legacy";return;case"end":e.align="end-legacy";return;default:e.align="middle-legacy";return}},down:"retired"},{id:tv.AddVerticalAlign,up:e=>{e.verticalAlign="middle"},down:"retired"},{id:tv.MakeUrlsValid,up:e=>{i.T.linkUrl.isValid(e.url)||(e.url="")},down:e=>{}},{id:tv.AddFontSizeAdjustment,up:e=>{e.fontSizeAdjustment=0},down:e=>{delete e.fontSizeAdjustment}},{id:tv.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}},{id:tv.AddLabelColor,up:e=>{e.labelColor="black"},down:e=>{delete e.labelColor}},{id:tv.AddRichText,up:e=>{e.richText=toRichText(e.text),delete e.text}}]},tk=StyleProp.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),t_={color:S,size:M,font:C,textAlign:tk,w:i.T.nonZeroNumber,richText:e6,scale:i.T.nonZeroNumber,autoSize:i.T.boolean},tC=createShapePropsMigrationIds("text",{RemoveJustify:1,AddTextAlign:2,AddRichText:3}),tI={sequence:[{id:tC.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:tC.AddTextAlign,up:e=>{e.textAlign=e.align,delete e.align},down:e=>{e.align=e.textAlign,delete e.textAlign}},{id:tC.AddRichText,up:e=>{e.richText=toRichText(e.text),delete e.text}}]},tE={w:i.T.nonZeroNumber,h:i.T.nonZeroNumber,time:i.T.number,playing:i.T.boolean,autoplay:i.T.boolean,url:i.T.linkUrl,assetId:o.nullable(),altText:i.T.string},tM=createShapePropsMigrationIds("video",{AddUrlProp:1,MakeUrlsValid:2,AddAltText:3,AddAutoplay:4}),tP={sequence:[{id:tM.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:tM.MakeUrlsValid,up:e=>{i.T.linkUrl.isValid(e.url)||(e.url="")},down:e=>{}},{id:tM.AddAltText,up:e=>{e.altText=""},down:e=>{delete e.altText}},{id:tM.AddAutoplay,up:e=>{e.autoplay=!0},down:e=>{delete e.autoplay}}]},tA=(0,d.uj)("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),tj=(0,d.w8)({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:tA.RemoveCodeAndIconShapeTypes,scope:"store",up:e=>{for(let[t,n]of(0,r.EP)(e))"shape"===n.typeName&&("icon"===n.type||"code"===n.type)&&delete e[t]}},{id:tA.AddInstancePresenceType,scope:"store",up(e){}},{id:tA.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:e=>{for(let[t,n]of(0,r.EP)(e))n.typeName.match(/^(user|user_presence)$/)&&delete e[t]}},{id:tA.RemoveUserDocument,scope:"store",up:e=>{for(let[t,n]of(0,r.EP)(e))n.typeName.match("user_document")&&delete e[t]}}]}),tD={arrow:{migrations:O,props:B},bookmark:{migrations:eK,props:eV},draw:{migrations:eX,props:eZ},embed:{migrations:e2,props:e0},frame:{migrations:e4,props:e3},geo:{migrations:ti,props:te},group:{migrations:tl,props:to},highlight:{migrations:tu,props:td},image:{migrations:tg,props:tp},line:{migrations:tw,props:tb},note:{migrations:tT,props:tS},text:{migrations:tI,props:t_},video:{migrations:tP,props:tE}},tB={arrow:{migrations:z,props:L}};function createTLSchema({shapes:e=tD,bindings:t=tB,migrations:n}={}){let o=new Map;for(let t of(0,r.UM)(e))for(let e of getShapePropKeysByStyle(t.props??{}).keys()){if(o.has(e.id)&&o.get(e.id)!==e)throw Error(`Multiple StyleProp instances with the same id: ${e.id}`);o.set(e.id,e)}let a=(0,d.ju)("shape",{scope:"document",validator:i.T.model("shape",i.T.union("type",(0,r.Fm)(e,(e,{props:t,meta:n})=>createShapeValidator(e,t,n))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}})),u=(0,d.ju)("binding",{scope:"document",validator:i.T.model("binding",i.T.union("type",(0,r.Fm)(t,(e,{props:t,meta:n})=>createBindingValidator(e,t,n))))}).withDefaultProperties(()=>({meta:{}})),h=function(e){let t={};for(let[n,r]of e)t[n]=i.T.optional(r);let n=i.T.model("instance",i.T.object({typeName:i.T.literal("instance"),id:idValidator("instance"),currentPageId:ei,followingUserId:i.T.string.nullable(),brush:l.nullable(),opacityForNextShape:c,stylesForNextShape:i.T.object(t),cursor:Q,scribbles:i.T.arrayOf(er),isFocusMode:i.T.boolean,isDebugMode:i.T.boolean,isToolLocked:i.T.boolean,exportBackground:i.T.boolean,screenBounds:l,insets:i.T.arrayOf(i.T.boolean),zoomBrush:l.nullable(),isPenMode:i.T.boolean,isGridMode:i.T.boolean,chatMessage:i.T.string,isChatting:i.T.boolean,highlightedUserIds:i.T.arrayOf(i.T.string),isFocused:i.T.boolean,devicePixelRatio:i.T.number,isCoarsePointer:i.T.boolean,isHoveringCanvas:i.T.boolean.nullable(),openMenus:i.T.arrayOf(i.T.string),isChangingStyle:i.T.boolean,isReadonly:i.T.boolean,meta:i.T.jsonValue,duplicateProps:i.T.object({shapeIds:i.T.arrayOf(idValidator("shape")),offset:i.T.object({x:i.T.number,y:i.T.number})}).nullable()}));return(0,d.ju)("instance",{validator:n,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:"undefined"==typeof window?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}(o);return d.sS.create({asset:e$,binding:u,camera:q,document:eM,instance:h,instance_page_state:em,page:el,instance_presence:e_,pointer:ew,shape:a},{migrations:[tj,eH,Z,eE,eu,eg,es,ek,ex,m,eD,eO,eU,...processPropsMigrations("shape",e),...processPropsMigrations("binding",t),...n??[]],onValidationFailure:onValidationFailure,createIntegrityChecker:createIntegrityChecker})}let tF=new Set(["vertex","virtual","create","clone"]),tO=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ms",label:"Bahasa Melayu"},{locale:"ca",label:"Catal\xe0"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xf1ol"},{locale:"tl",label:"Filipino"},{locale:"fr",label:"Fran\xe7ais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"nl",label:"Nederlands"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xeas - Brasil"},{locale:"pt-pt",label:"Portugu\xeas - Europeu"},{locale:"ro",label:"Rom\xe2n"},{locale:"sl",label:"Slovenina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"T\xfcrk\xe7e"},{locale:"el",label:""},{locale:"ru",label:""},{locale:"uk",label:""},{locale:"he",label:""},{locale:"ur",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ne",label:""},{locale:"mr",label:""},{locale:"hi-in",label:""},{locale:"bn",label:""},{locale:"pa",label:""},{locale:"gu-in",label:""},{locale:"ta",label:""},{locale:"te",label:""},{locale:"kn",label:""},{locale:"ml",label:""},{locale:"th",label:""},{locale:"km-kh",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}];function getDefaultTranslationLocale(){let e="undefined"!=typeof window?window.navigator.languages??["en"]:["en"];return function(e){for(let t of e){let e=function(e){let t=tO.find(t=>t.locale===e.toLowerCase());if(t)return t.locale;let[n,r]=e.split(/[-_]/).map(e=>e.toLowerCase());if(r){let e=tO.find(e=>e.locale===n);if(e)return e.locale}return n in tR?tR[n]:null}(t);if(e)return e}return"en"}(e)}let tR={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};(0,r.x2)("@tldraw/tlschema","3.15.4","esm")},70938:function(e,t,n){"use strict";let r,i,o,a;n.d(t,{Hj:function(){return M},IH:function(){return A},VU:function(){return j},B0:function(){return P},Jk:function(){return ExecutionQueue},P6:function(){return FileHelpers},Ee:function(){return Image},xe:function(){return MediaHelpers},aF:function(){return PerformanceTracker},bM:function(){return PngHelpers},x4:function(){return f},qB:function(){return q},_N:function(){return Timers},kM:function(){return WeakCache},R4:function(){return R},lw:function(){return annotateError},E8:function(){return areArraysShallowEqual},dn:function(){return areObjectsShallowEqual},hu:function(){return g},kP:function(){return m},ak:function(){return bind},ZL:function(){return clearLocalStorage},Xp:function(){return clearSessionStorage},oA:function(){return compact},Ds:function(){return debounce},D8:function(){return dedupe},Rv:function(){return deleteFromLocalStorage},F_:function(){return deleteFromSessionStorage},iP:function(){return exhaustiveSwitchError},he:function(){return fetch},H4:function(){return filterEntries},ch:function(){return fpsThrottle},nu:function(){return getChangedKeys},wi:function(){return getErrorAnnotations},lr:function(){return getFirstFromIterable},fp:function(){return getFromLocalStorage},Kk:function(){return getFromSessionStorage},Aq:function(){return getHashForBuffer},pT:function(){return getHashForObject},jK:function(){return getHashForString},_L:function(){return getIndexAbove},Xg:function(){return getIndexBelow},eI:function(){return getIndexBetween},H$:function(){return getIndices},vw:function(){return getIndicesAbove},dk:function(){return getIndicesBelow},Xv:function(){return getIndicesBetween},eg:function(){return getOwnProperty},vM:function(){return groupBy},nr:function(){return object_hasOwnProperty},VN:function(){return invLerp},$K:function(){return isDefined},Xy:function(){return c},sd:function(){return isEqualAllowingForFloatingPointErrors},A7:function(){return u},Bn:function(){return Z},GT:function(){return isNonNull},cF:function(){return isNonNullish},Z$:function(){return last},t7:function(){return lerp},L8:function(){return lns},Fm:function(){return mapObjectMapValues},UT:function(){return maxBy},Px:function(){return measureAverageDuration},P9:function(){return measureCbDuration},cR:function(){return measureDuration},Ct:function(){return mergeArraysAndReplaceDefaults},F:function(){return minBy},n:function(){return mockUniqueId},vm:function(){return modulate},ZT:function(){return noop},EP:function(){return objectMapEntries},Ls:function(){return objectMapFromEntries},GH:function(){return objectMapKeys},UM:function(){return objectMapValues},CE:function(){return omit},fP:function(){return omitFromStackTrace},uK:function(){return partition},un:function(){return promiseWithResolve},x2:function(){return registerTldrawLibraryVersion},TW:function(){return restoreUniqueId},XD:function(){return retry},Vk:function(){return rng},R8:function(){return rotateArray},Ad:function(){return safeParseUrl},_m:function(){return setInLocalStorage},sn:function(){return setInSessionStorage},_v:function(){return sleep},uv:function(){return sortById},hl:function(){return sortByIndex},b:function(){return stringEnum},v4:function(){return W},P2:function(){return h},Gf:function(){return throttleToNextFrame},jj:function(){return p},EL:function(){return uniqueId},LP:function(){return validateIndexKey},q4:function(){return warnDeprecatedGetter},O4:function(){return warnOnce}});let l="__TLDRAW_LIBRARY_VERSIONS__";function registerTldrawLibraryVersion(e,t,n){if(!e||!t||!n)throw Error("Missing name/version/module system in built version of tldraw library");let r=function(){if(globalThis[l])return globalThis[l];let e={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,l,{value:e,writable:!1,configurable:!1,enumerable:!1}),e}();if(r.versions.push({name:e,version:t,modules:n}),!r.scheduledNotice)try{r.scheduledNotice=setTimeout(()=>{r.scheduledNotice=null,checkLibraryVersions(r)},100)}catch{checkLibraryVersions(r)}}function checkLibraryVersions(e){if(!e.versions.length||e.didWarn)return;let t=e.versions.sort((e,t)=>compareVersions(e.version,t.version)),n=t[t.length-1].version,r=new Set,i=new Map;for(let e of t){if(i.has(e.name)){r.delete(e.name),entry(i,e.name,new Set).add(e.version);continue}e.version===n?r.add(e.name):(r.delete(e.name),entry(i,e.name,new Set).add(e.version))}if(i.size>0){let t=[`${format("[tldraw]",["bold","bgRed","textWhite"])} ${format("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${format(`v${n}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(r,e=>`  \u2022 \u2705 ${format(e,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(i,([e,t])=>{let r=Array.from(t).sort(compareVersions).map(e=>format(`v${e}`,e===n?["textGreen"]:["textRed"]));return`  \u2022 \u274C ${format(e,["bold"])} (${r.join(", ")})`})];console.log(t.join("\n")),e.didWarn=!0;return}let o=new Map;for(let e of t)entry(o,e.name,{version:e.version,modules:[]}).modules.push(e.modules);let a=new Map;for(let[e,t]of o)t.modules.length>1&&a.set(e,t);if(a.size>0){let t=[`${format("[tldraw]",["bold","bgRed","textWhite"])} ${format("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(a,([e,t])=>{let n=t.modules.map((e,t)=>"esm"===e?`      ${t+1}. ES Modules`:`      ${t+1}. CommonJS`).join("\n");return`  \u2022 \u274C ${format(e,["bold"])} v${t.version}: 
${n}`}),"","You should configure your bundler to only import one version of each library."];console.log(t.join("\n")),e.didWarn=!0;return}}function compareVersions(e,t){let n=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),r=t.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return n&&r?n[1]!==r[1]?Number(n[1])-Number(r[1]):n[2]!==r[2]?Number(n[2])-Number(r[2]):n[3]!==r[3]?Number(n[3])-Number(r[3]):n[4]&&r[4]?n[4].localeCompare(r[4]):n[4]?1:r[4]?-1:0:e.localeCompare(t)}let d={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function format(e,t=[]){return`\x1b[${t.map(e=>d[e]).join(";")}m${e}\x1b[m`}function entry(e,t,n){return e.has(t)?e.get(t):(e.set(t,n),n)}var c=n(99780),u=n(32818),h=n(26978),p=n(50528);function rotateArray(e,t){return e.map((n,r)=>e[(r+t)%e.length])}function dedupe(e,t){let n=[];n:for(let r of e){for(let e of n)if(t?t(r,e):r===e)continue n;n.push(r)}return n}function compact(e){return e.filter(e=>null!=e)}function last(e){return e[e.length-1]}function minBy(e,t){let n;let r=1/0;for(let i of e){let e=t(i);e<r&&(n=i,r=e)}return n}function maxBy(e,t){let n;let r=-1/0;for(let i of e){let e=t(i);e>r&&(n=i,r=e)}return n}function partition(e,t){let n=[],r=[];for(let i of e)t(i)?n.push(i):r.push(i);return[n,r]}function areArraysShallowEqual(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}function mergeArraysAndReplaceDefaults(e,t,n){let r=new Set(t.map(t=>t[e])),i=[];for(let t of n)r.has(t[e])||i.push(t);for(let e of t)i.push(e);return i}function omitFromStackTrace(e){let wrappedFn=(...t)=>{try{return e(...t)}catch(e){throw e instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(e,wrappedFn),e}};return wrappedFn}let noop=()=>{},f={ok:e=>({ok:!0,value:e}),err:e=>({ok:!1,error:e})};function exhaustiveSwitchError(e,t){let n=t&&e&&"object"==typeof e&&t in e?e[t]:e;throw Error(`Unknown switch case ${n}`)}let g=omitFromStackTrace((e,t)=>{if(!e)throw Error(t||"Assertion Error")}),m=omitFromStackTrace((e,t)=>{if(null==e)throw Error(t??"value must be defined");return e});function promiseWithResolve(){let e,t;let n=new Promise((n,r)=>{e=n,t=r});return Object.assign(n,{resolve:e,reject:t})}function sleep(e){return new Promise(t=>setTimeout(t,e))}/*!
 * MIT License: https://github.com/NoHomey/bind-decorator/blob/master/License
 * Copyright (c) 2016 Ivo Stratev
 */function bind(...e){if(2===e.length){let[t,n]=e;n.addInitializer(function(){g(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");let e=t.bind(this),r=Reflect.defineProperty(this,n.name,{value:e,writable:!0,configurable:!0});g(r,"Cannot bind a non-configurable class method.")})}else{let[t,n,r]=e;if(!r||"function"!=typeof r.value)throw TypeError(`Only methods can be decorated with @bind. <${n}> is not a method!`);return{configurable:!0,get(){let e=r.value.bind(this);return Object.defineProperty(this,n,{value:e,configurable:!0,writable:!0}),e}}}}let WeakCache=class WeakCache{items=new WeakMap;get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}};function debounce(e,t){let n;let fn=(...r)=>(n||((n={}).promise=new Promise((e,t)=>{n.resolve=e,n.reject=t})),clearTimeout(n.timeout),n.latestArgs=r,n.timeout=setTimeout(()=>{let t=n;n=void 0;try{t.resolve(e(...t.latestArgs))}catch(e){t.reject(e)}},t),n.promise);return fn.cancel=()=>{n&&clearTimeout(n.timeout)},fn}let y=new WeakMap;function annotateError(e,t){if("object"!=typeof e||null===e)return;let n=y.get(e);n||(n={tags:{},extras:{}},y.set(e,n)),t.tags&&(n.tags={...n.tags,...t.tags}),t.extras&&(n.extras={...n.extras,...t.extras})}function getErrorAnnotations(e){return y.get(e)??{tags:{},extras:{}}}let ExecutionQueue=class ExecutionQueue{constructor(e){this.timeout=e}queue=[];running=!1;isEmpty(){return 0===this.queue.length&&!this.running}async run(){if(!this.running)try{for(this.running=!0;this.queue.length;){let e=this.queue.shift();await e(),this.timeout&&await sleep(this.timeout)}}finally{this.running=!1}}async push(e){return new Promise((t,n)=>{this.queue.push(()=>Promise.resolve(e()).then(t).catch(n)),this.run()})}close(){this.queue=[]}};async function fetch(e,t){return window.fetch(e,{referrerPolicy:"strict-origin-when-cross-origin",...t})}let Image=(e,t)=>{let n=new window.Image(e,t);return n.referrerPolicy="strict-origin-when-cross-origin",n};let FileHelpers=class FileHelpers{static async dataUrlToArrayBuffer(e){return fetch(e).then(function(e){return e.arrayBuffer()})}static async urlToArrayBuffer(e){let t=await fetch(e);return await t.arrayBuffer()}static async urlToBlob(e){let t=await fetch(e);return await t.blob()}static async urlToDataUrl(e){if(e.startsWith("data:"))return e;let t=await FileHelpers.urlToBlob(e);return await FileHelpers.blobToDataUrl(t)}static async blobToDataUrl(e){return await new Promise((t,n)=>{if(e){let r=new FileReader;r.onload=()=>t(r.result),r.onerror=e=>n(e),r.onabort=e=>n(e),r.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((t,n)=>{if(e){let r=new FileReader;r.onload=()=>t(r.result),r.onerror=e=>n(e),r.onabort=e=>n(e),r.readAsText(e)}})}static rewriteMimeType(e,t){return e.type===t?e:e instanceof File?new File([e],e.name,{type:t}):new Blob([e],{type:t})}};function getHashForString(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)|0;return t+""}function getHashForObject(e){return getHashForString(JSON.stringify(e))}function getHashForBuffer(e){let t=new DataView(e),n=0;for(let e=0;e<t.byteLength;e++)n=(n<<5)-n+t.getUint8(e)|0;return n+""}function lns(e){let t=e.split("");return t.push(...t.splice(0,Math.round(t.length/5))),t.push(...t.splice(0,Math.round(t.length/4))),t.push(...t.splice(0,Math.round(t.length/3))),t.push(...t.splice(0,Math.round(t.length/2))),t.reverse().map(e=>+e?5>+e?5+ +e:+e>5?+e-5:e:e).join("")}/*!
 * MIT License: https://github.com/ai/nanoid/blob/main/LICENSE
 * Modified code originally from <https://github.com/ai/nanoid>
 * Copyright 2017 Andrey Sitnik <andrey@sitnik.ru>
 *
 * `nanoid` is currently only distributed as an ES module. Some tools (jest, playwright) don't
 * properly support ESM-only code yet, and tldraw itself is distributed as both an ES module and a
 * CommonJS module. By including nanoid here, we can make sure it works well in every environment
 * where tldraw is used. We can also remove some unused features like custom alphabets.
 */let b=globalThis.crypto;function nanoid(e=21){var t;t=e-=0,!r||r.length<t?(r=new Uint8Array(128*t),b.getRandomValues(r),i=0):i+t>r.length&&(b.getRandomValues(r),i=0),i+=t;let n="";for(let t=i-e;t<i;t++)n+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[t]];return n}let S=nanoid;function mockUniqueId(e){S=e}function restoreUniqueId(){S=nanoid}function uniqueId(e){return S(e)}function getFirstFromIterable(e){return e.values().next().value}var v=n(40263).Buffer;let isAvifAnimated=e=>{let t=new Uint8Array(e);return 44===t[3]};/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Jzef Sokoowski <j.k.sokolowski@gmail.com>
 */function getDataBlocksLength(e,t){let n=0;for(;e[t+n];)n+=e[t+n]+1;return n+1}/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */let k=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(k=new Int32Array(k));let crc=(e,t)=>{let n=0===t?0:-1^~~t;for(let t=0;t<e.length;t++)n=k[(n^e[t])&255]^n>>>8;return -1^n};let PngHelpers=class PngHelpers{static isPng(e,t){return 137===e.getUint8(t+0)&&80===e.getUint8(t+1)&&78===e.getUint8(t+2)&&71===e.getUint8(t+3)&&13===e.getUint8(t+4)&&10===e.getUint8(t+5)&&26===e.getUint8(t+6)&&10===e.getUint8(t+7)}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){let n={};if(!PngHelpers.isPng(e,t))throw Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){let r=t,i=e.getInt32(t);t+=4;let o=PngHelpers.getChunkType(e,t);if("IDAT"===o&&n[o]){t+=i+4+4;continue}if("IEND"===o)break;n[o]={start:r,dataOffset:t+4,size:i},t+=i+4+4}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){let n=PngHelpers.readChunks(e);return n[t]}static setPhysChunk(e,t=1,n){let r=46,i=0,o=PngHelpers.findChunk(e,"pHYs");o&&(r=o.start,i=o.size);let a=PngHelpers.findChunk(e,"IDAT");a&&(r=a.start,i=0);let l=new ArrayBuffer(21),d=new DataView(l);d.setUint32(0,9),d.setUint8(4,112),d.setUint8(5,72),d.setUint8(6,89),d.setUint8(7,115),d.setInt32(8,2835.5*t),d.setInt32(12,2835.5*t),d.setInt8(16,1);let c=new Uint8Array(l.slice(4,17));d.setInt32(17,crc(c));let u=e.buffer.slice(0,r),h=e.buffer.slice(r+i);return new Blob([u,l,h],n)}};let _=Object.freeze(["image/svg+xml"]),C=Object.freeze(["image/jpeg","image/png","image/webp"]),E=Object.freeze(["image/gif","image/apng","image/avif"]),M=Object.freeze([...C,..._,...E]),P=Object.freeze(["video/mp4","video/webm","video/quicktime"]),A=Object.freeze([...M,...P]),j=A.join(",");let MediaHelpers=class MediaHelpers{static loadVideo(e){return new Promise((t,n)=>{let r=document.createElement("video");r.onloadeddata=()=>t(r),r.onerror=e=>{console.error(e),n(Error("Could not load video"))},r.crossOrigin="anonymous",r.src=e})}static async getVideoFrameAsDataUrl(e,t=0){let n=promiseWithResolve(),r=!1,onReadyStateChanged=()=>{if(!r){if(!(e.readyState>=e.HAVE_METADATA))return;r=!0,e.currentTime=t}if(e.readyState>=e.HAVE_CURRENT_DATA){let t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;let r=t.getContext("2d");if(!r)throw Error("Could not get 2d context");r.drawImage(e,0,0),n.resolve(t.toDataURL())}},onError=e=>{console.error(e),n.reject(Error("Could not get video frame"))};e.addEventListener("loadedmetadata",onReadyStateChanged),e.addEventListener("loadeddata",onReadyStateChanged),e.addEventListener("canplay",onReadyStateChanged),e.addEventListener("seeked",onReadyStateChanged),e.addEventListener("error",onError),e.addEventListener("stalled",onError),onReadyStateChanged();try{return await n}finally{e.removeEventListener("loadedmetadata",onReadyStateChanged),e.removeEventListener("loadeddata",onReadyStateChanged),e.removeEventListener("canplay",onReadyStateChanged),e.removeEventListener("seeked",onReadyStateChanged),e.removeEventListener("error",onError),e.removeEventListener("stalled",onError)}}static getImageAndDimensions(e){return new Promise((t,n)=>{let r=Image();r.onload=()=>{let e;r.naturalWidth?e={w:r.naturalWidth,h:r.naturalHeight}:(document.body.appendChild(r),e={w:r.clientWidth,h:r.clientHeight},document.body.removeChild(r)),t({...e,image:r})},r.onerror=e=>{console.error(e),n(Error("Could not load image"))},r.crossOrigin="anonymous",r.referrerPolicy="strict-origin-when-cross-origin",r.style.visibility="hidden",r.style.position="absolute",r.style.opacity="0",r.style.zIndex="-9999",r.src=e})}static async getVideoSize(e){return MediaHelpers.usingObjectURL(e,async e=>{let t=await MediaHelpers.loadVideo(e);return{w:t.videoWidth,h:t.videoHeight}})}static async getImageSize(e){let{w:t,h:n}=await MediaHelpers.usingObjectURL(e,MediaHelpers.getImageAndDimensions);try{if("image/png"===e.type){let r=new DataView(await e.arrayBuffer());if(PngHelpers.isPng(r,0)){let e=PngHelpers.findChunk(r,"pHYs");if(e){let i=PngHelpers.parsePhys(r,e.dataOffset);if(0===i.unit&&i.ppux===i.ppuy){let e=Math.max(i.ppux/(72/.0254),1);return{w:Math.round(t/e),h:Math.round(n/e)}}}}}}catch(e){console.error(e)}return{w:t,h:n}}static async isAnimated(e){return"image/gif"===e.type?function(e){let t,n;let r=new Uint8Array(e),i=0,o=0;if(!function(e){let t=new TextDecoder("ascii"),n=t.decode(e.slice(0,3));return"GIF"===n}(e))return!1;for(t=128&r[10],n=7&r[10],i+=13+(t?3*Math.pow(2,n+1):0);o<2&&i<r.length;)switch(r[i]){case 44:o+=1,t=128&r[i+9],n=7&r[i+9],i+=10+(t?3*Math.pow(2,n+1):0),i+=getDataBlocksLength(r,i+1)+1;break;case 33:i+=2,i+=getDataBlocksLength(r,i);break;default:i=r.length}return o>1}(await e.arrayBuffer()):"image/avif"===e.type?isAvifAnimated(await e.arrayBuffer()):"image/webp"===e.type?function(e){let t=new Uint8Array(e);return!!t&&!(t.length<12)&&87===t[8]&&69===t[9]&&66===t[10]&&80===t[11]&&!!t&&!(t.length<21)&&(t[20]>>1&1)==1}(await e.arrayBuffer()):"image/apng"===e.type&&/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function(e){let t=new Uint8Array(e);if(!t||!(void 0!==v&&v.isBuffer(t)||t instanceof Uint8Array)||t.length<16)return!1;let n=137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7];if(!n)return!1;function indexOfSubstring(e,t,n,r,i=1024){if(!t)return -1;t=RegExp(t,"g");let o=t.source.length,a=new TextDecoder,l=e.length;if(void 0===r&&(r=l),n>=l||r<=0||n>=r)return -1;e=e.subarray(n,r);let d=-1,c=0,u=0,h="";e:for(;c<e.length;){let n;let r=c+i,l=e.subarray(c,r),p=a.decode(l,{stream:!0}),f=h+p,g=-1;for(;null!==(n=t.exec(f));){d=u+(g=n.index-h.length);break e}c=r,u+=p.length;let m=g>-1?g+o:p.length-o;h=p.slice(m)}return d>=0&&(d+=n>=0?n:l+n),d}let r=indexOfSubstring(t,"IDAT",12);if(r>=12){let e=indexOfSubstring(t,"acTL",8,r);return e>=8}return!1}(await e.arrayBuffer())}static isAnimatedImageType(e){return E.includes(e||"")}static isStaticImageType(e){return C.includes(e||"")}static isVectorImageType(e){return _.includes(e||"")}static isImageType(e){return M.includes(e||"")}static async usingObjectURL(e,t){let n=URL.createObjectURL(e);try{return await t(n)}finally{URL.revokeObjectURL(n)}}};function lerp(e,t,n){return e+(t-e)*n}function invLerp(e,t,n){return(n-e)/(t-e)}function rng(e=""){let t=0,n=0,r=0,i=0;function next(){let e=t^t<<11;return t=n,n=r,r=i,(i^=(i>>>19^e^e>>>8)>>>0)/4294967296*2}for(let n=0;n<e.length+64;n++)t^=0|e.charCodeAt(n),next();return next}function modulate(e,t,n,r=!1){let[i,o]=t,[a,l]=n,d=a+(e-i)/(o-i)*(l-a);return r?a<l?Math.max(Math.min(d,l),a):Math.max(Math.min(d,a),l):d}function object_hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function getOwnProperty(e,t){if(object_hasOwnProperty(e,t))return e[t]}function objectMapKeys(e){return Object.keys(e)}function objectMapValues(e){return Object.values(e)}function objectMapEntries(e){return Object.entries(e)}function objectMapFromEntries(e){return Object.fromEntries(e)}function filterEntries(e,t){let n={},r=!1;for(let[i,o]of objectMapEntries(e))t(i,o)?n[i]=o:r=!0;return r?n:e}function mapObjectMapValues(e,t){let n={};for(let[r,i]of objectMapEntries(e)){let e=t(r,i);n[r]=e}return n}function areObjectsShallowEqual(e,t){if(e===t)return!0;let n=new Set(Object.keys(e)),r=new Set(Object.keys(t));if(n.size!==r.size)return!1;for(let i of n)if(!r.has(i)||!Object.is(e[i],t[i]))return!1;return!0}function groupBy(e,t){let n={};for(let r of e){let e=t(r);n[e]||(n[e]=[]),n[e].push(r)}return n}function omit(e,t){let n={...e};for(let e of t)delete n[e];return n}function getChangedKeys(e,t){let n=[];for(let r in e)Object.is(e[r],t[r])||n.push(r);return n}function isEqualAllowingForFloatingPointErrors(e,t,n=1e-6){return u(e,t,(e,t)=>{if("number"==typeof e&&"number"==typeof t)return Math.abs(e-t)<n})}let D={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},B=D.Good;function measureCbDuration(e,t){let n=performance.now(),r=t();return console.debug(`%cPerf%c ${e} took ${performance.now()-n}ms`,`color: white; background: ${B};padding: 2px;border-radius: 3px;`,"font-weight: normal"),r}function measureDuration(e,t,n){let r=n.value;return n.value=function(...e){let n=performance.now(),i=r.apply(this,e);return console.debug(`%cPerf%c ${t} took: ${performance.now()-n}ms`,`color: white; background: ${B};padding: 2px;border-radius: 3px;`,"font-weight: normal"),i},n}let F=new Map;function measureAverageDuration(e,t,n){let r=n.value;return n.value=function(...e){let i=performance.now(),o=r.apply(this,e),a=performance.now(),l=a-i;if(0!==l){let e=F.get(n.value),r=e.total+l,o=e.count+1;F.set(n.value,{total:r,count:o}),console.debug(`%cPerf%c ${t} took ${(a-i).toFixed(2)}ms | average ${(r/o).toFixed(2)}ms`,`color: white; background: ${B};padding: 2px;border-radius: 3px;`,"font-weight: normal")}return o},F.set(n.value,{total:0,count:0}),n}let PerformanceTracker=class PerformanceTracker{startTime=0;name="";frames=0;started=!1;frame=null;recordFrame=()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))};start(e){this.name=e,this.frames=0,this.started=!0,null!==this.frame&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,null!==this.frame&&cancelAnimationFrame(this.frame);let e=(performance.now()-this.startTime)/1e3,t=0===e?0:Math.floor(this.frames/e),n=t>55?D.Good:t>30?D.Mid:D.Poor,r=n===D.Mid?"black":"white",i=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${i} %c${t}%c fps`,`color: white; background: ${B};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${n};color: ${r};`,"font-weight: normal")}isStarted(){return this.started}};var O=null;function base62CharSet(){return O||(O=function(e){let t=function(e){let t={},n={},r=e.length;for(let i=0;i<r;i++){let r=e[i];t[i]=r,n[r]=i}return{byCode:t,byChar:n,length:r}}(e.chars),n=function(e,t,n,r){let i=t?e.byChar[t]:Math.ceil(e.length/2),o=n?e.byChar[n]:e.length-1,a=r?e.byChar[r]:0;if(void 0===i||void 0===o||void 0===a)throw Error("invalid charSet");if(o-i<3)throw Error("mostPositive must be at least 3 characters away from neutral");if(i-a<3)throw Error("mostNegative must be at least 3 characters away from neutral");return{firstPositive:e.byCode[i],mostPositive:e.byCode[o],firstNegative:e.byCode[i-1],mostNegative:e.byCode[a]}}(t,e.firstPositive,e.mostPositive,e.mostNegative),r=e.jitterRange??Math.floor(Math.pow(t.length,3)/5),i=function(e,t){let n={};for(let r=0;r<100&&(n[r]=Math.pow(t,r),!(n[r]>e));r++);return n}(r,t.length);return{chars:e.chars,byChar:t.byChar,byCode:t.byCode,length:t.length,first:t.byCode[0],last:t.byCode[t.length-1],firstPositive:n.firstPositive,mostPositive:n.mostPositive,firstNegative:n.firstNegative,mostNegative:n.mostNegative,jitterRange:r,paddingDict:i}}({chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",firstPositive:"a",mostPositive:"z",mostNegative:"A"}))}function distanceBetween(e,t,n){let r=n.byChar[e],i=n.byChar[t];return Math.abs(r-i)}function integerLength(e,t){let n=e[0];if(n>t.mostPositive||n<t.mostNegative)throw Error("invalid firstChar on key");if(n===t.mostPositive){let r=distanceBetween(n,t.firstPositive,t)+1;return r+integerLengthFromSecondLevel(e.slice(1),"positive",t)}if(n===t.mostNegative){let r=distanceBetween(n,t.firstNegative,t)+1;return r+integerLengthFromSecondLevel(e.slice(1),"negative",t)}let r=n>=t.firstPositive;return r?distanceBetween(n,t.firstPositive,t)+2:distanceBetween(n,t.firstNegative,t)+2}function integerLengthFromSecondLevel(e,t,n){let r=e[0];if(r>n.mostPositive||r<n.mostNegative)throw Error("invalid firstChar on key");if(r===n.mostPositive&&"positive"===t){let i=distanceBetween(r,n.mostNegative,n)+1;return i+integerLengthFromSecondLevel(e.slice(1),t,n)}if(r===n.mostNegative&&"negative"===t){let i=distanceBetween(r,n.mostPositive,n)+1;return i+integerLengthFromSecondLevel(e.slice(1),t,n)}return"positive"===t?distanceBetween(r,n.mostNegative,n)+2:distanceBetween(r,n.mostPositive,n)+2}function makeSameLength(e,t,n,r,i){let o=i??Math.max(e.length,t.length);return"start"===n?[e.padStart(o,r),t.padStart(o,r)]:[e.padEnd(o,r),t.padEnd(o,r)]}function lexicalDistance(e,t,n){let[r,i]=makeSameLength(e,t,"end",n.first).sort(),o=subtractCharSetKeys(i,r,n);return function(e,t){let n=0,r=e.length,i=t.length;for(let o=0;o<r;o++)n+=t.byChar[e[o]]*Math.pow(i,r-o-1);return n}(o,n)}function addCharSetKeys(e,t,n){let r=n.length,[i,o]=makeSameLength(e,t,"start",n.first),a=[],l=0;for(let e=i.length-1;e>=0;e--){let t=n.byChar[i[e]],d=n.byChar[o[e]],c=t+d+l;l=Math.floor(c/r);let u=c%r;a.unshift(n.byCode[u])}return l>0&&a.unshift(n.byCode[l]),a.join("")}function subtractCharSetKeys(e,t,n,r=!0){let i=n.length,[o,a]=makeSameLength(e,t,"start",n.first),l=[],d=0;for(let e=o.length-1;e>=0;e--){let t=n.byChar[o[e]],r=n.byChar[a[e]]+d;t<r?(d=1,t+=i):d=0;let c=t-r;l.unshift(n.byCode[c])}if(d>0)throw Error("Subtraction result is negative. Ensure a is greater than or equal to b.");for(;r&&l.length>1&&l[0]===n.first;)l.shift();return l.join("")}function incrementKey(e,t){return addCharSetKeys(e,t.byCode[1],t)}function decrementKey(e,t){return subtractCharSetKeys(e,t.byCode[1],t,!1)}function encodeToCharSet(e,t){if(0===e)return t.byCode[0];let n="",r=t.length;for(;e>0;)n=t.byCode[e%r]+n,e=Math.floor(e/r);return n}function getIntegerPart(e,t){let n=integerHead(e,t),r=integerLength(n,t);if(r>e.length)throw Error("invalid order key length: "+e);return e.slice(0,r)}function validateInteger(e,t){if(!function(e,t){let n=integerLength(e,t);return n===e.length}(e,t))throw Error("invalid integer length: "+e)}function incrementInteger(e,t){validateInteger(e,t);let[n,r]=splitInteger(e,t),i=r.split("").some(e=>e!==t.byCode[t.length-1]);if(i){let e=incrementKey(r,t);return n+e}let o=function(e,t){let n=e>=t.firstPositive,r=incrementKey(e,t),i=e[e.length-1]===t.mostPositive,o=r[r.length-1]===t.mostPositive;return n&&o?r+t.mostNegative:!n&&i?e.slice(0,e.length-1):r}(n,t);return startOnNewHead(o,"lower",t)}function integerHead(e,t){let n=0;if(e[0]===t.mostPositive)for(;e[n]===t.mostPositive;)n+=1;if(e[0]===t.mostNegative)for(;e[n]===t.mostNegative;)n+=1;return e.slice(0,n+1)}function splitInteger(e,t){let n=integerHead(e,t),r=e.slice(n.length);return[n,r]}function startOnNewHead(e,t,n){let r=integerLength(e,n),i="upper"===t?n.byCode[n.length-1]:n.byCode[0];return e+i.repeat(r-e.length)}function jitterString(e,t){let n=encodeToCharSet(Math.floor(Math.random()*t.jitterRange),t);return addCharSetKeys(e,n,t)}function paddingNeededForDistance(e,t){let n=t.jitterRange-e,r=Object.entries(t.paddingDict).find(([e,t])=>t>n);return r?parseInt(r[0]):0}function generateJitteredKeyBetween(e,t,n=base62CharSet()){let r=function(e,t,n=base62CharSet()){if(null!==e&&getIntegerPart(e,n),null!==t&&getIntegerPart(t,n),null===e&&null===t)return n.firstPositive+n.byCode[0];if(null===e){let e=getIntegerPart(t,n);return function(e,t){validateInteger(e,t);let[n,r]=splitInteger(e,t),i=r.split("").some(e=>e!==t.byCode[0]);if(i){let e=decrementKey(r,t);return n+e}let o=function(e,t){let n=e>=t.firstPositive,r=e[e.length-1]===t.mostNegative;if(n&&r){let n=e.slice(0,e.length-1);return decrementKey(n,t)}return!n&&r?e+t.mostPositive:decrementKey(e,t)}(n,t);return startOnNewHead(o,"upper",t)}(e,n)}if(null===t){let t=getIntegerPart(e,n);return incrementInteger(t,n)}if(e>=t)throw Error(e+" >= "+t);return function(e,t,n){let[r,i]=makeSameLength(e,t,"end",n.first),o=lexicalDistance(r,i,n);1===o&&(r=r.padEnd(r.length+1,n.first),o=n.length);let a=encodeToCharSet(Math.floor(o/2),n);return addCharSetKeys(r,a,n)}(e,t,n)}(e,t,n),i=function(e,t,n){let r=getIntegerPart(e,n),i=incrementInteger(r,n),o=0;if(null!==t){let r=lexicalDistance(e,t,n);r<n.jitterRange+1&&(o=Math.max(o,paddingNeededForDistance(r,n)))}let a=lexicalDistance(e,i,n);return a<n.jitterRange+1&&(o=Math.max(o,paddingNeededForDistance(a,n))),o}(r,t,n);return i?function(e,t,n){let r=e.padEnd(e.length+t,n.first);return jitterString(r,n)}(r,i,n):jitterString(r,n)}let generateKeysFn=function generateNJitteredKeysBetween(e,t,n,r=base62CharSet()){return function(e,t,n,r,i,o){if(0===n)return[];if(1===n)return[i(e,t,r)];if(null==t){let o=i(e,t,r),a=[o];for(let e=0;e<n-1;e++)a.push(o=i(o,t,r));return a}if(null==e){let o=i(e,t,r),a=[o];for(let t=0;t<n-1;t++)a.push(o=i(e,o,r));return a.reverse(),a}let a=Math.floor(n/2),l=i(e,t,r);return[...o(e,l,a,r),l,...o(l,t,n-a-1,r)]}(e,t,n,r,generateJitteredKeyBetween,generateNJitteredKeysBetween)},R="a0";function validateIndexKey(e){try{generateJitteredKeyBetween(e,null)}catch{throw Error("invalid index: "+e)}}function getIndicesBetween(e,t,n){return generateKeysFn(e??null,t??null,n)}function getIndicesAbove(e,t){return generateKeysFn(e??null,null,t)}function getIndicesBelow(e,t){return generateKeysFn(null,e??null,t)}function getIndexBetween(e,t){return generateKeysFn(e??null,t??null,1)[0]}function getIndexAbove(e=null){return generateKeysFn(e,null,1)[0]}function getIndexBelow(e=null){return generateKeysFn(null,e,1)[0]}function getIndices(e,t="a1"){return[t,...generateKeysFn(t,null,e)]}function sortByIndex(e,t){return e.index<t.index?-1:e.index>t.index?1:0}async function retry(e,{attempts:t=3,waitDuration:n=1e3,abortSignal:r,matchError:i}={}){let o=null;for(let a=0;a<t;a++){if(r?.aborted)throw Error("aborted");try{return await e()}catch(e){if(i&&!i(e))throw e;o=e,await sleep(n)}}throw o}function sortById(e,t){return e.id>t.id?1:-1}function getFromLocalStorage(e){try{return localStorage.getItem(e)}catch{return null}}function setInLocalStorage(e,t){try{localStorage.setItem(e,t)}catch{}}function deleteFromLocalStorage(e){try{localStorage.removeItem(e)}catch{}}function clearLocalStorage(){try{localStorage.clear()}catch{}}function getFromSessionStorage(e){try{return sessionStorage.getItem(e)}catch{return null}}function setInSessionStorage(e,t){try{sessionStorage.setItem(e,t)}catch{}}function deleteFromSessionStorage(e){try{sessionStorage.removeItem(e)}catch{}}function clearSessionStorage(){try{sessionStorage.clear()}catch{}}function stringEnum(...e){let t={};for(let n of e)t[n]=n;return t}var L=n(25566);let isTest=()=>void 0!==L&&!1,N=[],z=.9*Math.floor(16.666666666666668),$=-z,flush=()=>{let e=N.splice(0,N.length);for(let t of e)t()};function tick(e=!1){if(o)return;let t=Date.now(),n=t-$;if(n<z){o=requestAnimationFrame(()=>{o=void 0,tick(!0)});return}if(e){if(a)return;$=t,flush()}else{if(a)return;a=requestAnimationFrame(()=>{a=void 0,$=t,flush()})}}function fpsThrottle(e){if(isTest())return e.cancel=()=>{o&&(cancelAnimationFrame(o),o=void 0),a&&(cancelAnimationFrame(a),a=void 0)},e;let throttledFn=()=>{N.includes(e)||(N.push(e),tick())};return throttledFn.cancel=()=>{let t=N.indexOf(e);t>-1&&N.splice(t,1)},throttledFn}function throttleToNextFrame(e){return isTest()?(e(),()=>void 0):(N.includes(e)||(N.push(e),tick()),()=>{let t=N.indexOf(e);t>-1&&N.splice(t,1)})}let Timers=class Timers{timeouts=new Map;intervals=new Map;rafs=new Map;constructor(){this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(e,t,n,...r){let i=window.setTimeout(t,n,r),o=this.timeouts.get(e)??[];return this.timeouts.set(e,[...o,i]),i}setInterval(e,t,n,...r){let i=window.setInterval(t,n,r),o=this.intervals.get(e)??[];return this.intervals.set(e,[...o,i]),i}requestAnimationFrame(e,t){let n=window.requestAnimationFrame(t),r=this.rafs.get(e)??[];return this.rafs.set(e,[...r,n]),n}dispose(e){this.timeouts.get(e)?.forEach(e=>clearTimeout(e)),this.intervals.get(e)?.forEach(e=>clearInterval(e)),this.rafs.get(e)?.forEach(e=>cancelAnimationFrame(e)),this.timeouts.delete(e),this.intervals.delete(e),this.rafs.delete(e)}disposeAll(){for(let e of this.timeouts.keys())this.dispose(e)}forContext(e){return{setTimeout:(t,n,...r)=>this.setTimeout(e,t,n,r),setInterval:(t,n,...r)=>this.setInterval(e,t,n,r),requestAnimationFrame:t=>this.requestAnimationFrame(e,t),dispose:()=>this.dispose(e)}}};let safeParseUrl=(e,t)=>{try{return new URL(e,t)}catch{return}};function isDefined(e){return void 0!==e}function isNonNull(e){return null!==e}function isNonNullish(e){return null!=e}let G="undefined"!=typeof globalThis&&globalThis.structuredClone?[globalThis.structuredClone,!0]:"undefined"!=typeof global&&global.structuredClone?[global.structuredClone,!0]:"undefined"!=typeof window&&window.structuredClone?[window.structuredClone,!0]:[e=>e?JSON.parse(JSON.stringify(e)):e,!1],W=G[0],Z=G[1],q=Object.getPrototypeOf(W({})),Y=new Set;function warnDeprecatedGetter(e){warnOnce(`Using '${e}' is deprecated and will be removed in the near future. Please refactor to use 'get${e[0].toLocaleUpperCase()}${e.slice(1)}' instead.`)}function warnOnce(e){Y.has(e)||(Y.add(e),console.warn(`[tldraw] ${e}`))}registerTldrawLibraryVersion("@tldraw/utils","3.15.4","esm")},45958:function(e,t,n){"use strict";n.d(t,{UR:function(){return ArrayOfValidator},oy:function(){return DictValidator},kx:function(){return ObjectValidator},T:function(){return r},zr:function(){return UnionValidator},cX:function(){return Validator}});var r={};n.r(r),n.d(r,{ArrayOfValidator:function(){return ArrayOfValidator},DictValidator:function(){return DictValidator},ObjectValidator:function(){return ObjectValidator},UnionValidator:function(){return UnionValidator},ValidationError:function(){return ValidationError},Validator:function(){return Validator},any:function(){return a},array:function(){return y},arrayOf:function(){return arrayOf},bigint:function(){return m},boolean:function(){return g},dict:function(){return dict},httpUrl:function(){return E},indexKey:function(){return M},integer:function(){return h},jsonDict:function(){return jsonDict},jsonValue:function(){return S},linkUrl:function(){return k},literal:function(){return literal},literalEnum:function(){return literalEnum},model:function(){return model},nonZeroInteger:function(){return f},nonZeroNumber:function(){return u},nullable:function(){return nullable},number:function(){return d},numberUnion:function(){return numberUnion},object:function(){return object},optional:function(){return optional},or:function(){return or},positiveInteger:function(){return p},positiveNumber:function(){return c},setEnum:function(){return setEnum},srcUrl:function(){return C},string:function(){return l},union:function(){return union},unknown:function(){return o},unknownObject:function(){return b}});var i=n(70938);let ValidationError=class ValidationError extends Error{constructor(e,t=[]){let n=function(e){if(!e.length)return null;let t="";for(let n of e)"number"==typeof n?t+=`.${n}`:n.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${n.slice(1)}`:t+=n:t+=`.${n}`;return(t=t.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,"")).startsWith(".")?t.slice(1):t}(t),r=e.split("\n").map((e,t)=>0===t?e:`  ${e}`).join("\n");super(t?`At ${n}: ${r}`:r),this.rawMessage=e,this.path=t}name="ValidationError"};function prefixError(e,t){try{return t()}catch(t){if(t instanceof ValidationError)throw new ValidationError(t.rawMessage,[e,...t.path]);throw new ValidationError(t.toString(),[e])}}function typeToString(e){if(null===e)return"null";if(Array.isArray(e))return"an array";let t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:(0,i.iP)(t)}}let Validator=class Validator{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){let t=this.validationFn(e);return t}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return nullable(this)}optional(){return optional(this)}refine(e){return new Validator(t=>e(this.validate(t)),(t,n)=>{let r=this.validateUsingKnownGoodVersion(t,n);return Object.is(t,r)?t:e(r)})}check(e,t){return"string"==typeof e?this.refine(n=>(prefixError(`(check ${e})`,()=>t(n)),n)):this.refine(t=>(e(t),t))}};let ArrayOfValidator=class ArrayOfValidator extends Validator{constructor(e){super(t=>{let n=y.validate(t);for(let t=0;t<n.length;t++)prefixError(t,()=>e.validate(n[t]));return n},(t,n)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(n);let r=y.validate(n),i=t.length!==r.length;for(let n=0;n<r.length;n++){let o=r[n];if(n>=t.length){i=!0,prefixError(n,()=>e.validate(o));continue}if(Object.is(t[n],o))continue;let a=prefixError(n,()=>e.validateUsingKnownGoodVersion(t[n],o));Object.is(a,t[n])||(i=!0)}return i?n:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(0===e.length)throw new ValidationError("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new ValidationError("Expected an array with length greater than 1")})}};let ObjectValidator=class ObjectValidator extends Validator{constructor(e,t=!1){super(n=>{if("object"!=typeof n||null===n)throw new ValidationError(`Expected object, got ${typeToString(n)}`);for(let[t,r]of Object.entries(e))prefixError(t,()=>{r.validate((0,i.eg)(n,t))});if(!t){for(let t of Object.keys(n))if(!(0,i.nr)(e,t))throw new ValidationError("Unexpected property",[t])}return n},(n,r)=>{if("object"!=typeof r||null===r)throw new ValidationError(`Expected object, got ${typeToString(r)}`);let o=!1;for(let[t,a]of Object.entries(e)){let e=(0,i.eg)(n,t),l=(0,i.eg)(r,t);if(Object.is(e,l))continue;let d=prefixError(t,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(e,l):a.validate(l));Object.is(d,e)||(o=!0)}if(!t){for(let t of Object.keys(r))if(!(0,i.nr)(e,t))throw new ValidationError("Unexpected property",[t])}for(let e of Object.keys(n))if(!(0,i.nr)(r,e)){o=!0;break}return o?r:n}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new ObjectValidator(this.config,!0)}extend(e){return new ObjectValidator({...this.config,...e})}};let UnionValidator=class UnionValidator extends Validator{constructor(e,t,n,r){super(t=>{this.expectObject(t);let{matchingSchema:n,variant:r}=this.getMatchingSchemaAndVariant(t);return void 0===n?this.unknownValueValidation(t,r):prefixError(`(${e} = ${r})`,()=>n.validate(t))},(t,n)=>{this.expectObject(n),this.expectObject(t);let{matchingSchema:r,variant:o}=this.getMatchingSchemaAndVariant(n);return void 0===r?this.unknownValueValidation(n,o):(0,i.eg)(t,e)!==(0,i.eg)(n,e)?prefixError(`(${e} = ${o})`,()=>r.validate(n)):prefixError(`(${e} = ${o})`,()=>r.validateUsingKnownGoodVersion?r.validateUsingKnownGoodVersion(t,n):r.validate(n))}),this.key=e,this.config=t,this.unknownValueValidation=n,this.useNumberKeys=r}expectObject(e){if("object"!=typeof e||null===e)throw new ValidationError(`Expected an object, got ${typeToString(e)}`,[])}getMatchingSchemaAndVariant(e){let t=(0,i.eg)(e,this.key);if(this.useNumberKeys||"string"==typeof t){if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new ValidationError(`Expected a number for key "${this.key}", got "${t}"`)}else throw new ValidationError(`Expected a string for key "${this.key}", got ${typeToString(t)}`);let n=(0,i.nr)(this.config,t)?this.config[t]:void 0;return{matchingSchema:n,variant:t}}validateUnknownVariants(e){return new UnionValidator(this.key,this.config,e,this.useNumberKeys)}};let DictValidator=class DictValidator extends Validator{constructor(e,t){super(n=>{if("object"!=typeof n||null===n)throw new ValidationError(`Expected object, got ${typeToString(n)}`);for(let[r,i]of Object.entries(n))prefixError(r,()=>{e.validate(r),t.validate(i)});return n},(n,r)=>{if("object"!=typeof r||null===r)throw new ValidationError(`Expected object, got ${typeToString(r)}`);let o=!1;for(let[a,l]of Object.entries(r)){if(!(0,i.nr)(n,a)){o=!0,prefixError(a,()=>{e.validate(a),t.validate(l)});continue}let r=(0,i.eg)(n,a),d=l;if(Object.is(r,d))continue;let c=prefixError(a,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(r,d):t.validate(d));Object.is(c,r)||(o=!0)}for(let e of Object.keys(n))if(!(0,i.nr)(r,e)){o=!0;break}return o?r:n}),this.keyValidator=e,this.valueValidator=t}};function typeofValidator(e){return new Validator(t=>{if(typeof t!==e)throw new ValidationError(`Expected ${e}, got ${typeToString(t)}`);return t})}let o=new Validator(e=>e),a=new Validator(e=>e),l=typeofValidator("string"),d=typeofValidator("number").check(e=>{if(Number.isNaN(e))throw new ValidationError("Expected a number, got NaN");if(!Number.isFinite(e))throw new ValidationError(`Expected a finite number, got ${e}`)}),c=d.check(e=>{if(e<0)throw new ValidationError(`Expected a positive number, got ${e}`)}),u=d.check(e=>{if(e<=0)throw new ValidationError(`Expected a non-zero positive number, got ${e}`)}),h=d.check(e=>{if(!Number.isInteger(e))throw new ValidationError(`Expected an integer, got ${e}`)}),p=h.check(e=>{if(e<0)throw new ValidationError(`Expected a positive integer, got ${e}`)}),f=h.check(e=>{if(e<=0)throw new ValidationError(`Expected a non-zero positive integer, got ${e}`)}),g=typeofValidator("boolean"),m=typeofValidator("bigint");function literal(e){return new Validator(t=>{if(t!==e)throw new ValidationError(`Expected ${e}, got ${JSON.stringify(t)}`);return e})}let y=new Validator(e=>{if(!Array.isArray(e))throw new ValidationError(`Expected an array, got ${typeToString(e)}`);return e});function arrayOf(e){return new ArrayOfValidator(e)}let b=new Validator(e=>{if("object"!=typeof e||null===e)throw new ValidationError(`Expected object, got ${typeToString(e)}`);return e});function object(e){return new ObjectValidator(e)}function isPlainObject(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e)||Object.getPrototypeOf(e)===i.qB)}let S=new Validator(e=>{if(function isValidJson(e){return null===e||"number"==typeof e||"string"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(isValidJson):!!isPlainObject(e)&&Object.values(e).every(isValidJson))}(e))return e;throw new ValidationError(`Expected json serializable value, got ${typeof e}`)},(e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){let n=e.length!==t.length;for(let r=0;r<t.length;r++){if(r>=e.length){n=!0,S.validate(t[r]);continue}let i=e[r],o=t[r];if(Object.is(i,o))continue;let a=S.validateUsingKnownGoodVersion(i,o);Object.is(a,i)||(n=!0)}return n?t:e}if(!(isPlainObject(e)&&isPlainObject(t)))return S.validate(t);{let n=!1;for(let r of Object.keys(t)){if(!(0,i.nr)(e,r)){n=!0,S.validate(t[r]);continue}let o=e[r],a=t[r];if(Object.is(o,a))continue;let l=S.validateUsingKnownGoodVersion(o,a);Object.is(l,o)||(n=!0)}for(let r of Object.keys(e))if(!(0,i.nr)(t,r)){n=!0;break}return n?t:e}});function jsonDict(){return dict(l,S)}function dict(e,t){return new DictValidator(e,t)}function union(e,t){return new UnionValidator(e,t,(n,r)=>{throw new ValidationError(`Expected one of ${Object.keys(t).map(e=>JSON.stringify(e)).join(" or ")}, got ${JSON.stringify(r)}`,[e])},!1)}function numberUnion(e,t){return new UnionValidator(e,t,(n,r)=>{throw new ValidationError(`Expected one of ${Object.keys(t).map(e=>JSON.stringify(e)).join(" or ")}, got ${JSON.stringify(r)}`,[e])},!0)}function model(e,t){return new Validator(n=>prefixError(e,()=>t.validate(n)),(n,r)=>prefixError(e,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(n,r):t.validate(r)))}function setEnum(e){return new Validator(t=>{if(!e.has(t)){let n=Array.from(e,e=>JSON.stringify(e)).join(" or ");throw new ValidationError(`Expected ${n}, got ${t}`)}return t})}function optional(e){return new Validator(t=>{if(void 0!==t)return e.validate(t)},(t,n)=>{if((void 0!==t||void 0!==n)&&void 0!==n)return e.validateUsingKnownGoodVersion&&void 0!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n)})}function nullable(e){return new Validator(t=>null===t?null:e.validate(t),(t,n)=>null===n?null:e.validateUsingKnownGoodVersion&&null!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n))}function literalEnum(...e){return setEnum(new Set(e))}function parseUrl(e){try{return new URL(e)}catch{if(e.startsWith("/")||e.startsWith("./"))try{return new URL(e,"http://example.com")}catch{throw new ValidationError(`Expected a valid url, got ${JSON.stringify(e)}`)}throw new ValidationError(`Expected a valid url, got ${JSON.stringify(e)}`)}}let v=new Set(["http:","https:","mailto:"]),k=l.check(e=>{if(""===e)return;let t=parseUrl(e);if(!v.has(t.protocol.toLowerCase()))throw new ValidationError(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),_=new Set(["http:","https:","data:","asset:"]),C=l.check(e=>{if(""===e)return;let t=parseUrl(e);if(!_.has(t.protocol.toLowerCase()))throw new ValidationError(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),E=l.check(e=>{if(""===e)return;let t=parseUrl(e);if(!t.protocol.toLowerCase().match(/^https?:$/))throw new ValidationError(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),M=l.refine(e=>{try{return(0,i.LP)(e),e}catch{throw new ValidationError(`Expected an index key, got ${JSON.stringify(e)}`)}});function or(e,t){return new Validator(n=>{try{return e.validate(n)}catch{return t.validate(n)}})}(0,i.x2)("@tldraw/validate","3.15.4","esm")},85063:function(e,t,n){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}n.d(t,{_:function(){return _extends}})},56984:function(e,t,n){"use strict";function _object_destructuring_empty(e){if(null==e)throw TypeError("Cannot destructure "+e);return e}n.d(t,{_:function(){return _object_destructuring_empty}})},58982:function(e,t,n){"use strict";n.d(t,{Ig:function(){return joinDown},MI:function(){return joinUp},N0:function(){return selectParentNode},NE:function(){return deleteSelection},QK:function(){return newlineInCode},U9:function(){return l},X0:function(){return liftEmptyBlock},Y_:function(){return joinForward},_M:function(){return selectNodeBackward},al:function(){return joinBackward},cR:function(){return joinTextblockForward},mD:function(){return createParagraphNear},nw:function(){return d},o:function(){return selectNodeForward},rr:function(){return joinTextblockBackward},uJ:function(){return setBlockType},uo:function(){return exitCode},xb:function(){return lift},ym:function(){return wrapIn}});var r,i=n(62312),o=n(22059),a=n(87789);let deleteSelection=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function atBlockStart(e,t){let{$cursor:n}=e.selection;return n&&(t?t.endOfTextblock("backward",e):!(n.parentOffset>0))?n:null}let joinBackward=(e,t,n)=>{let r=atBlockStart(e,n);if(!r)return!1;let l=findCutBefore(r);if(!l){let n=r.blockRange(),o=n&&(0,i.k9)(n);return null!=o&&(t&&t(e.tr.lift(n,o).scrollIntoView()),!0)}let d=l.nodeBefore;if(deleteBarrier(e,l,t,-1))return!0;if(0==r.parent.content.size&&(textblockAt(d,"end")||a.qv.isSelectable(d)))for(let n=r.depth;;n--){let c=(0,i.dR)(e.doc,r.before(n),r.after(n),o.p2.empty);if(c&&c.slice.size<c.to-c.from){if(t){let n=e.tr.step(c);n.setSelection(textblockAt(d,"end")?a.Y1.findFrom(n.doc.resolve(n.mapping.map(l.pos,-1)),-1):a.qv.create(n.doc,l.pos-d.nodeSize)),t(n.scrollIntoView())}return!0}if(1==n||r.node(n-1).childCount>1)break}return!!d.isAtom&&l.depth==r.depth-1&&(t&&t(e.tr.delete(l.pos-d.nodeSize,l.pos).scrollIntoView()),!0)},joinTextblockBackward=(e,t,n)=>{let r=atBlockStart(e,n);if(!r)return!1;let i=findCutBefore(r);return!!i&&joinTextblocksAround(e,i,t)},joinTextblockForward=(e,t,n)=>{let r=atBlockEnd(e,n);if(!r)return!1;let i=findCutAfter(r);return!!i&&joinTextblocksAround(e,i,t)};function joinTextblocksAround(e,t,n){let r=t.nodeBefore,l=t.pos-1;for(;!r.isTextblock;l--){if(r.type.spec.isolating)return!1;let e=r.lastChild;if(!e)return!1;r=e}let d=t.nodeAfter,c=t.pos+1;for(;!d.isTextblock;c++){if(d.type.spec.isolating)return!1;let e=d.firstChild;if(!e)return!1;d=e}let u=(0,i.dR)(e.doc,l,c,o.p2.empty);if(!u||u.from!=l||u instanceof i.Pu&&u.slice.size>=c-l)return!1;if(n){let t=e.tr.step(u);t.setSelection(a.Bs.create(t.doc,l)),n(t.scrollIntoView())}return!0}function textblockAt(e,t,n=!1){for(let r=e;r;r="start"==t?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&1!=r.childCount)break}return!1}let selectNodeBackward=(e,t,n)=>{let{$head:r,empty:i}=e.selection,o=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):r.parentOffset>0)return!1;o=findCutBefore(r)}let l=o&&o.nodeBefore;return!!(l&&a.qv.isSelectable(l))&&(t&&t(e.tr.setSelection(a.qv.create(e.doc,o.pos-l.nodeSize)).scrollIntoView()),!0)};function findCutBefore(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function atBlockEnd(e,t){let{$cursor:n}=e.selection;return n&&(t?t.endOfTextblock("forward",e):!(n.parentOffset<n.parent.content.size))?n:null}let joinForward=(e,t,n)=>{let r=atBlockEnd(e,n);if(!r)return!1;let l=findCutAfter(r);if(!l)return!1;let d=l.nodeAfter;if(deleteBarrier(e,l,t,1))return!0;if(0==r.parent.content.size&&(textblockAt(d,"start")||a.qv.isSelectable(d))){let n=(0,i.dR)(e.doc,r.before(),r.after(),o.p2.empty);if(n&&n.slice.size<n.to-n.from){if(t){let r=e.tr.step(n);r.setSelection(textblockAt(d,"start")?a.Y1.findFrom(r.doc.resolve(r.mapping.map(l.pos)),1):a.qv.create(r.doc,r.mapping.map(l.pos))),t(r.scrollIntoView())}return!0}}return!!d.isAtom&&l.depth==r.depth-1&&(t&&t(e.tr.delete(l.pos,l.pos+d.nodeSize).scrollIntoView()),!0)},selectNodeForward=(e,t,n)=>{let{$head:r,empty:i}=e.selection,o=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):r.parentOffset<r.parent.content.size)return!1;o=findCutAfter(r)}let l=o&&o.nodeAfter;return!!(l&&a.qv.isSelectable(l))&&(t&&t(e.tr.setSelection(a.qv.create(e.doc,o.pos)).scrollIntoView()),!0)};function findCutAfter(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}let joinUp=(e,t)=>{let n=e.selection,r=n instanceof a.qv,o;if(r){if(n.node.isTextblock||!(0,i.Mn)(e.doc,n.from))return!1;o=n.from}else if(null==(o=(0,i.GJ)(e.doc,n.from,-1)))return!1;if(t){let n=e.tr.join(o);r&&n.setSelection(a.qv.create(n.doc,o-e.doc.resolve(o).nodeBefore.nodeSize)),t(n.scrollIntoView())}return!0},joinDown=(e,t)=>{let n=e.selection,r;if(n instanceof a.qv){if(n.node.isTextblock||!(0,i.Mn)(e.doc,n.to))return!1;r=n.to}else if(null==(r=(0,i.GJ)(e.doc,n.to,1)))return!1;return t&&t(e.tr.join(r).scrollIntoView()),!0},lift=(e,t)=>{let{$from:n,$to:r}=e.selection,o=n.blockRange(r),a=o&&(0,i.k9)(o);return null!=a&&(t&&t(e.tr.lift(o,a).scrollIntoView()),!0)},newlineInCode=(e,t)=>{let{$head:n,$anchor:r}=e.selection;return!!(n.parent.type.spec.code&&n.sameParent(r))&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)};function defaultBlockAt(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}let exitCode=(e,t)=>{let{$head:n,$anchor:r}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),o=n.indexAfter(-1),l=defaultBlockAt(i.contentMatchAt(o));if(!l||!i.canReplaceWith(o,o,l))return!1;if(t){let r=n.after(),i=e.tr.replaceWith(r,r,l.createAndFill());i.setSelection(a.Y1.near(i.doc.resolve(r),1)),t(i.scrollIntoView())}return!0},createParagraphNear=(e,t)=>{let n=e.selection,{$from:r,$to:i}=n;if(n instanceof a.C1||r.parent.inlineContent||i.parent.inlineContent)return!1;let o=defaultBlockAt(i.parent.contentMatchAt(i.indexAfter()));if(!o||!o.isTextblock)return!1;if(t){let n=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,l=e.tr.insert(n,o.createAndFill());l.setSelection(a.Bs.create(l.doc,n+1)),t(l.scrollIntoView())}return!0},liftEmptyBlock=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let r=n.before();if((0,i.Ax)(e.doc,r))return t&&t(e.tr.split(r).scrollIntoView()),!0}let r=n.blockRange(),o=r&&(0,i.k9)(r);return null!=o&&(t&&t(e.tr.lift(r,o).scrollIntoView()),!0)},selectParentNode=(e,t)=>{let{$from:n,to:r}=e.selection,i,o=n.sharedDepth(r);return 0!=o&&(i=n.before(o),t&&t(e.tr.setSelection(a.qv.create(e.doc,i))),!0)};function deleteBarrier(e,t,n,r){let l,d,c,u=t.nodeBefore,h=t.nodeAfter,p,f,g=u.type.spec.isolating||h.type.spec.isolating;if(!g&&(l=t.nodeBefore,d=t.nodeAfter,c=t.index(),l&&d&&l.type.compatibleContent(d.type)&&(!l.content.size&&t.parent.canReplace(c-1,c)?(n&&n(e.tr.delete(t.pos-l.nodeSize,t.pos).scrollIntoView()),!0):!!(t.parent.canReplace(c,c+1)&&(d.isTextblock||(0,i.Mn)(e.doc,t.pos)))&&(n&&n(e.tr.join(t.pos).scrollIntoView()),!0))))return!0;let m=!g&&t.parent.canReplace(t.index(),t.index()+1);if(m&&(p=(f=u.contentMatchAt(u.childCount)).findWrapping(h.type))&&f.matchType(p[0]||h.type).validEnd){if(n){let r=t.pos+h.nodeSize,a=o.HY.empty;for(let e=p.length-1;e>=0;e--)a=o.HY.from(p[e].create(null,a));a=o.HY.from(u.copy(a));let l=e.tr.step(new i.FC(t.pos-1,r,t.pos,r,new o.p2(a,1,0),p.length,!0)),d=l.doc.resolve(r+2*p.length);d.nodeAfter&&d.nodeAfter.type==u.type&&(0,i.Mn)(l.doc,d.pos)&&l.join(d.pos),n(l.scrollIntoView())}return!0}let y=h.type.spec.isolating||r>0&&g?null:a.Y1.findFrom(t,1),b=y&&y.$from.blockRange(y.$to),S=b&&(0,i.k9)(b);if(null!=S&&S>=t.depth)return n&&n(e.tr.lift(b,S).scrollIntoView()),!0;if(m&&textblockAt(h,"start",!0)&&textblockAt(u,"end")){let r=u,a=[];for(;a.push(r),!r.isTextblock;)r=r.lastChild;let l=h,d=1;for(;!l.isTextblock;l=l.firstChild)d++;if(r.canReplace(r.childCount,r.childCount,l.content)){if(n){let r=o.HY.empty;for(let e=a.length-1;e>=0;e--)r=o.HY.from(a[e].copy(r));n(e.tr.step(new i.FC(t.pos-a.length,t.pos+h.nodeSize,t.pos+d,t.pos+h.nodeSize-d,new o.p2(r,a.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function selectTextblockSide(e){return function(t,n){let r=t.selection,i=e<0?r.$from:r.$to,o=i.depth;for(;i.node(o).isInline;){if(!o)return!1;o--}return!!i.node(o).isTextblock&&(n&&n(t.tr.setSelection(a.Bs.create(t.doc,e<0?i.start(o):i.end(o)))),!0)}}let l=selectTextblockSide(-1),d=selectTextblockSide(1);function wrapIn(e,t=null){return function(n,r){let{$from:o,$to:a}=n.selection,l=o.blockRange(a),d=l&&(0,i.nd)(l,e,t);return!!d&&(r&&r(n.tr.wrap(l,d).scrollIntoView()),!0)}}function setBlockType(e,t=null){return function(n,r){let i=!1;for(let r=0;r<n.selection.ranges.length&&!i;r++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[r];n.doc.nodesBetween(o,a,(r,o)=>{if(i)return!1;if(!(!r.isTextblock||r.hasMarkup(e,t))){if(r.type==e)i=!0;else{let t=n.doc.resolve(o),r=t.index();i=t.parent.canReplaceWith(r,r+1,e)}}})}if(!i)return!1;if(r){let i=n.tr;for(let r=0;r<n.selection.ranges.length;r++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[r];i.setBlockType(o,a,e,t)}r(i.scrollIntoView())}return!0}}function chainCommands(...e){return function(t,n,r){for(let i=0;i<e.length;i++)if(e[i](t,n,r))return!0;return!1}}let c=chainCommands(deleteSelection,joinBackward,selectNodeBackward),u=chainCommands(deleteSelection,joinForward,selectNodeForward),h={Enter:chainCommands(newlineInCode,createParagraphNear,liftEmptyBlock,(e,t)=>{let{$from:n,$to:o}=e.selection;if(e.selection instanceof a.qv&&e.selection.node.isBlock)return!!(n.parentOffset&&(0,i.Ax)(e.doc,n.pos))&&(t&&t(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let l=[],d,c,u=!1,h=!1;for(let e=n.depth;;e--){if(n.node(e).isBlock){u=n.end(e)==n.pos+(n.depth-e),h=n.start(e)==n.pos-(n.depth-e),c=defaultBlockAt(n.node(e-1).contentMatchAt(n.indexAfter(e-1)));let t=r&&r(o.parent,u,n);l.unshift(t||(u&&c?{type:c}:null)),d=e;break}if(1==e)return!1;l.unshift(null)}let p=e.tr;(e.selection instanceof a.Bs||e.selection instanceof a.C1)&&p.deleteSelection();let f=p.mapping.map(n.pos),g=(0,i.Ax)(p.doc,f,l.length,l);if(g||(l[0]=c?{type:c}:null,g=(0,i.Ax)(p.doc,f,l.length,l)),!g)return!1;if(p.split(f,l.length,l),!u&&h&&n.node(d).type!=c){let e=p.mapping.map(n.before(d)),t=p.doc.resolve(e);c&&n.node(d-1).canReplaceWith(t.index(),t.index()+1,c)&&p.setNodeMarkup(p.mapping.map(n.before(d)),c)}return t&&t(p.scrollIntoView()),!0}),"Mod-Enter":exitCode,Backspace:c,"Mod-Backspace":c,"Shift-Backspace":c,Delete:u,"Mod-Delete":u,"Mod-a":(e,t)=>(t&&t(e.tr.setSelection(new a.C1(e.doc))),!0)},p={"Ctrl-h":h.Backspace,"Alt-Backspace":h["Mod-Backspace"],"Ctrl-d":h.Delete,"Ctrl-Alt-Backspace":h["Mod-Delete"],"Alt-Delete":h["Mod-Delete"],"Alt-d":h["Mod-Delete"],"Ctrl-a":l,"Ctrl-e":d};for(let e in h)p[e]=h[e];"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform()},13503:function(e,t,n){"use strict";n.d(t,{$:function(){return keydownHandler},h:function(){return keymap}});for(var r={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},i={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},o="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),a="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),l=0;l<10;l++)r[48+l]=r[96+l]=String(l);for(var l=1;l<=24;l++)r[l+111]="F"+l;for(var l=65;l<=90;l++)r[l]=String.fromCharCode(l+32),i[l]=String.fromCharCode(l);for(var d in r)i.hasOwnProperty(d)||(i[d]=r[d]);var c=n(87789);let u="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),h="undefined"!=typeof navigator&&/Win/.test(navigator.platform);function modifiers(e,t,n=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n&&t.shiftKey&&(e="Shift-"+e),e}function keymap(e){return new c.Sy({props:{handleKeyDown:keydownHandler(e)}})}function keydownHandler(e){let t=function(e){let t=Object.create(null);for(let n in e)t[function(e){let t,n,r,i,o=e.split(/-(?!$)/),a=o[o.length-1];"Space"==a&&(a=" ");for(let e=0;e<o.length-1;e++){let a=o[e];if(/^(cmd|meta|m)$/i.test(a))i=!0;else if(/^a(lt)?$/i.test(a))t=!0;else if(/^(c|ctrl|control)$/i.test(a))n=!0;else if(/^s(hift)?$/i.test(a))r=!0;else if(/^mod$/i.test(a))u?i=!0:n=!0;else throw Error("Unrecognized modifier name: "+a)}return t&&(a="Alt-"+a),n&&(a="Ctrl-"+a),i&&(a="Meta-"+a),r&&(a="Shift-"+a),a}(n)]=e[n];return t}(e);return function(e,n){var l;let d=("Esc"==(l=!(o&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||a&&n.shiftKey&&n.key&&1==n.key.length||"Unidentified"==n.key)&&n.key||(n.shiftKey?i:r)[n.keyCode]||n.key||"Unidentified")&&(l="Escape"),"Del"==l&&(l="Delete"),"Left"==l&&(l="ArrowLeft"),"Up"==l&&(l="ArrowUp"),"Right"==l&&(l="ArrowRight"),"Down"==l&&(l="ArrowDown"),l),c,u=t[modifiers(d,n)];if(u&&u(e.state,e.dispatch,e))return!0;if(1==d.length&&" "!=d){if(n.shiftKey){let r=t[modifiers(d,n,!1)];if(r&&r(e.state,e.dispatch,e))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(h&&n.ctrlKey&&n.altKey)&&(c=r[n.keyCode])&&c!=d){let r=t[modifiers(c,n)];if(r&&r(e.state,e.dispatch,e))return!0}}return!1}}},22059:function(e,t,n){"use strict";function OrderedMap(e){this.content=e}n.d(t,{aw:function(){return DOMParser},PW:function(){return DOMSerializer},HY:function(){return Fragment},vc:function(){return Mark},ZU:function(){return MarkType},NB:function(){return Node},Ts:function(){return NodeRange},e4:function(){return ReplaceError},V_:function(){return Schema},p2:function(){return Slice}}),OrderedMap.prototype={constructor:OrderedMap,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return -1},get:function(e){var t=this.find(e);return -1==t?void 0:this.content[t+1]},update:function(e,t,n){var r=n&&n!=e?this.remove(n):this,i=r.find(e),o=r.content.slice();return -1==i?o.push(n||e,t):(o[i+1]=t,n&&(o[i]=n)),new OrderedMap(o)},remove:function(e){var t=this.find(e);if(-1==t)return this;var n=this.content.slice();return n.splice(t,2),new OrderedMap(n)},addToStart:function(e,t){return new OrderedMap([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new OrderedMap(n)},addBefore:function(e,t,n){var r=this.remove(t),i=r.content.slice(),o=r.find(e);return i.splice(-1==o?i.length:o,0,t,n),new OrderedMap(i)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return(e=OrderedMap.from(e)).size?new OrderedMap(e.content.concat(this.subtract(e).content)):this},append:function(e){return(e=OrderedMap.from(e)).size?new OrderedMap(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=OrderedMap.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach(function(t,n){e[t]=n}),e},get size(){return this.content.length>>1}},OrderedMap.from=function(e){if(e instanceof OrderedMap)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new OrderedMap(t)};let Fragment=class Fragment{constructor(e,t){if(this.content=e,this.size=t||0,null==t)for(let t=0;t<e.length;t++)this.size+=e[t].nodeSize}nodesBetween(e,t,n,r=0,i){for(let o=0,a=0;a<t;o++){let l=this.content[o],d=a+l.nodeSize;if(d>e&&!1!==n(l,r+a,i||null,o)&&l.content.size){let i=a+1;l.nodesBetween(Math.max(0,e-i),Math.min(l.content.size,t-i),n,r+i)}a=d}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,r){let i="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let d=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?r?"function"==typeof r?r(a):r:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&d||a.isTextblock)&&n&&(o?o=!1:i+=n),i+=d},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,r=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(n)&&(r[r.length-1]=t.withText(t.text+n.text),i=1);i<e.content.length;i++)r.push(e.content[i]);return new Fragment(r,this.size+e.size)}cut(e,t=this.size){if(0==e&&t==this.size)return this;let n=[],r=0;if(t>e)for(let i=0,o=0;o<t;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a=a.isText?a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),r+=a.nodeSize),o=l}return new Fragment(n,r)}cutByIndex(e,t){return e==t?Fragment.empty:0==e&&t==this.content.length?this:new Fragment(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let r=this.content.slice(),i=this.size+t.nodeSize-n.nodeSize;return r[e]=t,new Fragment(r,i)}addToStart(e){return new Fragment([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Fragment(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let r=this.content[t];e(r,n,t),n+=r.nodeSize}}findDiffStart(e,t=0){return function findDiffStart(e,t,n){for(let r=0;;r++){if(r==e.childCount||r==t.childCount)return e.childCount==t.childCount?null:n;let i=e.child(r),o=t.child(r);if(i==o){n+=i.nodeSize;continue}if(!i.sameMarkup(o))return n;if(i.isText&&i.text!=o.text){for(let e=0;i.text[e]==o.text[e];e++)n++;return n}if(i.content.size||o.content.size){let e=findDiffStart(i.content,o.content,n+1);if(null!=e)return e}n+=i.nodeSize}}(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return function findDiffEnd(e,t,n,r){for(let i=e.childCount,o=t.childCount;;){if(0==i||0==o)return i==o?null:{a:n,b:r};let a=e.child(--i),l=t.child(--o),d=a.nodeSize;if(a==l){n-=d,r-=d;continue}if(!a.sameMarkup(l))return{a:n,b:r};if(a.isText&&a.text!=l.text){let e=0,t=Math.min(a.text.length,l.text.length);for(;e<t&&a.text[a.text.length-e-1]==l.text[l.text.length-e-1];)e++,n--,r--;return{a:n,b:r}}if(a.content.size||l.content.size){let e=findDiffEnd(a.content,l.content,n-1,r-1);if(e)return e}n-=d,r-=d}}(this,e,t,n)}findIndex(e,t=-1){if(0==e)return retIndex(0,e);if(e==this.size)return retIndex(this.content.length,e);if(e>this.size||e<0)throw RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=r+this.child(n).nodeSize;if(i>=e){if(i==e||t>0)return retIndex(n+1,i);return retIndex(n,r)}r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return Fragment.empty;if(!Array.isArray(t))throw RangeError("Invalid input for Fragment.fromJSON");return new Fragment(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Fragment.empty;let t,n=0;for(let r=0;r<e.length;r++){let i=e[r];n+=i.nodeSize,r&&i.isText&&e[r-1].sameMarkup(i)?(t||(t=e.slice(0,r)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new Fragment(t||e,n)}static from(e){if(!e)return Fragment.empty;if(e instanceof Fragment)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Fragment([e],e.nodeSize);throw RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};Fragment.empty=new Fragment([],0);let r={index:0,offset:0};function retIndex(e,t){return r.index=e,r.offset=t,r}function compareDeep(e,t){if(e===t)return!0;if(!(e&&"object"==typeof e)||!(t&&"object"==typeof t))return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!compareDeep(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!compareDeep(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}let Mark=class Mark{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let r=0;r<e.length;r++){let i=e[r];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,r));else{if(i.type.excludes(this.type))return e;!n&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,r)),t.push(this),n=!0),t&&t.push(i)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&compareDeep(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw RangeError(`There is no mark type ${t.type} in this schema`);let r=n.create(t.attrs);return n.checkAttrs(r.attrs),r}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&0==e.length)return Mark.none;if(e instanceof Mark)return[e];let t=e.slice();return t.sort((e,t)=>e.type.rank-t.type.rank),t}};Mark.none=[];let ReplaceError=class ReplaceError extends Error{};let Slice=class Slice{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=function insertInto(e,t,n,r){let{index:i,offset:o}=e.findIndex(t),a=e.maybeChild(i);if(o==t||a.isText)return r&&!r.canReplace(i,i,n)?null:e.cut(0,t).append(n).append(e.cut(t));let l=insertInto(a.content,t-o-1,n);return l&&e.replaceChild(i,a.copy(l))}(this.content,e+this.openStart,t);return n&&new Slice(n,this.openStart,this.openEnd)}removeBetween(e,t){return new Slice(function removeRange(e,t,n){let{index:r,offset:i}=e.findIndex(t),o=e.maybeChild(r),{index:a,offset:l}=e.findIndex(n);if(i==t||o.isText){if(l!=n&&!e.child(a).isText)throw RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(r!=a)throw RangeError("Removing non-flat range");return e.replaceChild(r,o.copy(removeRange(o.content,t-i-1,n-i-1)))}(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Slice.empty;let n=t.openStart||0,r=t.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw RangeError("Invalid input for Slice.fromJSON");return new Slice(Fragment.fromJSON(e,t.content),n,r)}static maxOpen(e,t=!0){let n=0,r=0;for(let r=e.firstChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.firstChild)n++;for(let n=e.lastChild;n&&!n.isLeaf&&(t||!n.type.spec.isolating);n=n.lastChild)r++;return new Slice(e,n,r)}};function checkJoin(e,t){if(!t.type.compatibleContent(e.type))throw new ReplaceError("Cannot join "+t.type.name+" onto "+e.type.name)}function joinable(e,t,n){let r=e.node(n);return checkJoin(r,t.node(n)),r}function addNode(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function addRange(e,t,n,r){let i=(t||e).node(n),o=0,a=t?t.index(n):i.childCount;e&&(o=e.index(n),e.depth>n?o++:e.textOffset&&(addNode(e.nodeAfter,r),o++));for(let e=o;e<a;e++)addNode(i.child(e),r);t&&t.depth==n&&t.textOffset&&addNode(t.nodeBefore,r)}function dist_close(e,t){return e.type.checkContent(t),e.copy(t)}function replaceTwoWay(e,t,n){let r=[];return addRange(null,e,n,r),e.depth>n&&addNode(dist_close(joinable(e,t,n+1),replaceTwoWay(e,t,n+1)),r),addRange(t,null,n,r),new Fragment(r)}Slice.empty=new Slice(Fragment.empty,0,0);let ResolvedPos=class ResolvedPos{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return null==e?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[3*this.resolveDepth(e)]}index(e){return this.path[3*this.resolveDepth(e)+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e!=this.depth||this.textOffset?1:0)}start(e){return 0==(e=this.resolveDepth(e))?0:this.path[3*e-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(!(e=this.resolveDepth(e)))throw RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]}after(e){if(!(e=this.resolveDepth(e)))throw RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]+this.path[3*e].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=e.child(t);return n?e.child(t).cut(n):r}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):0==e?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[3*t],r=0==t?0:this.path[3*t-1]+1;for(let t=0;t<e;t++)r+=n.child(t).nodeSize;return r}marks(){let e=this.parent,t=this.index();if(0==e.content.size)return Mark.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),r=e.maybeChild(t);if(!n){let e=n;n=r,r=e}let i=n.marks;for(var o=0;o<i.length;o++)!1!==i[o].type.spec.inclusive||r&&i[o].isInSet(r.marks)||(i=i[o--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,r=e.parent.maybeChild(e.index());for(var i=0;i<n.length;i++)!1!==n[i].type.spec.inclusive||r&&n[i].isInSet(r.marks)||(n=n[i--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new NodeRange(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw RangeError("Position "+t+" out of range");let n=[],r=0,i=t;for(let t=e;;){let{index:e,offset:o}=t.content.findIndex(i),a=i-o;if(n.push(t,e,r+o),!a||(t=t.child(e)).isText)break;i=a-1,r+=o+1}return new ResolvedPos(t,n,i)}static resolveCached(e,t){let n=o.get(e);if(n)for(let e=0;e<n.elts.length;e++){let r=n.elts[e];if(r.pos==t)return r}else o.set(e,n=new ResolveCache);let r=n.elts[n.i]=ResolvedPos.resolve(e,t);return n.i=(n.i+1)%i,r}};let ResolveCache=class ResolveCache{constructor(){this.elts=[],this.i=0}};let i=12,o=new WeakMap;let NodeRange=class NodeRange{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}};let a=Object.create(null);let Node=class Node{constructor(e,t,n,r=Mark.none){this.type=e,this.attrs=t,this.marks=r,this.content=n||Fragment.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,r=0){this.content.nodesBetween(e,t,n,r,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,r){return this.content.textBetween(e,t,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&compareDeep(this.attrs,t||e.defaultAttrs||a)&&Mark.sameSet(this.marks,n||Mark.none)}copy(e=null){return e==this.content?this:new Node(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Node(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return 0==e&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return Slice.empty;let r=this.resolve(e),i=this.resolve(t),o=n?0:r.sharedDepth(t),a=r.start(o),l=r.node(o).content.cut(r.pos-a,i.pos-a);return new Slice(l,r.depth-o,i.depth-o)}replace(e,t,n){return function(e,t,n){if(n.openStart>e.depth)throw new ReplaceError("Inserted content deeper than insertion position");if(e.depth-n.openStart!=t.depth-n.openEnd)throw new ReplaceError("Inconsistent open depths");return function replaceOuter(e,t,n,r){let i=e.index(r),o=e.node(r);if(i==t.index(r)&&r<e.depth-n.openStart){let a=replaceOuter(e,t,n,r+1);return o.copy(o.content.replaceChild(i,a))}if(!n.content.size)return dist_close(o,replaceTwoWay(e,t,r));if(n.openStart||n.openEnd||e.depth!=r||t.depth!=r){let{start:i,end:a}=function(e,t){let n=t.depth-e.openStart,r=t.node(n).copy(e.content);for(let e=n-1;e>=0;e--)r=t.node(e).copy(Fragment.from(r));return{start:r.resolveNoCache(e.openStart+n),end:r.resolveNoCache(r.content.size-e.openEnd-n)}}(n,e);return dist_close(o,function replaceThreeWay(e,t,n,r,i){let o=e.depth>i&&joinable(e,t,i+1),a=r.depth>i&&joinable(n,r,i+1),l=[];return addRange(null,e,i,l),o&&a&&t.index(i)==n.index(i)?(checkJoin(o,a),addNode(dist_close(o,replaceThreeWay(e,t,n,r,i+1)),l)):(o&&addNode(dist_close(o,replaceTwoWay(e,t,i+1)),l),addRange(t,n,i,l),a&&addNode(dist_close(a,replaceTwoWay(n,r,i+1)),l)),addRange(r,null,i,l),new Fragment(l)}(e,i,a,t,r))}{let r=e.parent,i=r.content;return dist_close(r,i.cut(0,e.parentOffset).append(n.content).append(i.cut(t.parentOffset)))}}(e,t,n,0)}(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:r}=t.content.findIndex(e);if(!(t=t.maybeChild(n)))return null;if(r==e||t.isText)return t;e-=r+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(0==e)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let r=this.content.child(t-1);return{node:r,index:t-1,offset:n-r.nodeSize}}resolve(e){return ResolvedPos.resolveCached(this,e)}resolveNoCache(e){return ResolvedPos.resolve(this,e)}rangeHasMark(e,t,n){let r=!1;return t>e&&this.nodesBetween(e,t,e=>(n.isInSet(e.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),wrapMarks(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=Fragment.empty,r=0,i=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,r,i),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let e=r;e<i;e++)if(!this.type.allowsMarks(n.child(e).marks))return!1;return!0}canReplaceWith(e,t,n,r){if(r&&!this.type.allowsMarks(r))return!1;let i=this.contentMatchAt(e).matchType(n),o=i&&i.matchFragment(this.content,t);return!!o&&o.validEnd}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Mark.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!Mark.sameSet(e,this.marks))throw RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(e=>e.toJSON())),e}static fromJSON(e,t){let n;if(!t)throw RangeError("Invalid input for Node.fromJSON");if(t.marks){if(!Array.isArray(t.marks))throw RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if("text"==t.type){if("string"!=typeof t.text)throw RangeError("Invalid text node in JSON");return e.text(t.text,n)}let r=Fragment.fromJSON(e,t.content),i=e.nodeType(t.type).create(t.attrs,r,n);return i.type.checkAttrs(i.attrs),i}};Node.prototype.text=void 0;let TextNode=class TextNode extends Node{constructor(e,t,n,r){if(super(e,t,null,r),!n)throw RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new TextNode(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new TextNode(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return 0==e&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function wrapMarks(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}let ContentMatch=class ContentMatch{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){var n;let r,i=new TokenStream(e,t);if(null==i.next)return ContentMatch.empty;let o=function parseExpr(e){let t=[];do t.push(function(e){let t=[];do t.push(function(e){let t=function(e){if(e.eat("(")){let t=parseExpr(e);return e.eat(")")||e.err("Missing closing paren"),t}if(/\W/.test(e.next))e.err("Unexpected token '"+e.next+"'");else{let t=(function(e,t){let n=e.nodeTypes,r=n[t];if(r)return[r];let i=[];for(let e in n){let r=n[e];r.isInGroup(t)&&i.push(r)}return 0==i.length&&e.err("No node type or group '"+t+"' found"),i})(e,e.next).map(t=>(null==e.inline?e.inline=t.isInline:e.inline!=t.isInline&&e.err("Mixing inline and block content"),{type:"name",value:t}));return e.pos++,1==t.length?t[0]:{type:"choice",exprs:t}}}(e);for(;;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else if(e.eat("{"))t=function(e,t){let n=parseNum(e),r=n;return e.eat(",")&&(r="}"!=e.next?parseNum(e):-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:t}}(e,t);else break;return t}(e));while(e.next&&")"!=e.next&&"|"!=e.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}(e));while(e.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}(i);i.next&&i.err("Unexpected trailing text");let a=(n=function(e){let t=[[]];return connect(function compile(e,t){if("choice"==e.type)return e.exprs.reduce((e,n)=>e.concat(compile(n,t)),[]);if("seq"==e.type)for(let n=0;;n++){let r=compile(e.exprs[n],t);if(n==e.exprs.length-1)return r;connect(r,t=node())}else if("star"==e.type){let n=node();return edge(t,n),connect(compile(e.expr,n),n),[edge(n)]}else if("plus"==e.type){let n=node();return connect(compile(e.expr,t),n),connect(compile(e.expr,n),n),[edge(n)]}else if("opt"==e.type)return[edge(t)].concat(compile(e.expr,t));else if("range"==e.type){let n=t;for(let t=0;t<e.min;t++){let t=node();connect(compile(e.expr,n),t),n=t}if(-1==e.max)connect(compile(e.expr,n),n);else for(let t=e.min;t<e.max;t++){let t=node();edge(n,t),connect(compile(e.expr,n),t),n=t}return[edge(n)]}else if("name"==e.type)return[edge(t,void 0,e.value)];else throw Error("Unknown expr type")}(e,0),node()),t;function node(){return t.push([])-1}function edge(e,n,r){let i={term:r,to:n};return t[e].push(i),i}function connect(e,t){e.forEach(e=>e.to=t)}}(o),r=Object.create(null),function explore(e){let t=[];e.forEach(e=>{n[e].forEach(({term:e,to:r})=>{let i;if(e){for(let n=0;n<t.length;n++)t[n][0]==e&&(i=t[n][1]);nullFrom(n,r).forEach(n=>{i||t.push([e,i=[]]),-1==i.indexOf(n)&&i.push(n)})}})});let i=r[e.join(",")]=new ContentMatch(e.indexOf(n.length-1)>-1);for(let e=0;e<t.length;e++){let n=t[e][1].sort(cmp);i.next.push({type:t[e][0],next:r[n.join(",")]||explore(n)})}return i}(nullFrom(n,0)));return function(e,t){for(let n=0,r=[e];n<r.length;n++){let e=r[n],i=!e.validEnd,o=[];for(let t=0;t<e.next.length;t++){let{type:n,next:a}=e.next[t];o.push(n.name),i&&!(n.isText||n.hasRequiredAttrs())&&(i=!1),-1==r.indexOf(a)&&r.push(a)}i&&t.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(a,i),a}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let r=this;for(let i=t;r&&i<n;i++)r=r.matchType(e.child(i).type);return r}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let r=[this];return function search(i,o){let a=i.matchFragment(e,n);if(a&&(!t||a.validEnd))return Fragment.from(o.map(e=>e.createAndFill()));for(let e=0;e<i.next.length;e++){let{type:t,next:n}=i.next[e];if(!(t.isText||t.hasRequiredAttrs())&&-1==r.indexOf(n)){r.push(n);let e=search(n,o.concat(t));if(e)return e}}return null}(this,[])}findWrapping(e){for(let t=0;t<this.wrapCache.length;t+=2)if(this.wrapCache[t]==e)return this.wrapCache[t+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),i=r.match;if(i.matchType(e)){let e=[];for(let t=r;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<i.next.length;e++){let{type:o,next:a}=i.next[e];o.isLeaf||o.hasRequiredAttrs()||o.name in t||r.type&&!a.validEnd||(n.push({match:o.contentMatch,type:o,via:r}),t[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];return!function scan(t){e.push(t);for(let n=0;n<t.next.length;n++)-1==e.indexOf(t.next[n].next)&&scan(t.next[n].next)}(this),e.map((t,n)=>{let r=n+(t.validEnd?"*":" ")+" ";for(let n=0;n<t.next.length;n++)r+=(n?", ":"")+t.next[n].type.name+"->"+e.indexOf(t.next[n].next);return r}).join("\n")}};ContentMatch.empty=new ContentMatch(!0);let TokenStream=class TokenStream{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw SyntaxError(e+" (in content expression '"+this.string+"')")}};function parseNum(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");let t=Number(e.next);return e.pos++,t}function cmp(e,t){return t-e}function nullFrom(e,t){let n=[];return function scan(t){let r=e[t];if(1==r.length&&!r[0].term)return scan(r[0].to);n.push(t);for(let e=0;e<r.length;e++){let{term:t,to:i}=r[e];t||-1!=n.indexOf(i)||scan(i)}}(t),n.sort(cmp)}function defaultAttrs(e){let t=Object.create(null);for(let n in e){let r=e[n];if(!r.hasDefault)return null;t[n]=r.default}return t}function computeAttrs(e,t){let n=Object.create(null);for(let r in e){let i=t&&t[r];if(void 0===i){let t=e[r];if(t.hasDefault)i=t.default;else throw RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function checkAttrs(e,t,n,r){for(let r in t)if(!(r in e))throw RangeError(`Unsupported attribute ${r} for ${n} of type ${r}`);for(let n in e){let r=e[n];r.validate&&r.validate(t[n])}}function initAttrs(e,t){let n=Object.create(null);if(t)for(let r in t)n[r]=new Attribute(e,r,t[r]);return n}let NodeType=class NodeType{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=initAttrs(e,n.attrs),this.defaultAttrs=defaultAttrs(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==e),this.isText="text"==e}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ContentMatch.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:computeAttrs(this.attrs,e)}create(e=null,t,n){if(this.isText)throw Error("NodeType.create can't construct text nodes");return new Node(this,this.computeAttrs(e),Fragment.from(t),Mark.setFrom(n))}createChecked(e=null,t,n){return t=Fragment.from(t),this.checkContent(t),new Node(this,this.computeAttrs(e),t,Mark.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),(t=Fragment.from(t)).size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let r=this.contentMatch.matchFragment(t),i=r&&r.fillBefore(Fragment.empty,!0);return i?new Node(this,e,t.append(i),Mark.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let t=0;t<e.childCount;t++)if(!this.allowsMarks(e.child(t).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){checkAttrs(this.attrs,e,"node",this.name)}allowsMarkType(e){return null==this.markSet||this.markSet.indexOf(e)>-1}allowsMarks(e){if(null==this.markSet)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){let t;if(null==this.markSet)return e;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:Mark.none:e}static compile(e,t){let n=Object.create(null);e.forEach((e,r)=>n[e]=new NodeType(e,t,r));let r=t.spec.topNode||"doc";if(!n[r])throw RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw RangeError("Every schema needs a 'text' type");for(let e in n.text.attrs)throw RangeError("The text node type should not have attributes");return n}};let Attribute=class Attribute{constructor(e,t,n){let r;this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate="string"==typeof n.validate?(r=n.validate.split("|"),n=>{let i=null===n?"null":typeof n;if(0>r.indexOf(i))throw RangeError(`Expected value of type ${r} for attribute ${t} on type ${e}, got ${i}`)}):n.validate}get isRequired(){return!this.hasDefault}};let MarkType=class MarkType{constructor(e,t,n,r){this.name=e,this.rank=t,this.schema=n,this.spec=r,this.attrs=initAttrs(e,r.attrs),this.excluded=null;let i=defaultAttrs(this.attrs);this.instance=i?new Mark(this,i):null}create(e=null){return!e&&this.instance?this.instance:new Mark(this,computeAttrs(this.attrs,e))}static compile(e,t){let n=Object.create(null),r=0;return e.forEach((e,i)=>n[e]=new MarkType(e,r++,t,i)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){checkAttrs(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}};let Schema=class Schema{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let n in e)t[n]=e[n];t.nodes=OrderedMap.from(e.nodes),t.marks=OrderedMap.from(e.marks||{}),this.nodes=NodeType.compile(this.spec.nodes,this),this.marks=MarkType.compile(this.spec.marks,this);let n=Object.create(null);for(let e in this.nodes){if(e in this.marks)throw RangeError(e+" can not be both a node and a mark");let t=this.nodes[e],r=t.spec.content||"",i=t.spec.marks;if(t.contentMatch=n[r]||(n[r]=ContentMatch.parse(r,this.nodes)),t.inlineContent=t.contentMatch.inlineContent,t.spec.linebreakReplacement){if(this.linebreakReplacement)throw RangeError("Multiple linebreak nodes defined");if(!t.isInline||!t.isLeaf)throw RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=t}t.markSet="_"==i?null:i?gatherMarks(this,i.split(" ")):""!=i&&t.inlineContent?null:[]}for(let e in this.marks){let t=this.marks[e],n=t.spec.excludes;t.excluded=null==n?[t]:""==n?[]:gatherMarks(this,n.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,r){if("string"==typeof e)e=this.nodeType(e);else if(e instanceof NodeType){if(e.schema!=this)throw RangeError("Node type from different schema used ("+e.name+")")}else throw RangeError("Invalid node type: "+e);return e.createChecked(t,n,r)}text(e,t){let n=this.nodes.text;return new TextNode(n,n.defaultAttrs,e,Mark.setFrom(t))}mark(e,t){return"string"==typeof e&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return Node.fromJSON(this,e)}markFromJSON(e){return Mark.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw RangeError("Unknown node type: "+e);return t}};function gatherMarks(e,t){let n=[];for(let r=0;r<t.length;r++){let i=t[r],o=e.marks[i],a=o;if(o)n.push(o);else for(let t in e.marks){let r=e.marks[t];("_"==i||r.spec.group&&r.spec.group.split(" ").indexOf(i)>-1)&&n.push(a=r)}if(!a)throw SyntaxError("Unknown mark type: '"+t[r]+"'")}return n}let DOMParser=class DOMParser{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(e=>{if(null!=e.tag)this.tags.push(e);else if(null!=e.style){let t=/[^=]*/.exec(e.style)[0];0>n.indexOf(t)&&n.push(t),this.styles.push(e)}}),this.normalizeLists=!this.tags.some(t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)})}parse(e,t={}){let n=new ParseContext(this,t,!1);return n.addAll(e,Mark.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new ParseContext(this,t,!0);return n.addAll(e,Mark.none,t.from,t.to),Slice.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){var r;let n=this.tags[i];if(r=n.tag,(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,r)&&(void 0===n.namespace||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(!1===t)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,r){for(let i=r?this.styles.indexOf(r)+1:0;i<this.styles.length;i++){let r=this.styles[i],o=r.style;if(0==o.indexOf(e)&&(!r.context||n.matchesContext(r.context))&&(!(o.length>e.length)||61==o.charCodeAt(e.length)&&o.slice(e.length+1)==t)){if(r.getAttrs){let e=r.getAttrs(t);if(!1===e)continue;r.attrs=e||void 0}return r}}}static schemaRules(e){let t=[];function insert(e){let n=null==e.priority?50:e.priority,r=0;for(;r<t.length;r++){let e=t[r];if((null==e.priority?50:e.priority)<n)break}t.splice(r,0,e)}for(let t in e.marks){let n=e.marks[t].spec.parseDOM;n&&n.forEach(e=>{insert(e=copy(e)),e.mark||e.ignore||e.clearMark||(e.mark=t)})}for(let t in e.nodes){let n=e.nodes[t].spec.parseDOM;n&&n.forEach(e=>{insert(e=copy(e)),e.node||e.ignore||e.mark||(e.node=t)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new DOMParser(e,DOMParser.schemaRules(e)))}};let l={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},d={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},c={ol:!0,ul:!0};function wsOptionsFor(e,t,n){return null!=t?(t?1:0)|("full"===t?2:0):e&&"pre"==e.whitespace?3:-5&n}let NodeContext=class NodeContext{constructor(e,t,n,r,i,o){this.type=e,this.attrs=t,this.marks=n,this.solid=r,this.options=o,this.content=[],this.activeMarks=Mark.none,this.match=i||(4&o?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Fragment.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let t=this.type.contentMatch,n;return(n=t.findWrapping(e.type))?(this.match=t,n):null}}return this.match.findWrapping(e.type)}finish(e){if(!(1&this.options)){let e=this.content[this.content.length-1],t;e&&e.isText&&(t=/[ \t\r\n\u000c]+$/.exec(e.text))&&(e.text.length==t[0].length?this.content.pop():this.content[this.content.length-1]=e.withText(e.text.slice(0,e.text.length-t[0].length)))}let t=Fragment.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Fragment.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!l.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}};let ParseContext=class ParseContext{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let r=t.topNode,i,o=wsOptionsFor(null,t.preserveWhitespace,0)|(n?4:0);i=r?new NodeContext(r.type,r.attrs,Mark.none,!0,t.topMatch||r.type.contentMatch,o):n?new NodeContext(null,null,Mark.none,!0,null,o):new NodeContext(e.schema.topNodeType,null,Mark.none,!0,null,o),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){3==e.nodeType?this.addTextNode(e,t):1==e.nodeType&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,r=this.top,i=2&r.options?"full":this.localPreserveWS||(1&r.options)>0;if("full"===i||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(i)n="full"!==i?n.replace(/\r?\n|\r/g," "):n.replace(/\r\n?/g,"\n");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let t=r.content[r.content.length-1],i=e.previousSibling;(!t||i&&"BR"==i.nodeName||t.isText&&/[ \t\r\n\u000c]$/.test(t.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let r=this.localPreserveWS,i=this.top;("PRE"==e.tagName||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;c.hasOwnProperty(o)&&this.parser.normalizeLists&&function(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=1==t.nodeType?t.nodeName.toLowerCase():null;e&&c.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):"li"==e?n=t:e&&(n=null)}}(e);let u=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));r:if(u?u.ignore:d.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!u||u.skip||u.closeParent){u&&u.closeParent?this.open=Math.max(0,this.open-1):u&&u.skip.nodeType&&(e=u.skip);let n,r=this.needsBlock;if(l.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),n=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break r}let a=u&&u.skip?t:this.readStyles(e,t);a&&this.addAll(e,a),n&&this.sync(i),this.needsBlock=r}else{let n=this.readStyles(e,t);n&&this.addElementByRule(e,u,n,!1===u.consuming?a:void 0)}this.localPreserveWS=r}leafFallback(e,t){"BR"==e.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode("\n"),t)}ignoreFallback(e,t){"BR"!=e.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let e=0;e<this.parser.matchedStyles.length;e++){let r=this.parser.matchedStyles[e],i=n.getPropertyValue(r);if(i)for(let e;;){let n=this.parser.matchStyle(r,i,this,e);if(!n)break;if(n.ignore)return null;if(t=n.clearMark?t.filter(e=>!n.clearMark(e)):t.concat(this.parser.schema.marks[n.mark].create(n.attrs)),!1===n.consuming)e=n;else break}}return t}addElementByRule(e,t,n,r){let i,o;if(t.node){if((o=this.parser.schema.nodes[t.node]).isLeaf)this.insertNode(o.create(t.attrs),n,"BR"==e.nodeName)||this.leafFallback(e,n);else{let e=this.enter(o,t.attrs||null,n,t.preserveWhitespace);e&&(i=!0,n=e)}}else{let e=this.parser.schema.marks[t.mark];n=n.concat(e.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(r)this.addElement(e,n,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(e=>this.insertNode(e,n,!1));else{let r=e;"string"==typeof t.contentElement?r=e.querySelector(t.contentElement):"function"==typeof t.contentElement?r=t.contentElement(e):t.contentElement&&(r=t.contentElement),this.findAround(e,r,!0),this.addAll(r,n),this.findAround(e,r,!1)}i&&this.sync(a)&&this.open--}addAll(e,t,n,r){let i=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=null==r?null:e.childNodes[r];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,t);this.findAtPoint(e,i)}findPlace(e,t,n){let r,i;for(let t=this.open,o=0;t>=0;t--){let a=this.nodes[t],l=a.findWrapping(e);if(l&&(!r||r.length>l.length+o)&&(r=l,i=a,!l.length))break;if(a.solid){if(n)break;o+=2}}if(!r)return null;this.sync(i);for(let e=0;e<r.length;e++)t=this.enterInner(r[e],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&(t=this.enterInner(e,null,t))}let r=this.findPlace(e,t,n);if(r){this.closeExtra();let t=this.top;t.match&&(t.match=t.match.matchType(e.type));let n=Mark.none;for(let i of r.concat(e.marks))(t.type?t.type.allowsMarkType(i.type):markMayApply(i.type,e.type))&&(n=i.addToSet(n));return t.content.push(e.mark(n)),!0}return!1}enter(e,t,n,r){let i=this.findPlace(e.create(t),n,!1);return i&&(i=this.enterInner(e,t,n,!0,r)),i}enterInner(e,t,n,r=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=wsOptionsFor(e,i,o.options);4&o.options&&0==o.content.length&&(a|=4);let l=Mark.none;return n=n.filter(t=>(o.type?!o.type.allowsMarkType(t.type):!markMayApply(t.type,e))||(l=t.addToSet(l),!1)),this.nodes.push(new NodeContext(e,t,l,r,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=1)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)null==this.find[t].pos&&1==e.nodeType&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let r=0;r<this.find.length;r++)null==this.find[r].pos&&1==e.nodeType&&e.contains(this.find[r].node)&&t.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,r=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),i=-(n?n.depth+1:0)+(r?0:1),match=(e,o)=>{for(;e>=0;e--){let a=t[e];if(""==a){if(e==t.length-1||0==e)continue;for(;o>=i;o--)if(match(e-1,o))return!0;return!1}{let e=o>0||0==o&&r?this.nodes[o].type:n&&o>=i?n.node(o-i).type:null;if(!e||e.name!=a&&!e.isInGroup(a))return!1;o--}}return!0};return match(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let t=this.parser.schema.nodes[e];if(t.isTextblock&&t.defaultAttrs)return t}}};function copy(e){let t={};for(let n in e)t[n]=e[n];return t}function markMayApply(e,t){let n=t.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(e))continue;let o=[],scan=e=>{o.push(e);for(let n=0;n<e.edgeCount;n++){let{type:r,next:i}=e.edge(n);if(r==t||0>o.indexOf(i)&&scan(i))return!0}};if(scan(i.contentMatch))return!0}}let DOMSerializer=class DOMSerializer{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=doc(t).createDocumentFragment());let r=n,i=[];return e.forEach(e=>{if(i.length||e.marks.length){let n=0,o=0;for(;n<i.length&&o<e.marks.length;){let t=e.marks[o];if(!this.marks[t.type.name]){o++;continue}if(!t.eq(i[n][0])||!1===t.type.spec.spanning)break;n++,o++}for(;n<i.length;)r=i.pop()[1];for(;o<e.marks.length;){let n=e.marks[o++],a=this.serializeMark(n,e.isInline,t);a&&(i.push([n,r]),r.appendChild(a.dom),r=a.contentDOM||a.dom)}}r.appendChild(this.serializeNodeInner(e,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:r}=renderSpec(doc(t),this.nodes[e.type.name](e),null,e.attrs);if(r){if(e.isLeaf)throw RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,r)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let r=e.marks.length-1;r>=0;r--){let i=this.serializeMark(e.marks[r],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(n),n=i.dom)}return n}serializeMark(e,t,n={}){let r=this.marks[e.type.name];return r&&renderSpec(doc(n),r(e,t),null,e.attrs)}static renderSpec(e,t,n=null,r){return renderSpec(e,t,n,r)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new DOMSerializer(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=gatherToDOM(e.nodes);return t.text||(t.text=e=>e.text),t}static marksFromSchema(e){return gatherToDOM(e.marks)}};function gatherToDOM(e){let t={};for(let n in e){let r=e[n].spec.toDOM;r&&(t[n]=r)}return t}function doc(e){return e.document||window.document}let u=new WeakMap;function renderSpec(e,t,n,r){let i,o,a;if("string"==typeof t)return{dom:e.createTextNode(t)};if(null!=t.nodeType)return{dom:t};if(t.dom&&null!=t.dom.nodeType)return t;let l=t[0],d;if("string"!=typeof l)throw RangeError("Invalid array passed to renderSpec");if(r&&(void 0===(o=u.get(r))&&u.set(r,(a=null,function scan(e){if(e&&"object"==typeof e){if(Array.isArray(e)){if("string"==typeof e[0])a||(a=[]),a.push(e);else for(let t=0;t<e.length;t++)scan(e[t])}else for(let t in e)scan(e[t])}}(r),o=a)),d=o)&&d.indexOf(t)>-1)throw RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let c=l.indexOf(" ");c>0&&(n=l.slice(0,c),l=l.slice(c+1));let h=n?e.createElementNS(n,l):e.createElement(l),p=t[1],f=1;if(p&&"object"==typeof p&&null==p.nodeType&&!Array.isArray(p)){for(let e in f=2,p)if(null!=p[e]){let t=e.indexOf(" ");t>0?h.setAttributeNS(e.slice(0,t),e.slice(t+1),p[e]):h.setAttribute(e,p[e])}}for(let o=f;o<t.length;o++){let a=t[o];if(0===a){if(o<t.length-1||o>f)throw RangeError("Content hole must be the only child of its parent node");return{dom:h,contentDOM:h}}{let{dom:t,contentDOM:o}=renderSpec(e,a,n,r);if(h.appendChild(t),o){if(i)throw RangeError("Multiple content holes");i=o}}}return{dom:h,contentDOM:i}}},62483:function(e,t,n){"use strict";n.d(t,{IB:function(){return liftListItem},KI:function(){return wrapInList},bw:function(){return sinkListItem}});var r=n(62312),i=n(22059);function wrapInList(e,t=null){return function(n,o){let{$from:a,$to:l}=n.selection,d=a.blockRange(l);if(!d)return!1;let c=o?n.tr:null;return!!function(e,t,n,o=null){let a=!1,l=t,d=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(n)&&0==t.startIndex){if(0==t.$from.index(t.depth-1))return!1;let e=d.resolve(t.start-2);l=new i.Ts(e,e,t.depth),t.endIndex<t.parent.childCount&&(t=new i.Ts(t.$from,d.resolve(t.$to.end(t.depth)),t.depth)),a=!0}let c=(0,r.nd)(l,n,o,t);return!!c&&(e&&function(e,t,n,o,a){let l=i.HY.empty;for(let e=n.length-1;e>=0;e--)l=i.HY.from(n[e].type.create(n[e].attrs,l));e.step(new r.FC(t.start-(o?2:0),t.end,t.start,t.end,new i.p2(l,0,0),n.length,!0));let d=0;for(let e=0;e<n.length;e++)n[e].type==a&&(d=e+1);let c=n.length-d,u=t.start+n.length-(o?2:0),h=t.parent;for(let n=t.startIndex,i=t.endIndex,o=!0;n<i;n++,o=!1)!o&&(0,r.Ax)(e.doc,u,c)&&(e.split(u,c),u+=2*c),u+=h.child(n).nodeSize}(e,t,c,a,n),!0)}(c,d,e,t)&&(o&&o(c.scrollIntoView()),!0)}}function liftListItem(e){return function(t,n){let{$from:o,$to:a}=t.selection,l=o.blockRange(a,t=>t.childCount>0&&t.firstChild.type==e);return!!l&&(!n||(o.node(l.depth-1).type==e?function(e,t,n,o){let a=e.tr,l=o.end,d=o.$to.end(o.depth);l<d&&(a.step(new r.FC(l-1,d,l,d,new i.p2(i.HY.from(n.create(null,o.parent.copy())),1,0),1,!0)),o=new i.Ts(a.doc.resolve(o.$from.pos),a.doc.resolve(d),o.depth));let c=(0,r.k9)(o);if(null==c)return!1;a.lift(o,c);let u=a.doc.resolve(a.mapping.map(l,-1)-1);return(0,r.Mn)(a.doc,u.pos)&&u.nodeBefore.type==u.nodeAfter.type&&a.join(u.pos),t(a.scrollIntoView()),!0}(t,n,e,l):function(e,t,n){let o=e.tr,a=n.parent;for(let e=n.end,t=n.endIndex-1,r=n.startIndex;t>r;t--)e-=a.child(t).nodeSize,o.delete(e-1,e+1);let l=o.doc.resolve(n.start),d=l.nodeAfter;if(o.mapping.map(n.end)!=n.start+l.nodeAfter.nodeSize)return!1;let c=0==n.startIndex,u=n.endIndex==a.childCount,h=l.node(-1),p=l.index(-1);if(!h.canReplace(p+(c?0:1),p+1,d.content.append(u?i.HY.empty:i.HY.from(a))))return!1;let f=l.pos,g=f+d.nodeSize;return o.step(new r.FC(f-(c?1:0),g+(u?1:0),f+1,g-1,new i.p2((c?i.HY.empty:i.HY.from(a.copy(i.HY.empty))).append(u?i.HY.empty:i.HY.from(a.copy(i.HY.empty))),c?0:1,u?0:1),c?0:1)),t(o.scrollIntoView()),!0}(t,n,l)))}}function sinkListItem(e){return function(t,n){let{$from:o,$to:a}=t.selection,l=o.blockRange(a,t=>t.childCount>0&&t.firstChild.type==e);if(!l)return!1;let d=l.startIndex;if(0==d)return!1;let c=l.parent,u=c.child(d-1);if(u.type!=e)return!1;if(n){let o=u.lastChild&&u.lastChild.type==c.type,a=i.HY.from(o?e.create():null),d=new i.p2(i.HY.from(e.create(null,i.HY.from(c.type.create(null,a)))),o?3:1,0),h=l.start,p=l.end;n(t.tr.step(new r.FC(h-(o?3:1),p,h,p,d,1,!0)).scrollIntoView())}return!0}}},87789:function(e,t,n){"use strict";n.d(t,{Bs:function(){return TextSelection},C1:function(){return AllSelection},H$:function(){return PluginKey},Sy:function(){return Plugin},Y1:function(){return Selection},qv:function(){return NodeSelection},yy:function(){return EditorState}});var r=n(22059),i=n(62312);let o=Object.create(null);let Selection=class Selection{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new SelectionRange(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=r.p2.empty){let n=t.content.lastChild,i=null;for(let e=0;e<t.openEnd;e++)i=n,n=n.lastChild;let o=e.steps.length,a=this.ranges;for(let l=0;l<a.length;l++){let{$from:d,$to:c}=a[l],u=e.mapping.slice(o);e.replaceRange(u.map(d.pos),u.map(c.pos),l?r.p2.empty:t),0==l&&selectionToInsertionEnd(e,o,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let i=0;i<r.length;i++){let{$from:o,$to:a}=r[i],l=e.mapping.slice(n),d=l.map(o.pos),c=l.map(a.pos);i?e.deleteRange(d,c):(e.replaceRangeWith(d,c,t),selectionToInsertionEnd(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new TextSelection(e):findSelectionIn(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let r=e.depth-1;r>=0;r--){let i=t<0?findSelectionIn(e.node(0),e.node(r),e.before(r+1),e.index(r),t,n):findSelectionIn(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,n);if(i)return i}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new AllSelection(e.node(0))}static atStart(e){return findSelectionIn(e,e,0,0,1)||new AllSelection(e)}static atEnd(e){return findSelectionIn(e,e,e.content.size,e.childCount,-1)||new AllSelection(e)}static fromJSON(e,t){if(!t||!t.type)throw RangeError("Invalid input for Selection.fromJSON");let n=o[t.type];if(!n)throw RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in o)throw RangeError("Duplicate use of selection JSON ID "+e);return o[e]=t,t.prototype.jsonID=e,t}getBookmark(){return TextSelection.between(this.$anchor,this.$head).getBookmark()}};Selection.prototype.visible=!0;let SelectionRange=class SelectionRange{constructor(e,t){this.$from=e,this.$to=t}};let a=!1;function checkTextSelection(e){a||e.parent.inlineContent||(a=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}let TextSelection=class TextSelection extends Selection{constructor(e,t=e){checkTextSelection(e),checkTextSelection(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Selection.near(n);let r=e.resolve(t.map(this.anchor));return new TextSelection(r.parent.inlineContent?r:n,n)}replace(e,t=r.p2.empty){if(super.replace(e,t),t==r.p2.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof TextSelection&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new TextBookmark(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw RangeError("Invalid input for TextSelection.fromJSON");return new TextSelection(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(e,t,n){let r=e.pos-t.pos;if((!n||r)&&(n=r>=0?1:-1),!t.parent.inlineContent){let e=Selection.findFrom(t,n,!0)||Selection.findFrom(t,-n,!0);if(!e)return Selection.near(t,n);t=e.$head}return e.parent.inlineContent||(0==r?e=t:(e=(Selection.findFrom(e,-n,!0)||Selection.findFrom(e,n,!0)).$anchor).pos<t.pos==r<0||(e=t)),new TextSelection(e,t)}};Selection.jsonID("text",TextSelection);let TextBookmark=class TextBookmark{constructor(e,t){this.anchor=e,this.head=t}map(e){return new TextBookmark(e.map(this.anchor),e.map(this.head))}resolve(e){return TextSelection.between(e.resolve(this.anchor),e.resolve(this.head))}};let NodeSelection=class NodeSelection extends Selection{constructor(e){let t=e.nodeAfter;super(e,e.node(0).resolve(e.pos+t.nodeSize)),this.node=t}map(e,t){let{deleted:n,pos:r}=t.mapResult(this.anchor),i=e.resolve(r);return n?Selection.near(i):new NodeSelection(i)}content(){return new r.p2(r.HY.from(this.node),0,0)}eq(e){return e instanceof NodeSelection&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new NodeBookmark(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw RangeError("Invalid input for NodeSelection.fromJSON");return new NodeSelection(e.resolve(t.anchor))}static create(e,t){return new NodeSelection(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}};NodeSelection.prototype.visible=!1,Selection.jsonID("node",NodeSelection);let NodeBookmark=class NodeBookmark{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new TextBookmark(n,n):new NodeBookmark(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&NodeSelection.isSelectable(n)?new NodeSelection(t):Selection.near(t)}};let AllSelection=class AllSelection extends Selection{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=r.p2.empty){if(t==r.p2.empty){e.delete(0,e.doc.content.size);let t=Selection.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new AllSelection(e)}map(e){return new AllSelection(e)}eq(e){return e instanceof AllSelection}getBookmark(){return l}};Selection.jsonID("all",AllSelection);let l={map(){return this},resolve:e=>new AllSelection(e)};function findSelectionIn(e,t,n,r,i,o=!1){if(t.inlineContent)return TextSelection.create(e,n);for(let a=r-(i>0?0:1);i>0?a<t.childCount:a>=0;a+=i){let r=t.child(a);if(r.isAtom){if(!o&&NodeSelection.isSelectable(r))return NodeSelection.create(e,n-(i<0?r.nodeSize:0))}else{let t=findSelectionIn(e,r,n+i,i<0?r.childCount:0,i,o);if(t)return t}n+=r.nodeSize*i}return null}function selectionToInsertionEnd(e,t,n){let r,o=e.steps.length-1;if(o<t)return;let a=e.steps[o];(a instanceof i.Pu||a instanceof i.FC)&&(e.mapping.maps[o].forEach((e,t,n,i)=>{null==r&&(r=i)}),e.setSelection(Selection.near(e.doc.resolve(r),n)))}let Transaction=class Transaction extends i.wx{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(1|this.updated)&-3,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=2,this}ensureMarks(e){return r.vc.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(e,t){super.addStep(e,t),this.updated=-3&this.updated,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||r.vc.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let r=this.doc.type.schema;if(null==t)return e?this.replaceSelectionWith(r.text(e),!0):this.deleteSelection();{if(null==n&&(n=t),n=null==n?t:n,!e)return this.deleteRange(t,n);let i=this.storedMarks;if(!i){let e=this.doc.resolve(t);i=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,r.text(e,i)),this.selection.empty||this.setSelection(Selection.near(this.selection.$to)),this}}setMeta(e,t){return this.meta["string"==typeof e?e:e.key]=t,this}getMeta(e){return this.meta["string"==typeof e?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}};function bind(e,t){return t&&e?e.bind(t):e}let FieldDesc=class FieldDesc{constructor(e,t,n){this.name=e,this.init=bind(t.init,n),this.apply=bind(t.apply,n)}};let d=[new FieldDesc("doc",{init:e=>e.doc||e.schema.topNodeType.createAndFill(),apply:e=>e.doc}),new FieldDesc("selection",{init:(e,t)=>e.selection||Selection.atStart(t.doc),apply:e=>e.selection}),new FieldDesc("storedMarks",{init:e=>e.storedMarks||null,apply:(e,t,n,r)=>r.selection.$cursor?e.storedMarks:null}),new FieldDesc("scrollToSelection",{init:()=>0,apply:(e,t)=>e.scrolledIntoView?t+1:t})];let Configuration=class Configuration{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=d.slice(),t&&t.forEach(e=>{if(this.pluginsByKey[e.key])throw RangeError("Adding different instances of a keyed plugin ("+e.key+")");this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new FieldDesc(e.key,e.spec.state,e))})}};let EditorState=class EditorState{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),r=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=r?r[o].n:0,d=r?r[o].state:this,c=l<t.length&&a.spec.appendTransaction.call(a,l?t.slice(l):t,d,n);if(c&&n.filterTransaction(c,o)){if(c.setMeta("appendedTransaction",e),!r){r=[];for(let e=0;e<this.config.plugins.length;e++)r.push(e<o?{state:n,n:t.length}:{state:this,n:0})}t.push(c),n=n.applyInner(c),i=!0}r&&(r[o]={state:n,n:t.length})}}if(!i)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw RangeError("Applying a mismatched transaction");let t=new EditorState(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let i=n[r];t[i.name]=i.apply(e,this[i.name],this,t)}return t}get tr(){return new Transaction(this)}static create(e){let t=new Configuration(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new EditorState(t);for(let r=0;r<t.fields.length;r++)n[t.fields[r].name]=t.fields[r].init(e,n);return n}reconfigure(e){let t=new Configuration(this.schema,e.plugins),n=t.fields,r=new EditorState(t);for(let t=0;t<n.length;t++){let i=n[t].name;r[i]=this.hasOwnProperty(i)?this[i]:n[t].init(e,r)}return r}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(e=>e.toJSON())),e&&"object"==typeof e)for(let n in e){if("doc"==n||"selection"==n)throw RangeError("The JSON fields `doc` and `selection` are reserved");let r=e[n],i=r.spec.state;i&&i.toJSON&&(t[n]=i.toJSON.call(r,this[r.key]))}return t}static fromJSON(e,t,n){if(!t)throw RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw RangeError("Required config field 'schema' missing");let i=new Configuration(e.schema,e.plugins),o=new EditorState(i);return i.fields.forEach(i=>{if("doc"==i.name)o.doc=r.NB.fromJSON(e.schema,t.doc);else if("selection"==i.name)o.selection=Selection.fromJSON(o.doc,t.selection);else if("storedMarks"==i.name)t.storedMarks&&(o.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let r in n){let a=n[r],l=a.spec.state;if(a.key==i.name&&l&&l.fromJSON&&Object.prototype.hasOwnProperty.call(t,r)){o[i.name]=l.fromJSON.call(a,e,t[r],o);return}}o[i.name]=i.init(e,o)}}),o}};let Plugin=class Plugin{constructor(e){this.spec=e,this.props={},e.props&&function bindProps(e,t,n){for(let r in e){let i=e[r];i instanceof Function?i=i.bind(t):"handleDOMEvents"==r&&(i=bindProps(i,t,{})),n[r]=i}return n}(e.props,this,this.props),this.key=e.key?e.key.key:createKey("plugin")}getState(e){return e[this.key]}};let c=Object.create(null);function createKey(e){return e in c?e+"$"+ ++c[e]:(c[e]=0,e+"$")}let PluginKey=class PluginKey{constructor(e="key"){this.key=createKey(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}},62312:function(e,t,n){"use strict";n.d(t,{Ax:function(){return canSplit},FC:function(){return ReplaceAroundStep},GJ:function(){return joinPoint},Mn:function(){return canJoin},Pu:function(){return ReplaceStep},dR:function(){return replaceStep},k9:function(){return liftTarget},nd:function(){return findWrapping},nj:function(){return dropPoint},vs:function(){return Mapping},wx:function(){return Transform}});var r=n(22059);let MapResult=class MapResult{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}};let StepMap=class StepMap{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&StepMap.empty)return StepMap.empty}recover(e){let t=0,n=65535&e;if(!this.inverted)for(let e=0;e<n;e++)t+=this.ranges[3*e+2]-this.ranges[3*e+1];return this.ranges[3*n]+t+(e-(65535&e))/65536}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let r=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let d=this.ranges[a+i],c=this.ranges[a+o],u=l+d;if(e<=u){let i=d?e==l?-1:e==u?1:t:t,o=l+r+(i<0?0:c);if(n)return o;let h=e==(t<0?l:u)?null:a/3+(e-l)*65536,p=e==l?2:e==u?1:4;return(t<0?e!=l:e!=u)&&(p|=8),new MapResult(o,p,h)}r+=c-d}return n?e+r:new MapResult(e+r,0,null)}touches(e,t){let n=0,r=65535&t,i=this.inverted?2:1,o=this.inverted?1:2;for(let t=0;t<this.ranges.length;t+=3){let a=this.ranges[t]-(this.inverted?n:0);if(a>e)break;let l=this.ranges[t+i];if(e<=a+l&&t==3*r)return!0;n+=this.ranges[t+o]-l}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,i=0;r<this.ranges.length;r+=3){let o=this.ranges[r],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),d=this.ranges[r+t],c=this.ranges[r+n];e(a,a+d,l,l+c),i+=c-d}}invert(){return new StepMap(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?StepMap.empty:new StepMap(e<0?[0,-e,0]:[0,0,e])}};StepMap.empty=new StepMap([]);let Mapping=class Mapping{constructor(e,t,n=0,r=e?e.length:0){this.mirror=t,this.from=n,this.to=r,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new Mapping(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),null!=t&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let r=e.getMirror(t);this.appendMap(e._maps[t],null!=r&&r<t?n+r:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let r=e.getMirror(t);this.appendMap(e._maps[t].invert(),null!=r&&r>t?n-r-1:void 0)}}invert(){let e=new Mapping;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let r=0;for(let n=this.from;n<this.to;n++){let i=this._maps[n].mapResult(e,t);if(null!=i.recover){let t=this.getMirror(n);if(null!=t&&t>n&&t<this.to){n=t,e=this._maps[t].recover(i.recover);continue}}r|=i.delInfo,e=i.pos}return n?e:new MapResult(e,r,null)}};let i=Object.create(null);let Step=class Step{getMap(){return StepMap.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw RangeError("Invalid input for Step.fromJSON");let n=i[t.stepType];if(!n)throw RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in i)throw RangeError("Duplicate use of step JSON ID "+e);return i[e]=t,t.prototype.jsonID=e,t}};let StepResult=class StepResult{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new StepResult(e,null)}static fail(e){return new StepResult(null,e)}static fromReplace(e,t,n,i){try{return StepResult.ok(e.replace(t,n,i))}catch(e){if(e instanceof r.e4)return StepResult.fail(e.message);throw e}}};function mapFragment(e,t,n){let i=[];for(let r=0;r<e.childCount;r++){let o=e.child(r);o.content.size&&(o=o.copy(mapFragment(o.content,t,o))),o.isInline&&(o=t(o,n,r)),i.push(o)}return r.HY.fromArray(i)}let AddMarkStep=class AddMarkStep extends Step{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),o=new r.p2(mapFragment(t.content,(e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e,i),t.openStart,t.openEnd);return StepResult.fromReplace(e,this.from,this.to,o)}invert(){return new RemoveMarkStep(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new AddMarkStep(t.pos,n.pos,this.mark)}merge(e){return e instanceof AddMarkStep&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new AddMarkStep(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep(t.from,t.to,e.markFromJSON(t.mark))}};Step.jsonID("addMark",AddMarkStep);let RemoveMarkStep=class RemoveMarkStep extends Step{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new r.p2(mapFragment(t.content,e=>e.mark(this.mark.removeFromSet(e.marks)),e),t.openStart,t.openEnd);return StepResult.fromReplace(e,this.from,this.to,n)}invert(){return new AddMarkStep(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new RemoveMarkStep(t.pos,n.pos,this.mark)}merge(e){return e instanceof RemoveMarkStep&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new RemoveMarkStep(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep(t.from,t.to,e.markFromJSON(t.mark))}};Step.jsonID("removeMark",RemoveMarkStep);let AddNodeMarkStep=class AddNodeMarkStep extends Step{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return StepResult.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return StepResult.fromReplace(e,this.pos,this.pos+1,new r.p2(r.HY.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(e))return new AddNodeMarkStep(this.pos,t.marks[n]);return new AddNodeMarkStep(this.pos,this.mark)}}return new RemoveNodeMarkStep(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new AddNodeMarkStep(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new AddNodeMarkStep(t.pos,e.markFromJSON(t.mark))}};Step.jsonID("addNodeMark",AddNodeMarkStep);let RemoveNodeMarkStep=class RemoveNodeMarkStep extends Step{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return StepResult.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return StepResult.fromReplace(e,this.pos,this.pos+1,new r.p2(r.HY.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new AddNodeMarkStep(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new RemoveNodeMarkStep(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new RemoveNodeMarkStep(t.pos,e.markFromJSON(t.mark))}};Step.jsonID("removeNodeMark",RemoveNodeMarkStep);let ReplaceStep=class ReplaceStep extends Step{constructor(e,t,n,r=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=r}apply(e){return this.structure&&contentBetween(e,this.from,this.to)?StepResult.fail("Structure replace would overwrite content"):StepResult.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new StepMap([this.from,this.to-this.from,this.slice.size])}invert(e){return new ReplaceStep(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new ReplaceStep(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof ReplaceStep)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?r.p2.empty:new r.p2(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ReplaceStep(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?r.p2.empty:new r.p2(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ReplaceStep(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep(t.from,t.to,r.p2.fromJSON(e,t.slice),!!t.structure)}};Step.jsonID("replace",ReplaceStep);let ReplaceAroundStep=class ReplaceAroundStep extends Step{constructor(e,t,n,r,i,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=r,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(contentBetween(e,this.from,this.gapFrom)||contentBetween(e,this.gapTo,this.to)))return StepResult.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return StepResult.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?StepResult.fromReplace(e,this.from,this.to,n):StepResult.fail("Content does not fit in gap")}getMap(){return new StepMap([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new ReplaceAroundStep(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),r=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||r<t.pos||i>n.pos?null:new ReplaceAroundStep(t.pos,n.pos,r,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep(t.from,t.to,t.gapFrom,t.gapTo,r.p2.fromJSON(e,t.slice),t.insert,!!t.structure)}};function contentBetween(e,t,n){let r=e.resolve(t),i=n-t,o=r.depth;for(;i>0&&o>0&&r.indexAfter(o)==r.node(o).childCount;)o--,i--;if(i>0){let e=r.node(o).maybeChild(r.indexAfter(o));for(;i>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,i--}}return!1}function clearIncompatible(e,t,n,i=n.contentMatch,o=!0){let a=e.doc.nodeAt(t),l=[],d=t+1;for(let t=0;t<a.childCount;t++){let c=a.child(t),u=d+c.nodeSize,h=i.matchType(c.type);if(h){i=h;for(let t=0;t<c.marks.length;t++)n.allowsMarkType(c.marks[t].type)||e.step(new RemoveMarkStep(d,u,c.marks[t]));if(o&&c.isText&&"pre"!=n.whitespace){let e,t=/\r?\n|\r/g,i;for(;e=t.exec(c.text);)i||(i=new r.p2(r.HY.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),l.push(new ReplaceStep(d+e.index,d+e.index+e[0].length,i))}}else l.push(new ReplaceStep(d,u,r.p2.empty));d=u}if(!i.validEnd){let t=i.fillBefore(r.HY.empty,!0);e.replace(d,d,new r.p2(t,0,0))}for(let t=l.length-1;t>=0;t--)e.step(l[t])}function liftTarget(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth;;--n){let r=e.$from.node(n),i=e.$from.index(n),o=e.$to.indexAfter(n);if(n<e.depth&&r.canReplace(i,o,t))return n;if(0==n||r.type.spec.isolating||!((0==i||r.canReplace(i,r.childCount))&&(o==r.childCount||r.canReplace(0,o))))break}return null}function findWrapping(e,t,n=null,r=e){let i=function(e,t){let{parent:n,startIndex:r,endIndex:i}=e,o=n.contentMatchAt(r).findWrapping(t);if(!o)return null;let a=o.length?o[0]:t;return n.canReplaceWith(r,i,a)?o:null}(e,t),o=i&&function(e,t){let{parent:n,startIndex:r,endIndex:i}=e,o=n.child(r),a=t.contentMatch.findWrapping(o.type);if(!a)return null;let l=(a.length?a[a.length-1]:t).contentMatch;for(let e=r;l&&e<i;e++)l=l.matchType(n.child(e).type);return l&&l.validEnd?a:null}(r,t);return o?i.map(withAttrs).concat({type:t,attrs:n}).concat(o.map(withAttrs)):null}function withAttrs(e){return{type:e,attrs:null}}function replaceNewlines(e,t,n,r){t.forEach((i,o)=>{if(i.isText){let a,l=/\r?\n|\r/g;for(;a=l.exec(i.text);){let i=e.mapping.slice(r).map(n+1+o+a.index);e.replaceWith(i,i+1,t.type.schema.linebreakReplacement.create())}}})}function replaceLinebreaks(e,t,n,r){t.forEach((i,o)=>{if(i.type==i.type.schema.linebreakReplacement){let i=e.mapping.slice(r).map(n+1+o);e.replaceWith(i,i+1,t.type.schema.text("\n"))}})}function canSplit(e,t,n=1,r){let i=e.resolve(t),o=i.depth-n,a=r&&r[r.length-1]||i.parent;if(o<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!a.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let e=i.depth-1,t=n-2;e>o;e--,t--){let n=i.node(e),o=i.index(e);if(n.type.spec.isolating)return!1;let a=n.content.cutByIndex(o,n.childCount),l=r&&r[t+1];l&&(a=a.replaceChild(0,l.type.create(l.attrs)));let d=r&&r[t]||n;if(!n.canReplace(o+1,n.childCount)||!d.type.validContent(a))return!1}let l=i.indexAfter(o),d=r&&r[0];return i.node(o).canReplaceWith(l,l,d?d.type:i.node(o+1).type)}function canJoin(e,t){let n=e.resolve(t),r=n.index();return joinable(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function joinable(e,t){return!!(e&&t&&!e.isLeaf&&function(e,t){t.content.size||e.type.compatibleContent(t.type);let n=e.contentMatchAt(e.childCount),{linebreakReplacement:r}=e.type.schema;for(let i=0;i<t.childCount;i++){let o=t.child(i),a=o.type==r?e.type.schema.nodes.text:o.type;if(!(n=n.matchType(a))||!e.type.allowsMarks(o.marks))return!1}return n.validEnd}(e,t))}function joinPoint(e,t,n=-1){let r=e.resolve(t);for(let e=r.depth;;e--){let i,o,a=r.index(e);if(e==r.depth?(i=r.nodeBefore,o=r.nodeAfter):n>0?(i=r.node(e+1),a++,o=r.node(e).maybeChild(a)):(i=r.node(e).maybeChild(a-1),o=r.node(e+1)),i&&!i.isTextblock&&joinable(i,o)&&r.node(e).canReplace(a,a+1))return t;if(0==e)break;t=n<0?r.before(e):r.after(e)}}function dropPoint(e,t,n){let r=e.resolve(t);if(!n.content.size)return t;let i=n.content;for(let e=0;e<n.openStart;e++)i=i.firstChild.content;for(let e=1;e<=(0==n.openStart&&n.size?2:1);e++)for(let t=r.depth;t>=0;t--){let n=t==r.depth?0:r.pos<=(r.start(t+1)+r.end(t+1))/2?-1:1,o=r.index(t)+(n>0?1:0),a=r.node(t),l=!1;if(1==e)l=a.canReplace(o,o,i);else{let e=a.contentMatchAt(o).findWrapping(i.firstChild.type);l=e&&a.canReplaceWith(o,o,e[0])}if(l)return 0==n?r.pos:n<0?r.before(t+1):r.after(t+1)}return null}function replaceStep(e,t,n=t,i=r.p2.empty){if(t==n&&!i.size)return null;let o=e.resolve(t),a=e.resolve(n);return fitsTrivially(o,a,i)?new ReplaceStep(t,n,i):new Fitter(o,a,i).fit()}function fitsTrivially(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}Step.jsonID("replaceAround",ReplaceAroundStep);let Fitter=class Fitter{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=r.HY.empty;for(let t=0;t<=e.depth;t++){let n=e.node(t);this.frontier.push({type:n.type,match:n.contentMatchAt(e.indexAfter(t))})}for(let t=e.depth;t>0;t--)this.placed=r.HY.from(e.node(t).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let o=this.placed,a=n.depth,l=i.depth;for(;a&&l&&1==o.childCount;)o=o.firstChild.content,a--,l--;let d=new r.p2(o,a,l);return e>-1?new ReplaceAroundStep(n.pos,e,this.$to.pos,this.$to.end(),d,t):d.size||n.pos!=this.$to.pos?new ReplaceStep(n.pos,i.pos,d):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<e;n++){let i=t.firstChild;if(t.childCount>1&&(r=0),i.type.spec.isolating&&r<=n){e=n;break}t=i.content}for(let t=1;t<=2;t++)for(let n=1==t?e:this.unplaced.openStart;n>=0;n--){let e=null,i=(n?(e=contentAt(this.unplaced.content,n-1).firstChild).content:this.unplaced.content).firstChild;for(let o=this.depth;o>=0;o--){let{type:a,match:l}=this.frontier[o],d,c=null;if(1==t&&(i?l.matchType(i.type)||(c=l.fillBefore(r.HY.from(i),!1)):e&&a.compatibleContent(e.type)))return{sliceDepth:n,frontierDepth:o,parent:e,inject:c};if(2==t&&i&&(d=l.findWrapping(i.type)))return{sliceDepth:n,frontierDepth:o,parent:e,wrap:d};if(e&&l.matchType(e.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=contentAt(e,t);return!!i.childCount&&!i.firstChild.isLeaf&&(this.unplaced=new r.p2(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=contentAt(e,t);if(i.childCount<=1&&t>0){let o=e.size-t<=t+i.size;this.unplaced=new r.p2(dropFromFragment(e,t-1,1),t-1,o?t-1:n)}else this.unplaced=new r.p2(dropFromFragment(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:o}){for(;this.depth>t;)this.closeFrontierNode();if(o)for(let e=0;e<o.length;e++)this.openFrontierNode(o[e]);let a=this.unplaced,l=n?n.content:a.content,d=a.openStart-e,c=0,u=[],{match:h,type:p}=this.frontier[t];if(i){for(let e=0;e<i.childCount;e++)u.push(i.child(e));h=h.matchFragment(i)}let f=l.size+e-(a.content.size-a.openEnd);for(;c<l.childCount;){let e=l.child(c),t=h.matchType(e.type);if(!t)break;(++c>1||0==d||e.content.size)&&(h=t,u.push(function closeNodeStart(e,t,n){if(t<=0)return e;let i=e.content;return t>1&&(i=i.replaceChild(0,closeNodeStart(i.firstChild,t-1,1==i.childCount?n-1:0))),t>0&&(i=e.type.contentMatch.fillBefore(i).append(i),n<=0&&(i=i.append(e.type.contentMatch.matchFragment(i).fillBefore(r.HY.empty,!0)))),e.copy(i)}(e.mark(p.allowedMarks(e.marks)),1==c?d:0,c==l.childCount?f:-1)))}let g=c==l.childCount;g||(f=-1),this.placed=addToFragment(this.placed,t,r.HY.from(u)),this.frontier[t].match=h,g&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let e=0,t=l;e<f;e++){let e=t.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),t=e.content}this.unplaced=g?0==e?r.p2.empty:new r.p2(dropFromFragment(a.content,e-1,1),e-1,f<0?a.openEnd:e-1):new r.p2(dropFromFragment(a.content,e,c),a.openStart,a.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return -1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return -1;let{depth:n}=this.$to,r=this.$to.after(n);for(;n>1&&r==this.$to.end(--n);)++r;return r}findCloseLevel(e){i:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:r}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=contentAfterFits(e,t,r,n,i);if(o){for(let n=t-1;n>=0;n--){let{match:t,type:r}=this.frontier[n],i=contentAfterFits(e,n,r,t,!0);if(!i||i.childCount)continue i}return{depth:t,fit:o,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=addToFragment(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),r=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,r)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=addToFragment(this.placed,this.depth,r.HY.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(r.HY.empty,!0);e.childCount&&(this.placed=addToFragment(this.placed,this.frontier.length,e))}};function dropFromFragment(e,t,n){return 0==t?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(dropFromFragment(e.firstChild.content,t-1,n)))}function addToFragment(e,t,n){return 0==t?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(addToFragment(e.lastChild.content,t-1,n)))}function contentAt(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function contentAfterFits(e,t,n,r,i){let o=e.node(t),a=i?e.indexAfter(t):e.index(t);if(a==o.childCount&&!n.compatibleContent(o.type))return null;let l=r.fillBefore(o.content,!0,a);return l&&!function(e,t,n){for(let r=n;r<t.childCount;r++)if(!e.allowsMarks(t.child(r).marks))return!0;return!1}(n,o.content,a)?l:null}function coveredDepths(e,t){let n=[],r=Math.min(e.depth,t.depth);for(let i=r;i>=0;i--){let r=e.start(i);if(r<e.pos-(e.depth-i)||t.end(i)>t.pos+(t.depth-i)||e.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(r==t.start(i)||i==e.depth&&i==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==r-1)&&n.push(i)}return n}let AttrStep=class AttrStep extends Step{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return StepResult.fail("No node at attribute step's position");let n=Object.create(null);for(let e in t.attrs)n[e]=t.attrs[e];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return StepResult.fromReplace(e,this.pos,this.pos+1,new r.p2(r.HY.from(i),0,t.isLeaf?0:1))}getMap(){return StepMap.empty}invert(e){return new AttrStep(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new AttrStep(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw RangeError("Invalid input for AttrStep.fromJSON");return new AttrStep(t.pos,t.attr,t.value)}};Step.jsonID("attr",AttrStep);let DocAttrStep=class DocAttrStep extends Step{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let n in e.attrs)t[n]=e.attrs[n];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return StepResult.ok(n)}getMap(){return StepMap.empty}invert(e){return new DocAttrStep(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if("string"!=typeof t.attr)throw RangeError("Invalid input for DocAttrStep.fromJSON");return new DocAttrStep(t.attr,t.value)}};Step.jsonID("docAttr",DocAttrStep);let o=class extends Error{};(o=function TransformError(e){let t=Error.call(this,e);return t.__proto__=TransformError.prototype,t}).prototype=Object.create(Error.prototype),o.prototype.constructor=o,o.prototype.name="TransformError";let Transform=class Transform{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Mapping}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new o(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=r.p2.empty){let i=replaceStep(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new r.p2(r.HY.from(n),0,0))}delete(e,t){return this.replace(e,t,r.p2.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return!function(e,t,n,i){if(!i.size)return e.deleteRange(t,n);let o=e.doc.resolve(t),a=e.doc.resolve(n);if(fitsTrivially(o,a,i))return e.step(new ReplaceStep(t,n,i));let l=coveredDepths(o,e.doc.resolve(n));0==l[l.length-1]&&l.pop();let d=-(o.depth+1);l.unshift(d);for(let e=o.depth,t=o.pos-1;e>0;e--,t--){let n=o.node(e).type.spec;if(n.defining||n.definingAsContext||n.isolating)break;l.indexOf(e)>-1?d=e:o.before(e)==t&&l.splice(1,0,-e)}let c=l.indexOf(d),u=[],h=i.openStart;for(let e=i.content,t=0;;t++){let n=e.firstChild;if(u.push(n),t==i.openStart)break;e=n.content}for(let e=h-1;e>=0;e--){var p;let t=u[e],n=(p=t.type).spec.defining||p.spec.definingForContent;if(n&&!t.sameMarkup(o.node(Math.abs(d)-1)))h=e;else if(n||!t.type.isTextblock)break}for(let t=i.openStart;t>=0;t--){let d=(t+h+1)%(i.openStart+1),p=u[d];if(p)for(let t=0;t<l.length;t++){let u=l[(t+c)%l.length],h=!0;u<0&&(h=!1,u=-u);let f=o.node(u-1),g=o.index(u-1);if(f.canReplaceWith(g,g,p.type,p.marks))return e.replace(o.before(u),h?a.after(u):n,new r.p2(function closeFragment(e,t,n,i,o){if(t<n){let r=e.firstChild;e=e.replaceChild(0,r.copy(closeFragment(r.content,t+1,n,i,r)))}if(t>i){let t=o.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(r.HY.empty,!0))}return e}(i.content,0,i.openStart,d),d,i.openEnd))}}let f=e.steps.length;for(let r=l.length-1;r>=0&&(e.replace(t,n,i),!(e.steps.length>f));r--){let e=l[r];e<0||(t=o.before(e),n=a.after(e))}}(this,e,t,n),this}replaceRangeWith(e,t,n){return!function(e,t,n,i){if(!i.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let r=function(e,t,n){let r=e.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),n))return t;if(0==r.parentOffset)for(let e=r.depth-1;e>=0;e--){let t=r.index(e);if(r.node(e).canReplaceWith(t,t,n))return r.before(e+1);if(t>0)return null}if(r.parentOffset==r.parent.content.size)for(let e=r.depth-1;e>=0;e--){let t=r.indexAfter(e);if(r.node(e).canReplaceWith(t,t,n))return r.after(e+1);if(t<r.node(e).childCount)break}return null}(e.doc,t,i.type);null!=r&&(t=n=r)}e.replaceRange(t,n,new r.p2(r.HY.from(i),0,0))}(this,e,t,n),this}deleteRange(e,t){return!function(e,t,n){let r=e.doc.resolve(t),i=e.doc.resolve(n),o=coveredDepths(r,i);for(let t=0;t<o.length;t++){let n=o[t],a=t==o.length-1;if(a&&0==n||r.node(n).type.contentMatch.validEnd)return e.delete(r.start(n),i.end(n));if(n>0&&(a||r.node(n-1).canReplace(r.index(n-1),i.indexAfter(n-1))))return e.delete(r.before(n),i.after(n))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(t-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o&&r.start(o-1)==i.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),i.index(o-1)))return e.delete(r.before(o),n);e.delete(t,n)}(this,e,t),this}lift(e,t){return!function(e,t,n){let{$from:i,$to:o,depth:a}=t,l=i.before(a+1),d=o.after(a+1),c=l,u=d,h=r.HY.empty,p=0;for(let e=a,t=!1;e>n;e--)t||i.index(e)>0?(t=!0,h=r.HY.from(i.node(e).copy(h)),p++):c--;let f=r.HY.empty,g=0;for(let e=a,t=!1;e>n;e--)t||o.after(e+1)<o.end(e)?(t=!0,f=r.HY.from(o.node(e).copy(f)),g++):u++;e.step(new ReplaceAroundStep(c,u,l,d,new r.p2(h.append(f),p,g),h.size-p,!0))}(this,e,t),this}join(e,t=1){return!function(e,t,n){let i=null,{linebreakReplacement:o}=e.doc.type.schema,a=e.doc.resolve(t-n),l=a.node().type;if(o&&l.inlineContent){let e="pre"==l.whitespace,t=!!l.contentMatch.matchType(o);e&&!t?i=!1:!e&&t&&(i=!0)}let d=e.steps.length;if(!1===i){let r=e.doc.resolve(t+n);replaceLinebreaks(e,r.node(),r.before(),d)}l.inlineContent&&clearIncompatible(e,t+n-1,l,a.node().contentMatchAt(a.index()),null==i);let c=e.mapping.slice(d),u=c.map(t-n);if(e.step(new ReplaceStep(u,c.map(t+n,-1),r.p2.empty,!0)),!0===i){let t=e.doc.resolve(u);replaceNewlines(e,t.node(),t.before(),e.steps.length)}}(this,e,t),this}wrap(e,t){return!function(e,t,n){let i=r.HY.empty;for(let e=n.length-1;e>=0;e--){if(i.size){let t=n[e].type.contentMatch.matchFragment(i);if(!t||!t.validEnd)throw RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=r.HY.from(n[e].type.create(n[e].attrs,i))}let o=t.start,a=t.end;e.step(new ReplaceAroundStep(o,a,o,a,new r.p2(i,0,0),n.length,!0))}(this,e,t),this}setBlockType(e,t=e,n,i=null){return!function(e,t,n,i,o){if(!i.isTextblock)throw RangeError("Type given to setBlockType should be a textblock");let a=e.steps.length;e.doc.nodesBetween(t,n,(t,n)=>{var l,d;let c,u,h="function"==typeof o?o(t):o;if(t.isTextblock&&!t.hasMarkup(i,h)&&(l=e.doc,d=e.mapping.slice(a).map(n),u=(c=l.resolve(d)).index(),c.parent.canReplaceWith(u,u+1,i))){let o=null;if(i.schema.linebreakReplacement){let e="pre"==i.whitespace,t=!!i.contentMatch.matchType(i.schema.linebreakReplacement);e&&!t?o=!1:!e&&t&&(o=!0)}!1===o&&replaceLinebreaks(e,t,n,a),clearIncompatible(e,e.mapping.slice(a).map(n,1),i,void 0,null===o);let l=e.mapping.slice(a),d=l.map(n,1),c=l.map(n+t.nodeSize,1);return e.step(new ReplaceAroundStep(d,c,d+1,c-1,new r.p2(r.HY.from(i.create(h,null,t.marks)),0,0),1,!0)),!0===o&&replaceNewlines(e,t,n,a),!1}})}(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i){return!function(e,t,n,i,o){let a=e.doc.nodeAt(t);if(!a)throw RangeError("No node at given position");n||(n=a.type);let l=n.create(i,null,o||a.marks);if(a.isLeaf)return e.replaceWith(t,t+a.nodeSize,l);if(!n.validContent(a.content))throw RangeError("Invalid content for node type "+n.name);e.step(new ReplaceAroundStep(t,t+a.nodeSize,t+1,t+a.nodeSize-1,new r.p2(r.HY.from(l),0,0),1,!0))}(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new AttrStep(e,t,n)),this}setDocAttribute(e,t){return this.step(new DocAttrStep(e,t)),this}addNodeMark(e,t){return this.step(new AddNodeMarkStep(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw RangeError("No node at position "+e);if(t instanceof r.vc)t.isInSet(n.marks)&&this.step(new RemoveNodeMarkStep(e,t));else{let r=n.marks,i,o=[];for(;i=t.isInSet(r);)o.push(new RemoveNodeMarkStep(e,i)),r=i.removeFromSet(r);for(let e=o.length-1;e>=0;e--)this.step(o[e])}return this}split(e,t=1,n){return!function(e,t,n=1,i){let o=e.doc.resolve(t),a=r.HY.empty,l=r.HY.empty;for(let e=o.depth,t=o.depth-n,d=n-1;e>t;e--,d--){a=r.HY.from(o.node(e).copy(a));let t=i&&i[d];l=r.HY.from(t?t.type.create(t.attrs,l):o.node(e).copy(l))}e.step(new ReplaceStep(t,t,new r.p2(a.append(l),n,n),!0))}(this,e,t,n),this}addMark(e,t,n){var r;let i,o,a,l;return r=this,a=[],l=[],r.doc.nodesBetween(e,t,(r,d,c)=>{if(!r.isInline)return;let u=r.marks;if(!n.isInSet(u)&&c.type.allowsMarkType(n.type)){let c=Math.max(d,e),h=Math.min(d+r.nodeSize,t),p=n.addToSet(u);for(let e=0;e<u.length;e++)u[e].isInSet(p)||(i&&i.to==c&&i.mark.eq(u[e])?i.to=h:a.push(i=new RemoveMarkStep(c,h,u[e])));o&&o.to==c?o.to=h:l.push(o=new AddMarkStep(c,h,n))}}),a.forEach(e=>r.step(e)),l.forEach(e=>r.step(e)),this}removeMark(e,t,n){var i;let o,a;return i=this,o=[],a=0,i.doc.nodesBetween(e,t,(i,l)=>{if(!i.isInline)return;a++;let d=null;if(n instanceof r.ZU){let e=i.marks,t;for(;t=n.isInSet(e);)(d||(d=[])).push(t),e=t.removeFromSet(e)}else n?n.isInSet(i.marks)&&(d=[n]):d=i.marks;if(d&&d.length){let n=Math.min(l+i.nodeSize,t);for(let t=0;t<d.length;t++){let r=d[t],i;for(let e=0;e<o.length;e++){let t=o[e];t.step==a-1&&r.eq(o[e].style)&&(i=t)}i?(i.to=n,i.step=a):o.push({style:r,from:Math.max(l,e),to:n,step:a})}}}),o.forEach(e=>i.step(new RemoveMarkStep(e.from,e.to,e.style))),this}clearIncompatible(e,t,n){return clearIncompatible(this,e,t,n),this}}},86223:function(e,t,n){"use strict";n.r(t),n.d(t,{ARROW_LABEL_FONT_SIZES:function(){return r2},ASPECT_RATIO_OPTIONS:function(){return rY},ASPECT_RATIO_TO_VALUE:function(){return rX},AlignMenuItems:function(){return AlignMenuItems},Arc2d:function(){return Arc2d},ArrangeMenuSubmenu:function(){return ArrangeMenuSubmenu},ArrayOfValidator:function(){return N.UR},ArraySet:function(){return F.Ip},ArrowBindingUtil:function(){return ArrowBindingUtil},ArrowDownToolbarItem:function(){return ArrowDownToolbarItem},ArrowLeftToolbarItem:function(){return ArrowLeftToolbarItem},ArrowRightToolbarItem:function(){return ArrowRightToolbarItem},ArrowShapeArrowheadEndStyle:function(){return L.ZJ},ArrowShapeArrowheadStartStyle:function(){return L.TA},ArrowShapeKindStyle:function(){return L.dR},ArrowShapeTool:function(){return ArrowShapeTool},ArrowShapeUtil:function(){return ArrowShapeUtil},ArrowToolbarItem:function(){return ArrowToolbarItem},ArrowUpToolbarItem:function(){return ArrowUpToolbarItem},ArrowheadStylePickerSet:function(){return ArrowheadStylePickerSet},AssetRecordType:function(){return L.Yk},AssetToolbarItem:function(){return AssetToolbarItem},AssetUrlsProvider:function(){return AssetUrlsProvider},AtomMap:function(){return R.X0},BaseBoxShapeTool:function(){return BaseBoxShapeTool},BaseBoxShapeUtil:function(){return BaseBoxShapeUtil},BindingUtil:function(){return BindingUtil},BookmarkShapeUtil:function(){return BookmarkShapeUtil},BoundsSnaps:function(){return eE.J},Box:function(){return e9.xu},BreakPointProvider:function(){return BreakPointProvider},CameraRecordType:function(){return L.AN},CenteredTopPanelContainer:function(){return CenteredTopPanelContainer},CheckBoxToolbarItem:function(){return CheckBoxToolbarItem},Circle2d:function(){return Circle2d},ClickManager:function(){return eT.o},ClipboardMenuGroup:function(){return ClipboardMenuGroup},CloudToolbarItem:function(){return CloudToolbarItem},ColorSchemeMenu:function(){return ColorSchemeMenu},CommonStylePickerSet:function(){return CommonStylePickerSet},ContainerProvider:function(){return eG.jm},ContextMenu:function(){return sf},ConversionsMenuGroup:function(){return ConversionsMenuGroup},ConvertToBookmarkMenuItem:function(){return ConvertToBookmarkMenuItem},ConvertToEmbedMenuItem:function(){return ConvertToEmbedMenuItem},CopyAsMenuGroup:function(){return CopyAsMenuGroup},CopyMenuItem:function(){return CopyMenuItem},CubicBezier2d:function(){return CubicBezier2d},CubicSpline2d:function(){return CubicSpline2d},CursorChatItem:function(){return CursorChatItem},CutMenuItem:function(){return CutMenuItem},DEFAULT_ANIMATION_OPTIONS:function(){return eS.Xy},DEFAULT_CAMERA_OPTIONS:function(){return eS.B8},DEFAULT_EMBED_DEFINITIONS:function(){return nd},DEFAULT_MAX_ASSET_SIZE:function(){return ax},DEFAULT_MAX_IMAGE_DIMENSION:function(){return ab},DEFAULT_SUPPORTED_IMAGE_TYPES:function(){return B.Hj},DEFAULT_SUPPORTED_MEDIA_TYPES:function(){return B.IH},DEFAULT_SUPPORTED_MEDIA_TYPE_LIST:function(){return B.VU},DEFAULT_SUPPORT_VIDEO_TYPES:function(){return B.B0},DebugFlags:function(){return DebugFlags},DefaultA11yAnnouncer:function(){return tH},DefaultActionsMenu:function(){return sp},DefaultActionsMenuContent:function(){return DefaultActionsMenuContent},DefaultBackground:function(){return z.d},DefaultBrush:function(){return $.o},DefaultCanvas:function(){return G.o},DefaultCollaboratorHint:function(){return W.Y},DefaultColorStyle:function(){return L.R_},DefaultColorThemePalette:function(){return L.qi},DefaultContextMenu:function(){return sf},DefaultContextMenuContent:function(){return DefaultContextMenuContent},DefaultCursor:function(){return Z.T},DefaultDashStyle:function(){return L.ci},DefaultDebugMenu:function(){return DefaultDebugMenu},DefaultDebugMenuContent:function(){return DefaultDebugMenuContent},DefaultDialogs:function(){return r_},DefaultErrorFallback:function(){return q.d},DefaultFillStyle:function(){return L.pp},DefaultFontFaces:function(){return al},DefaultFontFamilies:function(){return L.p6},DefaultFontStyle:function(){return L.Y8},DefaultGrid:function(){return Y.y},DefaultHandle:function(){return X.C},DefaultHandles:function(){return Q.Q},DefaultHelpMenu:function(){return lB},DefaultHelpMenuContent:function(){return DefaultHelpMenuContent},DefaultHelperButtons:function(){return DefaultHelperButtons},DefaultHelperButtonsContent:function(){return DefaultHelperButtonsContent},DefaultHorizontalAlignStyle:function(){return L.Xo},DefaultImageToolbar:function(){return DefaultImageToolbar},DefaultImageToolbarContent:function(){return la},DefaultKeyboardShortcutsDialog:function(){return rv},DefaultKeyboardShortcutsDialogContent:function(){return DefaultKeyboardShortcutsDialogContent},DefaultMainMenu:function(){return sv},DefaultMainMenuContent:function(){return DefaultMainMenuContent},DefaultMenuPanel:function(){return sS},DefaultMinimap:function(){return DefaultMinimap},DefaultNavigationPanel:function(){return sE},DefaultPageMenu:function(){return sP},DefaultQuickActions:function(){return sA},DefaultQuickActionsContent:function(){return DefaultQuickActionsContent},DefaultRichTextToolbar:function(){return ls},DefaultRichTextToolbarContent:function(){return DefaultRichTextToolbarContent},DefaultScribble:function(){return ee.l},DefaultSelectionBackground:function(){return DefaultSelectionBackground},DefaultSelectionForeground:function(){return eo.u},DefaultShapeIndicator:function(){return ea.v},DefaultShapeIndicators:function(){return es.N},DefaultSharePanel:function(){return DefaultSharePanel},DefaultSizeStyle:function(){return L.ST},DefaultSnapIndicator:function(){return el.m},DefaultSpinner:function(){return ed.q},DefaultStylePanel:function(){return lo},DefaultStylePanelContent:function(){return DefaultStylePanelContent},DefaultSvgDefs:function(){return ec.K},DefaultTextAlignStyle:function(){return L.lI},DefaultToasts:function(){return rI},DefaultToolbar:function(){return lv},DefaultToolbarContent:function(){return DefaultToolbarContent},DefaultTopPanel:function(){return DefaultTopPanel},DefaultVerticalAlignStyle:function(){return L.HO},DefaultVideoToolbar:function(){return lk},DefaultVideoToolbarContent:function(){return lT},DefaultZoomMenu:function(){return l_},DefaultZoomMenuContent:function(){return DefaultZoomMenuContent},DeleteMenuItem:function(){return DeleteMenuItem},DiamondToolbarItem:function(){return DiamondToolbarItem},DictValidator:function(){return N.oy},DistributeMenuItems:function(){return DistributeMenuItems},DocumentRecordType:function(){return L._A},DrawShapeTool:function(){return DrawShapeTool},DrawShapeUtil:function(){return DrawShapeUtil},DrawToolbarItem:function(){return DrawToolbarItem},DuplicateMenuItem:function(){return DuplicateMenuItem},EASINGS:function(){return te.L},EMPTY_ARRAY:function(){return F.LZ},EVENT_NAME_MAP:function(){return eU.J},Edge2d:function(){return tl.W},EdgeScrollManager:function(){return ek.O},EditLinkMenuItem:function(){return menu_items_EditLinkMenuItem},EditMenuSubmenu:function(){return EditMenuSubmenu},EditSubmenu:function(){return EditSubmenu},Editor:function(){return ev.M},EditorContext:function(){return eW.rU},EditorProvider:function(){return eW.KU},EffectScheduler:function(){return F.R0},ElbowArrowSnap:function(){return L.U_},Ellipse2d:function(){return Ellipse2d},EllipseToolbarItem:function(){return EllipseToolbarItem},EmbedShapeUtil:function(){return EmbedShapeUtil},EnumStyleProp:function(){return L.$I},EraserTool:function(){return EraserTool},EraserToolbarItem:function(){return EraserToolbarItem},ErrorBoundary:function(){return eu.S},ErrorScreen:function(){return th.Cs},ExampleDialog:function(){return ExampleDialog},ExecutionQueue:function(){return B.Jk},ExportFileContentSubMenu:function(){return ExportFileContentSubMenu},ExtrasGroup:function(){return ExtrasGroup},FONT_FAMILIES:function(){return r3},FONT_SIZES:function(){return r0},FeatureFlags:function(){return FeatureFlags},FileHelpers:function(){return B.P6},FitFrameToContentMenuItem:function(){return FitFrameToContentMenuItem},FontManager:function(){return e_.Q},FrameShapeTool:function(){return FrameShapeTool},FrameShapeUtil:function(){return FrameShapeUtil},FrameToolbarItem:function(){return FrameToolbarItem},GeoShapeGeoStyle:function(){return L.Zu},GeoShapeTool:function(){return GeoShapeTool},GeoShapeUtil:function(){return GeoShapeUtil},GeoStylePickerSet:function(){return GeoStylePickerSet},Geometry2d:function(){return ti.l$},Geometry2dFilters:function(){return ti.Dn},Group2d:function(){return td.m},GroupMenuItem:function(){return menu_items_GroupMenuItem},GroupOrUngroupMenuItem:function(){return GroupOrUngroupMenuItem},GroupShapeUtil:function(){return eO.Q},HALF_PI:function(){return ei.pj},HTMLContainer:function(){return HTMLContainer},HandTool:function(){return HandTool},HandToolbarItem:function(){return HandToolbarItem},HandleSnaps:function(){return eM.O},HeartToolbarItem:function(){return HeartToolbarItem},HexagonToolbarItem:function(){return HexagonToolbarItem},HighlightShapeTool:function(){return HighlightShapeTool},HighlightShapeUtil:function(){return HighlightShapeUtil},HighlightToolbarItem:function(){return HighlightToolbarItem},HistoryManager:function(){return eC.E},Image:function(){return B.Ee},ImageShapeCrop:function(){return L.GD},ImageShapeUtil:function(){return ImageShapeUtil},IncrementalSetConstructor:function(){return R.mW},InstancePageStateRecordType:function(){return L.iS},InstancePresenceRecordType:function(){return L.AM},KeyboardShiftEnterTweakExtension:function(){return au},KeyboardShortcutsMenuItem:function(){return KeyboardShortcutsMenuItem},LABEL_FONT_SIZES:function(){return r1},LANGUAGES:function(){return L.a2},LanguageMenu:function(){return LanguageMenu},LaserTool:function(){return LaserTool},LaserToolbarItem:function(){return LaserToolbarItem},LicenseManager:function(){return e7.WN},LineShapeSplineStyle:function(){return L.t8},LineShapeTool:function(){return LineShapeTool},LineShapeUtil:function(){return LineShapeUtil},LineToolbarItem:function(){return LineToolbarItem},LoadingScreen:function(){return th.a_},LocalIndexedDb:function(){return tP.xh},Mat:function(){return tu._},MediaHelpers:function(){return B.xe},MenuClickCapture:function(){return ep.L},MigrationFailureReason:function(){return R.qx},MiscMenuGroup:function(){return MiscMenuGroup},MobileStylePanel:function(){return MobileStylePanel},MoveToPageMenu:function(){return MoveToPageMenu},NoteShapeTool:function(){return NoteShapeTool},NoteShapeUtil:function(){return NoteShapeUtil},NoteToolbarItem:function(){return NoteToolbarItem},ObjectValidator:function(){return N.kx},OfflineIndicator:function(){return OfflineIndicator},OpacitySlider:function(){return OpacitySlider},OptionalErrorBoundary:function(){return eu.e},OvalToolbarItem:function(){return OvalToolbarItem},OverflowingToolbar:function(){return OverflowingToolbar},PI:function(){return ei.PI},PI2:function(){return ei.yo},PORTRAIT_BREAKPOINT:function(){return nf},PageItemInput:function(){return PageItemInput},PageItemSubmenu:function(){return sM},PageRecordType:function(){return L.ez},PasteMenuItem:function(){return PasteMenuItem},PathBuilder:function(){return PathBuilder},PathBuilderGeometry2d:function(){return PathBuilderGeometry2d},PeopleMenu:function(){return PeopleMenu},PerformanceTracker:function(){return B.aF},PlainTextArea:function(){return aT},PlainTextLabel:function(){return a_},PngHelpers:function(){return B.bM},Point2d:function(){return Point2d},PointerRecordType:function(){return L.zh},Polygon2d:function(){return tc.w},Polyline2d:function(){return to.q},PreferencesGroup:function(){return PreferencesGroup},PrintItem:function(){return PrintItem},RESET_VALUE:function(){return F.SB},ROTATE_CORNER_TO_SELECTION_CORNER:function(){return e9.rf},ReadonlySharedStyleMap:function(){return tE._},RecordType:function(){return R.oX},Rectangle2d:function(){return eD.z},RectangleToolbarItem:function(){return RectangleToolbarItem},RemoveFrameMenuItem:function(){return RemoveFrameMenuItem},ReorderMenuItems:function(){return ReorderMenuItems},ReorderMenuSubmenu:function(){return ReorderMenuSubmenu},Result:function(){return B.x4},RhombusToolbarItem:function(){return RhombusToolbarItem},RichTextArea:function(){return az},RichTextLabel:function(){return aH},RichTextSVG:function(){return RichTextSVG},RotateCWMenuItem:function(){return RotateCWMenuItem},SIDES:function(){return eS.Fd},SIN:function(){return ei.dv},STROKE_SIZES:function(){return rQ},STRUCTURED_CLONE_OBJECT_PROTOTYPE:function(){return B.qB},SVGContainer:function(){return ef.g},ScribbleManager:function(){return eI.o},SelectAllMenuItem:function(){return SelectAllMenuItem},SelectTool:function(){return SelectTool},SelectToolbarItem:function(){return SelectToolbarItem},ShapeUtil:function(){return eB.E},SharedStyleMap:function(){return tE.o},SnapManager:function(){return eP.f},Spinner:function(){return Spinner},SplineStylePickerSet:function(){return SplineStylePickerSet},StackMenuItems:function(){return StackMenuItems},Stadium2d:function(){return Stadium2d},StarToolbarItem:function(){return StarToolbarItem},StateNode:function(){return eL.n},Store:function(){return R.yh},StoreQueries:function(){return R.Vz},StoreSchema:function(){return R.sS},StoreSideEffects:function(){return R.FH},StyleProp:function(){return L.fV},T:function(){return N.T},TAB_ID:function(){return ex.$5},TEXT_PROPS:function(){return rJ},TLDOCUMENT_ID:function(){return L.G4},TLDRAW_FILE_EXTENSION:function(){return lY},TLINSTANCE_ID:function(){return L.PQ},TLPOINTER_ID:function(){return L.LV},TLV1AlignStyle:function(){return lU},TLV1AssetType:function(){return lH},TLV1ColorStyle:function(){return lO},TLV1DashStyle:function(){return lL},TLV1Decoration:function(){return lz},TLV1FontStyle:function(){return lN},TLV1ShapeType:function(){return lF},TLV1SizeStyle:function(){return lR},TL_CANVAS_UI_COLOR_TYPES:function(){return L.z},TL_CURSOR_TYPES:function(){return L._R},TL_HANDLE_TYPES:function(){return L.$H},TL_SCRIBBLE_STATES:function(){return L.hC},Table:function(){return tP.iA},TextDirection:function(){return ac},TextLabel:function(){return aC},TextManager:function(){return eA.R},TextShapeTool:function(){return TextShapeTool},TextShapeUtil:function(){return TextShapeUtil},TextStylePickerSet:function(){return TextStylePickerSet},TextToolbarItem:function(){return TextToolbarItem},Timers:function(){return B._N},Tldraw:function(){return Tldraw},TldrawArrowHints:function(){return TldrawArrowHints},TldrawEditor:function(){return th.gR},TldrawHandles:function(){return TldrawHandles},TldrawImage:function(){return lD},TldrawOverlays:function(){return TldrawOverlays},TldrawScribble:function(){return TldrawScribble},TldrawSelectionForeground:function(){return rW},TldrawShapeIndicators:function(){return TldrawShapeIndicators},TldrawUi:function(){return lE},TldrawUiA11yProvider:function(){return TldrawUiA11yProvider},TldrawUiButton:function(){return tz},TldrawUiButtonCheck:function(){return TldrawUiButtonCheck},TldrawUiButtonIcon:function(){return TldrawUiButtonIcon},TldrawUiButtonLabel:function(){return TldrawUiButtonLabel},TldrawUiButtonPicker:function(){return sO},TldrawUiComponentsProvider:function(){return TldrawUiComponentsProvider},TldrawUiContextProvider:function(){return lI},TldrawUiContextualToolbar:function(){return TldrawUiContextualToolbar},TldrawUiDialogBody:function(){return TldrawUiDialogBody},TldrawUiDialogCloseButton:function(){return TldrawUiDialogCloseButton},TldrawUiDialogFooter:function(){return TldrawUiDialogFooter},TldrawUiDialogHeader:function(){return TldrawUiDialogHeader},TldrawUiDialogTitle:function(){return TldrawUiDialogTitle},TldrawUiDialogsProvider:function(){return TldrawUiDialogsProvider},TldrawUiDropdownMenuCheckboxItem:function(){return TldrawUiDropdownMenuCheckboxItem},TldrawUiDropdownMenuContent:function(){return TldrawUiDropdownMenuContent},TldrawUiDropdownMenuGroup:function(){return TldrawUiDropdownMenuGroup},TldrawUiDropdownMenuIndicator:function(){return TldrawUiDropdownMenuIndicator},TldrawUiDropdownMenuItem:function(){return TldrawUiDropdownMenuItem},TldrawUiDropdownMenuRoot:function(){return TldrawUiDropdownMenuRoot},TldrawUiDropdownMenuSub:function(){return TldrawUiDropdownMenuSub},TldrawUiDropdownMenuSubTrigger:function(){return TldrawUiDropdownMenuSubTrigger},TldrawUiDropdownMenuTrigger:function(){return TldrawUiDropdownMenuTrigger},TldrawUiEventsProvider:function(){return TldrawUiEventsProvider},TldrawUiIcon:function(){return nr},TldrawUiInput:function(){return ni},TldrawUiKbd:function(){return TldrawUiKbd},TldrawUiMenuActionCheckboxItem:function(){return TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem},TldrawUiMenuActionItem:function(){return TldrawUiMenuActionItem},TldrawUiMenuCheckboxItem:function(){return TldrawUiMenuCheckboxItem},TldrawUiMenuContextProvider:function(){return TldrawUiMenuContextProvider},TldrawUiMenuGroup:function(){return TldrawUiMenuGroup},TldrawUiMenuItem:function(){return TldrawUiMenuItem},TldrawUiMenuSubmenu:function(){return TldrawUiMenuSubmenu},TldrawUiMenuToolItem:function(){return TldrawUiMenuToolItem},TldrawUiPopover:function(){return TldrawUiPopover},TldrawUiPopoverContent:function(){return TldrawUiPopoverContent},TldrawUiPopoverTrigger:function(){return TldrawUiPopoverTrigger},TldrawUiSlider:function(){return lt},TldrawUiToastsProvider:function(){return TldrawUiToastsProvider},TldrawUiToolbar:function(){return nL},TldrawUiToolbarButton:function(){return nU},TldrawUiToolbarToggleGroup:function(){return TldrawUiToolbarToggleGroup},TldrawUiToolbarToggleItem:function(){return TldrawUiToolbarToggleItem},TldrawUiTranslationProvider:function(){return TldrawUiTranslationProvider},ToggleAutoSizeMenuItem:function(){return ToggleAutoSizeMenuItem},ToggleDebugModeItem:function(){return ToggleDebugModeItem},ToggleDynamicSizeModeItem:function(){return ToggleDynamicSizeModeItem},ToggleEdgeScrollingItem:function(){return ToggleEdgeScrollingItem},ToggleFocusModeItem:function(){return ToggleFocusModeItem},ToggleGridItem:function(){return ToggleGridItem},ToggleKeyboardShortcutsItem:function(){return ToggleKeyboardShortcutsItem},ToggleLockMenuItem:function(){return ToggleLockMenuItem},TogglePasteAtCursorItem:function(){return TogglePasteAtCursorItem},ToggleReduceMotionItem:function(){return ToggleReduceMotionItem},ToggleSnapModeItem:function(){return ToggleSnapModeItem},ToggleToolLockItem:function(){return ToggleToolLockItem},ToggleTransparentBgMenuItem:function(){return ToggleTransparentBgMenuItem},ToggleWrapModeItem:function(){return ToggleWrapModeItem},ToolbarItem:function(){return ToolbarItem},TransformedGeometry2d:function(){return ti.Lf},TrapezoidToolbarItem:function(){return TrapezoidToolbarItem},TriangleToolbarItem:function(){return TriangleToolbarItem},UNINITIALIZED:function(){return F.Z1},USER_COLORS:function(){return ew.A6},UndoRedoGroup:function(){return UndoRedoGroup},UngroupMenuItem:function(){return menu_items_UngroupMenuItem},UnionValidator:function(){return N.zr},UnlockAllMenuItem:function(){return UnlockAllMenuItem},UserPreferencesManager:function(){return ej.K},Validator:function(){return N.cX},Vec:function(){return eF.B},VideoShapeUtil:function(){return VideoShapeUtil},ViewSubmenu:function(){return ViewSubmenu},WeakCache:function(){return B.kM},XBoxToolbarItem:function(){return XBoxToolbarItem},ZERO_INDEX_KEY:function(){return B.R4},ZoomOrRotateMenuItem:function(){return ZoomOrRotateMenuItem},ZoomTo100MenuItem:function(){return menu_items_ZoomTo100MenuItem},ZoomToFitMenuItem:function(){return ZoomToFitMenuItem},ZoomToSelectionMenuItem:function(){return ZoomToSelectionMenuItem},ZoomTool:function(){return ZoomTool},activeElementShouldCaptureKeys:function(){return e0.hZ},allDefaultFontFaces:function(){return ad},angleDistance:function(){return ei.mR},annotateError:function(){return B.lw},applyRotationToSnapshotShapes:function(){return tC.Z},approximately:function(){return ei.C2},areAnglesCompatible:function(){return ei._G},areArraysShallowEqual:function(){return B.E8},areObjectsShallowEqual:function(){return B.dn},arrowBindingMigrations:function(){return L.Vz},arrowBindingProps:function(){return L.zn},arrowBindingVersions:function(){return L.Rw},arrowShapeMigrations:function(){return L.Vm},arrowShapeProps:function(){return L.si},arrowShapeVersions:function(){return L.S_},assert:function(){return B.hu},assertExists:function(){return B.kP},assertIdType:function(){return R.lS},assetIdValidator:function(){return L._3},assetMigrations:function(){return L.TD},assetValidator:function(){return L.$A},atom:function(){return F.cn},average:function(){return ei.Y8},bind:function(){return B.ak},bindingIdValidator:function(){return L.pA},bookmarkShapeMigrations:function(){return L.h9},bookmarkShapeProps:function(){return L.qU},boxModelValidator:function(){return L.lz},buildFromV1Document:function(){return buildFromV1Document},canonicalizeRotation:function(){return ei.f5},canvasUiColorTypeValidator:function(){return L.MN},centerOfCircleFromThreePoints:function(){return ei.fn},centerSelectionAroundPoint:function(){return centerSelectionAroundPoint},clamp:function(){return ei.uZ},clampRadians:function(){return ei.Ci},clampToBrowserMaxCanvasSize:function(){return tf.E},clearLocalStorage:function(){return B.ZL},clearSessionStorage:function(){return B.Xp},clockwiseAngleDist:function(){return ei.VK},compact:function(){return B.oA},computed:function(){return F.Fl},containBoxSize:function(){return containBoxSize},copyAs:function(){return copyAs},coreShapes:function(){return ey.u},counterClockwiseAngleDist:function(){return ei.pc},createAssetValidator:function(){return L.tL},createBindingId:function(){return L.vI},createBindingPropsMigrationIds:function(){return L.im},createBindingPropsMigrationSequence:function(){return L.bY},createBindingValidator:function(){return L.xc},createComputedCache:function(){return R.mV},createDeepLinkString:function(){return tm.y},createEmptyBookmarkShape:function(){return createEmptyBookmarkShape},createEmptyRecordsDiff:function(){return R.YD},createMigrationIds:function(){return R.uj},createMigrationSequence:function(){return R.w8},createPresenceStateDerivation:function(){return L.GP},createRecordMigrationSequence:function(){return R.AV},createRecordType:function(){return R.ju},createSessionStateSnapshotSignal:function(){return ex.fU},createShapeId:function(){return L.F1},createShapePropsMigrationIds:function(){return L.T_},createShapePropsMigrationSequence:function(){return L.af},createShapeValidator:function(){return L.JY},createShapesForAssets:function(){return createShapesForAssets},createTLSchema:function(){return L.HH},createTLSchemaFromUtils:function(){return eg.F_},createTLStore:function(){return eg.jx},createTLUser:function(){return em.L},dataUrlToFile:function(){return tp.B},debounce:function(){return B.Ds},debugEnableLicensing:function(){return debugEnableLicensing},debugFlags:function(){return tg.hR},dedupe:function(){return B.D8},defaultAddFontsFromNode:function(){return defaultAddFontsFromNode},defaultBindingSchemas:function(){return L.mP},defaultBindingUtils:function(){return rq},defaultColorNames:function(){return L.YQ},defaultEditorAssetUrls:function(){return sd},defaultHandleExternalEmbedContent:function(){return defaultHandleExternalEmbedContent},defaultHandleExternalExcalidrawContent:function(){return defaultHandleExternalExcalidrawContent},defaultHandleExternalFileAsset:function(){return defaultHandleExternalFileAsset},defaultHandleExternalFileContent:function(){return defaultHandleExternalFileContent},defaultHandleExternalSvgTextContent:function(){return defaultHandleExternalSvgTextContent},defaultHandleExternalTextContent:function(){return defaultHandleExternalTextContent},defaultHandleExternalTldrawContent:function(){return defaultHandleExternalTldrawContent},defaultHandleExternalUrlAsset:function(){return defaultHandleExternalUrlAsset},defaultHandleExternalUrlContent:function(){return defaultHandleExternalUrlContent},defaultShapeSchemas:function(){return L.gS},defaultShapeTools:function(){return av},defaultShapeUtils:function(){return a2},defaultTldrawOptions:function(){return e8.a},defaultTools:function(){return sl},defaultUserPreferences:function(){return ew.ks},deferAsyncEffects:function(){return F.V0},defineMigrations:function(){return R.zn},degreesToRadians:function(){return ei.Ht},deleteFromLocalStorage:function(){return B.Rv},deleteFromSessionStorage:function(){return B.F_},devFreeze:function(){return R.ZV},downloadFile:function(){return downloadFile},downsizeImage:function(){return downsizeImage},drawShapeMigrations:function(){return L._l},drawShapeProps:function(){return L.wu},embedShapeMigrations:function(){return L.BF},embedShapePermissionDefaults:function(){return nc},embedShapeProps:function(){return L.DW},exhaustiveSwitchError:function(){return B.iP},exportAs:function(){return exportAs},exportToBlob:function(){return exportToBlob},extractSessionStateFromLegacySnapshot:function(){return ex.wz},featureFlags:function(){return tg.VH},fetch:function(){return B.he},filterEntries:function(){return B.H4},fitFrameToContent:function(){return fitFrameToContent},fpsThrottle:function(){return B.ch},frameShapeMigrations:function(){return L.gR},frameShapeProps:function(){return L.k7},geoShapeMigrations:function(){return L.P3},geoShapeProps:function(){return L.eG},getArcMeasure:function(){return ei.D4},getArrowBindings:function(){return getArrowBindings},getArrowInfo:function(){return shared_getArrowInfo},getArrowTerminalsInArrowSpace:function(){return getArrowTerminalsInArrowSpace},getChangedKeys:function(){return B.nu},getComputedInstance:function(){return F.Z6},getCropBox:function(){return getCropBox},getCursor:function(){return eK.L},getDefaultCdnBaseUrl:function(){return tp.M},getDefaultColorTheme:function(){return L.y6},getDefaultCrop:function(){return getDefaultCrop},getDefaultTranslationLocale:function(){return L.Bz},getDefaultUserPresence:function(){return L.k1},getDroppedShapesToNewParents:function(){return getDroppedShapesToNewParents},getEmbedInfo:function(){return getEmbedInfo},getErrorAnnotations:function(){return B.wi},getFirstFromIterable:function(){return B.lr},getFontsFromRichText:function(){return getFontsFromRichText},getFreshUserPreferences:function(){return ew.MO},getFromLocalStorage:function(){return B.fp},getFromSessionStorage:function(){return B.Kk},getHashForBuffer:function(){return B.Aq},getHashForObject:function(){return B.pT},getHashForString:function(){return B.jK},getIncrementedName:function(){return ty.u},getIndexAbove:function(){return B._L},getIndexBelow:function(){return B.Xg},getIndexBetween:function(){return B.eI},getIndices:function(){return B.H$},getIndicesAbove:function(){return B.vw},getIndicesBelow:function(){return B.dk},getIndicesBetween:function(){return B.Xv},getMediaAssetInfoPartial:function(){return getMediaAssetInfoPartial},getOwnProperty:function(){return B.eg},getPerfectDashProps:function(){return eR.H},getPointInArcT:function(){return ei.rW},getPointOnCircle:function(){return ei.XD},getPointerInfo:function(){return e6.Y},getPointsOnArc:function(){return ei.jV},getPolygonVertices:function(){return ei.Oe},getRotationSnapshot:function(){return tC.o},getShapePropKeysByStyle:function(){return L.DR},getSnapshot:function(){return eb.v},getSvgAsImage:function(){return ez.u},getSvgPathFromPoints:function(){return tb.R},getUncroppedSize:function(){return getUncroppedSize},getUserPreferences:function(){return ew.JM},getVerticesCountForArcLength:function(){return getVerticesCountForArcLength},groupBy:function(){return B.vM},groupShapeMigrations:function(){return L.c4},groupShapeProps:function(){return L.A7},hardReset:function(){return hardReset},hardResetEditor:function(){return tx.W},hasOwnProperty:function(){return B.nr},highlightShapeMigrations:function(){return L.J1},highlightShapeProps:function(){return L.VW},idValidator:function(){return L.yd},imageShapeMigrations:function(){return L.y5},imageShapeProps:function(){return L.Fc},inlineBase64AssetStore:function(){return eg.uj},intersectCircleCircle:function(){return tn.bO},intersectCirclePolygon:function(){return tn.h9},intersectCirclePolyline:function(){return tn.XS},intersectLineSegmentCircle:function(){return tn.ZM},intersectLineSegmentLineSegment:function(){return tn.T9},intersectLineSegmentPolygon:function(){return tn.qZ},intersectLineSegmentPolyline:function(){return tn.Gc},intersectPolygonBounds:function(){return tn.S3},intersectPolygonPolygon:function(){return tn.tY},invLerp:function(){return B.VN},isAccelKey:function(){return tw.q},isAtom:function(){return F.J8},isBinding:function(){return L.QA},isBindingId:function(){return L.tO},isDefined:function(){return B.$K},isDocument:function(){return L.qk},isEqual:function(){return B.Xy},isEqualAllowingForFloatingPointErrors:function(){return B.sd},isEqualWith:function(){return B.A7},isNativeStructuredClone:function(){return B.Bn},isNonNull:function(){return B.GT},isNonNullish:function(){return B.cF},isPageId:function(){return L.r5},isRecordsDiffEmpty:function(){return R.B4},isSafeFloat:function(){return ei.AV},isShape:function(){return L.VV},isShapeId:function(){return L.YT},isSignal:function(){return F.$Z},isUninitialized:function(){return F.e1},kickoutOccludedShapes:function(){return kickoutOccludedShapes},last:function(){return B.Z$},lerp:function(){return B.t7},lineShapeMigrations:function(){return L.FH},lineShapeProps:function(){return L.BG},linesIntersect:function(){return tn.cB},lns:function(){return B.L8},loadSessionStateSnapshotIntoStore:function(){return ex.SB},loadSnapshot:function(){return eb.w},loopToHtmlElement:function(){return e0.Te},mapObjectMapValues:function(){return B.Fm},maxBy:function(){return B.UT},maybeSnapToGrid:function(){return maybeSnapToGrid},measureAverageDuration:function(){return B.Px},measureCbDuration:function(){return B.P9},measureDuration:function(){return B.cR},mergeArraysAndReplaceDefaults:function(){return B.Ct},minBy:function(){return B.F},mockUniqueId:function(){return B.n},modulate:function(){return B.vm},noop:function(){return B.ZT},normalizeWheel:function(){return tS.f},noteShapeMigrations:function(){return L.C_},noteShapeProps:function(){return L.m0},objectMapEntries:function(){return B.EP},objectMapFromEntries:function(){return B.Ls},objectMapKeys:function(){return B.GH},objectMapValues:function(){return B.UM},omit:function(){return B.CE},omitFromStackTrace:function(){return B.fP},opacityValidator:function(){return L.jm},openWindow:function(){return openWindow},pageIdValidator:function(){return L.CF},parentIdValidator:function(){return L.Mv},parseAndLoadDocument:function(){return parseAndLoadDocument},parseDeepLinkString:function(){return tm.Y},parseMigrationId:function(){return R.xf},parseTldrawJsonFile:function(){return parseTldrawJsonFile},partition:function(){return B.uK},perimeterOfEllipse:function(){return ei.Rp},pluckPreservingValues:function(){return L.Tc},pointInPolygon:function(){return ei.Of},polygonIntersectsPolyline:function(){return tn.TD},polygonsIntersect:function(){return tn.UQ},precise:function(){return ei.Yk},preloadFont:function(){return preloadFont},preventDefault:function(){return e0.PF},promiseWithResolve:function(){return B.un},putExcalidrawContent:function(){return putExcalidrawContent},radiansToDegrees:function(){return ei.vi},rangeIntersection:function(){return ei.mW},react:function(){return F.Ym},reactor:function(){return F.zH},refreshPage:function(){return tv.Z},registerDefaultExternalContentHandlers:function(){return registerDefaultExternalContentHandlers},registerDefaultSideEffects:function(){return registerDefaultSideEffects},registerTldrawLibraryVersion:function(){return B.x2},releasePointerCapture:function(){return e0.XE},removeFrame:function(){return removeFrame},renderHtmlFromRichText:function(){return renderHtmlFromRichText},renderHtmlFromRichTextForMeasurement:function(){return renderHtmlFromRichTextForMeasurement},renderPlaintextFromRichText:function(){return renderPlaintextFromRichText},renderRichTextFromHTML:function(){return renderRichTextFromHTML},resizeBox:function(){return resizeBox},resizeScaled:function(){return resizeScaled},restoreUniqueId:function(){return B.TW},retry:function(){return B.XD},reverseRecordsDiff:function(){return R.kJ},richTextValidator:function(){return L.xn},rng:function(){return B.Vk},rootBindingMigrations:function(){return L.hK},rootShapeMigrations:function(){return L.cL},rotateArray:function(){return B.R8},rotateSelectionHandle:function(){return e9.dC},runtime:function(){return tI.G},safeParseUrl:function(){return B.Ad},sanitizeId:function(){return e4.Vx},scribbleValidator:function(){return L.gw},serializeTldrawJson:function(){return serializeTldrawJson},serializeTldrawJsonBlob:function(){return serializeTldrawJsonBlob},setDefaultEditorAssetUrls:function(){return setDefaultEditorAssetUrls},setDefaultUiAssetUrls:function(){return setDefaultUiAssetUrls},setInLocalStorage:function(){return B._m},setInSessionStorage:function(){return B.sn},setPointerCapture:function(){return e0.I5},setRuntimeOverrides:function(){return tI.e},setUserPreferences:function(){return ew.yu},shapeIdValidator:function(){return L.u5},shortAngleDist:function(){return ei.Z7},sleep:function(){return B._v},snapAngle:function(){return ei.nD},sortById:function(){return B.uv},sortByIndex:function(){return B.hl},squashRecordDiffs:function(){return R.bs},squashRecordDiffsMutable:function(){return R.Ce},stopEventPropagation:function(){return e0.be},stringEnum:function(){return B.b},structuredClone:function(){return B.v4},suffixSafeId:function(){return e4.mq},textShapeMigrations:function(){return L.pL},textShapeProps:function(){return L.XB},throttle:function(){return B.P2},throttleToNextFrame:function(){return B.Gf},tipTapDefaultExtensions:function(){return ah},tlenv:function(){return eH.a},tlmenus:function(){return e$.h},tltime:function(){return eV.r},toDomPrecision:function(){return ei.$Z},toFixed:function(){return ei.FH},toPrecision:function(){return ei.Zd},toRichText:function(){return L.Ak},track:function(){return O.j},transact:function(){return F.ay},transaction:function(){return F.PS},truncateStringWithEllipsis:function(){return truncateStringWithEllipsis},uniq:function(){return tA.j},uniqueId:function(){return B.EL},unsafe__withoutCapture:function(){return F.dy},unwrapLabel:function(){return unwrapLabel},useA11y:function(){return useA11y},useActions:function(){return useActions},useAsset:function(){return aW},useAssetUrls:function(){return useAssetUrls},useAtom:function(){return O.KO},useBreakpoint:function(){return useBreakpoint},useCanRedo:function(){return useCanRedo},useCanUndo:function(){return useCanUndo},useCollaborationStatus:function(){return useCollaborationStatus},useComputed:function(){return O.vc},useContainer:function(){return eG.uK},useContainerIfExists:function(){return eG.mc},useCopyAs:function(){return useCopyAs},useCurrentTranslation:function(){return useCurrentTranslation},useDefaultColorTheme:function(){return useDefaultColorTheme},useDefaultHelpers:function(){return useDefaultHelpers},useDelaySvgExport:function(){return eN.OR},useDialogs:function(){return useDialogs},useEditablePlainText:function(){return useEditablePlainText},useEditableRichText:function(){return useEditableRichText},useEditableText:function(){return ak},useEditor:function(){return eW.jE},useEditorComponents:function(){return eZ.o},useEvent:function(){return eY.z},useExportAs:function(){return useExportAs},useGlobalMenuIsOpen:function(){return useGlobalMenuIsOpen},useImageOrVideoAsset:function(){return useImageOrVideoAsset},useIsCropping:function(){return useIsCropping},useIsDarkMode:function(){return eJ.G},useIsEditing:function(){return useIsEditing},useIsToolSelected:function(){return useIsToolSelected},useKeyboardShortcuts:function(){return useKeyboardShortcuts},useLocalStorageState:function(){return useLocalStorageState},useLocalStore:function(){return eQ.h},useMaybeEditor:function(){return eW.Z2},useMenuClipboardEvents:function(){return useMenuClipboardEvents},useMenuIsOpen:function(){return useMenuIsOpen},useNativeClipboardEvents:function(){return useNativeClipboardEvents},useOnMount:function(){return th.FI},usePassThroughMouseOverEvents:function(){return usePassThroughMouseOverEvents},usePassThroughWheelEvents:function(){return e1.O},usePeerIds:function(){return e2.k},usePrefersReducedMotion:function(){return usePrefersReducedMotion},usePresence:function(){return e3.o},useQuickReactor:function(){return O.BK},useReactiveEvent:function(){return eY.K},useReactor:function(){return O.vC},useReadonly:function(){return useReadonly},useRefState:function(){return e5.r},useRelevantStyles:function(){return useRelevantStyles},useSelectedShapesAnnouncer:function(){return useSelectedShapesAnnouncer},useSelectionEvents:function(){return useSelectionEvents},useShallowArrayIdentity:function(){return eX.T},useShallowObjectIdentity:function(){return eX.S},useSharedSafeId:function(){return e4.Ws},useShowCollaborationUi:function(){return useShowCollaborationUi},useStateTracking:function(){return O.uC},useSvgExportContext:function(){return eN.l8},useTLSchemaFromUtils:function(){return useTLSchemaFromUtils},useTLStore:function(){return useTLStore},useTldrawUiComponents:function(){return useTldrawUiComponents},useTldrawUser:function(){return em.z},useToasts:function(){return useToasts},useTools:function(){return useTools},useTransform:function(){return er.H},useTranslation:function(){return useTranslation},useUiEvents:function(){return useUiEvents},useUniqueSafeId:function(){return e4.Gj},useValue:function(){return O.Hg},useViewportHeight:function(){return useViewportHeight},userTypeValidator:function(){return ew.F9},validateIndexKey:function(){return B.LP},vecModelValidator:function(){return L.AT},videoShapeMigrations:function(){return L.lY},videoShapeProps:function(){return L.p$},warnDeprecatedGetter:function(){return B.q4},warnOnce:function(){return B.O4},whyAmIRunning:function(){return F.iJ},withDiff:function(){return F.qo}});var r,i,o,a,l,d,c,u,h,p,f,g,m,y,b,S,v,k,_,C,E,M,P,A,j,D,B=n(70938);n(69645),n(86930),n(64770),n(92880),n(19304);var F=n(31316),O=n(30742),R=n(63134),L=n(43001),N=n(45958),z=n(40255),$=n(36067),G=n(79548),W=n(40787),Z=n(38917),q=n(47328),Y=n(86251),X=n(85704),Q=n(93572),ee=n(37453),et=n(57437),en=n(2265),er=n(68576),ei=n(46166);function DefaultSelectionBackground({bounds:e,rotation:t}){let n=en.useRef(null);return(0,er.H)(n,e.x,e.y,1,t),en.useLayoutEffect(()=>{let t=n.current;t&&(t.style.width=(0,ei.$Z)(Math.max(1,e.width))+"px",t.style.height=(0,ei.$Z)(Math.max(1,e.height))+"px")},[e.width,e.height]),(0,et.jsx)("div",{ref:n,className:"tl-selection__bg",draggable:!1})}var eo=n(14203),ea=n(67677),es=n(30865),el=n(7611),ed=n(87717),ec=n(30126),eu=n(24519),eh=n(42744);function HTMLContainer({children:e,className:t="",...n}){return(0,et.jsx)("div",{...n,className:eh("tl-html-container",t),children:e})}var ep=n(60942),ef=n(17295),eg=n(95478),em=n(7217),ey=n(29968),eb=n(84995),ex=n(21834),ew=n(45894),eS=n(57655);let BindingUtil=class BindingUtil{constructor(e){this.editor=e}static props;static migrations;static type};var ev=n(80418),eT=n(75650),ek=n(22784),e_=n(36290),eC=n(42072),eI=n(12275),eE=n(51071),eM=n(49161),eP=n(57258),eA=n(48568),ej=n(5462),eD=n(29234),eB=n(25859),eF=n(14204);function resizeBox(e,t,n={}){let{newPoint:r,handle:i,scaleX:o,scaleY:a}=t,{minWidth:l=1,maxWidth:d=1/0,minHeight:c=1,maxHeight:u=1/0}=n,h=e.props.w*o,p=e.props.h*a,f=new eF.B(0,0);if(h>0){if(h<l){switch(i){case"top_left":case"left":case"bottom_left":f.x=h-l;break;case"top":case"bottom":f.x=(h-l)/2;break;default:f.x=0}h=l}}else if(f.x=h,(h=-h)<l){switch(i){case"top_left":case"left":case"bottom_left":f.x=-h;break;default:f.x=-l}h=l}if(p>0){if(p<c){switch(i){case"top_left":case"top":case"top_right":f.y=p-c;break;case"right":case"left":f.y=(p-c)/2;break;default:f.y=0}p=c}}else if(f.y=p,(p=-p)<c){switch(i){case"top_left":case"top":case"top_right":f.y=-p;break;default:f.y=-c}p=c}let{x:g,y:m}=f.rot(e.rotation).add(r);return{...e,x:g,y:m,props:{w:Math.min(d,h),h:Math.min(u,p)}}}let BaseBoxShapeUtil=class BaseBoxShapeUtil extends eB.E{getGeometry(e){return new eD.z({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,t){return resizeBox(e,t)}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,t,n){return{...t.props,w:(0,B.t7)(e.props.w,t.props.w,n),h:(0,B.t7)(e.props.h,t.props.h,n)}}};var eO=n(31738),eR=n(67370);function resizeScaled(e,{initialBounds:t,scaleX:n,scaleY:r,newPoint:i,handle:o}){let a;switch(o){case"bottom_left":case"bottom_right":case"top_left":case"top_right":a=Math.max(.01,Math.max(Math.abs(n),Math.abs(r)));break;case"left":case"right":a=Math.max(.01,Math.abs(n));break;case"bottom":case"top":a=Math.max(.01,Math.abs(r));break;default:throw(0,B.iP)(o)}let l=new eF.B(0,0);n<0&&(l.x=-(t.width*a)),r<0&&(l.y=-(t.height*a));let{x:d,y:c}=eF.B.Add(i,l.rot(e.rotation));return{x:d,y:c,props:{scale:a*e.props.scale}}}var eL=n(22797);let Idle=class Idle extends eL.n{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}};let Pointing=class Pointing extends eL.n{static id="pointing";onPointerMove(e){let{editor:t}=this;if(t.inputs.isDragging){let{originPagePoint:n}=t.inputs,r=this.parent.shapeType,i=(0,L.F1)(),o=t.markHistoryStoppingPoint(`creating_box:${i}`),a=maybeSnapToGrid(n,t);this.editor.createShapes([{id:i,type:r,x:a.x,y:a.y,props:{w:1,h:1}}]);let l=t.getShape(i);if(!l){this.cancel();return}t.select(i);let d=this.parent;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:o,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:d.onCreate?e=>d.onCreate?.(e):void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){let{originPagePoint:e}=this.editor.inputs,t=this.parent.shapeType,n=(0,L.F1)();this.editor.markHistoryStoppingPoint(`creating_box:${n}`),this.editor.createShapes([{id:n,type:t,x:e.x,y:e.y}]);let r=this.editor.getShape(n);if(!r){this.cancel();return}let{w:i,h:o}=r.props,a=new eF.B(i/2,o/2),l=this.editor.getShapeParentTransform(r);l&&a.rot(-l.rotation());let d=1;this.editor.user.getIsDynamicResizeMode()&&(i*=d=1/this.editor.getZoomLevel(),o*=d,a.mul(d));let c=(0,B.v4)(r),u=maybeSnapToGrid(new eF.B(r.x-a.x,r.y-a.y),this.editor);c.x=u.x,c.y=u.y,c.props.w=i,c.props.h=o,"scale"in r.props&&(c.props.scale=d),this.editor.updateShape(c),this.editor.setSelectedShapes([n]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}};function maybeSnapToGrid(e,t){let n=t.getInstanceState().isGridMode,r=t.getDocumentSettings().gridSize;return n?e.clone().snapToGrid(r):e.clone()}let BaseBoxShapeTool=class BaseBoxShapeTool extends eL.n{static id="box";static initial="idle";static children(){return[Idle,Pointing]}};var eU=n(40521),eN=n(62461),ez=n(12968),eH=n(49894),e$=n(18817),eV=n(90975),eG=n(45827),eK=n(3231),eW=n(3373),eZ=n(76413),eY=n(18560);function useGlobalMenuIsOpen(e,t,n){let r=(0,en.useRef)(!1),i=(0,en.useCallback)(n=>{r.current=n,n?e$.h.addOpenMenu(e):e$.h.deleteOpenMenu(e),t?.(n)},[e,t]),o=(0,O.Hg)("is menu open",()=>e$.h.getOpenMenus().includes(e),[e]);return(0,en.useEffect)(()=>(r.current&&(n?.("open-menu"),e$.h.addOpenMenu(e)),()=>{r.current&&(e$.h.deleteOpenMenu(e),e$.h.getOpenMenus().forEach(t=>{t.startsWith(e)&&(n?.("close-menu"),e$.h.deleteOpenMenu(t))}),r.current=!1)}),[e,n]),[o,i]}var eX=n(60180);function useIsCropping(e){let t=(0,eW.jE)();return(0,O.Hg)("isCropping",()=>t.getCroppingShapeId()===e,[t,e])}var eJ=n(75053);function useIsEditing(e){let t=(0,eW.jE)();return(0,O.Hg)("isEditing",()=>t.getEditingShapeId()===e,[t,e])}var eQ=n(83480),e0=n(77700);function usePassThroughMouseOverEvents(e){if(!e)throw Error("usePassThroughWheelEvents must be passed a ref");let t=(0,eG.uK)();(0,en.useEffect)(()=>{function onMouseOver(e){if(e.isSpecialRedispatchedEvent)return;(0,e0.PF)(e);let n=t.querySelector(".tl-canvas");if(!n)return;let r=new PointerEvent(e.type,e);r.isSpecialRedispatchedEvent=!0,n.dispatchEvent(r)}let n=e.current;if(n)return n.addEventListener("mouseover",onMouseOver,{passive:!1}),()=>{n.removeEventListener("mouseover",onMouseOver)}},[t,e])}var e1=n(5932),e2=n(27359),e3=n(80730),e5=n(22890),e4=n(91496),e6=n(49065);function useSelectionEvents(e){let t=(0,eW.jE)(),n=(0,en.useMemo)(function(){let n,r;return{onPointerDown:n=>{if(n.isKilled)return;if(n.button===eS.Hs){t.dispatch({type:"pointer",target:"selection",handle:e,name:"right_click",...(0,e6.Y)(n)});return}if(0!==n.button)return;let r=(0,e0.Te)(n.currentTarget);(0,e0.I5)(r,n),r.addEventListener("pointerup",function releaseCapture(){r.removeEventListener("pointerup",releaseCapture),(0,e0.XE)(r,n)}),t.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:e,...(0,e6.Y)(n)}),(0,e0.be)(n)},onPointerMove:function(i){i.isKilled||0!==i.button||i.clientX===n&&i.clientY===r||(n=i.clientX,r=i.clientY,t.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:e,...(0,e6.Y)(i)}))},onPointerUp:n=>{n.isKilled||0!==n.button||t.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:e,...(0,e6.Y)(n)})}}},[t,e]);return n}function useTLStore(e){let[t,n]=(0,en.useState)(()=>({store:(0,eg.jx)(e),opts:e}));if(!(0,B.dn)(t.opts,e)){let t={store:(0,eg.jx)(e),opts:e};return n(t),t.store}return t.store}function useTLSchemaFromUtils(e){let[t,n]=(0,en.useState)(()=>({opts:e,schema:(0,eg.F_)(e)}));if(!(0,B.dn)(t.opts,e)){let t=(0,eg.F_)(e);return n({opts:e,schema:t}),t}return t.schema}/*!
 * BSD License: https://github.com/outline/rich-markdown-editor/blob/main/LICENSE
 * Copyright (c) 2020 General Outline, Inc (https://www.getoutline.com/) and individual contributors.
 *
 * Returns the height of the viewport.
 * This is mainly to account for virtual keyboards on mobile devices.
 *
 * N.B. On iOS, you have to take into account the offsetTop as well so that you get an accurate position
 * while using the virtual keyboard.
 */function useViewportHeight(){let e=window.visualViewport,[t,n]=(0,en.useState)(()=>e?e.height+e.offsetTop:window.innerHeight);return(0,en.useLayoutEffect)(()=>{let handleResize=()=>{let e=window.visualViewport;n(()=>e?e.height+e.offsetTop:window.innerHeight)};return window.visualViewport?.addEventListener("resize",handleResize),window.visualViewport?.addEventListener("scroll",handleResize),()=>{window.visualViewport?.removeEventListener("resize",handleResize),window.visualViewport?.removeEventListener("scroll",handleResize)}},[]),t}var e7=n(39138),e8=n(25485),e9=n(30696),te=n(31986),tn=n(30224),ti=n(74519);function getVerticesCountForArcLength(e,t=20){return Math.max(8,Math.ceil(e/t))}let Arc2d=class Arc2d extends ti.l${_center;_radius;_start;_end;_largeArcFlag;_sweepFlag;_measure;_angleStart;_angleEnd;constructor(e){super({...e,isFilled:!1,isClosed:!1});let{center:t,sweepFlag:n,largeArcFlag:r,start:i,end:o}=e;if(i.equals(o))throw Error("Arc must have different start and end points.");this._angleStart=eF.B.Angle(t,i),this._angleEnd=eF.B.Angle(t,o),this._radius=eF.B.Dist(t,i),this._measure=(0,ei.D4)(this._angleStart,this._angleEnd,n,r),this._start=i,this._end=o,this._sweepFlag=n,this._largeArcFlag=r,this._center=t}nearestPoint(e){let t,n;let{_center:r,_measure:i,_radius:o,_angleEnd:a,_angleStart:l,_start:d,_end:c}=this,u=(0,ei.rW)(i,l,a,r.angle(e));if(u<=0)return d;if(u>=1)return c;let h=eF.B.Sub(e,r).uni().mul(o).add(r),p=1/0;for(let r of[d,c,h])(n=eF.B.Dist2(e,r))<p&&(t=r,p=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){let{_center:n,_radius:r,_measure:i,_angleStart:o,_angleEnd:a}=this,l=(0,tn.ZM)(e,t,n,r);return null!==l&&l.some(e=>{let t=(0,ei.rW)(i,o,a,n.angle(e));return t>=0&&t<=1})}getVertices(){let{_center:e,_measure:t,length:n,_radius:r,_angleStart:i}=this,o=[];for(let a=0,l=getVerticesCountForArcLength(Math.abs(n));a<l+1;a++){let n=a/l*t,d=i+n;o.push((0,ei.XD)(e,r,d))}return o}getSvgPathData(e=!0){let{_start:t,_end:n,_radius:r,_largeArcFlag:i,_sweepFlag:o}=this;return`${e?`M${t.toFixed()}`:""} A${r} ${r} 0 ${i} ${o} ${n.toFixed()}`}getLength(){return Math.abs(this._measure*this._radius)}};let Circle2d=class Circle2d extends ti.l${constructor(e){super({isClosed:!0,...e}),this.config=e;let{x:t=0,y:n=0,radius:r}=e;this._x=t,this._y=n,this._center=new eF.B(r+t,r+n),this._radius=r}_center;_radius;_x;_y;getBounds(){return new e9.xu(this._x,this._y,2*this._radius,2*this._radius)}getVertices(){let{_center:e,_radius:t}=this,n=ei.yo*t,r=[];for(let i=0,o=getVerticesCountForArcLength(n);i<o;i++){let n=i/o*ei.yo;r.push((0,ei.XD)(e,t,n))}return r}nearestPoint(e){let{_center:t,_radius:n}=this;return t.equals(e)?eF.B.AddXY(t,n,0):eF.B.Sub(e,t).uni().mul(n).add(t)}hitTestLineSegment(e,t,n=0){let{_center:r,_radius:i}=this;return null!==(0,tn.ZM)(e,t,r,i+n)}getSvgPathData(){let{_center:e,_radius:t}=this;return`M${e.x+t},${e.y} a${t},${t} 0 1,0 ${2*t},0a${t},${t} 0 1,0 -${2*t},0`}};var to=n(86368);let CubicBezier2d=class CubicBezier2d extends to.q{_a;_b;_c;_d;_resolution;constructor(e){let{start:t,cp1:n,cp2:r,end:i}=e;super({...e,points:[t,i]}),this._a=t,this._b=n,this._c=r,this._d=i,this._resolution=e.resolution??10}getVertices(){let e=[],{_a:t,_b:n,_c:r,_d:i}=this;for(let o=0,a=this._resolution;o<=a;o++){let l=o/a;e.push(new eF.B((1-l)*(1-l)*(1-l)*t.x+3*((1-l)*(1-l))*l*n.x+3*(1-l)*(l*l)*r.x+l*l*l*i.x,(1-l)*(1-l)*(1-l)*t.y+3*((1-l)*(1-l))*l*n.y+3*(1-l)*(l*l)*r.y+l*l*l*i.y))}return e}nearestPoint(e){let t,n,r;let i=1/0;for(let o of this.segments)r=o.nearestPoint(e),(n=eF.B.Dist2(r,e))<i&&(t=r,i=n);if(!t)throw Error("nearest point not found");return t}getSvgPathData(e=!0){let{_a:t,_b:n,_c:r,_d:i}=this;return`${e?`M ${t.toFixed()} `:""} C${n.toFixed()} ${r.toFixed()} ${i.toFixed()}`}static GetAtT(e,t){let{_a:n,_b:r,_c:i,_d:o}=e;return new eF.B((1-t)*(1-t)*(1-t)*n.x+3*((1-t)*(1-t))*t*r.x+3*(1-t)*(t*t)*i.x+t*t*t*o.x,(1-t)*(1-t)*(1-t)*n.y+3*((1-t)*(1-t))*t*r.y+3*(1-t)*(t*t)*i.y+t*t*t*o.y)}getLength(e,t=32){let n,r=this._a,i=0;for(let e=1;e<=t;e++)n=CubicBezier2d.GetAtT(this,e/t),i+=eF.B.Dist(r,n),r=n;return i}};let CubicSpline2d=class CubicSpline2d extends ti.l${_points;constructor(e){super({...e,isClosed:!1,isFilled:!1});let{points:t}=e;this._points=t}_segments;get segments(){if(!this._segments){this._segments=[];let{_points:e}=this,t=e.length,n=t-2;for(let r=0;r<t-1;r++){let t=0===r?e[0]:e[r-1],i=e[r],o=e[r+1],a=r===n?o:e[r+2],l=0===r?t:new eF.B(i.x+(o.x-t.x)/6*1.25,i.y+(o.y-t.y)/6*1.25),d=r===n?o:new eF.B(o.x-(a.x-i.x)/6*1.25,o.y-(a.y-i.y)/6*1.25);this._segments.push(new CubicBezier2d({start:i,cp1:l,cp2:d,end:o}))}}return this._segments}getLength(){return this.segments.reduce((e,t)=>e+t.length,0)}getVertices(){let e=this.segments.reduce((e,t)=>e.concat(t.vertices),[]);return e.push(this._points[this._points.length-1]),e}nearestPoint(e){let t,n,r;let i=1/0;for(let o of this.segments)r=o.nearestPoint(e),(n=eF.B.Dist2(r,e))<i&&(t=r,i=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){return this.segments.some(n=>n.hitTestLineSegment(e,t))}getSvgPathData(){let e=this.segments.reduce((e,t,n)=>e+t.getSvgPathData(0===n),"");return this.isClosed&&(e+="Z"),e}};var tl=n(84137);let Ellipse2d=class Ellipse2d extends ti.l${constructor(e){super({...e,isClosed:!0}),this.config=e;let{width:t,height:n}=e;this._w=t,this._h=n}_w;_h;_edges;get edges(){if(!this._edges){let{vertices:e}=this;this._edges=[];for(let t=0,n=e.length;t<n;t++){let r=e[t],i=e[(t+1)%n];this._edges.push(new tl.W({start:r,end:i}))}}return this._edges}getVertices(){let e=Math.max(1,this._w),t=Math.max(1,this._h),n=e/2,r=t/2,i=Math.pow(n-r,2)/Math.pow(n+r,2),o=ei.PI*(n+r)*(1+3*i/(10+Math.sqrt(4-3*i))),a=getVerticesCountForArcLength(o),l=ei.yo/a,d=Math.cos(l),c=Math.sin(l),u=0,h=1,p=0,f=1,g=Array(a);for(let i=0;i<a;i++)g[i]=new eF.B((0,ei.uZ)(n+n*h,0,e),(0,ei.uZ)(r+r*u,0,t)),p=c*h+d*u,f=d*h-c*u,u=p,h=f;return g}nearestPoint(e){let t,n,r;let i=1/0;for(let o of this.edges)r=o.nearestPoint(e),(n=eF.B.Dist2(r,e))<i&&(t=r,i=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){return this.edges.some(n=>n.hitTestLineSegment(e,t))}getBounds(){return new e9.xu(0,0,this._w,this._h)}getLength(){let{_w:e,_h:t}=this;return(0,ei.Rp)(Math.max(0,e/2),Math.max(0,t/2))}getSvgPathData(e=!1){let{_w:t,_h:n}=this,r=t/2,i=n/2,o=Math.max(0,r),a=Math.max(0,i);return`${e?`M${r-o},${i}`:""} a${o},${a},0,1,1,${2*o},0a${o},${a},0,1,1,-${2*o},0`}};var td=n(87684);let Point2d=class Point2d extends ti.l${_point;constructor(e){super({...e,isClosed:!0,isFilled:!0});let{point:t}=e;this._point=t}getVertices(){return[this._point]}nearestPoint(){return this._point}hitTestLineSegment(e,t,n){return eF.B.DistanceToLineSegment(e,t,this._point)<n}getSvgPathData(){let{_point:e}=this;return`M${e.toFixed()}`}};var tc=n(92042);let Stadium2d=class Stadium2d extends ti.l${constructor(e){super({...e,isClosed:!0}),this.config=e;let{width:t,height:n}=e;if(this._w=t,this._h=n,n>t){let e=t/2;this._a=new Arc2d({start:new eF.B(0,e),end:new eF.B(t,e),center:new eF.B(t/2,e),sweepFlag:1,largeArcFlag:1}),this._b=new tl.W({start:new eF.B(t,e),end:new eF.B(t,n-e)}),this._c=new Arc2d({start:new eF.B(t,n-e),end:new eF.B(0,n-e),center:new eF.B(t/2,n-e),sweepFlag:1,largeArcFlag:1}),this._d=new tl.W({start:new eF.B(0,n-e),end:new eF.B(0,e)})}else{let e=n/2;this._a=new Arc2d({start:new eF.B(e,n),end:new eF.B(e,0),center:new eF.B(e,e),sweepFlag:1,largeArcFlag:1}),this._b=new tl.W({start:new eF.B(e,0),end:new eF.B(t-e,0)}),this._c=new Arc2d({start:new eF.B(t-e,0),end:new eF.B(t-e,n),center:new eF.B(t-e,e),sweepFlag:1,largeArcFlag:1}),this._d=new tl.W({start:new eF.B(t-e,n),end:new eF.B(e,n)})}}_w;_h;_a;_b;_c;_d;nearestPoint(e){let t,n,r;let i=1/0,{_a:o,_b:a,_c:l,_d:d}=this;for(let c of[o,a,l,d])r=c.nearestPoint(e),(n=eF.B.Dist2(r,e))<i&&(t=r,i=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){let{_a:n,_b:r,_c:i,_d:o}=this;return[n,r,i,o].some(n=>n.hitTestLineSegment(e,t))}getVertices(){let{_a:e,_b:t,_c:n,_d:r}=this;return[e,t,n,r].reduce((e,t)=>(e.push(...t.vertices),e),[])}getBounds(){return new e9.xu(0,0,this._w,this._h)}getLength(){let{_h:e,_w:t}=this;return e>t?(ei.PI*(t/2)+(e-t))*2:(ei.PI*(e/2)+(t-e))*2}getSvgPathData(){let{_a:e,_b:t,_c:n,_d:r}=this;return[e,t,n,r].map((e,t)=>e.getSvgPathData(0===t)).join(" ")+" Z"}};var tu=n(45404),th=n(9354),tp=n(50280),tf=n(32764),tg=n(16384),tm=n(10966),ty=n(41605),tb=n(65852),tx=n(73432),tw=n(25689),tS=n(77744),tv=n(50590);function kickoutOccludedShapes(e,t,n){let r=new Set;for(let n of t){let t=e.getShape(n);if(!t)continue;r.add(t);let i=e.getShape(t.parentId);i&&r.add(i)}let i=new Map;for(let t of r){let r=e.getSortedChildIdsForParent(t);if(n?.filter&&!n.filter(t))i.set(t,r);else{let n=function(e,t,n){if(0===n.length)return F.LZ;let r=e.getShapePageBounds(t);if(!r)return F.LZ;let i=e.getShapeGeometry(t),o=e.getShapePageTransform(t),a=o.applyToPoints(i.vertices),l=e.getShapeMask(t),d=l?(0,tn.tY)(l,a):a;return d?n.filter(t=>{let n=e.getShapePageBounds(t);if(!n||!r.includes(n))return!1;let i=e.getShapePageTransform(t).clone().invert().applyToPoints(d),o=e.getShapeGeometry(t);return doesGeometryOverlapPolygon(o,i)}):F.LZ}(e,t.id,r);n.length<r.length&&i.set(t,r.filter(e=>!n.includes(e)))}}let o=e.getCurrentPageShapesSorted().map(e=>e.id),a={};for(let[t,r]of i){let i=(0,B.oA)(r.map(t=>e.getShape(t))),{reparenting:l,remainingShapesToReparent:d}=getDroppedShapesToNewParents(e,i,(e,r)=>(!n?.filter||!!n.filter(r))&&r.id!==t.id&&o.indexOf(r.id)<o.indexOf(e.id));if(l.forEach((e,t)=>{0!==e.length&&(a[t]||(a[t]={parentId:t,shapeIds:[]}),a[t].shapeIds.push(...e.map(e=>e.id)))}),d.size>0){let n=e.findShapeAncestor(t,t=>e.isShapeOfType(t,"group"))?.id??e.getCurrentPageId();d.forEach(r=>{if(!a[n]){let r;let i=e.getSortedChildIdsForParent(n),o=i.indexOf(t.id);if(o>-1){let n=i[o+1],a=n?e.getShape(n).index:(0,B._L)(t.index);r=(0,B.eI)(t.index,a)}a[n]={parentId:n,shapeIds:[],index:r}}a[n].shapeIds.push(r.id)})}}e.run(()=>{Object.values(a).forEach(({parentId:t,shapeIds:n,index:r})=>{0!==n.length&&(n.sort((e,t)=>o.indexOf(e)<o.indexOf(t)?-1:1),e.reparentShapes(n,t,r))})})}function doesGeometryOverlapPolygon(e,t){if(e instanceof td.m)return e.children.some(e=>doesGeometryOverlapPolygon(e,t));let{vertices:n,center:r,isFilled:i,isEmptyLabel:o,isClosed:a}=e;if(o)return!1;if(n.some(e=>(0,ei.Of)(e,t)))return!0;if(a){if(i&&((0,ei.Of)(r,t)||t.every(e=>(0,ei.Of)(e,n)))||(0,tn.UQ)(t,n))return!0}else if((0,tn.TD)(t,n))return!0;return!1}function getDroppedShapesToNewParents(e,t,n){let r=new Set(t),i=new Set;for(let n of t){let t=e.getShapeParent(n);t&&e.isShapeOfType(t,"group")&&!i.has(t)&&i.add(t)}for(let t of i){let n=(0,B.oA)(e.getSortedChildIdsForParent(t).map(t=>e.getShape(t)));for(let e of n)r.delete(e);r.add(t)}let o=new Map,a=new Map,l=new Set(r),d=e.getCurrentPageShapesSorted().filter(t=>e.getShapeUtil(t).canReceiveNewChildrenOfType?.(t,t.type)&&!l.has(t));for(let t=d.length-1;t>=0;t--){let r=d[t],i=e.findShapeAncestor(r,t=>e.isShapeOfType(t,"group"))?.id,c=e.getShapeGeometry(r),u=e.getShapePageTransform(r),h=e.getShapeMask(r),p=u.applyToPoints(c.vertices),f=h?(0,tn.tY)(h,p):p;if(!f)continue;let g=[];for(let t of l){if(r.id===t.id||n&&!n(t,r))continue;o.has(t.id)||o.set(t.id,e.findShapeAncestor(t,t=>e.isShapeOfType(t,"group"))?.id);let a=o.get(t.id);if(a!==i||e.findShapeAncestor(r,e=>t.id===e.id))continue;let d=e.getShapePageTransform(t).clone().invert().applyToPoints(f);if(doesGeometryOverlapPolygon(e.getShapeGeometry(t),d)){if(!e.getShapeUtil(r).canReceiveNewChildrenOfType?.(r,t.type))continue;t.parentId!==r.id&&g.push(t),l.delete(t);continue}}g.length&&a.set(r.id,g)}return{reparenting:a,remainingShapesToReparent:l}}var tT=n(67062),tk=n(22059);let t_=new B.kM;function getFontsFromRichText(e,t,n){let{tipTapConfig:r,addFontsFromNode:i}=e.getTextOptions();(0,B.hu)(r,"textOptions.tipTapConfig must be set to use rich text"),(0,B.hu)(i,"textOptions.addFontsFromNode must be set to use rich text");let o=t_.get(r,()=>(0,tT.J1)(r.extensions??[])),a=tk.NB.fromJSON(o,t),l=new Set;function addFont(e){l.add(e)}return!function visit(e,t){for(let n of(t=i(e,t,addFont),e.children))visit(n,t)}(a,n),Array.from(l)}var tC=n(17556),tI=n(29261),tE=n(9006),tM=n(98542),tP=n(76737);async function hardReset({shouldReload:e=!0}={}){for(let e of((0,B.Xp)(),tP.xh.connectedInstances))await e.close();await Promise.all((0,tP.Hy)().map(e=>(0,tM.deleteDB)(e))),(0,B.ZL)(),e&&window.location.reload()}"undefined"!=typeof window&&(window.__tldraw__hardReset=hardReset);var tA=n(71743);function openWindow(e,t="_blank"){tI.G.openWindow(e,t)}function debugEnableLicensing(){}(0,B.x2)("@tldraw/editor","3.15.4","esm");let PathBuilder=class PathBuilder{static lineThroughPoints(e,t){let n=new PathBuilder;n.moveTo(e[0].x,e[0].y,{...t,offset:t?.endOffsets??t?.offset});for(let r=1;r<e.length;r++){let i=r===e.length-1;n.lineTo(e[r].x,e[r].y,i?{offset:t?.endOffsets}:void 0)}return n}static cubicSplineThroughPoints(e,t){let n=new PathBuilder,r=e.length,i=r-2;n.moveTo(e[0].x,e[0].y,{...t,offset:t?.endOffsets??t?.offset});for(let o=0;o<r-1;o++){let r,a,l,d,c;let u=0===o?e[0]:e[o-1],h=e[o],p=e[o+1],f=o===i?p:e[o+2];0===o?(r=u.x,a=u.y):(r=h.x+(p.x-u.x)/6*1.25,a=h.y+(p.y-u.y)/6*1.25),o===i?(l=p.x,d=p.y,c={offset:t?.endOffsets}):(l=p.x-(f.x-h.x)/6*1.25,d=p.y-(f.y-h.y)/6*1.25),n.cubicBezierTo(p.x,p.y,r,a,l,d,c)}return n}constructor(){}commands=[];lastMoveTo=null;assertHasMoveTo(){return(0,B.hu)(this.lastMoveTo,"Start an SVGPathBuilder with `.moveTo()`"),this.lastMoveTo}moveTo(e,t,n){return this.lastMoveTo={type:"move",x:e,y:t,closeIdx:null,isClose:!1,opts:n},this.commands.push(this.lastMoveTo),this}lineTo(e,t,n){return this.assertHasMoveTo(),this.commands.push({type:"line",x:e,y:t,isClose:!1,opts:n}),this}circularArcTo(e,t,n,r,i,o){return this.arcTo(e,e,t,n,0,r,i,o)}arcTo(e,t,n,r,i,o,a,l){this.assertHasMoveTo();let d=this.commands[this.commands.length-1].x,c=this.commands[this.commands.length-1].y;if(d===o&&c===a)return this;if(0===e||0===t)return this.lineTo(o,a,l);let u=Math.sin(i),h=Math.cos(i),p=Math.abs(e),f=Math.abs(t),g=(d-o)/2,m=(c-a)/2,y=h*g+u*m,b=-u*g+h*m,S=y*y/(p*p)+b*b/(f*f);if(S>1){let e=Math.sqrt(S);p*=e,f*=e}let v=p*p*f*f-p*p*b*b-f*f*y*y,k=p*p*b*b+f*f*y*y,_=v/k;_=_<0?0:_;let C=(n!==r?1:-1)*Math.sqrt(_),E=C*(p*b/f),M=C*(-(f*y)/p),P=h*E-u*M+(d+o)/2,A=u*E+h*M+(c+a)/2,j=(y-E)/p,D=(b-M)/f,B=(-y-E)/p,F=(-b-M)/f,O=Math.atan2(D,j),R=Math.atan2(F,B);!r&&R>O?R-=2*Math.PI:r&&R<O&&(R+=2*Math.PI);let L=R-O,N=Math.max(p,f)*Math.abs(L),z=Math.min(4,Math.ceil(Math.abs(L)/(Math.PI/2))),$=Math.ceil(getVerticesCountForArcLength(N)/z),G=L/z,ellipsePoint=e=>({x:P+p*Math.cos(e)*h-f*Math.sin(e)*u,y:A+p*Math.cos(e)*u+f*Math.sin(e)*h}),ellipseDerivative=e=>({x:-p*Math.sin(e)*h-f*Math.cos(e)*u,y:-p*Math.sin(e)*u+f*Math.cos(e)*h});for(let e=0;e<z;e++){let t=O+e*G,n=O+(e+1)*G,r=n-t,i=ellipsePoint(t),o=ellipsePoint(n),a=ellipseDerivative(t),d=ellipseDerivative(n),c=4/3*Math.tan(r/4),u=i.x+c*a.x,h=i.y+c*a.y,p=o.x-c*d.x,f=o.y-c*d.y,g=0===e?l:{...l,mergeWithPrevious:!0};this.cubicBezierToWithResolution(o.x,o.y,u,h,p,f,g,$)}return this}cubicBezierTo(e,t,n,r,i,o,a){return this.cubicBezierToWithResolution(e,t,n,r,i,o,a)}cubicBezierToWithResolution(e,t,n,r,i,o,a,l){return this.assertHasMoveTo(),this.commands.push({type:"cubic",x:e,y:t,cp1:{x:n,y:r},cp2:{x:i,y:o},isClose:!1,opts:a,resolution:l}),this}close(){let e=this.assertHasMoveTo(),t=this.commands[this.commands.length-1];return(0,ei.C2)(e.x,t.x)&&(0,ei.C2)(e.y,t.y)?t.isClose=!0:this.commands.push({type:"line",x:e.x,y:e.y,isClose:!0}),e.closeIdx=this.commands.length-1,this.lastMoveTo=null,this}toD(e={}){let{startIdx:t=0,endIdx:n=this.commands.length,onlyFilled:r=!1}=e,i=[],o=!1,a=!1,l=!1,addMoveIfNeeded=e=>{if(a||0===e)return;a=!0;let t=this.commands[e-1];i.push("M",(0,ei.$Z)(t.x),(0,ei.$Z)(t.y))};for(let e=t;e<n;e++){let t=this.commands[e];switch(t.type){case"move":{let e=t.opts?.geometry!==!1&&(t.opts?.geometry?.isFilled??!1);r&&!e?o=!0:(o=!1,a=!0,l=!0,i.push("M",(0,ei.$Z)(t.x),(0,ei.$Z)(t.y)));break}case"line":if(o)break;addMoveIfNeeded(e),t.isClose&&l?i.push("Z"):i.push("L",(0,ei.$Z)(t.x),(0,ei.$Z)(t.y));break;case"cubic":if(o)break;addMoveIfNeeded(e),i.push("C",(0,ei.$Z)(t.cp1.x),(0,ei.$Z)(t.cp1.y),(0,ei.$Z)(t.cp2.x),(0,ei.$Z)(t.cp2.y),(0,ei.$Z)(t.x),(0,ei.$Z)(t.y));break;default:(0,B.iP)(t,"type")}}return i.join(" ")}toSvg(e){if(e.forceSolid)return this.toSolidSvg(e);switch(e.style){case"solid":return this.toSolidSvg(e);case"dashed":case"dotted":return this.toDashedSvg(e);case"draw":{let t=this.toDrawSvg(e);return t}default:(0,B.iP)(e,"style")}}toGeometry(){let e=[],t=null;for(let n=0;n<this.commands.length;n++){let r=this.commands[n];"move"===r.type&&(t&&t.opts?.geometry!==!1&&e.push(new PathBuilderGeometry2d(this,t.startIdx,n,{...t.opts?.geometry,isFilled:t.opts?.geometry?.isFilled??!1,isClosed:null!==t.moveCommand.closeIdx})),t={startIdx:n,moveCommand:r,opts:r.opts,isClosed:!1}),r.isClose&&((0,B.hu)(t,"No current move command"),t.isClosed=!0)}return(t&&t.opts?.geometry!==!1&&e.push(new PathBuilderGeometry2d(this,t.startIdx,this.commands.length,{...t.opts?.geometry,isFilled:t.opts?.geometry?.isFilled??!1,isClosed:null!==t.moveCommand.closeIdx})),(0,B.hu)(e.length>0),1===e.length)?e[0]:new td.m({children:e})}toSolidSvg(e){let{strokeWidth:t,props:n}=e;return(0,et.jsx)("path",{strokeWidth:t,d:this.toD({onlyFilled:e.onlyFilled}),...n})}toDashedSvg(e){let t;let{style:n,strokeWidth:r,snap:i,lengthRatio:o,props:{markerStart:a,markerEnd:l,...d}={}}=e,c=[],u=!1,h=!1,p=null,addCurrentRun=()=>{if(!p)return;let{startIdx:t,endIdx:d,isFirst:u,isLast:h,length:f,lineOpts:g,pathIsClosed:m}=p;if(p=null,t===d&&"move"===this.commands[t].type)return;let y=g?.dashStart??e.start,b=g?.dashEnd??e.end,{strokeDasharray:S,strokeDashoffset:v}=(0,eR.H)(f,r,{style:n,snap:i,lengthRatio:o,start:u?y??(m?"outset":"none"):"outset",end:h?b??(m?"outset":"none"):"outset"}),k=this.toD({startIdx:t,endIdx:d+1});c.push((0,et.jsx)("path",{d:k,strokeDasharray:S,strokeDashoffset:v,markerStart:u?a:void 0,markerEnd:h?l:void 0},c.length))};for(let n=0;n<this.commands.length;n++){let r=this.commands[n],i=this.commands[n-1];if("move"===r.type){u=null!==r.closeIdx;let n=r.opts?.geometry!==!1&&(r.opts?.geometry?.isFilled??!1);e.onlyFilled&&!n?h=!0:(h=!1,t=r.opts);continue}if(h)continue;let o=this.calculateSegmentLength(i,r),a="move"===i.type,l=r.isClose||n===this.commands.length-1||this.commands[n+1]?.type==="move";p&&r.opts?.mergeWithPrevious?(p.length+=o,p.endIdx=n,p.isLast=l):(addCurrentRun(),p={startIdx:n,endIdx:n,isFirst:a,isLast:l,length:o,lineOpts:t,pathIsClosed:u})}return addCurrentRun(),(0,et.jsx)("g",{strokeWidth:r,...d,children:c})}toDrawSvg(e){return(0,et.jsx)("path",{strokeWidth:e.strokeWidth,d:this.toDrawD(e),...e.props})}toDrawD(e){let{strokeWidth:t,randomSeed:n,offset:r=t/3,roundness:i=2*t,passes:o=2,onlyFilled:a=!1}=e,l=[],d=this.getCommandInfo(),c=[],u=null;for(let e=0;e<this.commands.length;e++){let t=this.commands[e],n=t.opts?.offset??r,o=t.opts?.roundness??i;"move"===t.type&&(u=e);let a=t.isClose?(0,B.kP)(u)+1:this.commands[e+1]&&"move"!==this.commands[e+1].type?e+1:void 0,l=void 0!==a&&this.commands[a]&&this.commands[a]?.type!=="move"?d[a]:void 0,h=tj[t.type],p=void 0!==a&&tj[this.commands[a].type],f=d[e],g=f?.tangentEnd,m=l?.tangentStart,y=h&&p&&g&&m&&eF.B.Len2(g)>.01&&eF.B.Len2(m)>.01?(0,B.vm)(Math.abs(eF.B.AngleBetween(g,m)),[Math.PI/2,Math.PI],[o,0],!0):0,b=Math.min(f?.length??1/0,l?.length??1/0),S=b-2*y,v=(0,ei.uZ)(n,0,S/4),k=Math.min(y,(f?.length??1/0)/4),_=Math.min(y,(l?.length??1/0)/4),C={command:t,offsetAmount:v,roundnessBefore:k,roundnessAfter:_,tangentToPrev:d[e]?.tangentEnd,tangentToNext:l?.tangentStart,moveDidClose:!1};if(c.push(C),t.isClose&&null!==u){let e=c[u];e.moveDidClose=!0,e.roundnessAfter=_}else"move"===t.type&&(u=e)}for(let e=0;e<o;e++){let t=(0,B.Vk)(n+e),r={x:0,y:0},i=!1;for(let{command:e,offsetAmount:n,roundnessBefore:o,roundnessAfter:d,tangentToNext:u,tangentToPrev:h}of c){let c=e.isClose?r:{x:t()*n,y:t()*n};if("move"===e.type){r=c;let t=e.opts?.geometry!==!1&&(e.opts?.geometry?.isFilled??!1);i=!!a&&!t}if(i)continue;let p=eF.B.Add(e,c),f=u&&d>0?eF.B.Mul(u,-d).add(p):p,g=h&&o>0?eF.B.Mul(h,o).add(p):p;if(f===p||g===p)switch(e.type){case"move":l.push("M",(0,ei.$Z)(f.x),(0,ei.$Z)(f.y));break;case"line":l.push("L",(0,ei.$Z)(f.x),(0,ei.$Z)(f.y));break;case"cubic":{let t=eF.B.Add(e.cp1,c),n=eF.B.Add(e.cp2,c);l.push("C",(0,ei.$Z)(t.x),(0,ei.$Z)(t.y),(0,ei.$Z)(n.x),(0,ei.$Z)(n.y),(0,ei.$Z)(f.x),(0,ei.$Z)(f.y));break}default:(0,B.iP)(e,"type")}else switch(e.type){case"move":l.push("M",(0,ei.$Z)(f.x),(0,ei.$Z)(f.y));break;case"line":l.push("L",(0,ei.$Z)(g.x),(0,ei.$Z)(g.y),"Q",(0,ei.$Z)(p.x),(0,ei.$Z)(p.y),(0,ei.$Z)(f.x),(0,ei.$Z)(f.y));break;case"cubic":{let t=eF.B.Add(e.cp1,c),n=eF.B.Add(e.cp2,c);l.push("C",(0,ei.$Z)(t.x),(0,ei.$Z)(t.y),(0,ei.$Z)(n.x),(0,ei.$Z)(n.y),(0,ei.$Z)(p.x),(0,ei.$Z)(p.y));break}default:(0,B.iP)(e,"type")}}}return l.join(" ")}calculateSegmentLength(e,t){switch(t.type){case"move":return 0;case"line":return eF.B.Dist(e,t);case"cubic":return tD.length(e.x,e.y,t.cp1.x,t.cp1.y,t.cp2.x,t.cp2.y,t.x,t.y);default:(0,B.iP)(t,"type")}}getCommands(){return this.commands}getCommandInfo(){let e=[];for(let t=1;t<this.commands.length;t++){let n,r;let i=this.commands[t-1],o=this.commands[t];if(o._info){e[t]=o._info;continue}if("move"!==o.type){switch(o.type){case"line":n=r=eF.B.Sub(i,o).uni();break;case"cubic":n=eF.B.Sub(o.cp1,i).uni(),r=eF.B.Sub(o.cp2,o).uni();break;default:(0,B.iP)(o,"type")}o._info={tangentStart:n,tangentEnd:r,length:this.calculateSegmentLength(i,o)},e[t]=o._info}}return e}};let tj={line:!0,move:!0,cubic:!1};let PathBuilderGeometry2d=class PathBuilderGeometry2d extends ti.l${constructor(e,t,n,r){super(r),this.path=e,this.startIdx=t,this.endIdx=n}_segments=null;getSegments(){if(this._segments)return this._segments;this._segments=[];let e=this.path.commands[this.startIdx];(0,B.hu)("move"===e.type);for(let t=this.startIdx+1;t<this.endIdx;t++){let n=this.path.commands[t];switch((0,B.hu)("move"!==n.type),n.type){case"line":this._segments.push(new tl.W({start:eF.B.From(e),end:eF.B.From(n)}));break;case"cubic":this._segments.push(new CubicBezier2d({start:eF.B.From(e),cp1:eF.B.From(n.cp1),cp2:eF.B.From(n.cp2),end:eF.B.From(n),resolution:n.resolution}));break;default:(0,B.iP)(n,"type")}e=n}return this._segments}getVertices(e){let t=this.getSegments().flatMap(t=>t.getVertices(e)).filter((e,t,n)=>{let r=n[t-1];return!r||!eF.B.Equals(r,e)});if(this.isClosed){let e=t[t.length-1],n=t[0];eF.B.Equals(e,n)||t.push(n)}return t}nearestPoint(e,t){let n=null,r=1/0;for(let t of this.getSegments()){let i=t.nearestPoint(e),o=eF.B.Dist2(e,i);o<r&&(r=o,n=i)}return(0,B.hu)(n,"No nearest point found"),n}hitTestLineSegment(e,t,n=0,r){return super.hitTestLineSegment(e,t,n,r)}getSvgPathData(){return this.path.toD({startIdx:this.startIdx,endIdx:this.endIdx})}};/*!
 * Adapted from https://github.com/adobe-webplatform/Snap.svg/tree/master
 * Apache License: https://github.com/adobe-webplatform/Snap.svg/blob/master/LICENSE
 * https://github.com/adobe-webplatform/Snap.svg/blob/c8e483c9694517e24b282f8f59f985629f4994ce/dist/snap.svg.js#L5786
 */let tD={base3:(e,t,n,r,i)=>e*(e*(-3*t+9*n-9*r+3*i)+6*t-12*n+6*r)-3*t+3*n,length(e,t,n,r,i,o,a,l,d=1){d=d>1?1:d<0?0:d;let c=d/2,u=0;u=0;for(let d=0;d<12;d++){let h=c*tD.Tvalues[d]+c,p=tD.base3(h,e,n,i,a),f=tD.base3(h,t,r,o,l),g=p*p+f*f;u+=tD.Cvalues[d]*Math.sqrt(g)}return c*u},Tvalues:[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],Cvalues:[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472]};function usePrefersReducedMotion(){let[e,t]=(0,en.useState)(!1);return(0,en.useEffect)(()=>{if("undefined"==typeof window||!("matchMedia"in window))return;let e=window.matchMedia("(prefers-reduced-motion: reduce)"),handler=()=>{t(e.matches)};return handler(),e.addEventListener("change",handler),()=>e.removeEventListener("change",handler)},[]),e}let tB=(0,en.createContext)(null);function TldrawUiA11yProvider({children:e}){let t=(0,O.KO)("a11y",{msg:"",priority:"assertive"}),n=(0,en.useContext)(tB),r=(0,en.useMemo)(()=>({currentMsg:t,announce(e){e&&t.set(e)}}),[t]);return n?(0,et.jsx)(et.Fragment,{children:e}):(0,et.jsx)(tB.Provider,{value:r,children:e})}function useA11y(){let e=(0,en.useContext)(tB);if(!e)throw Error("useA11y must be used within a A11yContext.Provider");return e}let tF=(0,en.createContext)(null);function AssetUrlsProvider({assetUrls:e,children:t}){return(0,en.useEffect)(()=>{for(let t of Object.values(e.icons)){if(!t)continue;let e=(0,B.Ee)();e.crossOrigin="anonymous",e.src=t,e.decode()}for(let t of Object.values(e.embedIcons)){if(!t)continue;let e=(0,B.Ee)();e.crossOrigin="anonymous",e.src=t,e.decode()}},[e]),(0,et.jsx)(tF.Provider,{value:e,children:t})}function useAssetUrls(){let e=(0,en.useContext)(tF);if(!e)throw Error("useAssetUrls must be used within an AssetUrlsProvider");return e}let tO={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.download-original":"Download original","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-kbd-shortcuts":"Open keyboard shortcuts","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-keyboard-shortcuts.menu":"Keyboard shortcuts","action.toggle-keyboard-shortcuts":"Toggle keyboard shortcuts","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.files.amount-too-many":"Too many files","assets.url.failed":"Couldnt load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.cloud":"Cloud","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.heart":"Heart","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","arrow-kind-style.arc":"Arc","arrow-kind-style.elbow":"Elbow","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.heart":"Heart","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.media":"Media","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","tool.image-zoom":"Zoom","tool.replace-media":"Replace media","tool.flip-horz":"Flip horizontally","tool.flip-vert":"Flip vertically","tool.rotate-cw":"Rotate","tool.aspect-ratio":"Aspect ratio","tool.aspect-ratio.original":"Original","tool.aspect-ratio.square":"Square (1:1)","tool.aspect-ratio.circle":"Circle (1:1)","tool.aspect-ratio.landscape":"Landscape (4:3)","tool.aspect-ratio.portrait":"Portrait (3:4)","tool.aspect-ratio.wide":"Wide (16:9)","tool.image-toolbar-title":"Image tools","tool.image-crop":"Crop image","tool.media-alt-text":"Alternative text","tool.media-alt-text-desc":"Give a description","tool.media-alt-text-confirm":"Confirm","tool.rich-text-bold":"Bold","tool.rich-text-italic":"Italic","tool.rich-text-code":"Code","tool.rich-text-highlight":"Highlight","tool.rich-text-strikethrough":"Strikethrough","tool.rich-text-link":"Link","tool.rich-text-link-visit":"Visit link","tool.rich-text-link-remove":"Remove link","tool.rich-text-header":"Header","tool.rich-text-bulletList":"Bulleted list","tool.rich-text-toolbar-title":"Text formatting","tool.rich-text-orderedList":"Ordered list","tool.bookmark":"Bookmark","a11y.status":"Status","a11y.skip-to-main-content":"Move focus to canvas","a11y.shape-index":"{num} of {total}","a11y.shape-image":"Image","a11y.shape-video":"Video","a11y.multiple-shapes":"{num} shapes selected","a11y.select-shape":"Select next shape","a11y.select-shape-direction":"Select shape in direction","a11y.enter-leave-container":"Enter/leave container","a11y.repeat-shape":"Repeat shape","a11y.move-shape":"Move shape","a11y.move-shape-faster":"Move shape faster","a11y.enlarge-shape":"Enlarge shape","a11y.shrink-shape":"Shrink shape","a11y.pan-camera":"Pan camera","a11y.adjust-shape-styles":"Adjust shape styles","a11y.open-context-menu":"Open context menu","a11y.open-keyboard-shortcuts":"Open keyboard shortcuts","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.title":"Context menu","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.copy-link":"Copy editor link","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project cant be shared because its too large. Were working on it!","share-menu.upload-failed":"Sorry, we couldnt upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.avatar-color":"Avatar color","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","people-menu.anonymous-user":"New user","help-menu.import-tldr-file":"Import file","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","edit-link-dialog.external-link":"External link","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the sites URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","shortcuts-dialog.a11y":"Accessibility","shortcuts-dialog.text-formatting":"Text formatting","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.arrow-kind":"Line","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.title":"Tools","tool-panel.more":"More","navigation-zone.title":"Navigation","navigation-zone.minimap":"Minimap","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","toast.success":"Success","toast.error":"Error","toast.info":"Info","toast.warning":"Warning","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesnt look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Dont ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Dont ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Dont ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"Weve updated this document to work with the current version of tldraw. If youd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Dont ask again","cursor-chat.type-to-chat":"Type to chat","app.loading":"Loading tldraw","handle.resize-top":"Resize top","handle.resize-bottom":"Resize bottom","handle.resize-left":"Resize left","handle.resize-right":"Resize right","handle.resize-top-left":"Resize top left","handle.resize-top-right":"Resize top right","handle.resize-bottom-left":"Resize bottom left","handle.resize-bottom-right":"Resize bottom right","handle.rotate.top_left_rotate":"Rotate top left","handle.rotate.top_right_rotate":"Rotate top right","handle.rotate.bottom_left_rotate":"Rotate bottom left","handle.rotate.bottom_right_rotate":"Rotate bottom right","handle.rotate.mobile_rotate":"Rotate","handle.crop.top":"Crop top","handle.crop.bottom":"Crop bottom","handle.crop.left":"Crop left","handle.crop.right":"Crop right","handle.crop.top-left":"Crop top left","handle.crop.top-right":"Crop top right","handle.crop.bottom-left":"Crop bottom left","handle.crop.bottom-right":"Crop bottom right","ui.close":"Close","ui.checked":"Checked","ui.unchecked":"Unchecked"},tR=new Set(["ar","fa","he","ur","ku"]),tL={locale:"en",label:"English",messages:tO,dir:"ltr"};async function fetchTranslation(e,t){let n=await (0,B.he)(t.translations.en);if(!n.ok)return console.warn("No main translations found."),tL;if("en"===e)return tL;let r=L.a2.find(t=>t.locale===e);if(!r)return console.warn(`No translation found for locale ${e}`),tL;let i=await (0,B.he)(t.translations[r.locale]),o=await i.json();if(!o)return console.warn(`No messages found for locale ${e}`),tL;let a=[];for(let e in tL.messages)o[e]||a.push(e);return a.length,{locale:e,label:r.label,dir:tR.has(r.locale)?"rtl":"ltr",messages:{...tL.messages,...o}}}let tU=en.createContext(null);function useCurrentTranslation(){let e=en.useContext(tU);if(!e)throw Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return e}function TldrawUiTranslationProvider({overrides:e,locale:t,children:n}){let r=useAssetUrls(),[i,o]=en.useState(()=>e&&e.en?{locale:"en",label:"English",dir:"ltr",messages:{...tO,...e.en}}:{locale:"en",label:"English",dir:"ltr",messages:tO});return en.useEffect(()=>{let n=!1;return async function(){let i=await fetchTranslation(t,r);i&&!n&&(e&&e[t]?o({...i,messages:{...i.messages,...e[t]}}):o(i))}(),()=>{n=!0}},[r,t,e]),(0,et.jsx)(tU.Provider,{value:i,children:n})}function useTranslation(){let e=useCurrentTranslation();return en.useCallback(function(t){return e.messages[t]??t},[e])}let tN={normal:"tlui-button__normal",primary:"tlui-button__primary",danger:"tlui-button__danger",low:"tlui-button__low",icon:"tlui-button__icon",tool:"tlui-button__tool",menu:"tlui-button__menu",help:"tlui-button__help"},tz=en.forwardRef(function({children:e,type:t,isActive:n,...r},i){return(0,et.jsx)("button",{ref:i,type:"button",draggable:!1,"data-isactive":n,...r,className:eh("tlui-button",tN[t],r.className),children:e})});function SkipToMainContent(){let e=(0,eW.jE)(),t=useTranslation(),n=(0,en.useRef)(null),r=(0,en.useCallback)(t=>{(0,e0.be)(t),n.current?.blur();let r=e.getCurrentPageShapesInReadingOrder();r.length&&(e.setSelectedShapes([r[0].id]),e.zoomToSelectionIfOffscreen(256,{animation:{duration:e.options.animationMediumMs},inset:0}),e.timers.setTimeout(()=>e.getContainer().focus(),100))},[e]);return(0,et.jsx)(tz,{ref:n,type:"low",tabIndex:0,className:"tl-skip-to-main-content",onClick:r,children:t("a11y.skip-to-main-content")})}let tH=(0,en.memo)(function(){let e=useA11y(),t=useTranslation(),n=(0,O.Hg)("a11y-msg",()=>e.currentMsg.get(),[]);return useA11yDebug(n.msg),useSelectedShapesAnnouncer(),n.msg&&(0,et.jsx)("div",{"aria-label":t("a11y.status"),"aria-live":n.priority||"assertive",role:"status","aria-hidden":"false",style:{position:"absolute",top:"-10000px",left:"-10000px"},children:n.msg})});function generateShapeAnnouncementMessage(e){let{editor:t,selectedShapeIds:n,msg:r}=e,i="",o=n.length;if(o>1)i=r("a11y.multiple-shapes").replace("{num}",o.toString());else if(1===o){let e=n[0],o=t.getShape(e);if(!o)return"";let a=t.getShapeUtil(o.type),l=["image","video"].includes(o.type),d="";d=r("geo"===o.type?`geo-style.${o.props.geo}`:l?`a11y.shape-${o.type}`:`tool.${o.type}`);let c=t.getCurrentPageShapesInReadingOrder(),u=(c.findIndex(t=>t.id===e)+1).toString(),h=c.length.toString(),p=r("a11y.shape-index").replace("{num}",u).replace("{total}",h),f=a.getAriaDescriptor(o)||a.getText(o)||"";i=(f?`${f}, `:"")+`${d}. ${p}`}return i}let useSelectedShapesAnnouncer=()=>{let e=(0,eW.Z2)(),t=useA11y(),n=useTranslation(),r=(0,en.useRef)([]);(0,O.vC)("announce selection",()=>{if(!e)return;let i=e.isIn("select.idle");if(i){let i=e.getSelectedShapeIds();i!==r.current&&(r.current=i,(0,F.dy)(()=>{let r=generateShapeAnnouncementMessage({editor:e,selectedShapeIds:i,msg:n});r&&t.announce({msg:r})}))}},[e,t,n])},useA11yDebug=e=>{let t=(0,eG.uK)();(0,en.useEffect)(()=>{if(tg.hR.a11y.get()){let log=e=>{console.debug(`%ca11y%c: ${e}`,"color: white; background: #40C057; padding: 2px;border-radius: 3px;","font-weight: normal")},handleKeyUp=e=>{let t=document.activeElement;if("Tab"===e.key&&t&&t!==document.body&&!t.classList.contains("tl-container")){let e=t.getAttribute("aria-label")||t.getAttribute("title")||t.textContent;e&&log(e)}};return e&&log(e),document.addEventListener("keyup",handleKeyUp),()=>document.removeEventListener("keyup",handleKeyUp)}},[t,e])},defaultEventHandler=()=>void 0,t$=en.createContext(null);function TldrawUiEventsProvider({onEvent:e,children:t}){return(0,et.jsx)(t$.Provider,{value:e??defaultEventHandler,children:t})}function useUiEvents(){let e=en.useContext(t$);return e??defaultEventHandler}var tV=n(7544),tG=n(85744),tK=n(56989),tW=n(9381),tZ=n(56325),tq=n(16459),tY=n(73763),tX="ContextMenu",[tJ,tQ]=(0,tK.b)(tX,[tZ.Wf]),t0=(0,tZ.Wf)(),[t1,t2]=tJ(tX),ContextMenu=e=>{let{__scopeContextMenu:t,children:n,onOpenChange:r,dir:i,modal:o=!0}=e,[a,l]=en.useState(!1),d=t0(t),c=(0,tq.W)(r),u=en.useCallback(e=>{l(e),c(e)},[c]);return(0,et.jsx)(t1,{scope:t,open:a,onOpenChange:u,modal:o,children:(0,et.jsx)(tZ.fC,{...d,dir:i,open:a,onOpenChange:u,modal:o,children:n})})};ContextMenu.displayName=tX;var t3="ContextMenuTrigger",t5=en.forwardRef((e,t)=>{let{__scopeContextMenu:n,disabled:r=!1,...i}=e,o=t2(t3,n),a=t0(n),l=en.useRef({x:0,y:0}),d=en.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...l.current})}),c=en.useRef(0),u=en.useCallback(()=>window.clearTimeout(c.current),[]),handleOpen=e=>{l.current={x:e.clientX,y:e.clientY},o.onOpenChange(!0)};return en.useEffect(()=>u,[u]),en.useEffect(()=>void(r&&u()),[r,u]),(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(tZ.ee,{...a,virtualRef:d}),(0,et.jsx)(tW.WV.span,{"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:r?e.onContextMenu:(0,tG.Mj)(e.onContextMenu,e=>{u(),handleOpen(e),e.preventDefault()}),onPointerDown:r?e.onPointerDown:(0,tG.Mj)(e.onPointerDown,whenTouchOrPen(e=>{u(),c.current=window.setTimeout(()=>handleOpen(e),700)})),onPointerMove:r?e.onPointerMove:(0,tG.Mj)(e.onPointerMove,whenTouchOrPen(u)),onPointerCancel:r?e.onPointerCancel:(0,tG.Mj)(e.onPointerCancel,whenTouchOrPen(u)),onPointerUp:r?e.onPointerUp:(0,tG.Mj)(e.onPointerUp,whenTouchOrPen(u))})]})});t5.displayName=t3;var ContextMenuPortal=e=>{let{__scopeContextMenu:t,...n}=e,r=t0(t);return(0,et.jsx)(tZ.h_,{...r,...n})};ContextMenuPortal.displayName="ContextMenuPortal";var t4="ContextMenuContent",t6=en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t2(t4,n),o=t0(n),a=en.useRef(!1);return(0,et.jsx)(tZ.VY,{...o,...r,ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),!t.defaultPrevented&&a.current&&t.preventDefault(),a.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||i.modal||(a.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});t6.displayName=t4,en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t0(n);return(0,et.jsx)(tZ.ZA,{...i,...r,ref:t})}).displayName="ContextMenuGroup",en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t0(n);return(0,et.jsx)(tZ.__,{...i,...r,ref:t})}).displayName="ContextMenuLabel";var t7=en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t0(n);return(0,et.jsx)(tZ.ck,{...i,...r,ref:t})});t7.displayName="ContextMenuItem";var t8=en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t0(n);return(0,et.jsx)(tZ.oC,{...i,...r,ref:t})});t8.displayName="ContextMenuCheckboxItem",en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t0(n);return(0,et.jsx)(tZ.Ee,{...i,...r,ref:t})}).displayName="ContextMenuRadioGroup",en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t0(n);return(0,et.jsx)(tZ.Rk,{...i,...r,ref:t})}).displayName="ContextMenuRadioItem",en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t0(n);return(0,et.jsx)(tZ.wU,{...i,...r,ref:t})}).displayName="ContextMenuItemIndicator",en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t0(n);return(0,et.jsx)(tZ.Z0,{...i,...r,ref:t})}).displayName="ContextMenuSeparator",en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t0(n);return(0,et.jsx)(tZ.Eh,{...i,...r,ref:t})}).displayName="ContextMenuArrow";var t9="ContextMenuSub",ContextMenuSub=e=>{let{__scopeContextMenu:t,children:n,onOpenChange:r,open:i,defaultOpen:o}=e,a=t0(t),[l,d]=(0,tY.T)({prop:i,defaultProp:o??!1,onChange:r,caller:t9});return(0,et.jsx)(tZ.Tr,{...a,open:l,onOpenChange:d,children:n})};ContextMenuSub.displayName=t9;var ne=en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t0(n);return(0,et.jsx)(tZ.fF,{...i,...r,ref:t})});ne.displayName="ContextMenuSubTrigger";var nt=en.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=t0(n);return(0,et.jsx)(tZ.tu,{...i,...r,ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});function whenTouchOrPen(e){return t=>"mouse"!==t.pointerType?e(t):void 0}function removeFrame(e,t){let n=(0,B.oA)(t.map(t=>e.getShape(t)).filter(t=>t&&e.isShapeOfType(t,"frame")));if(!n.length)return;let r=[];e.run(()=>{n.map(t=>{let i=e.getSortedChildIdsForParent(t.id);i.length&&(kickoutOccludedShapes(e,i,{filter:e=>!n.find(t=>t.id===e.id)}),r.push(...i))}),e.setSelectedShapes(r),e.deleteShapes(t)})}function getFrameChildrenBounds(e,t,n={padding:50}){let r=e9.xu.FromPoints(e.flatMap(e=>{if(!e)return[];let n=t.getShapeGeometry(e.id),r=t.getShapeLocalTransform(e);return r?.applyToPoints(n.vertices)??[]})),i=n.padding??50,o=r.w+2*i,a=r.h+2*i,l=i-r.minX,d=i-r.minY;return{w:o,h:a,dx:l,dy:d}}function fitFrameToContent(e,t,n={}){let r=e.getShape(t);if(!r)return;let i=e.getSortedChildIdsForParent(r.id),o=(0,B.oA)(i.map(t=>e.getShape(t)));if(!o.length)return;let{w:a,h:l,dx:d,dy:c}=getFrameChildrenBounds(o,e,n);if(0===d&&0===c&&r.props.w===a&&r.props.h===l)return;let u=new eF.B(d,c).rot(r.rotation);e.run(()=>{let t=i.map(t=>{let n=e.getShape(t);return{id:n.id,type:n.type,x:n.x+d,y:n.y+c}});t.push({id:r.id,type:r.type,x:r.x-u.x,y:r.y-u.y,props:{w:a,h:l}}),e.updateShapes(t)})}function TldrawUiButtonLabel({children:e}){return(0,et.jsx)("span",{className:"tlui-button__label",children:e})}nt.displayName="ContextMenuSubContent";var nn=n(28712);let nr=(0,en.memo)(function({label:e,small:t,invertIcon:n,icon:r,color:i,className:o,...a}){return"string"==typeof r?(0,et.jsx)(TldrawUIIconInner,{label:e,small:t,invertIcon:n,icon:r,color:i,className:o,...a}):(0,en.cloneElement)(r,{...a,className:eh({"tlui-icon__small":t},o,r.props.className),"aria-label":e,style:{color:i,transform:n?"scale(-1, 1)":void 0,...r.props.style}})});function TldrawUIIconInner({label:e,small:t,invertIcon:n,icon:r,color:i,className:o,...a}){let l=useAssetUrls(),d=l.icons[r]??l.icons["question-mark-circle"],c=(0,en.useRef)(null);return((0,en.useLayoutEffect)(()=>{d||console.error(`Icon not found: ${r}. Add it to the assetUrls.icons object.`),c?.current&&(c.current.style.webkitMask=`url(${d}) center 100% / 100% no-repeat`)},[c,d,r]),"none"===r)?(0,et.jsx)("div",{className:eh("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":t},o),...a}):(0,et.jsx)("div",{...a,ref:c,"aria-label":e,role:"img",className:eh("tlui-icon",{"tlui-icon__small":t},o),style:{color:i,mask:`url(${d}) center 100% / 100% no-repeat`,transform:n?"scale(-1, 1)":void 0}})}function TldrawUiButtonIcon({icon:e,small:t,invertIcon:n}){return(0,et.jsx)(nr,{"aria-hidden":"true",label:"",className:"tlui-button__icon",icon:e,small:t,invertIcon:n})}function TldrawUiDialogHeader({className:e,children:t}){return(0,et.jsx)("div",{className:eh("tlui-dialog__header",e),children:t})}function TldrawUiDialogTitle({className:e,children:t,style:n}){return(0,et.jsx)(nn.Title,{dir:"ltr",className:eh("tlui-dialog__header__title",e),style:n,children:t})}function TldrawUiDialogCloseButton(){let e=useTranslation();return(0,et.jsx)("div",{className:"tlui-dialog__header__close",children:(0,et.jsx)(nn.DialogClose,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:(0,et.jsx)(tz,{type:"icon","aria-label":e("ui.close"),onTouchEnd:e=>e.target.click(),children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"cross-2"})})})})}function TldrawUiDialogBody({className:e,children:t,style:n}){return(0,et.jsx)("div",{className:eh("tlui-dialog__body",e),style:n,tabIndex:0,children:t})}function TldrawUiDialogFooter({className:e,children:t}){return(0,et.jsx)("div",{className:eh("tlui-dialog__footer",e),children:t})}let ni=en.forwardRef(function({className:e,label:t,icon:n,iconLeft:r,iconLabel:i,autoSelect:o=!1,autoFocus:a=!1,defaultValue:l,placeholder:d,onComplete:c,onValueChange:u,onCancel:h,onFocus:p,onBlur:f,shouldManuallyMaintainScrollPositionWhenFocused:g=!1,children:m,value:y,"data-testid":b,disabled:S},v){let k=(0,eW.Z2)(),_=en.useRef(null);en.useImperativeHandle(v,()=>_.current);let C=useTranslation(),E=en.useRef(l??""),M=en.useRef(l??""),P=en.useRef(!1),[A,j]=en.useState(!1),D=en.useCallback(e=>{j(!0);let t=e.currentTarget;M.current=t.value,k?k.timers.requestAnimationFrame(()=>{o&&t.select()}):eV.r.requestAnimationFrame("anon",()=>{o&&t.select()}),p?.()},[o,k,p]),B=en.useCallback(e=>{let t=e.currentTarget.value;M.current=t,u?.(t)},[u]),F=en.useCallback(e=>{switch(e.key){case"Enter":if(P.current)return;e.currentTarget.blur(),(0,e0.be)(e),c?.(e.currentTarget.value);break;case"Escape":e.currentTarget.value=E.current,h?.(e.currentTarget.value),e.currentTarget.blur(),(0,e0.be)(e)}},[c,h]),O=en.useCallback(e=>{j(!1);let t=e.currentTarget.value;f?.(t)},[f]),R=en.useCallback(()=>P.current=!0,[]),L=en.useCallback(()=>P.current=!1,[]);return en.useEffect(()=>{if(!eH.a.isIos)return;let e=window.visualViewport;if(A&&g&&e){let onViewportChange=()=>{_.current?.scrollIntoView({block:"center"})};return e.addEventListener("resize",onViewportChange),e.addEventListener("scroll",onViewportChange),k?k.timers.requestAnimationFrame(()=>{_.current?.scrollIntoView({block:"center"})}):eV.r.requestAnimationFrame("anon",()=>{_.current?.scrollIntoView({block:"center"})}),()=>{e.removeEventListener("resize",onViewportChange),e.removeEventListener("scroll",onViewportChange)}}},[A,k,g]),(0,et.jsxs)("div",{draggable:!1,className:"tlui-input__wrapper",children:[m,t&&(0,et.jsx)("label",{children:C(t)}),r&&(0,et.jsx)(nr,{label:i?C(i):"",icon:r,className:"tlui-icon-left",small:!0}),(0,et.jsx)("input",{ref:_,className:eh("tlui-input",e),type:"text",defaultValue:l,onKeyDownCapture:F,onChange:B,onFocus:D,onBlur:O,onCompositionStart:R,onCompositionEnd:L,autoFocus:a,placeholder:d,value:y,"data-testid":b,disabled:S}),n&&(0,et.jsx)(nr,{label:i?C(i):"",icon:n,small:!!t})]})});function validateUrl(e){return N.T.linkUrl.isValid(e)?{isValid:!0,hasProtocol:!0}:N.T.linkUrl.isValid("https://"+e)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}let no=(0,O.j)(function({onClose:e}){let t=(0,eW.jE)(),n=t.getOnlySelectedShape();return n&&"url"in n.props&&"string"==typeof n.props.url?(0,et.jsx)(na,{onClose:e,selectedShape:n}):null}),na=(0,O.j)(function({onClose:e,selectedShape:t}){let n=(0,eW.jE)(),r=useTranslation(),i=(0,en.useRef)(null);(0,en.useEffect)(()=>{n.timers.requestAnimationFrame(()=>i.current?.focus())},[n]);let o=(0,en.useRef)(t.props.url),[a,l]=(0,en.useState)(()=>{let e=validateUrl(t.props.url),n=!0===e.isValid?e.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:n,safe:n,valid:!0}}),d=(0,en.useCallback)(e=>{let t=e.replace(/https?:\/\/(https?:\/\/)/,(e,t)=>t),n=validateUrl(t),r=!0===n.isValid?n.hasProtocol?t:"https://"+t:"https://";l({actual:t,safe:r,valid:n.isValid})},[]),c=(0,en.useCallback)(()=>{let t=n.getOnlySelectedShape();t&&(n.updateShapes([{id:t.id,type:t.type,props:{url:""}}]),e())},[n,e]),u=(0,en.useCallback)(()=>{let t=n.getOnlySelectedShape();t&&(t&&"url"in t.props&&t.props.url!==a.safe&&n.updateShapes([{id:t.id,type:t.type,props:{url:a.safe}}]),e())},[n,e,a]),h=(0,en.useCallback)(()=>{e()},[e]);if(!t)return e(),null;let p=o.current&&!a.valid;return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)(TldrawUiDialogHeader,{children:[(0,et.jsx)(TldrawUiDialogTitle,{children:r("edit-link-dialog.title")}),(0,et.jsx)(TldrawUiDialogCloseButton,{})]}),(0,et.jsx)(TldrawUiDialogBody,{children:(0,et.jsxs)("div",{className:"tlui-edit-link-dialog",children:[(0,et.jsx)(ni,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,autoSelect:!0,placeholder:"https://example.com",value:a.actual,onValueChange:d,onComplete:u,onCancel:h}),(0,et.jsx)("div",{children:r(a.valid?"edit-link-dialog.detail":"edit-link-dialog.invalid-url")})]})}),(0,et.jsxs)(TldrawUiDialogFooter,{className:"tlui-dialog__footer__actions",children:[(0,et.jsx)(tz,{type:"normal",onClick:h,onTouchEnd:h,children:(0,et.jsx)(TldrawUiButtonLabel,{children:r("edit-link-dialog.cancel")})}),p?(0,et.jsx)(tz,{type:"danger",onTouchEnd:c,onClick:c,children:(0,et.jsx)(TldrawUiButtonLabel,{children:r("edit-link-dialog.clear")})}):(0,et.jsx)(tz,{type:"primary",disabled:!a.valid,onTouchEnd:u,onClick:u,children:(0,et.jsx)(TldrawUiButtonLabel,{children:r("edit-link-dialog.save")})})]})]})});var ns=n(25566);let nl=/(^\/[f|p|r|ro|s|v]\/[^/]+\/?$)/,nd=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(nl))return t.searchParams.append("embed","true"),e},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(nl))return t.searchParams.delete("embed"),e}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{if(e.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto|design)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!e.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${e}`},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(/^\/embed\/?$/)){let e=t.searchParams.get("url");if(e)return e}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:e=>{if(e.includes("/maps/embed?"))return e;if(e.includes("/maps/")){let t;let n=e.match(/@(.*?),(.*?),(.*?)(z|m)/);if(n){let[,r,i,o,a]=n,l="z"===a?"roadmap":"satellite",d="roadmap"===l?o:-Math.log2(parseInt(o)/14772321)/.8,c=new URL(e).host.replace("www.","");t=`https://${c}/maps/embed/v1/view?key=${ns.env.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${d}&maptype=${l}`}else t="";return t}},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(!t)return;let n=t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/);if(n&&t.searchParams.has("center")&&t.searchParams.get("zoom")){let e=t.searchParams.get("zoom")??"12",n=t.searchParams.get("maptype")??"roadmap",r="roadmap"===n?e:14772321*Math.pow(2,-.8*parseInt(e)),[i,o]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${i},${o},${r}${"roadmap"===n?"z":"m"}`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:e=>{let t=(0,B.Ad)(e),n=t&&t.pathname.match(/\/v\/(.+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:e=>{let t=(0,B.Ad)(e),n=t&&t.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:e=>{let t=(0,B.Ad)(e),n=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:e=>{let t=(0,B.Ad)(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(t){let[e,n,r]=t;return`https://codepen.io/${n}/embed/${r}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(t){let[e,n,r]=t;return`https://codepen.io/${n}/pen/${r}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:e=>{let t=e.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(t){let[e,n]=t;return`https://scratch.mit.edu/projects/embed/${n}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(t){let[e,n]=t;return`https://scratch.mit.edu/projects/${n}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=(0,B.Ad)(e);if(!t)return;let n=t.hostname.replace(/^www./,"");if("youtu.be"===n){let e=t.pathname.split("/").filter(Boolean)[0],n=new URLSearchParams(t.search),r=n.get("t");r&&(n.set("start",r),n.delete("t"));let i=n.toString()?"?"+n.toString():"";return`https://www.youtube.com/embed/${e}${i}`}if(("youtube.com"===n||"m.youtube.com"===n)&&t.pathname.match(/^\/watch/)){let e=t.searchParams.get("v"),n=new URLSearchParams(t.search);n.delete("v");let r=n.get("t");r&&(n.set("start",r),n.delete("t"));let i=n.toString()?"?"+n.toString():"";return`https://www.youtube.com/embed/${e}${i}`}},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(!t)return;let n=t.hostname.replace(/^www./,"");if("youtube.com"===n){let e=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(e){let n=new URLSearchParams(t.search);n.set("v",e?.[1]??"");let r=n.get("start");return r&&(n.set("t",r),n.delete("start")),`https://www.youtube.com/watch?${n.toString()}`}}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:e=>{let t=(0,B.Ad)(e),n=t?.searchParams.get("cid");if(t?.pathname.match(/\/calendar\/u\/0/)&&n){t.pathname="/calendar/embed";let e=Array.from(t.searchParams.keys());for(let n of e)t.searchParams.delete(n);return t.searchParams.set("src",n),t.href}},fromEmbedUrl:e=>{let t=(0,B.Ad)(e),n=t?.searchParams.get("src");if(t?.pathname.match(/\/calendar\/embed/)&&n){t.pathname="/calendar/u/0";let e=Array.from(t.searchParams.keys());for(let n of e)t.searchParams.delete(n);return t.searchParams.set("cid",n),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/pub\/?$/)){t.pathname=t.pathname.replace(/\/pub$/,"/embed");let e=Array.from(t.searchParams.keys());for(let n of e)t.searchParams.delete(n);return t.href}},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/embed\/?$/)){t.pathname=t.pathname.replace(/\/embed$/,"/pub");let e=Array.from(t.searchParams.keys());for(let n of e)t.searchParams.delete(n);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/)){if(!e.split("/").pop())return;return e}},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/)){if(!e.split("/").pop())return;return e}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${e}?embed=true`},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&"vimeo.com"===t.hostname&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&"player.vimeo.com"===t.hostname){let e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.hash.match(/#room=/))return e},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.hash.match(/#room=/))return e}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}/embed${t.pathname}?cell=*`;if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){let e=t.pathname.replace(/^\/d/,"");return`${t.origin}/embed${e}?cell=*`}},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);return t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","")}#cell-*`:t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`:void 0}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&"www.desmos.com"===t.hostname&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&""===t.search&&""===t.hash)return`${e}?embed`},fromEmbedUrl:e=>{let t=(0,B.Ad)(e);if(t&&"www.desmos.com"===t.hostname&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===t.search&&""===t.hash)return e.replace("?embed","")}}],nc={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},nu=nd.map(e=>e.type);function useGetEmbedShapeUtil(){let e=(0,eW.Z2)();if(e&&e.hasShapeUtil("embed"))return e.getShapeUtil("embed")}function useGetEmbedDefinition(){let e=useGetEmbedShapeUtil();return t=>e?e.getEmbedDefinition(t):void 0}let nh=(0,O.j)(function({onClose:e}){let t=(0,eW.jE)(),n=useTranslation(),r=useAssetUrls(),[i,o]=(0,en.useState)(null),[a,l]=(0,en.useState)(""),[d,c]=(0,en.useState)(null),[u,h]=(0,en.useState)(!1),p=(0,en.useRef)(-1),f=function(){let e=useGetEmbedShapeUtil();return e?e.getEmbedDefinitions():[]}(),g=useGetEmbedDefinition();return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)(TldrawUiDialogHeader,{children:[(0,et.jsx)(TldrawUiDialogTitle,{children:i?`${n("embed-dialog.title")} \u2014 ${i.title}`:n("embed-dialog.title")}),(0,et.jsx)(TldrawUiDialogCloseButton,{})]}),i?(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)(TldrawUiDialogBody,{className:"tlui-embed-dialog__enter",children:[(0,et.jsx)(ni,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:e=>{l(e);let n=g(e);c(n&&n.definition.type===i.type?n:null),h(!1),clearTimeout(p.current),p.current=t.timers.setTimeout(()=>h(!n),320)}}),""===a?(0,et.jsxs)("div",{className:"tlui-embed-dialog__instruction",children:[(0,et.jsx)("span",{children:n("embed-dialog.instruction")})," ",i.instructionLink&&(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:"Learn more"}),"."]})]}):(0,et.jsx)("div",{className:"tlui-embed-dialog__warning",children:u?n("embed-dialog.invalid-url"):"\xa0"})]}),(0,et.jsxs)(TldrawUiDialogFooter,{className:"tlui-dialog__footer__actions",children:[(0,et.jsx)(tz,{type:"normal",onClick:()=>{o(null),c(null),l("")},children:(0,et.jsx)(TldrawUiButtonLabel,{children:n("embed-dialog.back")})}),(0,et.jsx)("div",{className:"tlui-embed__spacer"}),(0,et.jsx)(tz,{type:"normal",onClick:e,children:(0,et.jsx)(TldrawUiButtonLabel,{children:n("embed-dialog.cancel")})}),(0,et.jsx)(tz,{type:"primary",disabled:!d,onClick:()=>{d&&(t.putExternalContent({type:"embed",url:a,point:t.getViewportPageBounds().center,embed:d.definition}),e())},children:(0,et.jsx)(TldrawUiButtonLabel,{children:n("embed-dialog.create")})})]})]}):(0,et.jsx)(et.Fragment,{children:(0,et.jsx)(TldrawUiDialogBody,{className:"tlui-embed-dialog__list",children:f.map(e=>{var t;let n=(t=e.type,nu.includes(t))?r.embedIcons[e.type]:"icon"in e?e.icon:void 0;return(0,et.jsxs)(tz,{type:"menu",onClick:()=>o(e),children:[(0,et.jsx)(TldrawUiButtonLabel,{children:e.title}),n&&(0,et.jsx)("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${n})`}})]},e.type)})})})]})}),np=[0,389,436,476,580,640,840,1023];var nf=((r=nf||{})[r.ZERO=0]="ZERO",r[r.MOBILE_XXS=1]="MOBILE_XXS",r[r.MOBILE_XS=2]="MOBILE_XS",r[r.MOBILE_SM=3]="MOBILE_SM",r[r.MOBILE=4]="MOBILE",r[r.TABLET_SM=5]="TABLET_SM",r[r.TABLET=6]="TABLET",r[r.DESKTOP=7]="DESKTOP",r);let ng=en.createContext(null);function BreakPointProvider({forceMobile:e=!1,children:t}){let n=(0,eW.Z2)(),r=(0,O.Hg)("breakpoint",()=>{let{width:t}=n?.getViewportScreenBounds()??{width:window.innerWidth},r=e?nf.MOBILE_SM:np.length-1;for(let e=0;e<r;e++)if(t>np[e]&&t<=np[e+1])return e;return r},[n]);return(0,et.jsx)(ng.Provider,{value:r,children:t})}function useBreakpoint(){let e=(0,en.useContext)(ng);if(null===e)throw Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return e}let nm=(0,en.createContext)(null);function useTldrawUiMenuContext(){let e=(0,en.useContext)(nm);if(!e)throw Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return e}function TldrawUiMenuContextProvider({type:e,sourceId:t,children:n}){return(0,et.jsx)(nm.Provider,{value:{type:e,sourceId:t},children:n})}function useShowCollaborationUi(){let e=(0,eW.Z2)();return e?.store.props.collaboration!==void 0}function useCollaborationStatus(){let e=(0,eW.Z2)();return(0,O.Hg)("sync status",()=>e?.store.props.collaboration?.status?e.store.props.collaboration.status.get():null,[e])}function useReadonly(){let e=(0,eW.Z2)();return(0,O.Hg)("isReadonlyMode",()=>!!e?.getIsReadonly(),[e])}let ny=eH.a.isDarwin?"":"__CTRL__",nb=eH.a.isDarwin?"":"__ALT__";function kbd(e){return","===e?[","]:e.split(",")[0].split(/(\[\[[^\]]+\]\])/g).map(e=>e.startsWith("[[")?e.replace(/[[\]]/g,""):e.replace(/cmd\+/g,ny).replace(/ctrl\+/g,ny).replace(/alt\+/g,nb).replace(/shift\+/g,"").replace(/\$/g,ny).replace(/\?/g,nb).replace(/!/g,"").match(/__CTRL__|__ALT__|./g)||[]).flat().map((e,t)=>{if("__CTRL__"===e)return"Ctrl";if("__ALT__"===e)return"Alt";let n=e[0].toUpperCase()+e.slice(1);return eH.a.isDarwin||!t?n:["+",n]}).flat()}function kbdStr(e){return" "+kbd(e).join("")}function Spinner(e){let t=useTranslation();return(0,et.jsx)(ed.q,{"aria-label":t("app.loading"),...e})}function useMenuIsOpen(e,t){let n=(0,eW.Z2)(),r=(0,en.useCallback)(e=>{e&&n?.complete(),t?.(e)},[n,t]),i=useUiEvents(),o=(0,en.useCallback)(t=>{i(t,{source:"unknown",id:e})},[e,i]);return useGlobalMenuIsOpen(n?`${e}-${n.contextId}`:e,r,o)}function TldrawUiDropdownMenuRoot({id:e,children:t,modal:n=!1,debugOpen:r=!1}){let[i,o]=useMenuIsOpen(e);return(0,et.jsx)(tV.fC,{open:r||i,dir:"ltr",modal:n,onOpenChange:o,children:t})}function TldrawUiDropdownMenuTrigger({children:e,...t}){return(0,et.jsx)(tV.xz,{dir:"ltr",asChild:!0,onTouchEnd:e=>(0,e0.PF)(e),...t,children:e})}function TldrawUiDropdownMenuContent({className:e,side:t="bottom",align:n="start",sideOffset:r=8,alignOffset:i=8,children:o}){let a=(0,eG.uK)();return(0,et.jsx)(tV.Uv,{container:a,children:(0,et.jsx)(tV.VY,{className:eh("tlui-menu",e),side:t,sideOffset:r,align:n,alignOffset:i,collisionPadding:4,children:o})})}function TldrawUiDropdownMenuSub({id:e,children:t}){let[n,r]=useMenuIsOpen(e);return(0,et.jsx)(tV.Tr,{open:n,onOpenChange:r,children:t})}function TldrawUiDropdownMenuSubTrigger({id:e,label:t,title:n,disabled:r}){return(0,et.jsx)(tV.fF,{dir:"ltr",asChild:!0,disabled:r,children:(0,et.jsxs)(tz,{"data-testid":e,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:n,children:[(0,et.jsx)(TldrawUiButtonLabel,{children:t}),(0,et.jsx)(TldrawUiButtonIcon,{icon:"chevron-right",small:!0})]})})}function TldrawUiDropdownMenuSubContent({id:e,alignOffset:t=-1,sideOffset:n=-6,size:r="small",children:i}){let o=(0,eG.uK)();return(0,et.jsx)(tV.Uv,{container:o,children:(0,et.jsx)(tV.tu,{"data-testid":e,className:"tlui-menu tlui-menu__submenu__content",alignOffset:t,sideOffset:n,collisionPadding:4,"data-size":r,children:i})})}function TldrawUiDropdownMenuGroup({className:e,children:t}){return(0,et.jsx)("div",{dir:"ltr",className:eh("tlui-menu__group",e),children:t})}function TldrawUiDropdownMenuIndicator(){let e=useTranslation();return(0,et.jsx)(tV.wU,{dir:"ltr",asChild:!0,children:(0,et.jsx)(nr,{label:e("ui.checked"),icon:"check"})})}function TldrawUiDropdownMenuItem({noClose:e,children:t}){return(0,et.jsx)(tV.ck,{dir:"ltr",asChild:!0,onClick:e?e0.PF:void 0,children:t})}function TldrawUiDropdownMenuCheckboxItem({children:e,onSelect:t,...n}){let r=useTranslation();return(0,et.jsxs)(tV.oC,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:e=>{t?.(e),(0,e0.PF)(e)},...n,children:[(0,et.jsx)("div",{className:"tlui-button__checkbox__indicator",children:(0,et.jsx)(tV.wU,{dir:"ltr",children:(0,et.jsx)(nr,{label:r("ui.checked"),icon:"check",small:!0})})}),e]})}function TldrawUiKbd({children:e,visibleOnMobileLayout:t=!1}){let n=useBreakpoint();return!t&&n<nf.MOBILE?null:(0,et.jsx)("kbd",{className:"tlui-kbd",children:kbd(e).map((e,t)=>(0,et.jsx)("span",{children:e},t))})}var nx=n(44356),nw="horizontal",nS=["horizontal","vertical"],nv=en.forwardRef((e,t)=>{let{decorative:n,orientation:r=nw,...i}=e,o=nS.includes(r)?r:nw;return(0,et.jsx)(tW.WV.div,{"data-orientation":o,...n?{role:"none"}:{"aria-orientation":"vertical"===o?o:void 0,role:"separator"},...i,ref:t})});nv.displayName="Separator";var nT=n(42788),nk=n(65400),n_="Toolbar",[nC,nI]=(0,tK.b)(n_,[nx.Pc,nT.oY]),nE=(0,nx.Pc)(),nM=(0,nT.oY)(),[nP,nA]=nC(n_),nj=en.forwardRef((e,t)=>{let{__scopeToolbar:n,orientation:r="horizontal",dir:i,loop:o=!0,...a}=e,l=nE(n),d=(0,nk.gm)(i);return(0,et.jsx)(nP,{scope:n,orientation:r,dir:d,children:(0,et.jsx)(nx.fC,{asChild:!0,...l,orientation:r,dir:d,loop:o,children:(0,et.jsx)(tW.WV.div,{role:"toolbar","aria-orientation":r,dir:d,...a,ref:t})})})});nj.displayName=n_;var nD="ToolbarSeparator";en.forwardRef((e,t)=>{let{__scopeToolbar:n,...r}=e,i=nA(nD,n);return(0,et.jsx)(nv,{orientation:"horizontal"===i.orientation?"vertical":"horizontal",...r,ref:t})}).displayName=nD;var nB=en.forwardRef((e,t)=>{let{__scopeToolbar:n,...r}=e,i=nE(n);return(0,et.jsx)(nx.ck,{asChild:!0,...i,focusable:!e.disabled,children:(0,et.jsx)(tW.WV.button,{type:"button",...r,ref:t})})});nB.displayName="ToolbarButton",en.forwardRef((e,t)=>{let{__scopeToolbar:n,...r}=e,i=nE(n);return(0,et.jsx)(nx.ck,{asChild:!0,...i,focusable:!0,children:(0,et.jsx)(tW.WV.a,{...r,ref:t,onKeyDown:(0,tG.Mj)(e.onKeyDown,e=>{" "===e.key&&e.currentTarget.click()})})})}).displayName="ToolbarLink";var nF="ToolbarToggleGroup",nO=en.forwardRef((e,t)=>{let{__scopeToolbar:n,...r}=e,i=nA(nF,n),o=nM(n);return(0,et.jsx)(nT.fC,{"data-orientation":i.orientation,dir:i.dir,...o,...r,ref:t,rovingFocus:!1})});nO.displayName=nF;var nR=en.forwardRef((e,t)=>{let{__scopeToolbar:n,...r}=e,i=nM(n),o={__scopeToolbar:e.__scopeToolbar};return(0,et.jsx)(nB,{asChild:!0,...o,children:(0,et.jsx)(nT.ck,{...i,...r,ref:t})})});nR.displayName="ToolbarToggleItem";let nL=en.forwardRef(({children:e,className:t,label:n,...r},i)=>(0,et.jsx)(nj,{ref:i,...r,className:eh("tlui-toolbar-container",t),"aria-label":n,children:e})),nU=en.forwardRef(({asChild:e,children:t,type:n,isActive:r,...i},o)=>(0,et.jsx)(nB,{ref:o,asChild:e,draggable:!1,"data-isactive":r,...i,className:eh("tlui-button",`tlui-button__${n}`,i.className),children:t})),TldrawUiToolbarToggleGroup=({children:e,className:t,type:n,...r})=>(0,et.jsx)(nO,{type:n,...r,role:"radiogroup",className:eh("tlui-toolbar-toggle-group",t),children:e}),TldrawUiToolbarToggleItem=({children:e,className:t,type:n,value:r,...i})=>(0,et.jsx)(nR,{...i,className:eh("tlui-button",`tlui-button__${n}`,"tlui-toolbar-toggle-group-item",t),value:r,children:e});function TldrawUiMenuItem({disabled:e=!1,spinner:t=!1,readonlyOk:n=!1,id:r,kbd:i,label:o,icon:a,iconLeft:l,onSelect:d,noClose:c,isSelected:u}){let{type:h,sourceId:p}=useTldrawUiMenuContext(),f=useTranslation(),[g,m]=(0,en.useState)(!1),y=useReadonly();if(y&&!n)return null;let b=unwrapLabel(o,h),S=i?kbdStr(i):void 0,v=b?f(b):void 0,k=v&&S?`${v} ${S}`:v;switch(h){case"menu":return(0,et.jsx)(TldrawUiDropdownMenuItem,{children:(0,et.jsxs)(tz,{type:"menu","data-testid":`${p}.${r}`,disabled:e,title:k,onClick:e=>{c&&(0,e0.PF)(e),g?m(!1):d(p)},children:[l&&(0,et.jsx)(TldrawUiButtonIcon,{icon:l,small:!0}),(0,et.jsx)(TldrawUiButtonLabel,{children:v}),i&&(0,et.jsx)(TldrawUiKbd,{children:i})]})});case"context-menu":if(e)return null;return(0,et.jsxs)(t7,{dir:"ltr",title:k,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${p}.${r}`,onSelect:e=>{c&&(0,e0.PF)(e),g?m(!1):d(p)},children:[(0,et.jsx)("span",{className:"tlui-button__label",draggable:!1,children:v}),l&&(0,et.jsx)(TldrawUiButtonIcon,{icon:l,small:!0}),i&&(0,et.jsx)(TldrawUiKbd,{children:i}),t&&(0,et.jsx)(Spinner,{})]});case"panel":return(0,et.jsxs)(tz,{"data-testid":`${p}.${r}`,type:"menu",title:k,disabled:e,onClick:()=>d(p),children:[(0,et.jsx)(TldrawUiButtonLabel,{children:v}),t?(0,et.jsx)(Spinner,{}):a&&(0,et.jsx)(TldrawUiButtonIcon,{icon:a})]});case"small-icons":case"icons":return(0,et.jsx)(nU,{"data-testid":`${p}.${r}`,type:"icon",title:k,disabled:e,onClick:()=>d(p),children:(0,et.jsx)(TldrawUiButtonIcon,{icon:a,small:!0})});case"keyboard-shortcuts":if(!i)return console.warn(`Menu item '${o}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null;return(0,et.jsxs)("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${p}.${r}`,children:[(0,et.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:v}),(0,et.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:(0,et.jsx)(TldrawUiKbd,{visibleOnMobileLayout:!0,children:i})})]});case"helper-buttons":return(0,et.jsxs)(tz,{type:"low",onClick:()=>d(p),children:[(0,et.jsx)(TldrawUiButtonIcon,{icon:a}),(0,et.jsx)(TldrawUiButtonLabel,{children:v})]});case"toolbar":return(0,et.jsx)(nU,{"aria-label":v,"aria-pressed":u?"true":"false","data-testid":`tools.${r}`,"data-value":r,disabled:e,onClick:()=>d("toolbar"),onTouchStart:e=>{(0,e0.PF)(e),d("toolbar")},title:k,type:"tool",children:(0,et.jsx)(TldrawUiButtonIcon,{icon:a})});case"toolbar-overflow":return(0,et.jsx)(nU,{"aria-label":v,"aria-pressed":u?"true":"false",isActive:u,className:"tlui-button-grid__button","data-testid":`tools.more.${r}`,"data-value":r,disabled:e,onClick:()=>d("toolbar"),title:k,type:"icon",children:(0,et.jsx)(TldrawUiButtonIcon,{icon:a})});default:throw(0,B.iP)(h)}}function TldrawUiMenuActionItem({actionId:e="",...t}){let n=useActions(),r=n[e];return r?(0,et.jsx)(TldrawUiMenuItem,{...r,...t}):null}function TldrawUiMenuGroup({id:e,label:t,className:n,children:r}){let{type:i,sourceId:o}=useTldrawUiMenuContext(),a=useTranslation(),l=unwrapLabel(t,i),d=l?a(l):void 0;switch(i){case"panel":return(0,et.jsx)("div",{className:eh("tlui-menu__group",n),"data-testid":`${o}-group.${e}`,children:r});case"menu":return(0,et.jsx)(TldrawUiDropdownMenuGroup,{className:n,"data-testid":`${o}-group.${e}`,children:r});case"context-menu":return(0,et.jsx)("div",{dir:"ltr",className:eh("tlui-menu__group",n),"data-testid":`${o}-group.${e}`,children:r});case"keyboard-shortcuts":return(0,et.jsxs)("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${o}-group.${e}`,children:[(0,et.jsx)("h2",{className:"tlui-shortcuts-dialog__group__title",children:d}),(0,et.jsx)("div",{className:"tlui-shortcuts-dialog__group__content",children:r})]});default:return r}}let nN=(0,en.createContext)(null);function TldrawUiDialogsProvider({context:e,children:t}){let n=(0,en.useContext)(nN),r=useUiEvents(),i=(0,O.KO)("dialogs",[]),o=(0,en.useMemo)(()=>({dialogs:i,addDialog(t){let n=t.id??(0,B.EL)();return i.update(e=>[...e.filter(e=>e.id!==t.id),{...t,id:n}]),r("open-menu",{source:"dialog",id:n}),e$.h.addOpenMenu(n,e),n},removeDialog(t){let n=i.get().find(e=>e.id===t);return n&&(n.onClose?.(),r("close-menu",{source:"dialog",id:t}),e$.h.deleteOpenMenu(t,e),i.update(e=>e.filter(e=>e!==n))),t},clearDialogs(){let t=i.get();0!==t.length&&(t.forEach(t=>{t.onClose?.(),r("close-menu",{source:"dialog",id:t.id}),e$.h.deleteOpenMenu(t.id,e)}),i.set([]))}}),[r,i,e]);return n?(0,et.jsx)(et.Fragment,{children:t}):(0,et.jsx)(nN.Provider,{value:o,children:t})}function useDialogs(){let e=(0,en.useContext)(nN);if(!e)throw Error("useDialogs must be used within a DialogsProvider");return e}var nz=n(54887),nH=n(42210),n$=n(27733),nV=n(79249),nG=n(52730),nK=n(85606),nW=n(51030),nZ=n(8281),nq="ToastProvider",[nY,nX,nJ]=(0,n$.B)("Toast"),[nQ,n0]=(0,tK.b)("Toast",[nJ]),[n1,n2]=nQ(nq),ToastProvider=e=>{let{__scopeToast:t,label:n="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:a}=e,[l,d]=en.useState(null),[c,u]=en.useState(0),h=en.useRef(!1),p=en.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${nq}\`. Expected non-empty \`string\`.`),(0,et.jsx)(nY.Provider,{scope:t,children:(0,et.jsx)(n1,{scope:t,label:n,duration:r,swipeDirection:i,swipeThreshold:o,toastCount:c,viewport:l,onViewportChange:d,onToastAdd:en.useCallback(()=>u(e=>e+1),[]),onToastRemove:en.useCallback(()=>u(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:p,children:a})})};ToastProvider.displayName=nq;var n3="ToastViewport",n5=["F8"],n4="toast.viewportPause",n6="toast.viewportResume",n7=en.forwardRef((e,t)=>{let{__scopeToast:n,hotkey:r=n5,label:i="Notifications ({hotkey})",...o}=e,a=n2(n3,n),l=nX(n),d=en.useRef(null),c=en.useRef(null),u=en.useRef(null),h=en.useRef(null),p=(0,nH.e)(t,h,a.onViewportChange),f=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=a.toastCount>0;en.useEffect(()=>{let handleKeyDown=e=>{let t=0!==r.length&&r.every(t=>e[t]||e.code===t);t&&h.current?.focus()};return document.addEventListener("keydown",handleKeyDown),()=>document.removeEventListener("keydown",handleKeyDown)},[r]),en.useEffect(()=>{let e=d.current,t=h.current;if(g&&e&&t){let handlePause=()=>{if(!a.isClosePausedRef.current){let e=new CustomEvent(n4);t.dispatchEvent(e),a.isClosePausedRef.current=!0}},handleResume=()=>{if(a.isClosePausedRef.current){let e=new CustomEvent(n6);t.dispatchEvent(e),a.isClosePausedRef.current=!1}},handleFocusOutResume=t=>{let n=!e.contains(t.relatedTarget);n&&handleResume()},handlePointerLeaveResume=()=>{let t=e.contains(document.activeElement);t||handleResume()};return e.addEventListener("focusin",handlePause),e.addEventListener("focusout",handleFocusOutResume),e.addEventListener("pointermove",handlePause),e.addEventListener("pointerleave",handlePointerLeaveResume),window.addEventListener("blur",handlePause),window.addEventListener("focus",handleResume),()=>{e.removeEventListener("focusin",handlePause),e.removeEventListener("focusout",handleFocusOutResume),e.removeEventListener("pointermove",handlePause),e.removeEventListener("pointerleave",handlePointerLeaveResume),window.removeEventListener("blur",handlePause),window.removeEventListener("focus",handleResume)}}},[g,a.isClosePausedRef]);let m=en.useCallback(({tabbingDirection:e})=>{let t=l(),n=t.map(t=>{let n=t.ref.current,r=[n,...function(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}(n)];return"forwards"===e?r:r.reverse()});return("forwards"===e?n.reverse():n).flat()},[l]);return en.useEffect(()=>{let e=h.current;if(e){let handleKeyDown=t=>{let n=t.altKey||t.ctrlKey||t.metaKey,r="Tab"===t.key&&!n;if(r){let n=document.activeElement,r=t.shiftKey,i=t.target===e;if(i&&r){c.current?.focus();return}let o=m({tabbingDirection:r?"backwards":"forwards"}),a=o.findIndex(e=>e===n);focusFirst(o.slice(a+1))?t.preventDefault():r?c.current?.focus():u.current?.focus()}};return e.addEventListener("keydown",handleKeyDown),()=>e.removeEventListener("keydown",handleKeyDown)}},[l,m]),(0,et.jsxs)(nV.I0,{ref:d,role:"region","aria-label":i.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:g?void 0:"none"},children:[g&&(0,et.jsx)(n9,{ref:c,onFocusFromOutsideViewport:()=>{let e=m({tabbingDirection:"forwards"});focusFirst(e)}}),(0,et.jsx)(nY.Slot,{scope:n,children:(0,et.jsx)(tW.WV.ol,{tabIndex:-1,...o,ref:p})}),g&&(0,et.jsx)(n9,{ref:u,onFocusFromOutsideViewport:()=>{let e=m({tabbingDirection:"backwards"});focusFirst(e)}})]})});n7.displayName=n3;var n8="ToastFocusProxy",n9=en.forwardRef((e,t)=>{let{__scopeToast:n,onFocusFromOutsideViewport:r,...i}=e,o=n2(n8,n);return(0,et.jsx)(nZ.TX,{tabIndex:0,...i,ref:t,style:{position:"fixed"},onFocus:e=>{let t=e.relatedTarget,n=!o.viewport?.contains(t);n&&r()}})});n9.displayName=n8;var re="Toast",rt=en.forwardRef((e,t)=>{let{forceMount:n,open:r,defaultOpen:i,onOpenChange:o,...a}=e,[l,d]=(0,tY.T)({prop:r,defaultProp:i??!0,onChange:o,caller:re});return(0,et.jsx)(nK.z,{present:n||l,children:(0,et.jsx)(ri,{open:l,...a,ref:t,onClose:()=>d(!1),onPause:(0,tq.W)(e.onPause),onResume:(0,tq.W)(e.onResume),onSwipeStart:(0,tG.Mj)(e.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:(0,tG.Mj)(e.onSwipeMove,e=>{let{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${n}px`)}),onSwipeCancel:(0,tG.Mj)(e.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:(0,tG.Mj)(e.onSwipeEnd,e=>{let{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${n}px`),d(!1)})})})});rt.displayName=re;var[rn,rr]=nQ(re,{onClose(){}}),ri=en.forwardRef((e,t)=>{let{__scopeToast:n,type:r="foreground",duration:i,open:o,onClose:a,onEscapeKeyDown:l,onPause:d,onResume:c,onSwipeStart:u,onSwipeMove:h,onSwipeCancel:p,onSwipeEnd:f,...g}=e,m=n2(re,n),[y,b]=en.useState(null),S=(0,nH.e)(t,e=>b(e)),v=en.useRef(null),k=en.useRef(null),_=i||m.duration,C=en.useRef(0),E=en.useRef(_),M=en.useRef(0),{onToastAdd:P,onToastRemove:A}=m,j=(0,tq.W)(()=>{let e=y?.contains(document.activeElement);e&&m.viewport?.focus(),a()}),D=en.useCallback(e=>{e&&e!==1/0&&(window.clearTimeout(M.current),C.current=new Date().getTime(),M.current=window.setTimeout(j,e))},[j]);en.useEffect(()=>{let e=m.viewport;if(e){let handleResume=()=>{D(E.current),c?.()},handlePause=()=>{let e=new Date().getTime()-C.current;E.current=E.current-e,window.clearTimeout(M.current),d?.()};return e.addEventListener(n4,handlePause),e.addEventListener(n6,handleResume),()=>{e.removeEventListener(n4,handlePause),e.removeEventListener(n6,handleResume)}}},[m.viewport,_,d,c,D]),en.useEffect(()=>{o&&!m.isClosePausedRef.current&&D(_)},[o,_,m.isClosePausedRef,D]),en.useEffect(()=>(P(),()=>A()),[P,A]);let B=en.useMemo(()=>y?function getAnnounceTextContent(e){let t=[],n=Array.from(e.childNodes);return n.forEach(e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),e.nodeType===e.ELEMENT_NODE){let n=e.ariaHidden||e.hidden||"none"===e.style.display,r=""===e.dataset.radixToastAnnounceExclude;if(!n){if(r){let n=e.dataset.radixToastAnnounceAlt;n&&t.push(n)}else t.push(...getAnnounceTextContent(e))}}}),t}(y):null,[y]);return m.viewport?(0,et.jsxs)(et.Fragment,{children:[B&&(0,et.jsx)(ToastAnnounce,{__scopeToast:n,role:"status","aria-live":"foreground"===r?"assertive":"polite",children:B}),(0,et.jsx)(rn,{scope:n,onClose:j,children:nz.createPortal((0,et.jsx)(nY.ItemSlot,{scope:n,children:(0,et.jsx)(nV.fC,{asChild:!0,onEscapeKeyDown:(0,tG.Mj)(l,()=>{m.isFocusedToastEscapeKeyDownRef.current||j(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:(0,et.jsx)(tW.WV.li,{tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":m.swipeDirection,...g,ref:S,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:(0,tG.Mj)(e.onKeyDown,e=>{"Escape"!==e.key||(l?.(e.nativeEvent),e.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,j()))}),onPointerDown:(0,tG.Mj)(e.onPointerDown,e=>{0===e.button&&(v.current={x:e.clientX,y:e.clientY})}),onPointerMove:(0,tG.Mj)(e.onPointerMove,e=>{if(!v.current)return;let t=e.clientX-v.current.x,n=e.clientY-v.current.y,r=!!k.current,i=["left","right"].includes(m.swipeDirection),o=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,a=i?o(0,t):0,l=i?0:o(0,n),d="touch"===e.pointerType?10:2,c={x:a,y:l},p={originalEvent:e,delta:c};r?(k.current=c,handleAndDispatchCustomEvent("toast.swipeMove",h,p,{discrete:!1})):isDeltaInDirection(c,m.swipeDirection,d)?(k.current=c,handleAndDispatchCustomEvent("toast.swipeStart",u,p,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>d||Math.abs(n)>d)&&(v.current=null)}),onPointerUp:(0,tG.Mj)(e.onPointerUp,e=>{let t=k.current,n=e.target;if(n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),k.current=null,v.current=null,t){let n=e.currentTarget,r={originalEvent:e,delta:t};isDeltaInDirection(t,m.swipeDirection,m.swipeThreshold)?handleAndDispatchCustomEvent("toast.swipeEnd",f,r,{discrete:!0}):handleAndDispatchCustomEvent("toast.swipeCancel",p,r,{discrete:!0}),n.addEventListener("click",e=>e.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),ToastAnnounce=e=>{let{__scopeToast:t,children:n,...r}=e,i=n2(re,t),[o,a]=en.useState(!1),[l,d]=en.useState(!1);return function(e=()=>{}){let t=(0,tq.W)(e);(0,nW.b)(()=>{let e=0,n=0;return e=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(n)}},[t])}(()=>a(!0)),en.useEffect(()=>{let e=window.setTimeout(()=>d(!0),1e3);return()=>window.clearTimeout(e)},[]),l?null:(0,et.jsx)(nG.h,{asChild:!0,children:(0,et.jsx)(nZ.TX,{...r,children:o&&(0,et.jsxs)(et.Fragment,{children:[i.label," ",n]})})})},ro=en.forwardRef((e,t)=>{let{__scopeToast:n,...r}=e;return(0,et.jsx)(tW.WV.div,{...r,ref:t})});ro.displayName="ToastTitle";var ra=en.forwardRef((e,t)=>{let{__scopeToast:n,...r}=e;return(0,et.jsx)(tW.WV.div,{...r,ref:t})});ra.displayName="ToastDescription";var rs="ToastAction",rl=en.forwardRef((e,t)=>{let{altText:n,...r}=e;return n.trim()?(0,et.jsx)(ru,{altText:n,asChild:!0,children:(0,et.jsx)(rc,{...r,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${rs}\`. Expected non-empty \`string\`.`),null)});rl.displayName=rs;var rd="ToastClose",rc=en.forwardRef((e,t)=>{let{__scopeToast:n,...r}=e,i=rr(rd,n);return(0,et.jsx)(ru,{asChild:!0,children:(0,et.jsx)(tW.WV.button,{type:"button",...r,ref:t,onClick:(0,tG.Mj)(e.onClick,i.onClose)})})});rc.displayName=rd;var ru=en.forwardRef((e,t)=>{let{__scopeToast:n,altText:r,...i}=e;return(0,et.jsx)(tW.WV.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...i,ref:t})});function handleAndDispatchCustomEvent(e,t,n,{discrete:r}){let i=n.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?(0,tW.jH)(i,o):i.dispatchEvent(o)}var isDeltaInDirection=(e,t,n=0)=>{let r=Math.abs(e.x),i=Math.abs(e.y),o=r>i;return"left"===t||"right"===t?o&&r>n:!o&&i>n};function focusFirst(e){let t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}let rh=(0,en.createContext)(null);function TldrawUiToastsProvider({children:e}){let t=(0,O.KO)("toasts",[]),n=(0,en.useContext)(rh),r=(0,en.useMemo)(()=>({toasts:t,addToast(e){let n=e.id??(0,B.EL)();return t.update(t=>[...t.filter(t=>t.id!==e.id),{...e,id:n}]),n},removeToast:e=>(t.update(t=>t.filter(t=>t.id!==e)),e),clearToasts(){t.set([])}}),[t]);return n?(0,et.jsx)(et.Fragment,{children:e}):(0,et.jsx)(ToastProvider,{children:(0,et.jsx)(rh.Provider,{value:r,children:e})})}function useToasts(){let e=(0,en.useContext)(rh);if(!e)throw Error("useToasts must be used within a ToastsProvider");return e}function getLocalFiles(e){return new Promise(t=>{let{allowMultiple:n=!0,mimeTypes:r=[]}=e||{},i=document.createElement("input");async function onchange(e){let n=e.target.files;if(!n||0===n.length)return;let r=Array.from(n);i.value="",t(r),i.removeEventListener("change",onchange),i.remove()}i.type="file",i.accept=r?.join(","),i.multiple=n,i.addEventListener("change",onchange),i?.click()})}var rp=n(80352);let rf="web image/vnd.tldraw+png",rg={png:rf},rm={[rf]:"image/png"};async function pasteFiles(e,t,n,r){let i=t.map(e=>e instanceof File?e:new File([e],"tldrawFile",{type:e.type}));e.markHistoryStoppingPoint("paste"),await e.putExternalContent({type:"files",files:i,point:n,sources:r})}async function pasteUrl(e,t,n,r){return e.markHistoryStoppingPoint("paste"),await e.putExternalContent({type:"url",point:n,url:t,sources:r})}let ry=[rf,"image/png","image/jpeg","image/webp","image/svg+xml"];function stripHtml(e){let t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e.trim(),t.body.textContent||t.body.innerText||""}let isValidHttpURL=e=>{try{let t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch{return!1}},getValidHttpURLList=e=>{let t=e.split(/[\n\s]/);for(let e of t)try{let t=new URL(e);if(!("http:"===t.protocol||"https:"===t.protocol))return}catch{return}return(0,tA.j)(t)},isSvgText=e=>/^<svg/.test(e),rb=["input","select","textarea"];function areShortcutsDisabled(e){let{activeElement:t}=document;return e.menus.hasAnyOpenMenus()||t&&(t.isContentEditable||rb.indexOf(t.tagName.toLowerCase())>-1)}let handleText=(e,t,n,r)=>{let i=getValidHttpURLList(t);if(i)for(let t of i)pasteUrl(e,t,n);else isValidHttpURL(t)?pasteUrl(e,t,n):isSvgText(t)?(e.markHistoryStoppingPoint("paste"),e.putExternalContent({type:"svg-text",text:t,point:n,sources:r})):(e.markHistoryStoppingPoint("paste"),e.putExternalContent({type:"text",text:t,point:n,sources:r}))},handlePasteFromEventClipboardData=async(e,t,n)=>{if(null!==e.getEditingShapeId())return;if(!t)throw Error("No clipboard data");let r=[];for(let e of Object.values(t.items))switch(e.kind){case"file":r.push({type:"file",source:new Promise(t=>t(e.getAsFile()))});break;case"string":"text/html"===e.type?r.push({type:"html",source:new Promise(t=>e.getAsString(t))}):"text/plain"===e.type?r.push({type:"text",source:new Promise(t=>e.getAsString(t))}):r.push({type:e.type,source:new Promise(t=>e.getAsString(t))})}handleClipboardThings(e,r,n)},handlePasteFromClipboardApi=async({editor:e,clipboardItems:t,point:n,fallbackFiles:r})=>{let i=[];for(let e of t){for(let t of ry)if(e.types.includes(t)){let n=e.getType(t).then(e=>B.P6.rewriteMimeType(e,(0,B.eg)(rm,t)??t));i.push({type:"blob",source:n});break}e.types.includes("text/html")&&i.push({type:"html",source:(async()=>{let t=await e.getType("text/html");return await B.P6.blobToText(t)})()}),e.types.includes("text/uri-list")&&i.push({type:"url",source:(async()=>{let t=await e.getType("text/uri-list");return await B.P6.blobToText(t)})()}),e.types.includes("text/plain")&&i.push({type:"text",source:(async()=>{let t=await e.getType("text/plain");return await B.P6.blobToText(t)})()})}return r?.length&&1===i.length&&"text"===i[0].type?(i.pop(),i.push(...r.map(e=>({type:"file",source:Promise.resolve(e)})))):r?.length&&0===i.length&&i.push(...r.map(e=>({type:"file",source:Promise.resolve(e)}))),await handleClipboardThings(e,i,n)};async function handleClipboardThings(e,t,n){let r=t.filter(e=>("file"===e.type||"blob"===e.type)&&null!==e.source);if(r.length){if(r.length>e.options.maxFilesAtOnce)throw Error("Too many files");let t=(0,B.oA)(await Promise.all(r.map(e=>e.source)));return await pasteFiles(e,t,n)}let i=await Promise.all(t.filter(e=>"file"!==e.type).map(e=>new Promise(t=>{if("file"===e.type){t({type:"error",data:null,reason:"unexpected file"});return}e.source.then(n=>{let r=n.match(/<div data-tldraw[^>]*>(.*)<\/div>/)?.[1];if(r)try{let e;try{e=JSON.parse(r)}catch{let n=rp.decompressFromBase64(r);if(null===n){t({type:"error",data:null,reason:"found tldraw data comment but could not parse"});return}e=JSON.parse(n)}if("application/tldraw"!==e.type){t({type:"error",data:e,reason:`found tldraw data comment but JSON was of a different type: ${e.type}`});return}if(3===e.version)try{let n=JSON.parse(rp.decompressFromBase64(e.data.otherCompressed)||"{}"),r={assets:e.data.assets||[],...n};t({type:"tldraw",data:r});return}catch(n){t({type:"error",data:e,reason:`failed to decompress version 2 clipboard data: ${n}`});return}if(2===e.version)t({type:"tldraw",data:e.data});else{if("string"==typeof e.data){t({type:"error",data:e,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}t({type:"tldraw",data:e.data});return}}catch{t({type:"error",data:r,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if("html"===e.type){t({type:"text",data:n,subtype:"html"});return}if("url"===e.type){t({type:"text",data:n,subtype:"url"});return}try{let e=JSON.parse(n);if("excalidraw/clipboard"===e.type){t({type:"excalidraw",data:e});return}t({type:"text",data:n,subtype:"json"});return}catch{t({type:"text",data:n,subtype:"text"});return}}t({type:"error",data:n,reason:"unhandled case"})})})));for(let t of i)if("tldraw"===t.type){e.markHistoryStoppingPoint("paste"),e.putExternalContent({type:"tldraw",content:t.data,point:n});return}for(let t of i)if("excalidraw"===t.type){e.markHistoryStoppingPoint("paste"),e.putExternalContent({type:"excalidraw",content:t.data,point:n});return}for(let t of i){if("text"===t.type&&"html"===t.subtype){let r=new DOMParser().parseFromString(t.data,"text/html"),o=r.querySelector("body"),a=o&&1===Array.from(o.children).filter(e=>1===e.nodeType).length&&o.firstElementChild&&"A"===o.firstElementChild.tagName&&o.firstElementChild.hasAttribute("href")&&""!==o.firstElementChild.getAttribute("href");if(a){let t=o.firstElementChild.getAttribute("href");handleText(e,t,n,i);return}if(!i.some(e=>"text"===e.type&&"html"!==e.subtype)&&t.data.trim()){let r=stripHtml(t.data)??"";if(r){handleText(e,stripHtml(t.data),n,i);return}}if(i.some(e=>"text"===e.type&&"html"!==e.subtype)){let r=stripHtml(t.data)??"";if(r){e.markHistoryStoppingPoint("paste"),e.putExternalContent({type:"text",text:r,html:t.data,point:n,sources:i});return}}}if("text"===t.type&&"text"===t.subtype&&t.data.startsWith("<iframe ")){let r=new DOMParser().parseFromString(t.data,"text/html"),o=r.querySelector("body"),a=o&&1===Array.from(o.children).filter(e=>1===e.nodeType).length&&o.firstElementChild&&"IFRAME"===o.firstElementChild.tagName&&o.firstElementChild.hasAttribute("src")&&""!==o.firstElementChild.getAttribute("src");if(a){let t=o.firstElementChild.getAttribute("src");handleText(e,t,n,i);return}}}for(let t of i)if("text"===t.type&&"url"===t.subtype){pasteUrl(e,t.data,n,i);return}for(let t of i)if("text"===t.type&&"text"===t.subtype&&t.data.trim()){handleText(e,t.data,n,i);return}}let handleNativeOrMenuCopy=async e=>{let t=await e.resolveAssetsInContent(e.getContentFromCurrentPage(e.getSelectedShapeIds()));if(!t){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}let{assets:n,...r}=t,i={type:"application/tldraw",kind:"content",version:3,data:{assets:n||[],otherCompressed:rp.compressToBase64(JSON.stringify(r))}},o=JSON.stringify(i);if("undefined"!=typeof navigator){let n=t.shapes.map(t=>{let n=e.getShapeUtil(t);return n.getText(t)}).filter(B.$K);if(navigator.clipboard?.write){let e=new Blob([`<div data-tldraw>${o}</div>`],{type:"text/html"}),t=n.join(" ");""===t&&(t=" "),navigator.clipboard.write([new ClipboardItem({"text/html":e,"text/plain":new Blob([t],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${o}</div>`)}};function useMenuClipboardEvents(){let e=(0,eW.Z2)(),t=useUiEvents(),n=(0,en.useCallback)(async function(n){(0,B.hu)(e,"editor is required for copy"),0!==e.getSelectedShapeIds().length&&(await handleNativeOrMenuCopy(e),t("copy",{source:n}))},[e,t]),r=(0,en.useCallback)(async function(n){e&&0!==e.getSelectedShapeIds().length&&(await handleNativeOrMenuCopy(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:n}))},[e,t]),i=(0,en.useCallback)(async function(n,r,o){e&&null===e.getEditingShapeId()&&(Array.isArray(n)&&n[0]instanceof ClipboardItem?(handlePasteFromClipboardApi({editor:e,clipboardItems:n,point:o}),t("paste",{source:"menu"})):navigator.clipboard.read().then(e=>{i(e,r,o)}))},[e,t]);return{copy:n,cut:r,paste:i}}function useNativeClipboardEvents(){let e=(0,eW.jE)(),t=useUiEvents(),n=(0,O.Hg)("editor.isFocused",()=>e.getInstanceState().isFocused,[e]);(0,en.useEffect)(()=>{if(!n)return;let copy=async n=>{0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||areShortcutsDisabled(e)||((0,e0.PF)(n),await handleNativeOrMenuCopy(e),t("copy",{source:"kbd"}))};async function cut(n){0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||areShortcutsDisabled(e)||((0,e0.PF)(n),await handleNativeOrMenuCopy(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:"kbd"}))}let r=!1,pointerUpHandler=t=>{1===t.button&&(r=!0,e.timers.requestAnimationFrame(()=>{r=!1}))},paste=n=>{let i;if(r){(0,e0.be)(n);return}if(null!==e.getEditingShapeId()||areShortcutsDisabled(e))return;let o=!1;e.inputs.shiftKey&&(o=!0),e.user.getIsPasteAtCursorMode()&&(o=!o),o&&(i=e.inputs.currentPagePoint);let pasteFromEvent=()=>{n.clipboardData&&handlePasteFromEventClipboardData(e,n.clipboardData,i)};if(navigator.clipboard?.read){let t=Array.from(n.clipboardData?.files||[]);navigator.clipboard.read().then(n=>{Array.isArray(n)&&n[0]instanceof ClipboardItem&&handlePasteFromClipboardApi({editor:e,clipboardItems:n,point:i,fallbackFiles:t})},()=>{pasteFromEvent()})}else pasteFromEvent();(0,e0.PF)(n),t("paste",{source:"kbd"})};return document.addEventListener("copy",copy),document.addEventListener("cut",cut),document.addEventListener("paste",paste),document.addEventListener("pointerup",pointerUpHandler),()=>{document.removeEventListener("copy",copy),document.removeEventListener("cut",cut),document.removeEventListener("paste",paste),document.removeEventListener("pointerup",pointerUpHandler)}},[e,t,n])}async function exportToBlob({editor:e,ids:t,format:n,opts:r={}}){let i=t?.length?t:[...e.getCurrentPageShapeIds()];switch(n){case"jpeg":case"png":case"webp":case"svg":return(await e.toImage(i,{...r,format:n})).blob;default:(0,B.iP)(n)}}let rx={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",svg:"text/plain"};function copyAs(...e){let[t,n,r]="string"==typeof e[2]?[e[0],e[1],{...e[3],format:e[2]}]:e;if(!navigator.clipboard)return Promise.reject(Error("Copy not supported"));if(navigator.clipboard.write){var i;let{blobPromise:e,mimeType:o}=function(e,t,n={}){let r=t?.length?t:[...e.getCurrentPageShapeIds()],i=n.format??"png";return{blobPromise:e.toImage(r,n).then(e=>B.P6.rewriteMimeType(e.blob,rx[i])),mimeType:rx[i]}}(t,n,r),a={[o]:e},l=(i=r.format,(0,B.eg)(rg,i)??null);return l&&"undefined"!=typeof ClipboardItem&&"supports"in ClipboardItem&&ClipboardItem.supports(l)&&(a[l]=e.then(e=>B.P6.rewriteMimeType(e,l))),function(e){let t=Object.entries(e);for(let[e,n]of t)n.catch(e=>console.error(e));return navigator.clipboard.write([new ClipboardItem(e)]).catch(e=>(console.error(e),Promise.all(t.map(async([e,t])=>[e,await t])).then(e=>{let t=(0,B.Ls)(e);return navigator.clipboard.write([new ClipboardItem(t)])})))}(a)}switch(r.format){case"svg":return fallbackWriteTextAsync(async()=>{let e=await t.getSvgString(n,r);if(!e)throw Error("Failed to copy");return e.svg});case"png":throw Error("Copy not supported");default:(0,B.iP)(r.format)}}async function fallbackWriteTextAsync(e){await navigator.clipboard?.writeText?.(await e())}function useCopyAs(){let e=(0,eW.Z2)(),{addToast:t}=useToasts(),n=useTranslation();return(0,en.useCallback)((r,i="svg")=>{(0,B.hu)(e,"useCopyAs: editor is required"),copyAs(e,r,{format:i}).catch(()=>{t({id:"copy-fail",severity:"warning",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[e,t,n])}async function exportAs(...e){let[t,n,r]="object"==typeof e[2]?e:[e[0],e[1],{...e[4],format:e[2]??"png",name:e[3]}],i=r.name;if(!i&&(i=`shapes at ${getTimestamp()}`,1===n.length)){let e=t.getShape(n[0]);i=t.isShapeOfType(e,"frame")?e.props.name||"frame":`${(0,e4.Vx)(e.id)} at ${getTimestamp()}`}i+=`.${r.format}`;let{blob:o}=await t.toImage(n,r),a=new File([o],i,{type:o.type});downloadFile(a)}function getTimestamp(){let e=new Date,t=String(e.getFullYear()).slice(2),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0");return`${t}-${n}-${r} ${i}.${o}.${a}`}function downloadFile(e){let t=document.createElement("a"),n=URL.createObjectURL(e);t.href=n,t.download=e.name,t.click(),URL.revokeObjectURL(n)}function useExportAs(){let e=(0,eW.Z2)(),{addToast:t}=useToasts(),n=useTranslation();return(0,en.useCallback)((r,i="png",o)=>{(0,B.hu)(e,"useExportAs: editor is required"),exportAs(e,r,{format:i,name:o,scale:1}).catch(e=>{console.error(e.message),t({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc"),severity:"error"})})},[e,t,n])}let rw=(0,en.createContext)([]);function useDefaultHelpers(){let e=(0,eW.Z2)(),{addToast:t,removeToast:n,clearToasts:r}=useToasts(),{addDialog:i,clearDialogs:o,removeDialog:a}=useDialogs(),l=useTranslation(),d=function(){let e=(0,eW.Z2)(),t=(0,en.useRef)(null),n=(0,en.useRef)(null);return(0,en.useCallback)(async function(){(0,B.hu)(e,"usePrint: editor is required");let r=document.createElement("div"),i=document.createElement("style"),clearElements=(e,t)=>{e&&(e.innerHTML=""),t&&document.head.contains(t)&&document.head.removeChild(t),e&&document.body.contains(e)&&document.body.removeChild(e)};clearElements(t.current,n.current),t.current=r,n.current=i;let o=`tl-print-surface-${(0,B.EL)()}`;r.className=o,i.innerHTML=`
			.${o} {
				display: none;
			}

			.${o} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${o} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${o}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${o}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${o}__item__header {
					display: none;
				}

				.${o}__item__footer {
					display: none;
					text-align: right;
				}

				.${o}__item__footer__hide {
					display: none;
				}

				
			}

		`;let beforePrintHandler=()=>{document.head.appendChild(i),document.body.appendChild(r)},afterPrintHandler=()=>{e.once("tick",()=>{clearElements(r,i)})};function addPageToPrint(e,t,n){try{r.innerHTML+=`<div class="${o}__item">
        <div class="${o}__item__header">
          ${e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${o}__item__main">
          ${n}
        </div>
        <div class="${o}__item__footer ${o}__item__footer__${t?"":"hide"}">
          ${t??""}
        </div>
      </div>`}catch(e){console.error(e)}}function triggerPrint(){eH.a.isChromeForIos?(beforePrintHandler(),window.print()):eH.a.isSafari?(beforePrintHandler(),document.execCommand("print",!1)):window.print()}window.addEventListener("beforeprint",beforePrintHandler),window.addEventListener("afterprint",afterPrintHandler);let a=e.getSelectedShapeIds(),l=e.getCurrentPageId(),d=e.getPages(),c={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(e.getSelectedShapeIds().length>0){let t=await e.getSvgString(a,c);if(t){let e=d.find(e=>e.id===l);addPageToPrint(`tldraw \u2014 ${e?.name}`,null,t.svg),triggerPrint()}}else{let t=e.getCurrentPage(),n=await e.getSvgString(e.getSortedChildIdsForParent(t.id),c);n&&(addPageToPrint(`tldraw \u2014 ${t.name}`,null,n.svg),triggerPrint())}window.removeEventListener("beforeprint",beforePrintHandler),window.removeEventListener("afterprint",afterPrintHandler)},[e])}(),{cut:c,copy:u,paste:h}=useMenuClipboardEvents(),p=useCopyAs(),f=useExportAs(),g=useGetEmbedDefinition(),m=useBreakpoint(),y=m<nf.TABLET_SM,b=(0,eX.T)((0,en.useContext)(rw)),S=(0,en.useCallback)(async()=>{if(!e)return;let t=await getLocalFiles({allowMultiple:!0,mimeTypes:b});t.length&&(e.markHistoryStoppingPoint("insert media"),e.putExternalContent({type:"files",files:t,point:e.getViewportPageBounds().center}))},[e,b]),v=(0,en.useCallback)(async t=>{if(!e)return;let n=await getLocalFiles({allowMultiple:!1,mimeTypes:b?.filter(e=>t?e.startsWith("image/"):e.startsWith("video/"))});if(!n.length)return;let r=e.getOnlySelectedShape();if(!r||t&&"image"!==r.type||!t&&"video"!==r.type)return;e.markHistoryStoppingPoint("replace media");let i=n[0];e.replaceExternalContent({type:"file-replace",file:i,shapeId:r.id,isImage:t})},[e,b]),k=(0,en.useCallback)(()=>v(!0),[v]),_=(0,en.useCallback)(()=>v(!1),[v]);return(0,en.useMemo)(()=>({addToast:t,removeToast:n,clearToasts:r,addDialog:i,removeDialog:a,clearDialogs:o,msg:l,isMobile:y,insertMedia:S,replaceImage:k,replaceVideo:_,printSelectionOrPages:d,cut:c,copy:u,paste:h,copyAs:p,exportAs:f,getEmbedDefinition:g}),[t,n,r,i,a,o,l,y,S,k,_,d,c,u,h,p,f,g])}function useShallowArrayEquality(e){return(0,en.useMemo)(()=>e,e)}function useMergedTranslationOverrides(e){let t=useShallowArrayEquality(null==e?[]:Array.isArray(e)?e:[e]);return(0,en.useMemo)(()=>{let e={};for(let n of t)if(n.translations)for(let[t,r]of(0,B.EP)(n.translations)){let n=e[t];n||(n=e[t]={}),Object.assign(n,r)}return e},[t])}let rS=en.createContext(null);function ToolsProvider({overrides:e,children:t}){let n=(0,eW.Z2)(),r=useUiEvents(),i=useA11y(),o=useTranslation(),a=useDefaultHelpers(),l=en.useCallback((e,t,n)=>{i.announce({msg:o(t.label)}),r("select-tool",{source:e,id:n??t.id})},[i,o,r]),d=en.useMemo(()=>{if(!n)return{};let t=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(e){if(n.isIn("select")){let e=n.root.getCurrent();e.exit({},e.id),e.enter({},e.id)}n.setCurrentTool("select"),l(e,this)}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(e){n.setCurrentTool("hand"),l(e,this)}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(e){n.setCurrentTool("eraser"),l(e,this)}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(e){n.setCurrentTool("draw"),l(e,this)}},...[...L.Zu.values].map(e=>({id:e,label:`tool.${e}`,meta:{geo:e},kbd:"rectangle"===e?"r":"ellipse"===e?"o":void 0,icon:"geo-"+e,onSelect(t){n.run(()=>{n.setStyleForNextShapes(L.Zu,e),n.setCurrentTool("geo"),l(t,this,`geo-${e}`)})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(e){n.setCurrentTool("arrow"),l(e,this)}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(e){n.setCurrentTool("line"),l(e,this)}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(e){n.setCurrentTool("frame"),l(e,this)}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(e){n.setCurrentTool("text"),l(e,this)}},{id:"asset",label:"tool.media",icon:"tool-media",kbd:"cmd+u,ctrl+u",onSelect(e){a.insertMedia(),l(e,this,"media")}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(e){n.setCurrentTool("note"),l(e,this)}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(e){n.setCurrentTool("laser"),l(e,this)}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(e){a.addDialog({component:nh}),l(e,this)}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"shift+d",onSelect(e){n.setCurrentTool("highlight"),l(e,this)}}];t.forEach(e=>e.onSelect=e.onSelect.bind(e));let r=Object.fromEntries(t.map(e=>[e.id,e]));return e?e(n,r,a):r},[e,n,a,l]);return(0,et.jsx)(rS.Provider,{value:d,children:t})}function useTools(){let e=en.useContext(rS);if(!e)throw Error("useTools must be used within a ToolProvider");return e}function TldrawUiMenuToolItem({toolId:e="",...t}){let n=useTools(),r=n[e];return r?(0,et.jsx)(TldrawUiMenuItem,{...r,...t}):null}function DefaultKeyboardShortcutsDialogContent(){let e=useShowCollaborationUi();return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.tools",id:"tools",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"toggle-tool-lock"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"insert-media"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"select"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"draw"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"eraser"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"hand"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"rectangle"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"ellipse"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"arrow"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"line"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"text"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"frame"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"note"}),(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"laser"}),(0,et.jsx)(TldrawUiMenuItem,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),(0,et.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.preferences",id:"preferences",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"toggle-dark-mode"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"toggle-focus-mode"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"toggle-grid"})]}),(0,et.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.edit",id:"edit",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"undo"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"redo"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"cut"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"copy"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"paste"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"select-all"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"delete"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"duplicate"})]}),(0,et.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.view",id:"view",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-in"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-out"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-to-100"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-to-fit"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-to-selection"})]}),(0,et.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.transform",id:"transform",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"bring-to-front"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"bring-forward"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"send-backward"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"send-to-back"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"group"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"ungroup"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"flip-horizontal"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"flip-vertical"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-top"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-center-vertical"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-bottom"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-left"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-center-horizontal"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-right"})]}),(0,et.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.text-formatting",id:"text",children:[(0,et.jsx)(TldrawUiMenuItem,{id:"text-bold",label:"tool.rich-text-bold",kbd:"cmd+b",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"text-italic",label:"tool.rich-text-italic",kbd:"cmd+i",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"text-code",label:"tool.rich-text-code",kbd:"cmd+e",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"text-highlight",label:"tool.rich-text-highlight",kbd:"cmd+shift+h",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"text-strikethrough",label:"tool.rich-text-strikethrough",kbd:"cmd+shift+s",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"text-link",label:"tool.rich-text-link",kbd:"cmd+shift+k",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"text-header",label:"tool.rich-text-header",kbd:"cmd+shift+[[1-6]]",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"text-orderedList",label:"tool.rich-text-orderedList",kbd:"cmd+shift+7",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"text-bulletedlist",label:"tool.rich-text-bulletList",kbd:"cmd+shift+8",onSelect:()=>{}})]}),(0,et.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.a11y",id:"a11y",children:[(0,et.jsx)(TldrawUiMenuItem,{id:"a11y-select-next-shape",label:"a11y.select-shape",kbd:"[[Tab]]",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"a11y-select-next-shape-direction",label:"a11y.select-shape-direction",kbd:"cmd+",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"a11y-select-next-shape-container",label:"a11y.enter-leave-container",kbd:"cmd+shift+",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"a11y-pan-camera",label:"a11y.pan-camera",kbd:"[[Space]]+",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+[[Enter]]",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"open-context-menu",label:"a11y.open-context-menu",kbd:"cmd+shift+[[Enter]]",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"a11y-move-shape",label:"a11y.move-shape",kbd:"",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuItem,{id:"a11y-move-shape-faster",label:"a11y.move-shape-faster",kbd:"shift+",onSelect:()=>{}}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"enlarge-shapes"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"shrink-shapes"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"a11y-repeat-shape-announce"}),(0,et.jsx)(TldrawUiMenuItem,{id:"a11y-open-keyboard-shortcuts",label:"a11y.open-keyboard-shortcuts",kbd:"cmd+alt+/",onSelect:()=>{}})]}),e&&(0,et.jsx)(TldrawUiMenuGroup,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"open-cursor-chat"})})]})}let rv=(0,en.memo)(function({children:e}){let t=useTranslation(),n=useBreakpoint(),r=e??(0,et.jsx)(DefaultKeyboardShortcutsDialogContent,{});return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)(TldrawUiDialogHeader,{className:"tlui-shortcuts-dialog__header",children:[(0,et.jsx)(TldrawUiDialogTitle,{children:t("shortcuts-dialog.title")}),(0,et.jsx)(TldrawUiDialogCloseButton,{})]}),(0,et.jsx)(TldrawUiDialogBody,{className:eh("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":n<=nf.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":n<=nf.TABLET}),children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"keyboard-shortcuts",sourceId:"kbd",children:r})}),(0,et.jsx)("div",{className:"tlui-dialog__scrim"})]})});async function flattenShapesToImages(e,t,n){let r=(0,B.oA)(t.map(t=>{let n=e.getShape(t);if(!n)return;let r=e.getShapeUtil(n.type);if(void 0!==r.toSvg)return n}));if(0===r.length)return;if(1===r.length){let t=r[0];if(!t||e.isShapeOfType(t,"image"))return}let i=[];if(void 0!==n){let t=r.map(t=>({shape:t,bounds:e.getShapeMaskedPageBounds(t).clone().expandBy(n)}));for(let e=0;e<t.length;e++){let n=t[e];if(0===e){i[0]={shapes:[n.shape],bounds:n.bounds};continue}let r=!1;for(let e of i)if(e.bounds.includes(n.bounds)){e.shapes.push(n.shape),e.bounds.expand(n.bounds),r=!0;break}r||i.push({shapes:[n.shape],bounds:n.bounds})}}else{let t=e9.xu.Common(r.map(t=>e.getShapeMaskedPageBounds(t)));i.push({shapes:r,bounds:t})}let o=e.options.flattenImageBoundsPadding;for(let t of i){void 0!==n&&t.bounds.expandBy(-n);let r=await e.getSvgString(t.shapes,{padding:o,background:!1});if(!r?.svg)continue;let i=await e.getAssetForExternalContent({type:"file",file:new File([r.svg],"asset.svg",{type:"image/svg+xml"})});i&&(t.asset=i)}let a=[];return(0,F.ay)(()=>{for(let t of i){let n,r,i;let{asset:l,bounds:d,shapes:c}=t;if(!l)continue;let u=e.findCommonAncestor(c)??e.getCurrentPageId();if(!u)continue;let h="a1";for(let e of c)if(e.parentId===u){e.index>h&&(h=e.index);break}if((0,L.YT)(u)){let t=e.getShape(u);if(!t)continue;let a=e.getPointInShapeSpace(t,{x:d.x,y:d.y});i=e.getShapePageTransform(u).rotation(),a.sub(new eF.B(o,o).rot(-i)),n=a.x,r=a.y}else n=d.x-o,r=d.y-o,i=0;e.deleteShapes(c),e.createAssets([{...l,id:l.id}]);let p=(0,L.F1)();e.createShape({id:p,type:"image",index:h,parentId:u,x:n,y:r,rotation:-i,props:{assetId:l.id,w:d.w+2*o,h:d.h+2*o}}),a.push(p)}}),a}let rT=en.createContext(null);function supportsDownloadingOriginal(e,t){return(t.isShapeOfType(e,"image")||t.isShapeOfType(e,"video"))&&!!e.props.assetId}function getExportName(e,t){let n=e.getSelectedShapes();if(0===n.length)return e.getDocumentSettings().name||t}function ActionsProvider({overrides:e,children:t}){let n=(0,eW.Z2)(),r=useShowCollaborationUi(),i=useDefaultHelpers(),o=useUiEvents(),a=useA11y(),l=useTranslation(),d=i.msg("document.default-name"),c=en.useMemo(()=>{if(!n)return{};function mustGoBackToSelectToolFirst(){return n.isIn("select")||(n.complete(),n.setCurrentTool("select")),!1}function canApplySelectionAction(){return n.isIn("select")&&n.getSelectedShapeIds().length>0}function scaleShapes(e){if(!canApplySelectionAction()||mustGoBackToSelectToolFirst())return;n.markHistoryStoppingPoint("resize shapes");let t=n.getSelectedShapeIds();0!==t.length&&n.run(()=>{let r=t.map(e=>n.getShape(e)).filter(Boolean);r.forEach(t=>{n.resizeShape(t.id,new eF.B(e,e),{scaleOrigin:n.getSelectionPageBounds()?.center})})})}let t=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("edit-link",{source:e}),n.markHistoryStoppingPoint("edit-link"),i.addDialog({component:no})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"cmd+i,ctrl+i",onSelect(e){o("insert-embed",{source:e}),i.addDialog({component:nh})}},{id:"open-kbd-shortcuts",label:"action.open-kbd-shortcuts",kbd:"cmd+alt+/,ctrl+alt+/",onSelect(e){o("open-kbd-shortcuts",{source:e}),i.addDialog({component:rv})}},{id:"insert-media",label:"action.insert-media",kbd:"cmd+u,ctrl+u",onSelect(e){o("insert-media",{source:e}),i.insertMedia()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"cmd+z,ctrl+z",onSelect(e){o("undo",{source:e}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"cmd+shift+z,ctrl+shift+z",onSelect(e){o("redo",{source:e}),n.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(o("export-as",{format:"svg",source:e}),i.exportAs(t,"svg",getExportName(n,d)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(o("export-as",{format:"png",source:e}),i.exportAs(t,"png",getExportName(n,d)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(o("export-all-as",{format:"svg",source:e}),i.exportAs(Array.from(n.getCurrentPageShapeIds()),"svg",getExportName(n,d)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(e){let t=Array.from(n.getCurrentPageShapeIds().values());0!==t.length&&(o("export-all-as",{format:"png",source:e}),i.exportAs(t,"png",getExportName(n,d)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"cmd+shift+c,ctrl+shift+c",readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(o("copy-as",{format:"svg",source:e}),i.copyAs(t,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(o("copy-as",{format:"png",source:e}),i.copyAs(t,"png"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("toggle-auto-size",{source:e}),n.markHistoryStoppingPoint("toggling auto size"),n.run(()=>{let e=n.getSelectedShapes().filter(e=>n.isShapeOfType(e,"text")&&!1===e.props.autoSize);n.updateShapes(e.map(e=>({id:e.id,type:e.type,props:{...e.props,w:8,autoSize:!0}}))),kickoutOccludedShapes(n,e.map(e=>e.id))})))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(e){o("open-embed-link",{source:e});let t=n.getSelectedShapeIds(),r="No embed shapes selected";if(1!==t.length){console.error(r);return}let i=n.getShape(t[0]);if(!i||!n.isShapeOfType(i,"embed")){console.error(r);return}openWindow(i.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(e){if(n.root.getCurrent()?.id!=="zoom"&&(o("zoom-tool",{source:e}),!(n.inputs.shiftKey||n.inputs.ctrlKey))){let e=n.root.getCurrent();e&&e.getCurrent()?.id==="idle"&&n.setCurrentTool("zoom",{onInteractionEnd:e.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||n.run(()=>{o("convert-to-bookmark",{source:e});let t=n.getSelectedShapes(),r=[],i=[];for(let e of t){if(!e||!n.isShapeOfType(e,"embed")||!e.props.url)continue;let t=new eF.B(e.x,e.y);t.rot(-e.rotation),t.add(new eF.B(e.props.w/2-150,e.props.h/2-160)),t.rot(e.rotation);let o={id:(0,L.F1)(),type:"bookmark",rotation:e.rotation,x:t.x,y:t.y,opacity:1,props:{url:e.props.url}};r.push(o),i.push(e.id)}n.markHistoryStoppingPoint("convert shapes to bookmark"),n.deleteShapes(i),n.createShapes(r)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("convert-to-embed",{source:e}),n.run(()=>{let e=n.getSelectedShapeIds(),t=(0,B.oA)(e.map(e=>n.getShape(e))),r=[],o=[];for(let e of t){if(!n.isShapeOfType(e,"bookmark"))continue;let{url:t}=e.props,a=i.getEmbedDefinition(t);if(!a||!a.definition)continue;let{width:l,height:d}=a.definition,c=new eF.B(e.x,e.y);c.rot(-e.rotation),c.add(new eF.B(e.props.w/2-l/2,e.props.h/2-d/2)),c.rot(e.rotation);let u={id:(0,L.F1)(),type:"embed",x:c.x,y:c.y,rotation:e.rotation,props:{url:t,w:l,h:d}};r.push(u),o.push(e.id)}n.markHistoryStoppingPoint("convert shapes to embed"),n.deleteShapes(o),n.createShapes(r)})))}},{id:"duplicate",kbd:"cmd+d,ctrl+d",label:"action.duplicate",icon:"duplicate",onSelect(e){let t,r;if(!canApplySelectionAction()||mustGoBackToSelectToolFirst())return;o("duplicate-shapes",{source:e});let i=n.getInstanceState();if(i.duplicateProps)t=i.duplicateProps.shapeIds,r=i.duplicateProps.offset;else{t=n.getSelectedShapeIds();let e=e9.xu.Common((0,B.oA)(t.map(e=>n.getShapePageBounds(e))));r=n.getCameraOptions().isLocked?{x:n.options.adjacentShapeMargin,y:n.options.adjacentShapeMargin}:{x:e.width+n.options.adjacentShapeMargin,y:0}}n.markHistoryStoppingPoint("duplicate shapes"),n.duplicateShapes(t,r),i.duplicateProps&&n.updateInstanceState({duplicateProps:{...i.duplicateProps,shapeIds:n.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"cmd+shift+g,ctrl+shift+g",icon:"ungroup",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("ungroup-shapes",{source:e}),n.markHistoryStoppingPoint("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"cmd+g,ctrl+g",icon:"group",onSelect(e){if(!canApplySelectionAction()||mustGoBackToSelectToolFirst())return;o("group-shapes",{source:e});let t=n.getOnlySelectedShape();t&&n.isShapeOfType(t,"group")?(n.markHistoryStoppingPoint("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())):(n.markHistoryStoppingPoint("group"),n.groupShapes(n.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"cmd+shift+f,ctrl+shift+f",onSelect(e){if(!canApplySelectionAction())return;o("remove-frame",{source:e});let t=n.getSelectedShapes();t.length>0&&t.every(e=>n.isShapeOfType(e,"frame"))&&(n.markHistoryStoppingPoint("remove-frame"),removeFrame(n,t.map(e=>e.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(e){if(!canApplySelectionAction())return;o("fit-frame-to-content",{source:e});let t=n.getOnlySelectedShape();t&&n.isShapeOfType(t,"frame")&&(n.markHistoryStoppingPoint("fit-frame-to-content"),fitFrameToContent(n,t.id))}},{id:"align-left",label:"action.align-left",kbd:"alt+A",icon:"align-left",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("align-shapes",{operation:"left",source:e}),n.markHistoryStoppingPoint("align left"),n.run(()=>{let e=n.getSelectedShapeIds();n.alignShapes(e,"left"),kickoutOccludedShapes(n,e)})))}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"alt+H",icon:"align-center-horizontal",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("align-shapes",{operation:"center-horizontal",source:e}),n.markHistoryStoppingPoint("align center horizontal"),n.run(()=>{let e=n.getSelectedShapeIds();n.alignShapes(e,"center-horizontal"),kickoutOccludedShapes(n,e)})))}},{id:"align-right",label:"action.align-right",kbd:"alt+D",icon:"align-right",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("align-shapes",{operation:"right",source:e}),n.markHistoryStoppingPoint("align right"),n.run(()=>{let e=n.getSelectedShapeIds();n.alignShapes(e,"right"),kickoutOccludedShapes(n,e)})))}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"alt+V",icon:"align-center-vertical",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("align-shapes",{operation:"center-vertical",source:e}),n.markHistoryStoppingPoint("align center vertical"),n.run(()=>{let e=n.getSelectedShapeIds();n.alignShapes(e,"center-vertical"),kickoutOccludedShapes(n,e)})))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"alt+W",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("align-shapes",{operation:"top",source:e}),n.markHistoryStoppingPoint("align top"),n.run(()=>{let e=n.getSelectedShapeIds();n.alignShapes(e,"top"),kickoutOccludedShapes(n,e)})))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"alt+S",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("align-shapes",{operation:"bottom",source:e}),n.markHistoryStoppingPoint("align bottom"),n.run(()=>{let e=n.getSelectedShapeIds();n.alignShapes(e,"bottom"),kickoutOccludedShapes(n,e)})))}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"alt+shift+h",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("distribute-shapes",{operation:"horizontal",source:e}),n.markHistoryStoppingPoint("distribute horizontal"),n.run(()=>{let e=n.getSelectedShapeIds();n.distributeShapes(e,"horizontal"),kickoutOccludedShapes(n,e)})))}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"alt+shift+V",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("distribute-shapes",{operation:"vertical",source:e}),n.markHistoryStoppingPoint("distribute vertical"),n.run(()=>{let e=n.getSelectedShapeIds();n.distributeShapes(e,"vertical"),kickoutOccludedShapes(n,e)})))}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("stretch-shapes",{operation:"horizontal",source:e}),n.markHistoryStoppingPoint("stretch horizontal"),n.run(()=>{let e=n.getSelectedShapeIds();n.stretchShapes(e,"horizontal"),kickoutOccludedShapes(n,e)})))}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("stretch-shapes",{operation:"vertical",source:e}),n.markHistoryStoppingPoint("stretch vertical"),n.run(()=>{let e=n.getSelectedShapeIds();n.stretchShapes(e,"vertical"),kickoutOccludedShapes(n,e)})))}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"shift+h",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("flip-shapes",{operation:"horizontal",source:e}),n.markHistoryStoppingPoint("flip horizontal"),n.run(()=>{let e=n.getSelectedShapeIds();n.flipShapes(e,"horizontal"),kickoutOccludedShapes(n,e)})))}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"shift+v",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("flip-shapes",{operation:"vertical",source:e}),n.markHistoryStoppingPoint("flip vertical"),n.run(()=>{let e=n.getSelectedShapeIds();n.flipShapes(e,"vertical"),kickoutOccludedShapes(n,e)})))}},{id:"pack",label:"action.pack",icon:"pack",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("pack-shapes",{source:e}),n.markHistoryStoppingPoint("pack"),n.run(()=>{let e=n.getSelectedShapeIds();n.packShapes(e,n.options.adjacentShapeMargin),kickoutOccludedShapes(n,e)})))}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("stack-shapes",{operation:"vertical",source:e}),n.markHistoryStoppingPoint("stack-vertical"),n.run(()=>{let e=n.getSelectedShapeIds();n.stackShapes(e,"vertical",n.options.adjacentShapeMargin),kickoutOccludedShapes(n,e)})))}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("stack-shapes",{operation:"horizontal",source:e}),n.markHistoryStoppingPoint("stack-horizontal"),n.run(()=>{let e=n.getSelectedShapeIds();n.stackShapes(e,"horizontal",n.options.adjacentShapeMargin),kickoutOccludedShapes(n,e)})))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("reorder-shapes",{operation:"toFront",source:e}),n.markHistoryStoppingPoint("bring to front"),n.bringToFront(n.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"alt+]",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("reorder-shapes",{operation:"forward",source:e}),n.markHistoryStoppingPoint("bring forward"),n.bringForward(n.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"alt+[",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("reorder-shapes",{operation:"backward",source:e}),n.markHistoryStoppingPoint("send backward"),n.sendBackward(n.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("reorder-shapes",{operation:"toBack",source:e}),n.markHistoryStoppingPoint("send to back"),n.sendToBack(n.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"cmd+x,ctrl+x",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(n.markHistoryStoppingPoint("cut"),i.cut(e)))}},{id:"copy",label:"action.copy",kbd:"cmd+c,ctrl+c",readonlyOk:!0,onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||i.copy(e))}},{id:"paste",label:"action.paste",kbd:"cmd+v,ctrl+v",onSelect(e){navigator.clipboard?.read().then(t=>{i.paste(t,e,"context-menu"===e?n.inputs.currentPagePoint:void 0)}).catch(()=>{i.addToast({title:i.msg("action.paste-error-title"),description:i.msg("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"cmd+a,ctrl+a",readonlyOk:!0,onSelect(e){n.run(()=>{mustGoBackToSelectToolFirst()||(o("select-all-shapes",{source:e}),n.markHistoryStoppingPoint("select all kbd"),n.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("select-none-shapes",{source:e}),n.markHistoryStoppingPoint("select none"),n.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del",icon:"trash",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("delete-shapes",{source:e}),n.markHistoryStoppingPoint("delete"),n.deleteShapes(n.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("rotate-cw",{source:e}),n.markHistoryStoppingPoint("rotate-cw"),n.run(()=>{let e=n.getSelectionRotation()%(ei.pj/2),t=(0,ei.C2)(e,0)||(0,ei.C2)(e,ei.pj/2),r=n.getSelectedShapeIds();n.rotateShapesBy(r,ei.pj/2-(t?0:e)),kickoutOccludedShapes(n,r)})))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("rotate-ccw",{source:e}),n.markHistoryStoppingPoint("rotate-ccw"),n.run(()=>{let e=n.getSelectionRotation()%(ei.pj/2),t=(0,ei.C2)(e,0),r=n.getSelectedShapeIds();n.rotateShapesBy(r,t?-(ei.pj/2):-e),kickoutOccludedShapes(n,r)})))}},{id:"zoom-in",label:"action.zoom-in",kbd:"cmd+=,ctrl+=,=",readonlyOk:!0,onSelect(e){o("zoom-in",{source:e,towardsCursor:!1}),n.zoomIn(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-in-on-cursor",label:"action.zoom-in",kbd:"shift+cmd+=,shift+ctrl+=,shift+=",readonlyOk:!0,onSelect(e){o("zoom-in",{source:e,towardsCursor:!0}),n.zoomIn(n.inputs.currentScreenPoint,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"cmd+-,ctrl+-,-",readonlyOk:!0,onSelect(e){o("zoom-out",{source:e,towardsCursor:!1}),n.zoomOut(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-out-on-cursor",label:"action.zoom-out",kbd:"shift+cmd+-,shift+ctrl+-,shift+-",readonlyOk:!0,onSelect(e){o("zoom-out",{source:e,towardsCursor:!0}),n.zoomOut(n.inputs.currentScreenPoint,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"shift+0",readonlyOk:!0,onSelect(e){o("reset-zoom",{source:e}),n.resetZoom(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"shift+1",readonlyOk:!0,onSelect(e){o("zoom-to-fit",{source:e}),n.zoomToFit({animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"shift+2",readonlyOk:!0,onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(o("zoom-to-selection",{source:e}),n.zoomToSelection({animation:{duration:n.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(e){o("toggle-snap-mode",{source:e}),n.user.updateUserPreferences({isSnapMode:!n.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"cmd+/,ctrl+/",readonlyOk:!0,onSelect(e){let t=n.user.getIsDarkMode()?"light":"dark";o("color-scheme",{source:e,value:t}),n.user.updateUserPreferences({colorScheme:t})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(e){o("toggle-wrap-mode",{source:e}),n.user.updateUserPreferences({isWrapMode:!n.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(e){o("toggle-dynamic-size-mode",{source:e}),n.user.updateUserPreferences({isDynamicSizeMode:!n.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(e){o("toggle-paste-at-cursor",{source:e}),n.user.updateUserPreferences({isPasteAtCursorMode:!n.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(e){o("toggle-reduce-motion",{source:e}),n.user.updateUserPreferences({animationSpeed:0===n.user.getAnimationSpeed()?1:0})},checkbox:!0},{id:"toggle-keyboard-shortcuts",label:{default:"action.toggle-keyboard-shortcuts",menu:"action.toggle-keyboard-shortcuts.menu"},readonlyOk:!0,onSelect(e){o("toggle-keyboard-shortcuts",{source:e}),n.user.updateUserPreferences({areKeyboardShortcutsEnabled:!n.user.getAreKeyboardShortcutsEnabled()})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(e){o("toggle-edge-scrolling",{source:e}),n.user.updateUserPreferences({edgeScrollSpeed:0===n.user.getEdgeScrollSpeed()?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(e){o("toggle-transparent",{source:e}),n.updateInstanceState({exportBackground:!n.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(e){o("toggle-tool-lock",{source:e}),n.updateInstanceState({isToolLocked:!n.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(e){o("unlock-all",{source:e});let t=[];for(let e of n.getCurrentPageShapes())e.isLocked&&t.push({id:e.id,type:e.type,isLocked:!1});t.length>0&&n.updateShapes(t)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"cmd+.,ctrl+.",checkbox:!0,onSelect(e){n.timers.requestAnimationFrame(()=>{n.run(()=>{o("toggle-focus-mode",{source:e}),i.clearDialogs(),i.clearToasts(),n.updateInstanceState({isFocusMode:!n.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"cmd+',ctrl+'",onSelect(e){o("toggle-grid-mode",{source:e}),n.updateInstanceState({isGridMode:!n.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(e){o("toggle-debug-mode",{source:e}),n.updateInstanceState({isDebugMode:!n.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"cmd+p,ctrl+p",readonlyOk:!0,onSelect(e){o("print",{source:e}),i.printSelectionOrPages()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(e){o("exit-pen-mode",{source:e}),n.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(e){o("stop-following",{source:e}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(e){o("zoom-to-content",{source:e});let t=n.getSelectionPageBounds()??n.getCurrentPageBounds();t&&n.zoomToBounds(t,{targetZoom:Math.min(1,n.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"shift+l",onSelect(e){n.markHistoryStoppingPoint("locking"),o("toggle-lock",{source:e}),n.toggleLock(n.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(e){let t=L.ez.createId(),r=n.getSelectedShapeIds();n.run(()=>{n.markHistoryStoppingPoint("move_shapes_to_page"),n.createPage({name:i.msg("page-menu.new-page-initial-name"),id:t}),n.moveShapesToPage(r,t)}),o("move-to-new-page",{source:e})}},{id:"select-white-color",label:"color-style.white",kbd:"alt+t",onSelect(e){let t=L.R_;n.run(()=>{n.markHistoryStoppingPoint("change-color"),n.isIn("select")&&n.setStyleForSelectedShapes(t,"white"),n.setStyleForNextShapes(t,"white")}),o("set-style",{source:e,id:t.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"alt+f",onSelect(e){let t=L.pp;n.run(()=>{n.markHistoryStoppingPoint("change-fill"),n.isIn("select")&&n.setStyleForSelectedShapes(t,"fill"),n.setStyleForNextShapes(t,"fill")}),o("set-style",{source:e,id:t.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"shift+f",onSelect:async e=>{let t=n.getSelectedShapeIds();if(0===t.length)return;n.markHistoryStoppingPoint("flattening to image"),o("flatten-to-image",{source:e});let r=await flattenShapesToImages(n,t,n.options.flattenImageBoundsExpand);r?.length&&n.setSelectedShapes(r)}},{id:"select-geo-tool",kbd:"g",onSelect:async e=>{o("select-tool",{source:e,id:"geo-previous"}),n.setCurrentTool("geo")}},{id:"change-page-prev",kbd:"alt+left,alt+up",readonlyOk:!0,onSelect:async e=>{let t=n.getPages(),r=t.findIndex(e=>e.id===n.getCurrentPageId());r<1||(o("change-page",{source:e,direction:"prev"}),n.setCurrentPage(t[r-1].id))}},{id:"change-page-next",kbd:"alt+right,alt+down",readonlyOk:!0,onSelect:async e=>{let t=n.getPages(),r=t.findIndex(e=>e.id===n.getCurrentPageId());if(-1===r||r>=t.length-1){if(n.getCurrentPageShapes().length<=0||n.getIsReadonly())return;o("new-page",{source:e}),n.run(()=>{n.markHistoryStoppingPoint("creating page");let e=L.ez.createId();n.createPage({name:i.msg("page-menu.new-page-initial-name"),id:e}),n.setCurrentPage(e)});return}n.setCurrentPage(t[r+1].id),o("change-page",{source:e,direction:"next"})}},{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+Enter,ctrl+Enter",isRequiredA11yAction:!0,onSelect:async e=>{if(!canApplySelectionAction())return;let t=n.getContainer().querySelector(".tlui-style-panel button");t?.focus(),o("adjust-shape-styles",{source:e})}},{id:"a11y-open-context-menu",kbd:"cmd+shift+Enter,ctrl+shift+Enter",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async e=>{if(!canApplySelectionAction())return;let t=n.getSelectionPageBounds();if(!t)return;let r=t.x+t.width/2,i=t.y+t.height/2,a=n.pageToScreen(new eF.B(r,i));n.getContainer().querySelector(".tl-canvas")?.dispatchEvent(new PointerEvent("contextmenu",{clientX:a.x,clientY:a.y,bubbles:!0})),o("open-context-menu",{source:e})}},{id:"enlarge-shapes",label:"a11y.enlarge-shape",kbd:"cmd+alt+shift+=,ctrl+alt+shift+=",onSelect:async e=>{scaleShapes(1.1),o("enlarge-shapes",{source:e})}},{id:"shrink-shapes",label:"a11y.shrink-shape",kbd:"cmd+alt+shift+-,ctrl+alt+shift+-",onSelect:async e=>{scaleShapes(1/1.1),o("shrink-shapes",{source:e})}},{id:"a11y-repeat-shape-announce",kbd:"alt+r",label:"a11y.repeat-shape",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async e=>{let t=n.getSelectedShapeIds();if(!t.length)return;let r=generateShapeAnnouncementMessage({editor:n,selectedShapeIds:t,msg:l});r&&(a.announce({msg:""}),n.timers.requestAnimationFrame(()=>{a.announce({msg:r})}),o("a11y-repeat-shape-announce",{source:e}))}},{id:"image-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async e=>{o("image-replace",{source:e}),i.replaceImage()}},{id:"video-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async e=>{o("video-replace",{source:e}),i.replaceVideo()}},{id:"download-original",label:"action.download-original",readonlyOk:!0,onSelect:async e=>{let t=n.getSelectedShapes();if(0===t.length)return;let r=t.filter(e=>supportsDownloadingOriginal(e,n));if(0!==r.length){for(let e of r){let t=n.getAsset(e.props.assetId);if(!t||!t.props.src)continue;let r=await n.resolveAssetUrl(t.id,{shouldResolveToOriginal:!0});if(!r)return;let i=document.createElement("a");i.href=r,"video"!==t.type&&"image"!==t.type||t.props.src.startsWith("asset:")?i.download="download":i.download=t.props.name,document.body.appendChild(i),i.click(),document.body.removeChild(i)}o("download-original",{source:e})}}}];r&&t.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(e){o("open-cursor-chat",{source:e}),n.getInstanceState().isCoarsePointer||n.timers.requestAnimationFrame(()=>{n.updateInstanceState({isChatting:!0})})}});let c=Object.fromEntries(t.map(e=>[e.id,e]));return e?e(n,c,i):c},[i,n,o,e,d,r,l,a]);return(0,et.jsx)(rT.Provider,{value:c,children:t})}function useActions(){let e=en.useContext(rT);if(!e)throw Error("useTools must be used within a ToolProvider");return e}function unwrapLabel(e,t){return e?"string"==typeof e?e:t?e[t]??e.default:void 0:void 0}function TldrawUiMenuCheckboxItem({id:e,kbd:t,label:n,readonlyOk:r,onSelect:i,toggle:o=!1,disabled:a=!1,checked:l=!1}){let{type:d,sourceId:c}=useTldrawUiMenuContext(),u=useReadonly(),h=useTranslation();if(u&&!r)return null;let p=unwrapLabel(n,d),f=p?h(p):void 0;switch(d){case"menu":return(0,et.jsxs)(tV.oC,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:f,onSelect:e=>{i?.(c),(0,e0.PF)(e)},disabled:a,checked:l,children:[(0,et.jsx)(nr,{small:!0,label:h(l?"ui.checked":"ui.unchecked"),icon:o?l?"toggle-on":"toggle-off":l?"check":"none"}),f&&(0,et.jsx)("span",{className:"tlui-button__label",draggable:!1,children:f}),t&&(0,et.jsx)(TldrawUiKbd,{children:t})]});case"context-menu":return(0,et.jsxs)(t8,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:f,onSelect:e=>{i(c),(0,e0.PF)(e)},disabled:a,checked:l,children:[(0,et.jsx)(nr,{small:!0,label:h(l?"ui.checked":"ui.unchecked"),icon:o?l?"toggle-on":"toggle-off":l?"check":"none"}),f&&(0,et.jsx)("span",{className:"tlui-button__label",draggable:!1,children:f}),t&&(0,et.jsx)(TldrawUiKbd,{children:t})]},e);default:return null}}function TldrawUiMenuSubmenu({id:e,disabled:t=!1,label:n,size:r="small",children:i}){let{type:o,sourceId:a}=useTldrawUiMenuContext(),l=(0,eG.uK)(),d=useTranslation(),c=n?"string"==typeof n?n:n[o]??n.default:void 0,u=c?d(c):void 0;switch(o){case"menu":return(0,et.jsxs)(TldrawUiDropdownMenuSub,{id:`${a}-sub.${e}`,children:[(0,et.jsx)(TldrawUiDropdownMenuSubTrigger,{id:`${a}-sub.${e}-button`,disabled:t,label:u,title:u}),(0,et.jsx)(TldrawUiDropdownMenuSubContent,{id:`${a}-sub.${e}-content`,size:r,children:i})]});case"context-menu":if(t)return null;return(0,et.jsxs)(ContextMenuSubWithMenu,{id:`${a}-sub.${e}`,children:[(0,et.jsx)(ne,{dir:"ltr",disabled:t,asChild:!0,children:(0,et.jsxs)(tz,{"data-testid":`${a}-sub.${e}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[(0,et.jsx)(TldrawUiButtonLabel,{children:u}),(0,et.jsx)(TldrawUiButtonIcon,{icon:"chevron-right",small:!0})]})}),(0,et.jsx)(ContextMenuPortal,{container:l,children:(0,et.jsx)(nt,{"data-testid":`${a}-sub.${e}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:i})})]});default:return i}}function ContextMenuSubWithMenu({id:e,children:t}){let[n,r]=useMenuIsOpen(e);return(0,et.jsx)(ContextMenuSub,{open:n,onOpenChange:r,children:t})}let rk=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function ColorSchemeMenu(){let e=(0,eW.jE)(),t=useUiEvents(),n=(0,O.Hg)("colorScheme",()=>e.user.getUserPreferences().colorScheme??(e.user.getIsDarkMode()?"dark":"light"),[e]);return(0,et.jsx)(TldrawUiMenuSubmenu,{id:"help menu color-scheme",label:"menu.theme",children:(0,et.jsx)(TldrawUiMenuGroup,{id:"theme",children:rk.map(({colorScheme:r,label:i})=>(0,et.jsx)(TldrawUiMenuCheckboxItem,{id:`color-scheme-${r}`,label:i,checked:r===n,readonlyOk:!0,onSelect:()=>{e.user.updateUserPreferences({colorScheme:r}),t("color-scheme",{source:"menu",value:r})}},r))})})}let TldrawUiDialog=({id:e,component:t,onClose:n,preventBackgroundClose:r})=>{let{removeDialog:i}=useDialogs(),o=(0,en.useRef)(!1),a=(0,eG.uK)(),l=(0,en.useCallback)(t=>{if(!t){if(n)try{n()}catch(e){console.warn(e)}i(e)}},[e,n,i]);return(0,et.jsx)(nn.Root,{onOpenChange:l,defaultOpen:!0,children:(0,et.jsx)(nn.Portal,{container:a,children:(0,et.jsx)(nn.Overlay,{dir:"ltr",className:"tlui-dialog__overlay",onClick:e=>{o.current||r||e.target!==e.currentTarget||l(!1)},children:(0,et.jsx)(nn.Content,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,onMouseDown:()=>o.current=!0,onMouseUp:()=>o.current=!1,onInteractOutside:e=>{o.current=!1,r&&e.preventDefault()},children:(0,et.jsx)(t,{onClose:()=>{o.current=!1,l(!1)}})})})})})},r_=(0,en.memo)(function(){let{dialogs:e}=useDialogs(),t=(0,O.Hg)("dialogs",()=>e.get(),[e]);return t.map(e=>(0,et.jsx)(TldrawUiDialog,{...e},e.id))});function TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem({actionId:e="",...t}){let n=useActions(),r=n[e];return r?(0,et.jsx)(TldrawUiMenuCheckboxItem,{...r,...t}):null}let rC={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function TldrawUiToast({toast:e}){let{removeToast:t}=useToasts(),n=useTranslation(),r=e.actions&&e.actions.length>0,i=e.icon||e.severity&&rC[e.severity],o=e.iconLabel||(e.severity?n(`toast.${e.severity}`):"");return(0,et.jsxs)(rt,{onOpenChange:n=>{n||t(e.id)},className:"tlui-toast__container",duration:e.keepOpen?1/0:4e3,"data-severity":e.severity,children:[i&&(0,et.jsx)("div",{className:"tlui-toast__icon",children:(0,et.jsx)(nr,{label:o,icon:i})}),(0,et.jsxs)("div",{className:"tlui-toast__main","data-title":!!e.title,"data-description":!!e.description,"data-actions":!!e.actions,children:[(0,et.jsxs)("div",{className:"tlui-toast__content",children:[e.title&&(0,et.jsx)(ro,{className:"tlui-toast__title",children:e.title}),e.description&&(0,et.jsx)(ra,{className:"tlui-toast__description",children:e.description})]}),e.actions&&(0,et.jsxs)("div",{className:"tlui-toast__actions",children:[e.actions.map((e,t)=>(0,et.jsx)(rl,{altText:e.label,asChild:!0,onClick:e.onClick,children:(0,et.jsx)(tz,{type:e.type,children:(0,et.jsx)(TldrawUiButtonLabel,{children:e.label})})},t)),(0,et.jsx)(rc,{asChild:!0,children:(0,et.jsx)(tz,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:(0,et.jsx)(TldrawUiButtonLabel,{children:e.closeLabel??n("toast.close")})})})]})]}),!r&&(0,et.jsx)(rc,{asChild:!0,children:(0,et.jsx)(tz,{type:"normal",className:"tlui-toast__close",children:(0,et.jsx)(TldrawUiButtonLabel,{children:e.closeLabel??n("toast.close")})})})]})}let rI=(0,en.memo)(function(){let{toasts:e}=useToasts(),t=(0,O.Hg)("toasts",()=>e.get(),[]);return(0,et.jsxs)(et.Fragment,{children:[t.map(e=>(0,et.jsx)(TldrawUiToast,{toast:e},e.id)),(0,et.jsx)(n7,{className:"tlui-toast__viewport"})]})});function getStraightArrowInfo(e,t,n){let{arrowheadStart:r,arrowheadEnd:i}=t.props,o=getArrowTerminalsInArrowSpace(e,t,n),a=o.start.clone(),l=o.end.clone(),d=eF.B.Med(a,l);if(eF.B.Equals(a,l))return{bindings:n,type:"straight",start:{handle:a,point:a,arrowhead:t.props.arrowheadStart},end:{handle:l,point:l,arrowhead:t.props.arrowheadEnd},middle:d,isValid:!1,length:0};let c=eF.B.Sub(l,a).uni(),u=getBoundShapeInfoForTerminal(e,t,"start"),h=getBoundShapeInfoForTerminal(e,t,"end"),p=e.getShapePageTransform(t);updateArrowheadPointWithBoundShape(l,o.start,p,h),updateArrowheadPointWithBoundShape(a,o.end,p,u);let f=0,g=0,m=0,y=0,b=rL*t.props.scale,S=u&&h&&u.shape===h.shape,v=u&&h?getBoundShapeRelationships(e,u.shape.id,h.shape.id):"safe";"safe"===v&&u&&h&&!S&&!u.isExact&&!h.isExact&&(h.didIntersect&&!u.didIntersect?u.isClosed&&a.setTo(l.clone().add(c.clone().mul(rL*t.props.scale))):!h.didIntersect&&h.isClosed&&l.setTo(a.clone().sub(c.clone().mul(rL*t.props.scale))));let k=eF.B.Sub(l,a),_=eF.B.Len(k)?k.uni():eF.B.From(k),C=!eF.B.Equals(_,c);S||("start-contains-end"!==v&&u&&"none"!==r&&!u.isExact&&(f=(rU+(m=rz[t.props.size]/2+("size"in u.shape.props?rz[u.shape.props.size]/2:0)))*t.props.scale,b+=m*t.props.scale),"end-contains-start"===v||!h||"none"===i||h.isExact||(g=(rU+(y=rz[t.props.size]/2+("size"in h.shape.props?rz[h.shape.props.size]/2:0)))*t.props.scale,b+=y*t.props.scale));let E=a.clone().add(_.clone().mul(f*(C?-1:1))),M=l.clone().sub(_.clone().mul(g*(C?-1:1)));eF.B.DistMin(E,M,b)&&(0!==f&&0!==g?(f*=-1.5,g*=-1.5):0!==f?f*=-1:0!==g&&(g*=-1)),a.add(_.clone().mul(f*(C?-1:1))),l.sub(_.clone().mul(g*(C?-1:1))),C?(u&&h&&l.setTo(eF.B.Add(a,_.clone().mul(-rL*t.props.scale))),d.setTo(eF.B.Med(o.start,o.end))):d.setTo(eF.B.Med(a,l));let P=eF.B.Dist(a,l);return{bindings:n,type:"straight",start:{handle:o.start,point:a,arrowhead:t.props.arrowheadStart},end:{handle:o.end,point:l,arrowhead:t.props.arrowheadEnd},middle:d,isValid:P>0,length:P}}function updateArrowheadPointWithBoundShape(e,t,n,r){let i;if(void 0===r||r.isExact)return;let o=tu._.applyToPoint(n,t),a=tu._.applyToPoint(n,e),l=tu._.applyToPoint(tu._.Inverse(r.transform),o),d=tu._.applyToPoint(tu._.Inverse(r.transform),a),c=Array.from(r.geometry.intersectLineSegment(l,d,{includeLabels:!1,includeInternal:!1}));if(c.length&&(i=c.sort((e,t)=>eF.B.Dist2(e,l)-eF.B.Dist2(t,l))[0]??(r.isClosed?void 0:d)),void 0===i&&(i=r.geometry.nearestPoint(d),!eF.B.DistMin(i,d,1)))return;let u=tu._.applyToPoint(r.transform,i),h=tu._.applyToPoint(tu._.Inverse(n),u);e.setTo(h),r.didIntersect=!0}function getArcInfo(e,t,n){let r=(0,ei.fn)(e,t,n)??eF.B.Med(e,t),i=eF.B.Dist(r,e),o=+eF.B.Clockwise(e,n,t),a=((e.y-t.y)**2+(e.x-t.x)**2)**.5,l=((t.y-n.y)**2+(t.x-n.x)**2)**.5,d=((n.y-e.y)**2+(n.x-e.x)**2)**.5,c=2*Math.acos((l*l+d*d-a*a)/(2*l*d)),u=+(ei.PI>c),h=(ei.yo-c)*(o?1:-1);return{center:r,radius:i,size:h,length:h*i,largeArcFlag:u,sweepFlag:o}}let rE=["right","bottom","left","top"],rM={top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},rP={left:"x",right:"x",top:"y",bottom:"y"},rA={top:"bottom",right:"left",bottom:"top",left:"right"},rj={x:{v:(e,t)=>new eF.B(e,t),loEdge:"left",hiEdge:"right",crossMid:"midY",gap:"gapX",midRange:"midXRange",self:"x",cross:"y",size:"width"},y:{v:(e,t)=>new eF.B(t,e),loEdge:"top",hiEdge:"bottom",crossMid:"midX",gap:"gapY",midRange:"midYRange",self:"y",cross:"x",size:"height"}};function createRange(e,t){return{min:Math.min(e,t),max:Math.max(e,t)}}function isWithinRange(e,t){return e>=t.min&&e<=t.max}function flipEdgeCrossInPlace(e){if(!e)return;let t=e.cross.min;e.cross.min=-e.cross.max,e.cross.max=-t,e.crossTarget=-e.crossTarget}function flipEdgeValueInPlace(e){e&&(e.value=-e.value,e.expanded=null===e.expanded?null:-e.expanded)}let rD={Identity:{x:1,y:1,transpose:!1},Rotate90:{x:-1,y:1,transpose:!0},Rotate180:{x:-1,y:-1,transpose:!1},Rotate270:{x:1,y:-1,transpose:!0},FlipY:{x:1,y:-1,transpose:!1}};function swap(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function transformVecInPlace(e,t){t.x=e.x*t.x,t.y=e.y*t.y,e.transpose&&swap(t,"x","y")}function transformBoxInPlace(e,t){-1===e.x&&(t.x=-(t.x+t.width)),-1===e.y&&(t.y=-(t.y+t.height)),e.transpose&&(swap(t,"x","y"),swap(t,"width","height"))}function transformEdgesInPlace(e,t){-1===e.x&&(swap(t,"left","right"),flipEdgeCrossInPlace(t.top),flipEdgeCrossInPlace(t.bottom),flipEdgeValueInPlace(t.left),flipEdgeValueInPlace(t.right)),-1===e.y&&(swap(t,"top","bottom"),flipEdgeCrossInPlace(t.left),flipEdgeCrossInPlace(t.right),flipEdgeValueInPlace(t.top),flipEdgeValueInPlace(t.bottom)),e.transpose&&(swap(t,"left","top"),swap(t,"right","bottom"))}let ElbowArrowWorkingInfo=class ElbowArrowWorkingInfo{options;A;B;common;gapX;gapY;midX;midY;bias;constructor(e){this.options=e.options,this.A=e.A,this.B=e.B,this.common=e.common,this.midX=e.midX,this.midY=e.midY,this.gapX=e.gapX,this.gapY=e.gapY,this.bias=new eF.B(1,1)}transform=rD.Identity;inverse=rD.Identity;apply(e){var t;if(this.transform=function(e,t){let n={...e};return t.transpose&&(swap(n,"x","y"),n.transpose=!n.transpose),-1===t.x&&(n.x=-n.x),-1===t.y&&(n.y=-n.y),n}(e,this.transform),this.inverse=(t=this.transform).transpose?{x:t.y,y:t.x,transpose:!0}:t,transformBoxInPlace(e,this.A.original),transformBoxInPlace(e,this.B.original),transformBoxInPlace(e,this.common.original),transformBoxInPlace(e,this.A.expanded),transformBoxInPlace(e,this.B.expanded),transformBoxInPlace(e,this.common.expanded),transformEdgesInPlace(e,this.A.edges),transformEdgesInPlace(e,this.B.edges),transformVecInPlace(e,this.bias),-1===e.x&&(this.gapX=-this.gapX,this.midX=null===this.midX?null:-this.midX),-1===e.y&&(this.gapY=-this.gapY,this.midY=null===this.midY?null:-this.midY),e.transpose){let e=this.midX;this.midX=this.midY,this.midY=e,e=this.gapX,this.gapX=this.gapY,this.gapY=e}}reset(){this.apply(this.inverse)}vec(e,t){let n=new eF.B(e,t);return transformVecInPlace(this.inverse,n),n}};let ElbowArrowRouteBuilder=class ElbowArrowRouteBuilder{constructor(e,t){this.info=e,this.name=t}points=[];add(e,t){return this.points.push(this.info.vec(e,t)),this}_midpointHandle=null;midpointHandle(e){(0,B.hu)(null===this._midpointHandle,"midX/midY called multiple times");let t=eF.B.Lrp(this.points[this.points.length-2],this.points[this.points.length-1],.5);return this._midpointHandle={axis:this.info.transform.transpose?"x"===e?"y":"x":e,point:t,segmentStart:this.points[this.points.length-2].clone(),segmentEnd:this.points[this.points.length-1].clone()},this}build(){let e=[];for(let t=0;t<this.points.length;t++){let n=this.points[t],r=e[e.length-1],i=e[e.length-2];if(r&&i){let t=Math.abs(n.x-r.x),o=Math.abs(n.y-r.y),a=Math.abs(n.x-i.x),l=Math.abs(n.y-i.y);t<.01&&o<.01||(t<.01&&a<.01?r.y=n.y:o<.01&&l<.01?r.x=n.x:e.push(n))}else e.push(n)}return{name:this.name,points:e,distance:function(e){let t=0;for(let n=0;n<e.length-1;n++){let r=e[n],i=e[n+1];t+=Math.abs(i.x-r.x)+Math.abs(i.y-r.y)}return t}(e),aEdgePicking:"manual",bEdgePicking:"manual",skipPointsWhenDrawing:new Set,midpointHandle:this._midpointHandle}}};function routeRightToLeft(e){let t=e.A.edges.right,n=e.B.edges.left;if(!t||!n)return null;if(t.crossTarget>n.crossTarget&&e.apply(rD.FlipY),e.gapX>0&&null!==e.midX)return new ElbowArrowRouteBuilder(e,"to left 1").add(t.value,t.crossTarget).add(e.midX,t.crossTarget).add(e.midX,n.crossTarget).midpointHandle("x").add(n.value,n.crossTarget).build();if(null===t.expanded||null===n.expanded)return null;if(null!==e.midY)return new ElbowArrowRouteBuilder(e,"to left 2").add(t.value,t.crossTarget).add(t.expanded,t.crossTarget).add(t.expanded,e.midY).add(n.expanded,e.midY).midpointHandle("y").add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build();let r=Math.abs(t.value-e.common.expanded.right)+Math.abs(t.crossTarget-e.common.expanded.bottom)+Math.abs(e.common.expanded.right-n.expanded)+Math.abs(e.common.expanded.bottom-n.crossTarget)+e.options.expandElbowLegLength+6,i=e.options.expandElbowLegLength+Math.abs(t.crossTarget-e.common.expanded.top)+Math.abs(t.expanded-e.common.expanded.left)+Math.abs(e.common.expanded.top-n.crossTarget)+Math.abs(e.common.expanded.left-n.value)+6+e.bias.y,o=e.gapX<0&&null!==e.midX?e.options.expandElbowLegLength+Math.abs(t.crossTarget-e.A.expanded.bottom)+e.common.expanded.width+Math.abs(e.A.expanded.bottom-e.B.expanded.top)+Math.abs(e.B.expanded.top-n.crossTarget)+e.options.expandElbowLegLength+8:1/0;return r<i&&r<o?new ElbowArrowRouteBuilder(e,"to left 3").add(t.value,t.crossTarget).add(e.common.expanded.right,t.crossTarget).add(e.common.expanded.right,e.common.expanded.bottom).add(n.expanded,e.common.expanded.bottom).add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build():i<o?new ElbowArrowRouteBuilder(e,"to left 4").add(t.value,t.crossTarget).add(t.expanded,t.crossTarget).add(t.expanded,e.common.expanded.top).add(e.common.expanded.left,e.common.expanded.top).add(e.common.expanded.left,n.crossTarget).add(n.value,n.crossTarget).build():null!==e.midX?new ElbowArrowRouteBuilder(e,"to left 5").add(t.value,t.crossTarget).add(t.expanded,t.crossTarget).add(t.expanded,e.A.expanded.bottom).add(e.midX,e.A.expanded.bottom).add(e.midX,e.B.expanded.top).midpointHandle("y").add(n.expanded,e.B.expanded.top).add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build():null}function routeRightToTop(e){let t=e.A.edges.right,n=e.B.edges.top;if(!t||!n)return null;if(t.crossTarget<(n.expanded??n.value)&&n.crossTarget>(t.expanded??t.value)||e.A.isPoint&&e.B.expanded.containsPoint(e.A.original.center))return new ElbowArrowRouteBuilder(e,"to top 1").add(t.value,t.crossTarget).add(n.crossTarget,t.crossTarget).add(n.crossTarget,n.value).build();if(e.gapX>0&&null!==e.midX&&null!==n.expanded)return new ElbowArrowRouteBuilder(e,"to top 2").add(t.value,t.crossTarget).add(e.midX,t.crossTarget).add(e.midX,n.expanded).midpointHandle("x").add(n.crossTarget,n.expanded).add(n.crossTarget,n.value).build();if(e.gapY>0&&null!==t.expanded&&n.crossTarget<t.expanded&&null!==e.midY)return new ElbowArrowRouteBuilder(e,"to top 3").add(t.value,t.crossTarget).add(t.expanded,t.crossTarget).add(t.expanded,e.midY).add(n.crossTarget,e.midY).midpointHandle("y").add(n.crossTarget,n.value).build();let r=Math.abs(t.value-e.common.expanded.right)+Math.abs(t.crossTarget-e.common.expanded.top)+Math.abs(n.crossTarget-e.common.expanded.right)+Math.abs(n.value-e.common.expanded.top),i=null!==t.expanded&&null!==e.midY&&null!==n.expanded?Math.abs(t.value-t.expanded)+Math.abs(e.B.expanded.left-t.expanded)+Math.abs(e.B.expanded.left-n.crossTarget)+Math.abs(t.crossTarget-e.B.expanded.top)+Math.abs(n.value-n.expanded):1/0,o=null!==t.expanded&&null!==e.midX&&null!==n.expanded?Math.abs(t.value-e.common.expanded.right)+Math.abs(t.crossTarget-e.A.expanded.bottom)+Math.abs(t.expanded-n.crossTarget)+Math.abs(e.A.expanded.bottom-n.expanded)+Math.abs(n.expanded-n.value):1/0;return r<i&&r<o?new ElbowArrowRouteBuilder(e,"to top 4").add(t.value,t.crossTarget).add(e.common.expanded.right,t.crossTarget).add(e.common.expanded.right,e.common.expanded.top).add(n.crossTarget,e.common.expanded.top).add(n.crossTarget,n.value).build():null!==n.expanded&&null!==t.expanded&&null!==e.midY&&i<o?new ElbowArrowRouteBuilder(e,"to top 5").add(t.value,t.crossTarget).add(t.expanded,t.crossTarget).add(t.expanded,e.midY).add(e.B.expanded.left,e.midY).midpointHandle("y").add(e.B.expanded.left,n.expanded).add(n.crossTarget,n.expanded).add(n.crossTarget,n.value).build():null!==n.expanded&&null!==t.expanded&&null!==e.midX?new ElbowArrowRouteBuilder(e,"to top 6").add(t.value,t.crossTarget).add(t.expanded,t.crossTarget).add(t.expanded,e.A.expanded.bottom).add(e.midX,e.A.expanded.bottom).add(e.midX,n.expanded).midpointHandle("x").add(n.crossTarget,n.expanded).add(n.crossTarget,n.value).build():null}function routeRightToBottom(e){return e.apply(rD.FlipY),routeRightToTop(e)}function routeRightToRight(e){let t=e.A.edges.right,n=e.B.edges.right;if(!t||!n)return null;if((e.gapX<=0||t.crossTarget>e.B.expanded.bottom||t.crossTarget<e.B.expanded.top)&&(n.value>e.A.original.left||n.crossTarget>e.A.expanded.bottom||n.crossTarget<e.A.expanded.top))return new ElbowArrowRouteBuilder(e,"to right 1").add(t.value,t.crossTarget).add(e.common.expanded.right,t.crossTarget).add(e.common.expanded.right,n.crossTarget).add(n.value,n.crossTarget).build();if(null===e.midX)return null;if(null!==n.expanded&&e.gapX>=0){let r=Math.abs(n.crossTarget-e.B.expanded.bottom)+Math.abs(t.crossTarget-e.B.expanded.bottom),i=Math.abs(n.crossTarget-e.B.expanded.top)+Math.abs(t.crossTarget-e.B.expanded.top),o=r<i?"bottom":"top";return new ElbowArrowRouteBuilder(e,`to right 2 via ${o}`).add(t.value,t.crossTarget).add(e.midX,t.crossTarget).add(e.midX,e.B.expanded[o]).midpointHandle("x").add(n.expanded,e.B.expanded[o]).add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build()}if(null!==t.expanded&&e.gapX<=0){let r=Math.abs(n.crossTarget-e.A.expanded.bottom)+Math.abs(t.crossTarget-e.A.expanded.bottom),i=Math.abs(n.crossTarget-e.A.expanded.top)+Math.abs(t.crossTarget-e.A.expanded.top),o=r<i?"bottom":"top";return new ElbowArrowRouteBuilder(e,`to right 3 via ${o}`).add(t.value,t.crossTarget).add(t.expanded,t.crossTarget).add(t.expanded,e.A.expanded[o]).add(e.midX,e.A.expanded[o]).add(e.midX,n.crossTarget).midpointHandle("x").add(n.value,n.crossTarget).build()}return null}let rB={top:{top:[rD.Rotate270,routeRightToRight],left:[rD.Rotate270,routeRightToTop],bottom:[rD.Rotate270,routeRightToLeft],right:[rD.Rotate270,routeRightToBottom]},right:{top:[rD.Identity,routeRightToTop],right:[rD.Identity,routeRightToRight],bottom:[rD.Identity,routeRightToBottom],left:[rD.Identity,routeRightToLeft]},bottom:{top:[rD.Rotate90,routeRightToLeft],left:[rD.Rotate90,routeRightToBottom],bottom:[rD.Rotate90,routeRightToRight],right:[rD.Rotate90,routeRightToTop]},left:{top:[rD.Rotate180,routeRightToBottom],left:[rD.Rotate180,routeRightToRight],bottom:[rD.Rotate180,routeRightToTop],right:[rD.Rotate180,routeRightToLeft]}};function tryRouteArrow(e,t,n){let[r,i]=rB[t][n];e.apply(r);let o=i(e);return e.reset(),o}function pickBest(e,t){let n=null,r=1/0,i=1/0,o=0;for(let[a,l,d,c]of t){o+=1;let t=tryRouteArrow(e,a,l);t&&(t.aEdgePicking=d,t.bEdgePicking=c,t.points.length<r?(r=t.points.length,i=t.distance,n=t):t.points.length===r&&t.distance+o<i&&(i=t.distance,n=t))}return n}function getElbowArrowInfo(e,t,n){let r;let i=e.getShapeUtil(t.type).options,o={elbowMidpoint:t.props.elbowMidPoint,expandElbowLegLength:i.expandElbowLegLength[t.props.size]*t.props.scale,minElbowLegLength:i.minElbowLegLength[t.props.size]*t.props.scale},a=getElbowArrowTerminalInfo(e,t,n.start,t.props.start),l=getElbowArrowTerminalInfo(e,t,n.end,t.props.end);a=adjustTerminalForUnclosedPathIfNeeded(a,l,o),l=adjustTerminalForUnclosedPathIfNeeded(l,a,o);let d=!!(!a.side&&l.side),{aTerminal:c,bTerminal:u}=d?{aTerminal:l,bTerminal:a}:{aTerminal:a,bTerminal:l},h={top:getUsableEdge(c,u,"top",o),right:getUsableEdge(c,u,"right",o),bottom:getUsableEdge(c,u,"bottom",o),left:getUsableEdge(c,u,"left",o)},p={top:getUsableEdge(u,c,"top",o),right:getUsableEdge(u,c,"right",o),bottom:getUsableEdge(u,c,"bottom",o),left:getUsableEdge(u,c,"left",o)},f=hasUsableEdge(h,c.side),g=hasUsableEdge(p,u.side),m=!1;f&&g||(m=!0,f||(u=convertTerminalToPoint(u)),g||(c=convertTerminalToPoint(c)),u.bounds.containsPoint(c.target,o.expandElbowLegLength)&&(u=convertTerminalToPoint(u)),c.bounds.containsPoint(u.target,o.expandElbowLegLength)&&(c=convertTerminalToPoint(c))),m&&(h={top:getUsableEdge(c,u,"top",o),right:getUsableEdge(c,u,"right",o),bottom:getUsableEdge(c,u,"bottom",o),left:getUsableEdge(c,u,"left",o)},p={top:getUsableEdge(u,c,"top",o),right:getUsableEdge(u,c,"right",o),bottom:getUsableEdge(u,c,"bottom",o),left:getUsableEdge(u,c,"left",o)});let y=c.isPoint?c.bounds:c.bounds.clone().expandBy(o.expandElbowLegLength),b=u.isPoint?u.bounds:u.bounds.clone().expandBy(o.expandElbowLegLength),S={original:e9.xu.Common([c.bounds,u.bounds]),expanded:e9.xu.Common([y,b])},v=u.bounds.minX-c.bounds.maxX;v<0&&((v=c.bounds.minX-u.bounds.maxX)<0&&(v=0),v=-v);let k=u.bounds.minY-c.bounds.maxY;k<0&&((k=c.bounds.minY-u.bounds.maxY)<0&&(k=0),k=-k);let _=3*c.minEndSegmentLength,C=3*u.minEndSegmentLength,E=(c.isPoint?_:o.minElbowLegLength)+(u.isPoint?C:o.minElbowLegLength),M=null;v>E?M={a:c.isPoint?c.bounds.maxX+_:y.maxX,b:u.isPoint?u.bounds.minX-C:b.minX}:v<-E&&(M={a:c.isPoint?c.bounds.minX-_:y.minX,b:u.isPoint?u.bounds.maxX+C:b.maxX});let P=null;k>E?P={a:c.isPoint?c.bounds.maxY+_:y.maxY,b:u.isPoint?u.bounds.minY-C:b.minY}:k<-E&&(P={a:c.isPoint?c.bounds.minY-_:y.minY,b:u.isPoint?u.bounds.maxY+C:b.maxY});let A=d?1-o.elbowMidpoint:o.elbowMidpoint,j=M?(0,B.t7)(M.a,M.b,A):null,D=P?(0,B.t7)(P.a,P.b,A):null,F={options:o,swapOrder:d,A:{isPoint:c.isPoint,target:c.target,isExact:c.isExact,arrowheadOffset:c.arrowheadOffset,minEndSegmentLength:c.minEndSegmentLength,original:c.bounds,expanded:y,edges:h,geometry:c.geometry},B:{isPoint:u.isPoint,target:u.target,isExact:u.isExact,arrowheadOffset:u.arrowheadOffset,minEndSegmentLength:u.minEndSegmentLength,original:u.bounds,expanded:b,edges:p,geometry:u.geometry},common:S,gapX:v,gapY:k,midX:j,midY:D},O=new ElbowArrowWorkingInfo(F),R=getSideToUse(c,u,F.A.edges),L=getSideToUse(u,c,F.B.edges);return R&&L?r=function(e,t,n){let r=tryRouteArrow(e,t,n);return r||(e.A.isPoint&&e.B.isPoint?pickBest(e,[[rA[t],rA[n],"manual","manual"],[t,rA[n],"manual","auto"],[rA[t],n,"auto","manual"]]):e.A.isPoint?tryRouteArrow(e,rA[t],n):e.B.isPoint?tryRouteArrow(e,t,rA[n]):null)}(O,R,L):R&&!L&&(r=function(e,t){let n=null,r=e.A.edges.right,i=e.A.edges.left,o=e.B.edges.top,a=e.B.edges.bottom;switch(t){case"right":e.gapX>0&&e.gapX>Math.abs(e.gapY)&&null!==e.midX?n=tryRouteArrow(e,"right","left"):r&&o&&(r.expanded??r.value)<=o.crossTarget&&r.crossTarget<=(o.expanded??o.value)?n=tryRouteArrow(e,"right","top"):r&&a&&(r.expanded??r.value)<=a.crossTarget&&r.crossTarget>=(a.expanded??a.value)&&(n=tryRouteArrow(e,"right","bottom"));break;case"left":e.gapX<0&&Math.abs(e.gapX)>Math.abs(e.gapY)&&null!==e.midX?n=tryRouteArrow(e,"left","right"):i&&o&&(i.expanded??i.value)>=o.crossTarget&&i.crossTarget<=(o.expanded??o.value)?n=tryRouteArrow(e,"left","top"):i&&a&&(i.expanded??i.value)>=a.crossTarget&&i.crossTarget>=(a.expanded??a.value)&&(n=tryRouteArrow(e,"left","bottom"));break;case"top":case"bottom":break;default:(0,B.iP)(t)}if(n)return n.aEdgePicking="manual",n.bEdgePicking="auto",n;switch(t){case"top":return pickBest(e,[["top","bottom","manual","auto"],["top","right","manual","auto"],["top","left","manual","auto"],["top","top","manual","auto"]]);case"bottom":return pickBest(e,[["bottom","top","manual","auto"],["bottom","right","manual","auto"],["bottom","left","manual","auto"],["bottom","bottom","manual","auto"]]);case"left":return pickBest(e,[["left","right","manual","auto"],["left","bottom","manual","auto"],["left","left","manual","auto"],["left","top","manual","auto"]]);case"right":return pickBest(e,[["right","left","manual","auto"],["right","bottom","manual","auto"],["right","right","manual","auto"],["right","top","manual","auto"]])}}(O,R)),r||(r=function(e,t){let n=null;if(Math.abs(e.gapX)+1>Math.abs(e.gapY)&&null!==e.midX)n=e.gapX>0?tryRouteArrow(e,"right","left"):tryRouteArrow(e,"left","right");else{let t=e.A.edges.right,r=e.A.edges.left,i=e.B.edges.top,o=e.B.edges.bottom;e.A.isPoint&&e.B.isPoint?n=e.gapY>0?tryRouteArrow(e,"bottom","top"):tryRouteArrow(e,"top","bottom"):t&&i&&(t.expanded??t.value)<=i.crossTarget&&t.crossTarget<=(i.expanded??i.value)?n=tryRouteArrow(e,"right","top"):t&&o&&(t.expanded??t.value)<=o.crossTarget&&t.crossTarget>=(o.expanded??o.value)?n=tryRouteArrow(e,"right","bottom"):r&&i&&(r.expanded??r.value)>=i.crossTarget&&r.crossTarget<=(i.expanded??i.value)?n=tryRouteArrow(e,"left","top"):r&&o&&(r.expanded??r.value)>=o.crossTarget&&r.crossTarget>=(o.expanded??o.value)?n=tryRouteArrow(e,"left","bottom"):e.gapY>0&&null!==e.midY?n=tryRouteArrow(e,"bottom","top"):e.gapY<0&&null!==e.midY&&(n=tryRouteArrow(e,"top","bottom"))}if(n)return n.aEdgePicking=t,n.bEdgePicking=t,n;let r=rE.filter(t=>e.A.edges[t]),i=rE.filter(t=>e.B.edges[t]),o=r.flatMap(e=>i.map(n=>[e,n,t,t]));return pickBest(e,o)}(O,R||L?"fallback":"auto")),r&&(castPathSegmentIntoGeometry("first",F.A,F.B,r),castPathSegmentIntoGeometry("last",F.B,F.A,r),function(e,t,n){if(e){if(e.points.length>=3){let n=e.points[0],r=e.points[1],i=eF.B.ManhattanDist(n,r);if(i<t.minEndSegmentLength&&(e.points.splice(1,1),e.points.length>=3)){let t=(0,ei.C2)(n.x,r.x)?"y":"x";e.points[1][t]=n[t]}}if(e.points.length>=3){let t=e.points[e.points.length-1],r=e.points[e.points.length-2],i=eF.B.ManhattanDist(t,r);if(i<n.minEndSegmentLength&&(e.points.splice(e.points.length-2,1),e.points.length>=3)){let n=(0,ei.C2)(t.x,r.x)?"y":"x";e.points[e.points.length-2][n]=t[n]}}}}(r,c,u),d&&r.points.reverse()),{...F,route:r,midXRange:M?d?{lo:M.b,hi:M.a}:{lo:M.a,hi:M.b}:null,midYRange:P?d?{lo:P.b,hi:P.a}:{lo:P.a,hi:P.b}:null}}function getElbowArrowTerminalInfo(e,t,n,r){let i=rz[t.props.size]*t.props.scale/2,o=i*t.props.scale*3;if(n){let r=e.getShape(n.toId),l=function(e,t,n,r){let i="start"===r.terminal?"none"!==t.props.arrowheadStart:"none"!==t.props.arrowheadEnd,o=e.getShapeGeometry(n,i?void 0:{context:"@tldraw/arrow-without-arrowhead"});if(!o)return null;let a=e.getShapePageTransform(t.id),l=e.getShapePageTransform(n),d=a.clone().invert().multiply(l),c=o.transform(d),u={x:.5,y:.5},h=r.isPrecise?r.normalizedAnchor:u,p={x:(0,B.t7)(o.bounds.minX,o.bounds.maxX,h.x),y:(0,B.t7)(o.bounds.minY,o.bounds.maxY,h.y)},f={x:(0,B.t7)(o.bounds.minX,o.bounds.maxX,u.x),y:(0,B.t7)(o.bounds.minY,o.bounds.maxY,u.y)},g=tu._.applyToPoint(d,p),m=tu._.applyToPoint(d,f);return{bounds:c.bounds,geometry:c,target:g,center:m,shapeToArrowTransform:d}}(e,t,n.toId,n.props);if(l&&r){let e=0,d="start"===n.props.terminal?"arrowheadStart":"arrowheadEnd";if("none"!==t.props[d]){let n="scale"in r.props?r.props.scale:1,o="size"in r.props?(rz[r.props.size]??0)*n/2:0;e=i+o+rU*t.props.scale}let c=null,u=l.target;if(n.props.isPrecise){var a;a=eF.B.RotWith(n.props.normalizedAnchor,{x:.5,y:.5},l.shapeToArrowTransform.rotation()),c=(0,ei.C2)(a.x,.5)&&(0,ei.C2)(a.y,.5)?null:Math.abs(a.x-.5)>Math.abs(a.y-.5)-1e-4?a.x<.5?"left":"right":a.y<.5?"top":"bottom"}return{targetShapeId:n.toId,isPoint:!1,isExact:n.props.isExact,bounds:l.bounds,geometry:l.geometry,target:u,arrowheadOffset:e,minEndSegmentLength:o,side:c,snap:n.props.snap}}}return{targetShapeId:null,bounds:e9.xu.FromCenter(r,{x:0,y:0}),geometry:null,isExact:!1,isPoint:!0,target:eF.B.From(r),arrowheadOffset:0,minEndSegmentLength:o,side:null,snap:"none"}}let rF={top:{expand:-1,main:"minY",opposite:"maxY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"max",crossAxis:"x"},bottom:{expand:1,main:"maxY",opposite:"minY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"min",crossAxis:"x"},left:{expand:-1,main:"minX",opposite:"maxX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"max",crossAxis:"y"},right:{expand:1,main:"maxX",opposite:"minX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"min",crossAxis:"y"}};function getUsableEdge(e,t,n,r){let i=rF[n],o=e.targetShapeId===t.targetShapeId&&null!==e.targetShapeId&&("edge"===e.snap||"edge-point"===e.snap)&&("edge"===t.snap||"edge-point"===t.snap),a=e.bounds[i.main],l=e.isPoint?null:a+i.expand*r.expandElbowLegLength,d=createRange(e.bounds[i.crossMin],e.bounds[i.crossMax]),c=d;if(!c)return null;(0,B.hu)(d);let u=createRange(t.bounds[i.main],t.bounds[i.opposite]);t.isPoint||(u[i.bRangeExpand]-=2*r.minElbowLegLength*i.expand);let h=function(e,t){let n={min:e.min-t,max:e.max+t};return n.min>n.max?null:n}(createRange(t.bounds[i.crossMin],t.bounds[i.crossMax]),r.expandElbowLegLength);(0,B.hu)(u&&h);let p=!1;if(isWithinRange(a,u)&&!e.isPoint&&!t.isPoint&&!o){var f,g,m;let e=(f=c,((0,B.hu)(f.min<=f.max&&h.min<=h.max),f.min<=h.min&&h.max<=f.max)?[{min:f.min,max:h.min},{min:h.max,max:f.max}]:h.max<=f.min||h.min>=f.max?[f]:h.min<=f.min&&f.max<=h.max?[]:isWithinRange(f.min,h)?[{min:h.max,max:f.max}]:isWithinRange(f.max,h)?[{min:f.min,max:h.min}]:[]);switch(e.length){case 0:return null;case 1:p=e[0]!==c,c=e[0];break;case 2:p=!0,c=(g=e[0]).max-g.min>(m=e[1]).max-m.min?e[0]:e[1];break;default:(0,B.iP)(e)}}if(!isWithinRange(e.target[i.crossAxis],c))return null;let y=e.target[i.crossAxis];return{value:a,expanded:l,cross:c,crossTarget:y,isPartial:p}}function hasUsableEdge(e,t){return null===t?!!(e.bottom||e.left||e.right||e.top):"x"===t?!!e.left||!!e.right:"y"===t?!!e.top||!!e.bottom:!!e[t]}function getSideToUse(e,t,n){switch(e.side){case null:return null;case"x":if(e.bounds.center.x>t.bounds.center.x&&n?.left)return"left";if(n?.right)return"right";return null;case"y":if(e.bounds.center.y>t.bounds.center.y&&n?.top)return"top";if(n?.bottom)return"bottom";return null;default:return e.side}}function convertTerminalToPoint(e){if(e.isPoint)return e;let t=null,n=0;return("edge"===e.snap||"edge-point"===e.snap)&&(n=e.arrowheadOffset,("x"===e.side||"left"===e.side||"right"===e.side)&&(t="x"),("y"===e.side||"top"===e.side||"bottom"===e.side)&&(t="y")),{targetShapeId:e.targetShapeId,side:t,bounds:new e9.xu(e.target.x,e.target.y,0,0),geometry:e.geometry,target:e.target,arrowheadOffset:n,minEndSegmentLength:e.minEndSegmentLength,isExact:e.isExact,isPoint:!0,snap:e.snap}}function castPathSegmentIntoGeometry(e,t,n,r){if(!t.geometry)return;let i="first"===e?r.points[0]:r.points[r.points.length-1],o="first"===e?r.points[1]:r.points[r.points.length-2],a=t.geometry.isClosed?o:t.target,l=eF.B.ManhattanDist(i,a),d=null,c=1/0;if(t.isExact)d=t.target;else if(t.geometry){let e=t.geometry.intersectLineSegment(o,t.target,{includeLabels:!1,includeInternal:!1});for(let n of(t.geometry.hitTestPoint(t.target,Math.max(1,t.arrowheadOffset),!0,ti.Dn.EXCLUDE_NON_STANDARD)&&e.push(t.target),e)){let e=eF.B.ManhattanDist(a,n);e<c&&(c=e,d=n)}}if(d){let a=t.arrowheadOffset,c=eF.B.ManhattanDist(o,d),u=2*t.arrowheadOffset;if(c<u){let e=u-t.arrowheadOffset;a=c-e}a<t.minEndSegmentLength&&(a=t.geometry.bounds.containsPoint(n.target)?Math.max(0,a):-t.arrowheadOffset);let h=d,p=!1;if(!t.isExact&&0!==a){let e=eF.B.Nudge(d,o,a);h=e,a<0&&!t.geometry.hitTestPoint(e,0,!0,ti.Dn.EXCLUDE_NON_STANDARD)?h=d:(a<0&&(p=!0),h=e)}let f=eF.B.ManhattanDist(o,h);if(r.distance+=f-l,i.x=h.x,i.y=h.y,p){let t=eF.B.Lrp(o,i,.5);r.skipPointsWhenDrawing.add(t),r.points.splice("first"===e?1:r.points.length-1,0,t)}}}function adjustTerminalForUnclosedPathIfNeeded(e,t,n){if(!e.geometry||e.geometry.isClosed)return e;let r=e.geometry.uninterpolateAlongEdge(e.target,ti.Dn.EXCLUDE_NON_STANDARD),i=e.geometry.interpolateAlongEdge(r-.01/e.geometry.length),o=e.geometry.interpolateAlongEdge(r+.01/e.geometry.length),a=o.sub(i).per().uni(),l=Math.abs(a.x)>Math.abs(a.y)?rj.x:rj.y;if(e.geometry.bounds.containsPoint(t.target,n.expandElbowLegLength))return e.side=l.self,convertTerminalToPoint(e);let d=l.v(e.target[l.self]-2*e.bounds[l.size],e.target[l.cross]),c=l.v(e.target[l.self]+2*e.bounds[l.size],e.target[l.cross]),u=null,h=0,p=null,f=0,g=l.self;for(let t of e.geometry.intersectLineSegment(d,c,ti.Dn.EXCLUDE_NON_STANDARD))!(1>Math.abs(t[l.self]-e.target[l.self]))&&(t[l.self]<e.target[l.self]?eF.B.ManhattanDist(t,e.target)>h&&(h=eF.B.ManhattanDist(t,e.target),u=t):eF.B.ManhattanDist(t,e.target)>f&&(f=eF.B.ManhattanDist(t,e.target),p=t));return u&&p?g=h>f?l.hiEdge:l.loEdge:u&&!p?g=l.hiEdge:!u&&p&&(g=l.loEdge),e.side=g,e}function getBoundShapeInfoForTerminal(e,t,n){let r=e.getBindingsFromShape(t,"arrow").find(e=>e.props.terminal===n);if(!r)return;let i=e.getShape(r.toId);if(!i)return;let o=e.getShapePageTransform(i),a="start"===n?"none"!==t.props.arrowheadStart:"none"!==t.props.arrowheadEnd,l=e.getShapeGeometry(i,a?void 0:{context:"@tldraw/arrow-without-arrowhead"});return{shape:i,transform:o,isClosed:l.isClosed,isExact:r.props.isExact,didIntersect:!1,geometry:l}}function getArrowTerminalInArrowSpace(e,t,n,r){let i=e.getShape(n.toId);if(!i)return new eF.B(0,0);{let{point:o,size:a}=e.getShapeGeometry(i).bounds,l=eF.B.Add(o,eF.B.MulV(n.props.isPrecise||r?n.props.normalizedAnchor:{x:.5,y:.5},a)),d=tu._.applyToPoint(e.getShapePageTransform(i),l),c=tu._.applyToPoint(tu._.Inverse(t),d);return c}}let rO=(0,R.mV)("arrow bindings",(e,t)=>{let n=e.getBindingsFromShape(t.id,"arrow");return{start:n.find(e=>"start"===e.props.terminal),end:n.find(e=>"end"===e.props.terminal)}},{areRecordsEqual:(e,t)=>e.id===t.id,areResultsEqual:(e,t)=>e.start===t.start&&e.end===t.end});function getArrowBindings(e,t){return rO.get(e,t.id)}let rR=(0,R.mV)("arrow info",(e,t)=>{let n=getArrowBindings(e,t);if("elbow"===t.props.kind){let r=getElbowArrowInfo(e,t,n);if(!r?.route)return getStraightArrowInfo(e,t,n);let i=r.swapOrder?r.B:r.A,o=r.swapOrder?r.A:r.B;return{type:"elbow",bindings:n,start:{handle:i.target,point:r.route.points[0],arrowhead:t.props.arrowheadStart},end:{handle:o.target,point:r.route.points[r.route.points.length-1],arrowhead:t.props.arrowheadEnd},elbow:r,route:r.route,isValid:!0}}return"arc"===t.props.kind&&Math.abs(t.props.bend)<8*t.props.scale?getStraightArrowInfo(e,t,n):function(e,t,n){let{arrowheadEnd:r,arrowheadStart:i}=t.props,o=t.props.bend;if(Math.abs(o)>Math.abs(t.props.bend*(rN*t.props.scale)))return getStraightArrowInfo(e,t,n);let a=getArrowTerminalsInArrowSpace(e,t,n),l=eF.B.Med(a.start,a.end),d=eF.B.Sub(a.end,a.start),c=eF.B.Len(d)?d.uni():eF.B.From(d),u=eF.B.Add(l,c.per().mul(-o)),h=getBoundShapeInfoForTerminal(e,t,"start"),p=getBoundShapeInfoForTerminal(e,t,"end"),f=a.start.clone(),g=a.end.clone(),m=u.clone();if(eF.B.Equals(f,g))return{bindings:n,type:"straight",start:{handle:f,point:f,arrowhead:t.props.arrowheadStart},end:{handle:g,point:g,arrowhead:t.props.arrowheadEnd},middle:m,isValid:!1,length:0};let y=t.props.bend<0,b=y?ei.VK:ei.pc,S=getArcInfo(f,g,m),v=eF.B.Angle(S.center,f),k=eF.B.Angle(S.center,g),_=b(v,k);if(0===S.length||0===S.size||!(0,ei.AV)(S.length)||!(0,ei.AV)(S.size))return getStraightArrowInfo(e,t,n);let C=f.clone(),E=g.clone(),M=m.clone(),P=e.getShapePageTransform(t),A=0,j=0,D=rL*t.props.scale;if(h&&!h.isExact){let n;let r=tu._.applyToPoint(P,C),o=tu._.applyToPoint(P,S.center),a=tu._.applyToPoint(P,E),l=tu._.Inverse(h.transform),d=tu._.applyToPoint(l,r),c=tu._.applyToPoint(l,o),u=tu._.applyToPoint(l,a),{isClosed:p}=h,f=Array.from(h.geometry.intersectCircle(c,S.radius,{includeLabels:!1,includeInternal:!1}));if(f.length){let e=c.angle(d),t=c.angle(u),r=b(e,t);f=f.filter(t=>b(e,c.angle(t))<=r);let i=.25*r;f.sort(p?(t,n)=>Math.abs(b(e,c.angle(t))-i)<Math.abs(b(e,c.angle(n))-i)?-1:1:(t,n)=>b(e,c.angle(t))<b(e,c.angle(n))?-1:1),n=f[0]}if(!n){if(p){let e=h.geometry.nearestPoint(d);eF.B.DistMin(e,d,1)&&(n=e)}else n=d}if(n&&(C.setTo(e.getPointInShapeSpace(t,tu._.applyToPoint(h.transform,n))),h.didIntersect=!0,"none"!==i)){let e=rz[t.props.size]/2+("size"in h.shape.props?rz[h.shape.props.size]/2:0);A=(rU+e)*t.props.scale,D+=e*t.props.scale}}if(p&&!p.isExact){let n;let i=tu._.applyToPoint(P,C),o=tu._.applyToPoint(P,E),a=tu._.applyToPoint(P,S.center),l=tu._.Inverse(p.transform),d=tu._.applyToPoint(l,i),c=tu._.applyToPoint(l,a),u=tu._.applyToPoint(l,o),h=p.isClosed,f=Array.from(p.geometry.intersectCircle(c,S.radius,{includeLabels:!1,includeInternal:!1}));if(f.length){let e=c.angle(d),t=c.angle(u),r=b(e,t),i=.75*r;(f=f.filter(t=>b(e,c.angle(t))<=r)).sort(h?(t,n)=>Math.abs(b(e,c.angle(t))-i)<Math.abs(b(e,c.angle(n))-i)?-1:1:(t,n)=>b(e,c.angle(t))<b(e,c.angle(n))?-1:1),n=f[0]}if(!n){if(h){let e=p.geometry.nearestPoint(u);eF.B.DistMin(e,u,1)&&(n=e)}else n=u}if(n&&(E.setTo(e.getPointInShapeSpace(t,tu._.applyToPoint(p.transform,n))),p.didIntersect=!0,"none"!==r)){let e=rz[t.props.size]/2+("size"in p.shape.props?rz[p.shape.props.size]/2:0);j=(rU+e)*t.props.scale,D+=e*t.props.scale}}let B=eF.B.Angle(S.center,C),F=eF.B.Angle(S.center,E),O=b(B,F),R=O*S.radius,L=C.clone(),N=E.clone();if(0!==A&&L.setTo(S.center).add(eF.B.FromAngle(B+O*(A/R*(y?1:-1))).mul(S.radius)),0!==j&&N.setTo(S.center).add(eF.B.FromAngle(F+O*(j/R*(y?-1:1))).mul(S.radius)),eF.B.DistMin(L,N,D)){0!==A&&0!==j?(A*=-1.5,j*=-1.5):0!==A?A*=-2:0!==j&&(j*=-2);let e=.1-b(v,B)*S.radius,t=.1-b(F,k)*S.radius;A=Math.max(A,e),j=Math.max(j,t)}if(0!==A&&C.setTo(S.center).add(eF.B.FromAngle(B+O*(A/R*(y?1:-1))).mul(S.radius)),0!==j&&E.setTo(S.center).add(eF.B.FromAngle(F+O*(j/R*(y?-1:1))).mul(S.radius)),h&&p&&!h.isExact&&!p.isExact){R=(O=b(B=eF.B.Angle(S.center,C),F=eF.B.Angle(S.center,E)))*S.radius;let n=getBoundShapeRelationships(e,h.shape.id,p.shape.id);"double-bound"===n&&R<30?(C.setTo(f),E.setTo(g),M.setTo(m)):"safe"===n&&(h&&!h.didIntersect&&C.setTo(f),(p&&!p.didIntersect||b(v,B)>b(v,F))&&E.setTo(S.center).add(eF.B.FromAngle(B+O*(Math.min(.9,rL*t.props.scale/R)*(y?1:-1))).mul(S.radius)))}(function(e,t,n,r,i,o,a){let l=eF.B.Angle(e,n),d=eF.B.Angle(e,r),c=(0,ei.VK)(l,d);if(a||(c=ei.yo-c),i.setTo(e).add(eF.B.FromAngle(l+c*(.5*(a?1:-1))).mul(t)),c>o){i.rotWith(e,ei.PI);let t=r.clone();r.setTo(n),n.setTo(t)}})(S.center,S.radius,C,E,M,_,y),C.equals(E)&&(C.setTo(M.clone().addXY(1,1)),E.setTo(M.clone().subXY(1,1))),f.setTo(C),g.setTo(E),m.setTo(M);let z=getArcInfo(f,g,m);return{bindings:n,type:"arc",start:{point:f,handle:a.start,arrowhead:t.props.arrowheadStart},end:{point:g,handle:a.end,arrowhead:t.props.arrowheadEnd},middle:m,handleArc:S,bodyArc:z,isValid:0!==z.length&&isFinite(z.center.x)&&isFinite(z.center.y)}}(e,t,n)},{areRecordsEqual:(e,t)=>e.props===t.props,areResultsEqual:B.sd});function shared_getArrowInfo(e,t){let n="string"==typeof t?t:t.id;return rR.get(e,n)}function getArrowTerminalsInArrowSpace(e,t,n){let r=e.getShapePageTransform(t),i=getBoundShapeRelationships(e,n.start?.toId,n.end?.toId),o=n.start?getArrowTerminalInArrowSpace(e,r,n.start,"double-bound"===i||"start-contains-end"===i):eF.B.From(t.props.start),a=n.end?getArrowTerminalInArrowSpace(e,r,n.end,"double-bound"===i||"end-contains-start"===i):eF.B.From(t.props.end);return{start:o,end:a}}function createOrUpdateArrowBinding(e,t,n,r){let i="string"==typeof t?t:t.id,o="string"==typeof n?n:n.id,a=e.getBindingsFromShape(i,"arrow").filter(e=>e.props.terminal===r.terminal);a.length>1&&e.deleteBindings(a.slice(1));let l=a[0];l?e.updateBinding({...l,toId:o,props:r}):e.createBinding({type:"arrow",fromId:i,toId:o,props:r})}function removeArrowBinding(e,t,n){let r=e.getBindingsFromShape(t,"arrow").filter(e=>e.props.terminal===n);e.deleteBindings(r)}let rL=10,rU=10,rN=10,rz={s:2,m:3.5,l:5,xl:10};function getBoundShapeRelationships(e,t,n){if(!t||!n)return"safe";if(t===n)return"double-bound";let r=e.getShapePageBounds(t),i=e.getShapePageBounds(n);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}let ArrowBindingUtil=class ArrowBindingUtil extends BindingUtil{static type="arrow";static props=L.zn;static migrations=L.Vz;getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5},snap:"none"}}onAfterCreate({binding:e}){let t=this.editor.getShape(e.fromId);t&&arrowDidUpdate(this.editor,t)}onAfterChange({bindingAfter:e}){let t=this.editor.getShape(e.fromId);t&&arrowDidUpdate(this.editor,t)}onAfterChangeFromShape({shapeAfter:e}){arrowDidUpdate(this.editor,e)}onAfterChangeToShape({binding:e,shapeBefore:t,shapeAfter:n,reason:r}){("ancestry"===r||t.parentId!==n.parentId||t.index!==n.index)&&reparentArrow(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){let t=this.editor.getShape(e.fromId);t&&updateArrowTerminal({editor:this.editor,arrow:t,terminal:e.props.terminal})}};function reparentArrow(e,t){let n,r,i;let o=e.getShape(t);if(!o)return;let a=getArrowBindings(e,o),{start:l,end:d}=a,c=l?e.getShape(l.toId):void 0,u=d?e.getShape(d.toId):void 0,h=e.getAncestorPageId(o);if(!h)return;if(c&&u)n=e.findCommonAncestor([c,u])??h;else{if(!c&&!u)return;let e=(c||u)?.parentId;n=e&&e===o.parentId?o.parentId:h}n&&n!==o.parentId&&e.reparentShapes([t],n);let p=e.getShape(t);if(!p)throw Error("no reparented arrow");let f=e.getShapeNearestSibling(p,c),g=e.getShapeNearestSibling(p,u);if(f&&g)r=f.index>g.index?f:g;else if(f&&!g)r=f;else{if(!g||f)return;r=g}let m=e.getSortedChildIdsForParent(r.parentId).map(t=>e.getShape(t)).filter(e=>e.index>r.index);if(m.length){let e=m.find(e=>"arrow"!==e.type);if(p.index>r.index&&(!e||p.index<e.index))return;i=(0,B.eI)(r.index,m[0].index)}else i=(0,B._L)(r.index);i!==p.index&&e.updateShapes([{id:t,type:"arrow",index:i}])}function arrowDidUpdate(e,t){let n=getArrowBindings(e,t);for(let r of["start","end"]){let i=n[r];if(!i)continue;let o=e.getShape(i.toId),a=e.getAncestorPageId(t)===e.getAncestorPageId(o);o&&a||updateArrowTerminal({editor:e,arrow:t,terminal:r,unbind:!0})}reparentArrow(e,t.id)}function updateArrowTerminal({editor:e,arrow:t,terminal:n,unbind:r=!1,useHandle:i=!1}){let o=shared_getArrowInfo(e,t);if(!o)throw Error("expected arrow info");let a=i?o.start.handle:o.start.point,l=i?o.end.handle:o.end.point,d="start"===n?a:l,c={id:t.id,type:"arrow",props:{[n]:{x:d.x,y:d.y},bend:t.props.bend}};if("arc"===o.type){let e="start"===n?a:o.start.handle,r="end"===n?l:o.end.handle,i=eF.B.Med(e,r),d=eF.B.Sub(e,r).per().uni().mul(2*o.handleArc.radius*Math.sign(t.props.bend)),u=(0,tn.ZM)(o.handleArc.center,eF.B.Add(i,d),o.handleArc.center,o.handleArc.radius);(0,B.hu)(u?.length===1);let h=eF.B.Dist(i,u[0])*Math.sign(t.props.bend);(0,ei.C2)(h,c.props.bend)||(c.props.bend=h)}e.updateShape(c),r&&removeArrowBinding(e,t,n)}function TldrawHandles({children:e}){let t=(0,eW.jE)(),n=(0,O.Hg)("shouldDisplayHandles",()=>{if(t.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(t.isInAny("select.editing_shape")){let e=t.getOnlySelectedShape();return e&&t.isShapeOfType(e,"note")}return!1},[t]);return n?(0,et.jsx)("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:e}):null}let rH=new B.kM;function getArrowTargetAtom(e){return rH.get(e,()=>(0,F.cn)("arrowTarget",null))}function clearArrowTargetState(e){getArrowTargetAtom(e).set(null)}function updateArrowTargetState({editor:e,pointInPageSpace:t,arrow:n,isPrecise:r,currentBinding:i,oppositeBinding:o}){let a=e.getShapeUtil("arrow");if(a.options.shouldIgnoreTargets(e))return getArrowTargetAtom(e).set(null),null;let l=a.options.shouldBeExact(e),d=n?n.props.kind:e.getStyleForNextShape(L.dR),c=e.getShapeAtPoint(t,{hitInside:!0,hitFrameInside:!0,margin:"elbow"===d?8:0,filter:t=>!t.isLocked&&e.canBindShapes({fromShape:n??r$,toShape:t,binding:"arrow"})});if(!c)return getArrowTargetAtom(e).set(null),null;let u=e.getShapeGeometry(c),h=e9.xu.ZeroFix(u.bounds),p=u.center,f=e.getShapePageTransform(c),g=e.getPointInShapeSpace(c,t),m=Math.max(u.bounds.width,u.bounds.height),y=(0,B.Fm)(rM,(e,t)=>{let n=rj[rP[e]],r=eF.B.Mul(t,m).add(p),i=!1,o=n.v(h[e],h[n.crossMid]),a=0,l=u.intersectLineSegment(p,r,ti.Dn.EXCLUDE_NON_STANDARD);for(let e of l){let t=eF.B.Dist2(e,p);t>a&&(a=t,o=e,i=u.isClosed)}let d=f.applyToPoint(o);return{point:d,isEnabled:i,far:f.applyToPoint(r)}}),b=e.getZoomLevel(),S=a.options.minElbowHandleDistance/b,v=f.applyToPoint(p);for(let e of(0,B.GH)(y)){let t=y[e];eF.B.DistMin(t.point,v,S)&&(t.isEnabled=!1)}let k=r||l;k||i&&(!i||c.id===i.toId)||(k=.5>e.inputs.pointerVelocity.len()),!r&&(u.isClosed||(k=!0),o&&c.id===o.toId&&o.props.isPrecise&&(k=!0));let _=!l&&k&&u.isClosed,C=!l&&(k&&"elbow"===d||!u.isClosed),E=!l&&k&&"elbow"===d&&u.isClosed,M=k&&(u.isClosed||l),P=!l&&k&&"elbow"===d&&u.isClosed,A="none",j=t;if(M||(A="center",j=v),C){let n=M?calculateSnapDistance(e,h,a.options.elbowArrowEdgeSnapDistance):1/0,r=u.nearestPoint(g,{includeLabels:!1,includeInternal:!1}),i=f.applyToPoint(r),o=eF.B.Dist(i,t);o<n&&(A="edge",j=i)}if(P){let n=calculateSnapDistance(e,h,a.options.elbowArrowAxisSnapDistance),r=eF.B.DistanceToLineSegment(y.left.far,y.right.far,t),i=eF.B.DistanceToLineSegment(y.top.far,y.bottom.far,t),o=r<i&&r<n?"x":i<n?"y":null;if(o){let e=rj[o],n=eF.B.Dist2(y[e.loEdge].far,t),r=eF.B.Dist2(y[e.hiEdge].far,t),i=n<r?e.loEdge:e.hiEdge;y[i].isEnabled&&(A="edge-point",j=y[i].point)}}if(E){let n=calculateSnapDistance(e,h,a.options.elbowArrowPointSnapDistance),r=null,i=1/0;for(let[e,o]of(0,B.EP)(y)){if(!o.isEnabled)continue;let a=eF.B.Dist(o.point,t);a<n&&a<i&&(i=a,r=e)}r&&(A="edge-point",j=y[r].point)}if(_){let t=calculateSnapDistance(e,h,"elbow"===d?a.options.elbowArrowCenterSnapDistance:a.options.arcArrowCenterSnapDistance);eF.B.Dist(g,h.center)<t&&(A="center",j=v)}let D=e.getPointInShapeSpace(c,j),F={x:(0,B.VN)(h.minX,h.maxX,D.x),y:(0,B.VN)(h.minY,h.maxY,D.y)},O={target:c,arrowKind:d,handlesInPageSpace:y,centerInPageSpace:v,anchorInPageSpace:j,isExact:l,isPrecise:k,snap:A,normalizedAnchor:F};return getArrowTargetAtom(e).set(O),O}let r$={type:"arrow"};function calculateSnapDistance(e,t,n){return(0,ei.uZ)(.15*Math.min(t.width,t.height),4,n)/e.getZoomLevel()}function TldrawOverlays(){let e=(0,eW.jE)(),t=(0,O.Hg)("should show arrow hints",()=>{if(e.isInAny("arrow.idle","arrow.pointing"))return!0;if(e.isIn("select.pointing_handle")){let t=e.getStateDescendant("select.pointing_handle");if("arrow"===t.info.shape.type&&("start"===t.info.handle.id||"end"===t.info.handle.id))return!0}if(e.isIn("select.dragging_handle")){let t=e.getStateDescendant("select.dragging_handle");if("arrow"===t.info.shape.type&&("start"===t.info.handle.id||"end"===t.info.handle.id))return!0}return!1},[e]);return t?(0,et.jsx)(TldrawArrowHints,{}):null}function TldrawArrowHints(){let e=(0,eW.jE)(),{ShapeIndicator:t}=(0,eZ.o)(),n=(0,O.Hg)("arrow target info",()=>getArrowTargetAtom(e).get(),[e]);if(!n)return null;let{handlesInPageSpace:r,snap:i,anchorInPageSpace:o,arrowKind:a,isExact:l,isPrecise:d}=n;return(0,et.jsxs)(et.Fragment,{children:[t&&(0,et.jsx)(t,{shapeId:n.target.id}),!l&&"elbow"===a&&(0,et.jsxs)("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[(0,et.jsx)("circle",{cx:o.x,cy:o.y,className:`tl-arrow-hint-snap tl-arrow-hint-snap__${d?i??"none":"none"}`}),Object.entries(r).map(([e,t])=>t.isEnabled?(0,et.jsx)("circle",{cx:t.point.x,cy:t.point.y,className:"tl-arrow-hint-handle"},e):null)]})]})}let{PI:rV}=Math,rG=rV+1e-4;function getStrokeOutlineTracks(e,t={}){let n;let{size:r=16,smoothing:i=.5}=t;if(0===e.length||r<=0)return{left:[],right:[]};let o=e[0],a=e[e.length-1],l=a.runningLength,d=Math.pow(r*i,2),c=[],u=[],h=e[0].vector,p=e[0].point,f=p,g=p,m=f,y=!1;for(let t=0;t<e.length;t++){n=e[t];let{point:r,vector:i}=e[t],b=n.vector.dpr(h),S=(t<e.length-1?e[t+1]:e[t]).vector,v=t<e.length-1?S.dpr(n.vector):1,k=b<0&&!y,_=null!==v&&v<.2;if(k||_){if(v>-.62&&l-n.runningLength>n.radius){let e=h.clone().mul(n.radius),t=h.clone().cpr(S);t<0?(g=eF.B.Add(r,e),m=eF.B.Sub(r,e)):(g=eF.B.Sub(r,e),m=eF.B.Add(r,e)),c.push(g),u.push(m)}else{let e=h.clone().mul(n.radius).per(),t=eF.B.Sub(n.input,e);for(let e=1/13,r=0;r<1;r+=e)g=eF.B.RotWith(t,n.input,rG*r),c.push(g),m=eF.B.RotWith(t,n.input,rG+-(rG*r)),u.push(m)}p=g,f=m,_&&(y=!0);continue}if(y=!1,n===o||n===a){let e=eF.B.Per(i).mul(n.radius);c.push(eF.B.Sub(r,e)),u.push(eF.B.Add(r,e));continue}let C=eF.B.Lrp(S,i,v).per().mul(n.radius);g=eF.B.Sub(r,C),(t<=1||eF.B.Dist2(p,g)>d)&&(c.push(g),p=g),m=eF.B.Add(r,C),(t<=1||eF.B.Dist2(f,m)>d)&&(u.push(m),f=m),h=i}return{left:c,right:u}}function getStrokeOutlinePoints(e,t={}){let{size:n=16,start:r={},end:i={},last:o=!1}=t,{cap:a=!0}=r,{cap:l=!0}=i;if(0===e.length||n<=0)return[];let d=e[0],c=e[e.length-1],u=c.runningLength,h=!1===r.taper?0:!0===r.taper?Math.max(n,u):r.taper,p=!1===i.taper?0:!0===i.taper?Math.max(n,u):i.taper,{left:f,right:g}=getStrokeOutlineTracks(e,t),m=d.point,y=e.length>1?e[e.length-1].point:eF.B.AddXY(d.point,1,1);if(1===e.length&&(!(h||p)||o)){let e=eF.B.Add(m,eF.B.Sub(m,y).uni().per().mul(-d.radius)),t=[];for(let n=1/13,r=n;r<=1;r+=n)t.push(eF.B.RotWith(e,m,2*rG*r));return t}let b=[];if(h||p&&1===e.length);else if(a)for(let e=1/8,t=e;t<=1;t+=e){let e=eF.B.RotWith(g[0],m,rG*t);b.push(e)}else{let e=eF.B.Sub(f[0],g[0]),t=eF.B.Mul(e,.5),n=eF.B.Mul(e,.51);b.push(eF.B.Sub(m,t),eF.B.Sub(m,n),eF.B.Add(m,n),eF.B.Add(m,t))}let S=[],v=c.vector.clone().per().neg();if(p||h&&1===e.length)S.push(y);else if(l){let e=eF.B.Add(y,eF.B.Mul(v,c.radius));for(let t=1/29,n=t;n<1;n+=t)S.push(eF.B.RotWith(e,y,3*rG*n))}else S.push(eF.B.Add(y,eF.B.Mul(v,c.radius)),eF.B.Add(y,eF.B.Mul(v,.99*c.radius)),eF.B.Sub(y,eF.B.Mul(v,.99*c.radius)),eF.B.Sub(y,eF.B.Mul(v,c.radius)));return f.concat(S,g.reverse(),b)}function getStrokePoints(e,t={}){let n,r;let{streamline:i=.5,size:o=16,simulatePressure:a=!1}=t;if(0===e.length)return[];let l=.15+(1-i)*.85,d=e.map(eF.B.From),c=0;if(!a){let e=d[0];for(;e&&!(e.z>=.025);)d.shift(),e=d[0]}if(!a){let e=d[d.length-1];for(;e&&!(e.z>=.01);)d.pop(),e=d[d.length-1]}if(0===d.length)return[{point:eF.B.From(e[0]),input:eF.B.From(e[0]),pressure:a?.5:.15,vector:new eF.B(1,1),distance:0,runningLength:0,radius:1}];let u=d[1];for(;u&&!(eF.B.Dist2(u,d[0])>(o/3)**2);)d[0].z=Math.max(d[0].z,u.z),d.splice(1,1),u=d[1];let h=d.pop();for(u=d[d.length-1];u&&!(eF.B.Dist2(u,h)>(o/3)**2);)d.pop(),u=d[d.length-1],c++;d.push(h);let p=t.last||!t.simulatePressure||d.length>1&&eF.B.Dist2(d[d.length-1],d[d.length-2])<o**2||c>0;if(2===d.length&&t.simulatePressure){let e=d[1];d=d.slice(0,-1);for(let t=1;t<5;t++){let n=eF.B.Lrp(d[0],e,t/4);n.z=(d[0].z+(e.z-d[0].z))*t/4,d.push(n)}}let f=[{point:d[0],input:d[0],pressure:a?.5:d[0].z,vector:new eF.B(1,1),distance:0,runningLength:0,radius:1}],g=0,m=f[0];p&&i>0&&d.push(d[d.length-1].clone());for(let e=1,i=d.length;e<i;e++)if(n=!l||t.last&&e===i-1?d[e].clone():d[e].clone().lrp(m.point,1-l),!m.point.equals(n)){if(g+=r=eF.B.Dist(n,m.point),e<4&&g<o)continue;m={input:d[e],point:n,pressure:a?.5:d[e].z,vector:eF.B.Sub(m.point,n).uni(),distance:r,runningLength:g,radius:1},f.push(m)}if(f[1]?.vector&&(f[0].vector=f[1].vector.clone()),g<1){let e=Math.max(.5,...f.map(e=>e.pressure));f.forEach(t=>t.pressure=e)}return f}let{min:rK}=Math;function setStrokePointRadii(e,t){let n,r;let{size:i=16,thinning:o=.5,simulatePressure:a=!0,easing:l=e=>e,start:d={},end:c={}}=t,{easing:u=te.L.easeOutQuad}=d,{easing:h=te.L.easeOutCubic}=c,p=e[e.length-1].runningLength,f=e[0].pressure;if(!a&&p<i){let t=e.reduce((e,t)=>Math.max(e,t.pressure),.5);return e.forEach(e=>{e.pressure=t,e.radius=i*l(.5-o*(.5-e.pressure))}),e}{let t;for(let n=0,o=e.length;n<o&&!((r=e[n]).runningLength>5*i);n++){let e=rK(1,r.distance/i);if(a){let n=rK(1,1-e);t=rK(1,f+(n-f)*(.275*e))}else t=rK(1,f+(r.pressure-f)*.5);f+=(t-f)*.5}for(let t=0;t<e.length;t++){if(r=e[t],o){let{pressure:e}=r,t=rK(1,r.distance/i);if(a){let n=rK(1,1-t);e=rK(1,f+(n-f)*(.275*t))}else e=rK(1,f+(e-f)*(.275*t));r.radius=i*l(.5-o*(.5-e)),f=e}else r.radius=i/2;void 0===n&&(n=r.radius)}}let g=!1===d.taper?0:!0===d.taper?Math.max(i,p):d.taper,m=!1===c.taper?0:!0===c.taper?Math.max(i,p):c.taper;if(g||m)for(let t=0;t<e.length;t++){r=e[t];let{runningLength:n}=r,i=n<g?u(n/g):1,o=p-n<m?h((p-n)/m):1;r.radius=Math.max(.01,r.radius*Math.min(i,o))}return e}function TldrawScribble({scribble:e,zoom:t,color:n,opacity:r,className:i}){let o;if(!e.points.length)return null;let a=function(e,t={}){return getStrokeOutlinePoints(setStrokePointRadii(getStrokePoints(e,t),t),t)}(e.points,{size:e.size/t,start:{taper:e.taper,easing:te.L.linear},last:"stopping"===e.state,simulatePressure:!1,streamline:.32});if(a.length<4){let n=e.size/t/2,{x:r,y:i}=e.points[e.points.length-1];o=`M ${r-n},${i} a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 ${-(2*n)},0`}else o=(0,tb.R)(a);return(0,et.jsx)("svg",{className:i?eh("tl-overlays__item",i):i,children:(0,et.jsx)("path",{className:"tl-scribble",d:o,fill:n??`var(--color-${e.color})`,opacity:r??e.opacity})})}function TldrawCropHandles({size:e,width:t,height:n,hideAlternateHandles:r}){let i=(0,ei.$Z)(e/3),o=i/2,a=useTranslation();return(0,et.jsxs)("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[(0,et.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${(0,ei.$Z)(0-o)},${(0,ei.$Z)(e)} 
						${(0,ei.$Z)(0-o)},${(0,ei.$Z)(0-o)} 
						${(0,ei.$Z)(e)},${(0,ei.$Z)(0-o)}`,strokeWidth:i,"data-testid":"selection.crop.top_left",role:"button","aria-label":a("handle.crop.top-left")}),(0,et.jsx)("line",{className:eh("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,ei.$Z)(t/2-e),y1:(0,ei.$Z)(0-o),x2:(0,ei.$Z)(t/2+e),y2:(0,ei.$Z)(0-o),strokeWidth:i,"data-testid":"selection.crop.top",role:"button","aria-label":a("handle.crop.top")}),(0,et.jsx)("polyline",{className:eh("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${(0,ei.$Z)(t-e)},${(0,ei.$Z)(0-o)} 
						${(0,ei.$Z)(t+o)},${(0,ei.$Z)(0-o)} 
						${(0,ei.$Z)(t+o)},${(0,ei.$Z)(e)}`,strokeWidth:i,"data-testid":"selection.crop.top_right",role:"button","aria-label":a("handle.crop.top-right")}),(0,et.jsx)("line",{className:eh("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,ei.$Z)(t+o),y1:(0,ei.$Z)(n/2-e),x2:(0,ei.$Z)(t+o),y2:(0,ei.$Z)(n/2+e),strokeWidth:i,"data-testid":"selection.crop.right",role:"button","aria-label":a("handle.crop.right")}),(0,et.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${(0,ei.$Z)(t+o)},${(0,ei.$Z)(n-e)} 
						${(0,ei.$Z)(t+o)},${(0,ei.$Z)(n+o)}
						${(0,ei.$Z)(t-e)},${(0,ei.$Z)(n+o)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right",role:"button","aria-label":a("handle.crop.bottom-right")}),(0,et.jsx)("line",{className:eh("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,ei.$Z)(t/2-e),y1:(0,ei.$Z)(n+o),x2:(0,ei.$Z)(t/2+e),y2:(0,ei.$Z)(n+o),strokeWidth:i,"data-testid":"selection.crop.bottom",role:"button","aria-label":a("handle.crop.bottom")}),(0,et.jsx)("polyline",{className:eh("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${(0,ei.$Z)(0+e)},${(0,ei.$Z)(n+o)} 
						${(0,ei.$Z)(0-o)},${(0,ei.$Z)(n+o)}
						${(0,ei.$Z)(0-o)},${(0,ei.$Z)(n-e)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left",role:"button","aria-label":a("handle.crop.bottom-left")}),(0,et.jsx)("line",{className:eh("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,ei.$Z)(0-o),y1:(0,ei.$Z)(n/2-e),x2:(0,ei.$Z)(0-o),y2:(0,ei.$Z)(n/2+e),strokeWidth:i,"data-testid":"selection.crop.left",role:"button","aria-label":a("handle.crop.left")})]})}let rW=(0,O.j)(function({bounds:e,rotation:t}){let n=(0,eW.jE)(),r=useTranslation(),i=(0,en.useRef)(null),o=useReadonly(),a=useSelectionEvents("top"),l=useSelectionEvents("right"),d=useSelectionEvents("bottom"),c=useSelectionEvents("left"),u=useSelectionEvents("top_left"),h=useSelectionEvents("top_right"),p=useSelectionEvents("bottom_right"),f=useSelectionEvents("bottom_left"),g="default"===n.getInstanceState().cursor.type,m=n.getInstanceState().isCoarsePointer,y=n.getOnlySelectedShape(),b=y&&n.isShapeOrAncestorLocked(y),S=y?n.getShapeUtil(y).expandSelectionOutlinePx(y):0,v=S instanceof e9.xu?e.clone().expand(S).zeroFix():e.clone().expandBy(S).zeroFix();if((0,er.H)(i,e?.x,e?.y,1,n.getSelectionRotation(),{x:v.x-e.x,y:v.y-e.y}),y&&n.isShapeHidden(y))return null;let k=n.getZoomLevel(),_=n.getInstanceState().isChangingStyle,C=v.width,E=v.height,M=8/k,P=C<2*M,A=E<2*M,j=C<4*M,D=E<4*M,B=C<5*M,F=E<5*M,O=m?1.75:1,R=6/k*O,L=(j?R/2:R)*(.75*O),N=(D?R/2:R)*(.75*O),z=(!y||!n.getShapeUtil(y).hideSelectionBoundsFg(y))&&!_,$=z&&n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||z&&n.isIn("select.resizing")&&y&&n.isShapeOfType(y,"text");y&&$&&eH.a.isFirefox&&n.isShapeOfType(y,"embed")&&($=!1);let G=n.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!_&&!o,W=n.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!_&&!o,Z=!m&&!(P||A)&&(W||G)&&(!y||!n.getShapeUtil(y).hideRotateHandle(y))&&!b,q=m&&(!j||!D)&&(W||G)&&(!y||!n.getShapeUtil(y).hideRotateHandle(y))&&!b,Y=W&&(!y||n.getShapeUtil(y).canResize(y)&&!n.getShapeUtil(y).hideResizeHandles(y))&&!G&&!b,X=P||A,Q=P&&A,ee=B||F,eo=Y||G,ea=!Z,es=!W||!eo,el=!W||!eo||X,ed=!W||!eo||X,ec=!W||!eo||Q&&!G,eu=!0,ep=!0;if(G)eu=ee,ep=ee;else if(Y){eu=X||Q||m;let e=m&&y&&"text"===y.type;ep=eu&&!e}let ef=Math.min(24/k,E-3*N),eg=W&&m&&y&&n.isShapeOfType(y,"text")&&ef*k>=4;return(0,et.jsx)("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground","aria-hidden":"true",children:(0,et.jsxs)("g",{ref:i,children:[$&&(0,et.jsx)("rect",{className:"tl-selection__fg__outline",width:(0,ei.$Z)(C),height:(0,ei.$Z)(E)}),(0,et.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:R,corner:"top_left_rotate",cursor:g?(0,eK.L)("nwse-rotate",t):void 0,isHidden:ea}),(0,et.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.top-right",cx:C+3*R,cy:0,targetSize:R,corner:"top_right_rotate",cursor:g?(0,eK.L)("nesw-rotate",t):void 0,isHidden:ea}),(0,et.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:E+3*R,targetSize:R,corner:"bottom_left_rotate",cursor:g?(0,eK.L)("swne-rotate",t):void 0,isHidden:ea}),(0,et.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.bottom-right",cx:C+3*R,cy:E+3*R,targetSize:R,corner:"bottom_right_rotate",cursor:g?(0,eK.L)("senw-rotate",t):void 0,isHidden:ea}),(0,et.jsx)(MobileRotateHandle,{"data-testid":"selection.rotate.mobile",cx:j?-(1.5*R):C/2,cy:j?E/2:-(1.5*R),size:M,isHidden:!W||!q}),(0,et.jsx)(ResizeHandle,{hide:eu,dataTestId:"selection.resize.top",ariaLabel:r("handle.resize-top"),x:0,y:(0,ei.$Z)(0-(D?2*N:N)),width:(0,ei.$Z)(C),height:(0,ei.$Z)(Math.max(1,2*N)),cursor:g?(0,eK.L)("ns-resize",t):void 0,events:a}),(0,et.jsx)(ResizeHandle,{hide:ep,dataTestId:"selection.resize.right",ariaLabel:r("handle.resize-right"),x:(0,ei.$Z)(C-(j?0:L)),y:0,height:(0,ei.$Z)(E),width:(0,ei.$Z)(Math.max(1,2*L)),cursor:g?(0,eK.L)("ew-resize",t):void 0,events:l}),(0,et.jsx)(ResizeHandle,{hide:eu,dataTestId:"selection.resize.bottom",ariaLabel:r("handle.resize-bottom"),x:0,y:(0,ei.$Z)(E-(D?0:N)),width:(0,ei.$Z)(C),height:(0,ei.$Z)(Math.max(1,2*N)),cursor:g?(0,eK.L)("ns-resize",t):void 0,events:d}),(0,et.jsx)(ResizeHandle,{hide:ep,dataTestId:"selection.resize.left",ariaLabel:r("handle.resize-left"),x:(0,ei.$Z)(0-(j?2*L:L)),y:0,height:(0,ei.$Z)(E),width:(0,ei.$Z)(Math.max(1,2*L)),cursor:g?(0,eK.L)("ew-resize",t):void 0,events:c}),(0,et.jsx)(ResizeHandle,{hide:es,dataTestId:"selection.target.top-left",ariaLabel:r("handle.resize-top-left"),x:(0,ei.$Z)(0-(j?2*L:1.5*L)),y:(0,ei.$Z)(0-(D?2*N:1.5*N)),width:(0,ei.$Z)(3*L),height:(0,ei.$Z)(3*N),cursor:g?(0,eK.L)("nwse-resize",t):void 0,events:u}),(0,et.jsx)(ResizeHandle,{hide:el,dataTestId:"selection.target.top-right",ariaLabel:r("handle.resize-top-right"),x:(0,ei.$Z)(C-(j?0:1.5*L)),y:(0,ei.$Z)(0-(D?2*N:1.5*N)),width:(0,ei.$Z)(3*L),height:(0,ei.$Z)(3*N),cursor:g?(0,eK.L)("nesw-resize",t):void 0,events:h}),(0,et.jsx)(ResizeHandle,{hide:ec,dataTestId:"selection.target.bottom-right",ariaLabel:r("handle.resize-bottom-right"),x:(0,ei.$Z)(C-(j?L:1.5*L)),y:(0,ei.$Z)(E-(D?N:1.5*N)),width:(0,ei.$Z)(3*L),height:(0,ei.$Z)(3*N),cursor:g?(0,eK.L)("nwse-resize",t):void 0,events:p}),(0,et.jsx)(ResizeHandle,{hide:ed,dataTestId:"selection.target.bottom-left",ariaLabel:r("handle.resize-bottom-left"),x:(0,ei.$Z)(0-(j?3*L:1.5*L)),y:(0,ei.$Z)(E-(D?0:1.5*N)),width:(0,ei.$Z)(3*L),height:(0,ei.$Z)(3*N),cursor:g?(0,eK.L)("nesw-resize",t):void 0,events:f}),Y&&(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("rect",{"data-testid":"selection.resize.top-left",className:eh("tl-corner-handle",{"tl-hidden":es}),x:(0,ei.$Z)(0-M/2),y:(0,ei.$Z)(0-M/2),width:(0,ei.$Z)(M),height:(0,ei.$Z)(M)}),(0,et.jsx)("rect",{"data-testid":"selection.resize.top-right",className:eh("tl-corner-handle",{"tl-hidden":el}),x:(0,ei.$Z)(C-M/2),y:(0,ei.$Z)(0-M/2),width:(0,ei.$Z)(M),height:(0,ei.$Z)(M)}),(0,et.jsx)("rect",{"data-testid":"selection.resize.bottom-right",className:eh("tl-corner-handle",{"tl-hidden":ec}),x:(0,ei.$Z)(C-M/2),y:(0,ei.$Z)(E-M/2),width:(0,ei.$Z)(M),height:(0,ei.$Z)(M)}),(0,et.jsx)("rect",{"data-testid":"selection.resize.bottom-left",className:eh("tl-corner-handle",{"tl-hidden":ed}),x:(0,ei.$Z)(0-M/2),y:(0,ei.$Z)(E-M/2),width:(0,ei.$Z)(M),height:(0,ei.$Z)(M)})]}),eg&&(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle",x:(0,ei.$Z)(0-M/4),y:(0,ei.$Z)(E/2-ef/2),rx:M/4,width:(0,ei.$Z)(M/2),height:(0,ei.$Z)(ef)}),(0,et.jsx)("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle",rx:M/4,x:(0,ei.$Z)(C-M/4),y:(0,ei.$Z)(E/2-ef/2),width:(0,ei.$Z)(M/2),height:(0,ei.$Z)(ef)})]}),G&&(0,et.jsx)(TldrawCropHandles,{size:M,width:C,height:E,hideAlternateHandles:ee})]})})}),ResizeHandle=function({hide:e,dataTestId:t,ariaLabel:n,x:r,y:i,width:o,height:a,cursor:l,events:d}){return(0,et.jsx)("rect",{className:eh("tl-resize-handle","tl-transparent",{"tl-hidden":e}),"data-testid":t,role:"button","aria-label":n,pointerEvents:"all",x:r,y:i,width:o,height:a,cursor:l,...d})},RotateCornerHandle=function({cx:e,cy:t,targetSize:n,corner:r,cursor:i,isHidden:o,"data-testid":a}){let l=useSelectionEvents(r),d=useTranslation(),c=d(`handle.rotate.${r}`);return(0,et.jsx)("rect",{className:eh("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":a,role:"button","aria-label":c,pointerEvents:"all",x:(0,ei.$Z)(e-3*n),y:(0,ei.$Z)(t-3*n),width:(0,ei.$Z)(Math.max(1,3*n)),height:(0,ei.$Z)(Math.max(1,3*n)),cursor:i,...l})},rZ=Math.sqrt(Math.PI),MobileRotateHandle=function({cx:e,cy:t,size:n,isHidden:r,"data-testid":i}){let o=useSelectionEvents("mobile_rotate"),a=(0,eW.jE)(),l=(0,O.Hg)("zoom level",()=>a.getZoomLevel(),[a]),d=useTranslation();return(0,et.jsxs)("g",{role:"button","aria-label":d("handle.rotate.mobile_rotate"),children:[(0,et.jsx)("circle",{"data-testid":i,pointerEvents:"all",className:eh("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":r}),cx:e,cy:t,r:Math.max(14*(1/l),20/Math.max(1,l)),...o}),(0,et.jsx)("circle",{className:eh("tl-mobile-rotate__fg",{"tl-hidden":r}),cx:e,cy:t,r:n/rZ})]})};function TldrawShapeIndicators(){let e=(0,eW.jE)(),t=(0,O.Hg)("is in a valid select state",()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[e]);return(0,et.jsx)(es.N,{hideAll:!t})}let rq=[ArrowBindingUtil];function getDefaultCrop(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}let rY=["original","square","circle","landscape","portrait","wide"],rX={original:0,square:1,circle:1,landscape:4/3,portrait:3/4,wide:16/9};function getUncroppedSize(e,t){if(!t)return{w:e.w,h:e.h};let n=e.w/(t.bottomRight.x-t.topLeft.x),r=e.h/(t.bottomRight.y-t.topLeft.y);return{w:n,h:r}}function getCropDimensions(e){return{width:e.bottomRight.x-e.topLeft.x,height:e.bottomRight.y-e.topLeft.y}}function getCropCenter(e){let{width:t,height:n}=getCropDimensions(e);return{x:e.topLeft.x+t/2,y:e.topLeft.y+n/2}}function createCropAroundCenter(e,t,n,r,i){let o=Math.max(0,Math.min(1-n,e-n/2)),a=Math.max(0,Math.min(1-r,t-r/2));return{topLeft:{x:o,y:a},bottomRight:{x:o+n,y:a+r},isCircle:i}}function getCropBox(e,t,n={}){let{handle:r,change:i,crop:o,aspectRatioLocked:a}=t,{w:l,h:d}=t.uncroppedSize,{minWidth:c=8,minHeight:u=8}=n;if(l<c||d<u||0===i.x&&0===i.y)return;let h=new e9.xu(o.topLeft.x*l,o.topLeft.y*d,(o.bottomRight.x-o.topLeft.x)*l,(o.bottomRight.y-o.topLeft.y)*d),p=h.aspectRatio,f=h.clone();if("top_left"===r||"bottom_left"===r||"left"===r)f.x=(0,ei.uZ)(f.x+i.x,0,h.maxX-c),f.w=h.maxX-f.x;else if("top_right"===r||"bottom_right"===r||"right"===r){let e=(0,ei.uZ)(f.maxX+i.x,h.x+c,l);f.w=e-f.x}if("top_left"===r||"top_right"===r||"top"===r)f.y=(0,ei.uZ)(f.y+i.y,0,h.maxY-u),f.h=h.maxY-f.y;else if("bottom_left"===r||"bottom_right"===r||"bottom"===r){let e=(0,ei.uZ)(f.maxY+i.y,h.y+u,d);f.h=e-f.y}if(a){let e=f.aspectRatio>p;switch(e?f.h=f.w/p:f.w=f.h*p,r){case"top_left":f.x=h.maxX-f.w,f.y=h.maxY-f.h,f.x<=0&&(f.x=0,f.w=h.maxX-f.x,f.h=f.w/p,f.y=h.maxY-f.h),f.y<=0&&(f.y=0,f.h=h.maxY-f.y,f.w=f.h*p,f.x=h.maxX-f.w);break;case"top_right":f.x=h.x,f.y=h.maxY-f.h,f.maxX>=l&&(f.w=l-h.x,f.h=f.w/p,f.y=h.maxY-f.h),f.y<=0&&(f.y=0,f.h=h.maxY-f.y,f.w=f.h*p);break;case"bottom_left":f.x=h.maxX-f.w,f.y=h.y,f.x<=0&&(f.x=0,f.w=h.maxX-f.x,f.h=f.w/p),f.maxY>=d&&(f.h=d-h.y,f.w=f.h*p,f.x=h.maxX-f.w);break;case"bottom_right":f.x=h.x,f.y=h.y,f.maxX>=l&&(f.w=l-h.x,f.h=f.w/p),f.maxY>=d&&(f.h=d-h.y,f.w=f.h*p);break;case"top":if(f.h=h.maxY-f.y,f.w=f.h*p,f.x-=(f.w-h.w)/2,f.x<=0){let e=h.midX;f.w=2*e,f.h=f.w/p,f.x=0}if(f.maxX>=l){let e=l-h.midX;f.w=2*e,f.h=f.w/p,f.x=l-f.w}f.y=h.maxY-f.h;break;case"right":if(f.w=f.maxX-h.x,f.h=f.w/p,f.y-=(f.h-h.h)/2,f.y<=0){let e=h.midY;f.h=2*e,f.w=f.h*p,f.y=0}if(f.maxY>=d){let e=d-h.midY;f.h=2*e,f.w=f.h*p,f.y=d-f.h}break;case"bottom":if(f.h=f.maxY-h.y,f.w=f.h*p,f.x-=(f.w-h.w)/2,f.x<=0){let e=h.midX;f.w=2*e,f.h=f.w/p,f.x=0}if(f.maxX>=l){let e=l-h.midX;f.w=2*e,f.h=f.w/p,f.x=l-f.w}break;case"left":if(f.w=h.maxX-f.x,f.h=f.w/p,f.y-=(f.h-h.h)/2,f.y<=0){let e=h.midY;f.h=2*e,f.w=f.h*p,f.y=0}if(f.maxY>=d){let e=d-h.midY;f.h=2*e,f.w=f.h*p,f.y=d-f.h}f.x=h.maxX-f.w}}let g={topLeft:{x:f.x/l,y:f.y/d},bottomRight:{x:f.maxX/l,y:f.maxY/d},isCircle:o.isCircle};if(g.topLeft.x===o.topLeft.x&&g.topLeft.y===o.topLeft.y&&g.bottomRight.x===o.bottomRight.x&&g.bottomRight.y===o.bottomRight.y)return;let m=new eF.B(f.x-o.topLeft.x*l,f.y-o.topLeft.y*d).rot(e.rotation).add(e);return{id:e.id,type:e.type,x:m.x,y:m.y,props:{w:f.w,h:f.h,crop:g}}}let rJ={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},rQ={s:2,m:3.5,l:5,xl:10},r0={s:18,m:24,l:36,xl:44},r1={s:18,m:22,l:26,xl:32},r2={s:18,m:20,l:24,xl:28},r3={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};function containBoxSize(e,t){let n=e.w/t.w,r=e.h/t.h;return n<=1&&r<=1?e:n>r?{w:e.w/n,h:e.h/n}:{w:e.w/r,h:e.h/r}}async function downsizeImage(e,t,n,r={}){let{w:i,h:o,image:a}=await B.xe.usingObjectURL(e,B.xe.getImageAndDimensions),{type:l=e.type,quality:d=.85}=r,[c,u]=(0,tf.E)(Math.min(2*t,i),Math.min(2*n,o)),h=document.createElement("canvas");h.width=c,h.height=u;let p=(0,B.kP)(h.getContext("2d",{willReadFrequently:!0}),"Could not get canvas context");return p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.drawImage(a,0,0,c,u),new Promise((e,t)=>{h.toBlob(n=>{n?e(n):t(Error("Could not resize image"))},l,d)})}async function putExcalidrawContent(e,t,n){let{elements:r,files:i}=t,o={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:e.store.schema.serialize()},a=new Map,l=new Map,d=e.getCurrentPageId(),c=new Map,u=[],h=new Set;r.forEach(e=>{if(c.set(e.id,(0,L.F1)()),null!==e.boundElements)for(let t of e.boundElements)"text"===t.type&&h.add(t.id)});let p=B.R4;for(let e of r){if(h.has(e.id))continue;let t=c.get(e.id),n={id:t,typeName:"shape",parentId:d,index:p,x:e.x,y:e.y,rotation:0,isLocked:e.locked,opacity:getOpacity(e.opacity),meta:{}};switch(0!==e.angle&&l.set(t,e.angle),e.groupIds&&e.groupIds.length>0?a.has(e.groupIds[0])?a.get(e.groupIds[0])?.push(t):a.set(e.groupIds[0],[t]):u.push(t),e.type){case"rectangle":case"ellipse":case"diamond":{let t="",i="middle";if(null!==e.boundElements){for(let n of e.boundElements)if("text"===n.type){let e=r.find(e=>e.id===n.id);e&&(t=e.text,i=it[e.textAlign])}}let a="transparent"===e.backgroundColor?e.strokeColor:e.backgroundColor;o.shapes.push({...n,type:"geo",props:{geo:e.type,url:e.link??"",w:e.width,h:e.height,size:r5[e.strokeWidth]??"draw",color:r8[a]??"black",richText:(0,L.Ak)(t),align:i,dash:getDash(e),fill:getFill(e)}});break}case"freedraw":o.shapes.push({...n,type:"draw",props:{dash:getDash(e),size:r5[e.strokeWidth],color:r8[e.strokeColor]??"black",segments:[{type:"free",points:e.points.map(([e,t,n=.5])=>({x:e,y:t,z:n}))}]}});break;case"line":{let t=e.points.slice();if(t.length<2)break;let r=(0,B.H$)(e.points.length);o.shapes.push({...n,type:"line",props:{dash:getDash(e),size:r5[e.strokeWidth],color:r8[e.strokeColor]??"black",spline:e.roundness?"cubic":"line",points:{...Object.fromEntries(e.points.map(([e,t],n)=>{let i=r[n];return[i,{id:i,index:i,x:e,y:t}]}))}}});break}case"arrow":{let i="";if(null!==e.boundElements){for(let t of e.boundElements)if("text"===t.type){let e=r.find(e=>e.id===t.id);e&&(i=e.text)}}let a=e.points[0],l=e.points[e.points.length-1],d=c.get(e.startBinding?.elementId),u=c.get(e.endBinding?.elementId);o.shapes.push({...n,type:"arrow",props:{text:i,kind:e.elbowed?"elbow":"arc",bend:function(e,t,n){let r=0;if(e.points.length>2){let i=new eF.B(t[0],t[1]),o=new eF.B(n[0],n[1]),a=new eF.B(e.points[1][0],e.points[1][1]),l=eF.B.Sub(o,i),d=eF.B.Per(l),c=eF.B.Med(o,i),u=eF.B.Sub(c,d),h=eF.B.Add(c,d),p=eF.B.NearestPointOnLineSegment(u,h,a,!1);r=eF.B.Dist(p,c),eF.B.Clockwise(p,o,c)&&(r*=-1)}return r}(e,a,l),dash:getDash(e),size:r5[e.strokeWidth]??"m",color:r8[e.strokeColor]??"black",start:{x:a[0],y:a[1]},end:{x:l[0],y:l[1]},arrowheadEnd:ii[e.endArrowhead]??"none",arrowheadStart:ii[e.startArrowhead]??"none"}}),d&&o.bindings.push({id:(0,L.vI)(),typeName:"binding",type:"arrow",fromId:t,toId:d,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),u&&o.bindings.push({id:(0,L.vI)(),typeName:"binding",type:"arrow",fromId:t,toId:u,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{let{size:t,scale:r}=function(e){let t=r4[e];return t?{size:t,scale:1}:e<16?{size:"s",scale:e/16}:e>36?{size:"xl",scale:e/36}:{size:"m",scale:1}}(e.fontSize);o.shapes.push({...n,type:"text",props:{size:t,scale:r,font:r6[e.fontFamily]??"draw",color:r8[e.strokeColor]??"black",richText:(0,L.Ak)(e.text),textAlign:ir[e.textAlign]}});break}case"image":{let t=i[e.fileId];if(!t)break;let r=L.Yk.createId();o.assets.push({id:r,typeName:"asset",type:"image",props:{w:e.width,h:e.height,fileSize:t.size,name:e.id??"Untitled",isAnimated:!1,mimeType:t.mimeType,src:t.dataURL},meta:{}}),o.shapes.push({...n,type:"image",props:{w:e.width,h:e.height,assetId:r}})}}p=(0,B._L)(p)}let f=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);for(let t of(e.putContentOntoCurrentPage(o,{point:f,select:!1,preserveIds:!0}),a.values()))if(t.length>1){e.groupShapes(t);let n=e.getShape(t[0]);n?.parentId&&(0,L.YT)(n.parentId)&&u.push(n.parentId)}for(let[t,n]of l)e.select(t),e.rotateShapesBy([t],n);let g=(0,B.oA)(u.map(t=>e.getShape(t))),m=e9.xu.Common(g.map(t=>e.getShapePageBounds(t))),y=e.getViewportPageBounds().center;e.updateShapes(g.map(e=>{let t={x:(e.x??0)-(m.x+m.w/2),y:(e.y??0)-(m.y+m.h/2)};return{id:e.id,type:e.type,x:y.x+t.x,y:y.y+t.y}})),e.setSelectedShapes(u)}let getOpacity=e=>{let t=e/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},r5={1:"s",2:"m",3:"l",4:"xl"},r4={16:"s",20:"m",28:"l",36:"xl"},r6={1:"draw",2:"sans",3:"mono"},r7={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function mapExcalidrawColorToTldrawColors(e,t,n){let r=[0,1,2,3,4].map(t=>r7[e][t]);return Object.fromEntries(r.map((e,r)=>[e,r<3?t:n]))}let r8={...mapExcalidrawColorToTldrawColors("gray","grey","black"),...mapExcalidrawColorToTldrawColors("red","light-red","red"),...mapExcalidrawColorToTldrawColors("pink","light-red","red"),...mapExcalidrawColorToTldrawColors("grape","light-violet","violet"),...mapExcalidrawColorToTldrawColors("blue","light-blue","blue"),...mapExcalidrawColorToTldrawColors("cyan","light-blue","blue"),...mapExcalidrawColorToTldrawColors("teal","light-green","green"),...mapExcalidrawColorToTldrawColors("green","light-green","green"),...mapExcalidrawColorToTldrawColors("yellow","yellow","orange"),...mapExcalidrawColorToTldrawColors("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},r9={solid:"draw",dashed:"dashed",dotted:"dotted"},ie={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},it={left:"start",center:"middle",right:"end"},ir={left:"start",center:"middle",right:"end"},ii={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"},getDash=e=>{let t=r9[e.strokeStyle]??"draw";return"draw"===t&&0===e.roughness&&(t="solid"),t},getFill=e=>"transparent"===e.backgroundColor?"none":ie[e.fillStyle]??"solid",io=/(^|[^`])`([^`]+)`(?!`)/,ia=/(^|[^`])`([^`]+)`(?!`)/g,is=tT.vc.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:e}){return["code",(0,tT.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[(0,tT.Cf)({find:io,type:this.type})]},addPasteRules(){return[(0,tT.K9)({find:ia,type:this.type})]}}),il=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,id=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,ic=tT.vc.create({name:"highlight",addOptions:()=>({multicolor:!1,HTMLAttributes:{}}),addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:e=>e.getAttribute("data-color")||e.style.backgroundColor,renderHTML:e=>e.color?{"data-color":e.color,style:`background-color: ${e.color}; color: inherit`}:{}}}:{}},parseHTML:()=>[{tag:"mark"}],renderHTML({HTMLAttributes:e}){return["mark",(0,tT.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setHighlight:e=>({commands:t})=>t.setMark(this.name,e),toggleHighlight:e=>({commands:t})=>t.toggleMark(this.name,e),unsetHighlight:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[(0,tT.Cf)({find:il,type:this.type})]},addPasteRules(){return[(0,tT.K9)({find:id,type:this.type})]}}),linkify_es_assign=(e,t)=>{for(let n in t)e[n]=t[n];return e},iu="numeric",ih="ascii",ip="alpha",ig="asciinumeric",im="alphanumeric",iy="domain",ib="emoji",ix="whitespace";function addToGroups(e,t,n){for(let r in t[iu]&&(t[ig]=!0,t[im]=!0),t[ih]&&(t[ig]=!0,t[ip]=!0),t[ig]&&(t[im]=!0),t[ip]&&(t[im]=!0),t[im]&&(t[iy]=!0),t[ib]&&(t[iy]=!0),t){let t=(r in n||(n[r]=[]),n[r]);0>t.indexOf(e)&&t.push(e)}}function State(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}State.groups={},State.prototype={accepts(){return!!this.t},go(e){let t=this.j[e];if(t)return t;for(let t=0;t<this.jr.length;t++){let n=this.jr[t][0],r=this.jr[t][1];if(r&&n.test(e))return r}return this.jd},has(e,t=!1){return t?e in this.j:!!this.go(e)},ta(e,t,n,r){for(let i=0;i<e.length;i++)this.tt(e[i],t,n,r)},tr(e,t,n,r){let i;return r=r||State.groups,t&&t.j?i=t:(i=new State(t),n&&r&&addToGroups(t,n,r)),this.jr.push([e,i]),i},ts(e,t,n,r){let i=this,o=e.length;if(!o)return i;for(let t=0;t<o-1;t++)i=i.tt(e[t]);return i.tt(e[o-1],t,n,r)},tt(e,t,n,r){if(r=r||State.groups,t&&t.j)return this.j[e]=t,t;let i,o=this.go(e);if(o?(linkify_es_assign((i=new State).j,o.j),i.jr.push.apply(i.jr,o.jr),i.jd=o.jd,i.t=o.t):i=new State,t){if(r){if(i.t&&"string"==typeof i.t){let e=linkify_es_assign(function(e,t){let n={};for(let r in t)t[r].indexOf(e)>=0&&(n[r]=!0);return n}(i.t,r),n);addToGroups(t,e,r)}else n&&addToGroups(t,n,r)}i.t=t}return this.j[e]=i,i}};let ta=(e,t,n,r,i)=>e.ta(t,n,r,i),tr=(e,t,n,r,i)=>e.tr(t,n,r,i),ts=(e,t,n,r,i)=>e.ts(t,n,r,i),tt=(e,t,n,r,i)=>e.tt(t,n,r,i),iw="WORD",iS="UWORD",iv="ASCIINUMERICAL",iT="ALPHANUMERICAL",ik="LOCALHOST",i_="UTLD",iC="SCHEME",iI="SLASH_SCHEME",iE="OPENBRACE",iM="CLOSEBRACE",iP="OPENBRACKET",iA="CLOSEBRACKET",ij="OPENPAREN",iD="CLOSEPAREN",iB="OPENANGLEBRACKET",iF="CLOSEANGLEBRACKET",iO="FULLWIDTHLEFTPAREN",iR="FULLWIDTHRIGHTPAREN",iL="LEFTCORNERBRACKET",iU="RIGHTCORNERBRACKET",iN="LEFTWHITECORNERBRACKET",iz="RIGHTWHITECORNERBRACKET",iH="FULLWIDTHLESSTHAN",i$="FULLWIDTHGREATERTHAN",iV="AMPERSAND",iG="APOSTROPHE",iK="ASTERISK",iW="BACKSLASH",iZ="BACKTICK",iq="CARET",iY="COLON",iX="COMMA",iJ="DOLLAR",iQ="EQUALS",i0="EXCLAMATION",i1="HYPHEN",i2="PERCENT",i3="PIPE",i5="PLUS",i4="POUND",i6="QUERY",i7="QUOTE",i8="FULLWIDTHMIDDLEDOT",i9="SEMI",oe="SLASH",ot="TILDE",on="UNDERSCORE",oi="EMOJI";var oo=Object.freeze({__proto__:null,WORD:iw,UWORD:iS,ASCIINUMERICAL:iv,ALPHANUMERICAL:iT,LOCALHOST:ik,TLD:"TLD",UTLD:i_,SCHEME:iC,SLASH_SCHEME:iI,NUM:"NUM",WS:"WS",NL:"NL",OPENBRACE:iE,CLOSEBRACE:iM,OPENBRACKET:iP,CLOSEBRACKET:iA,OPENPAREN:ij,CLOSEPAREN:iD,OPENANGLEBRACKET:iB,CLOSEANGLEBRACKET:iF,FULLWIDTHLEFTPAREN:iO,FULLWIDTHRIGHTPAREN:iR,LEFTCORNERBRACKET:iL,RIGHTCORNERBRACKET:iU,LEFTWHITECORNERBRACKET:iN,RIGHTWHITECORNERBRACKET:iz,FULLWIDTHLESSTHAN:iH,FULLWIDTHGREATERTHAN:i$,AMPERSAND:iV,APOSTROPHE:iG,ASTERISK:iK,AT:"AT",BACKSLASH:iW,BACKTICK:iZ,CARET:iq,COLON:iY,COMMA:iX,DOLLAR:iJ,DOT:"DOT",EQUALS:iQ,EXCLAMATION:i0,HYPHEN:i1,PERCENT:i2,PIPE:i3,PLUS:i5,POUND:i4,QUERY:i6,QUOTE:i7,FULLWIDTHMIDDLEDOT:i8,SEMI:i9,SLASH:oe,TILDE:ot,UNDERSCORE:on,EMOJI:oi,SYM:"SYM"});let oa=/[a-z]/,ol=/\p{L}/u,od=/\p{Emoji}/u,oc=/\d/,ou=/\s/,oh=null,op=null;function run$1(e,t){let n=function(e){let t=[],n=e.length,r=0;for(;r<n;){let i,o=e.charCodeAt(r),a=o<55296||o>56319||r+1===n||(i=e.charCodeAt(r+1))<56320||i>57343?e[r]:e.slice(r,r+2);t.push(a),r+=a.length}return t}(t.replace(/[A-Z]/g,e=>e.toLowerCase())),r=n.length,i=[],o=0,a=0;for(;a<r;){let l=e,d=null,c=0,u=null,h=-1,p=-1;for(;a<r&&(d=l.go(n[a]));)(l=d).accepts()?(h=0,p=0,u=l):h>=0&&(h+=n[a].length,p++),c+=n[a].length,o+=n[a].length,a++;o-=h,a-=p,c-=h,i.push({t:u.t,v:t.slice(o-c,o),s:o-c,e:o})}return i}function fastts(e,t,n,r,i){let o;let a=t.length;for(let n=0;n<a-1;n++){let a=t[n];e.j[a]?o=e.j[a]:((o=new State(r)).jr=i.slice(),e.j[a]=o),e=o}return(o=new State(n)).jr=i.slice(),e.j[t[a-1]]=o,o}function decodeTlds(e){let t=[],n=[],r=0;for(;r<e.length;){let i=0;for(;"0123456789".indexOf(e[r+i])>=0;)i++;if(i>0){t.push(n.join(""));for(let t=parseInt(e.substring(r,r+i),10);t>0;t--)n.pop();r+=i}else n.push(e[r]),r++}return t}let of={defaultProtocol:"http",events:null,format:noop,formatHref:noop,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Options(e,t=null){let n=linkify_es_assign({},of);e&&(n=linkify_es_assign(n,e instanceof Options?e.o:e));let r=n.ignoreTags,i=[];for(let e=0;e<r.length;e++)i.push(r[e].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=i}function noop(e){return e}function MultiToken(e,t){this.t="token",this.v=e,this.tk=t}function createTokenClass(e,t){let Token=class Token extends MultiToken{constructor(t,n){super(t,n),this.t=e}};for(let e in t)Token.prototype[e]=t[e];return Token.t=e,Token}Options.prototype={o:of,ignoreTags:[],defaultRender:e=>e,check(e){return this.get("validate",e.toString(),e)},get(e,t,n){let r=null!=t,i=this.o[e];return i&&("object"==typeof i?"function"==typeof(i=n.t in i?i[n.t]:of[e])&&r&&(i=i(t,n)):"function"==typeof i&&r&&(i=i(t,n.t,n))),i},getObj(e,t,n){let r=this.o[e];return"function"==typeof r&&null!=t&&(r=r(t,n.t,n)),r},render(e){let t=e.render(this),n=this.get("render",null,e)||this.defaultRender;return n(t,e.t,e)}},MultiToken.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){let t=this.toString(),n=e.get("truncate",t,this),r=e.get("format",t,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=of.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){let t=this.toHref(e.get("defaultProtocol")),n=e.get("formatHref",t,this),r=e.get("tagName",t,this),i=this.toFormattedString(e),o={},a=e.get("className",t,this),l=e.get("target",t,this),d=e.get("rel",t,this),c=e.getObj("attributes",t,this),u=e.getObj("events",t,this);return o.href=n,a&&(o.class=a),l&&(o.target=l),d&&(o.rel=d),c&&linkify_es_assign(o,c),{tagName:r,attributes:o,content:i,eventListeners:u}}};let og=createTokenClass("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),om=createTokenClass("text"),oy=createTokenClass("nl"),ob=createTokenClass("url",{isLink:!0,toHref(e=of.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){let e=this.tk;return e.length>=2&&e[0].t!==ik&&e[1].t===iY}}),makeState=e=>new State(e);function initMultiToken(e,t,n){let r=n[0].s,i=n[n.length-1].e,o=t.slice(r,i);return new e(o,n)}let ox="undefined"!=typeof console&&console&&console.warn||(()=>{}),ow={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function registerCustomProtocol(e,t=!1){if(ow.initialized&&ox(`linkifyjs: already initialized - will not register custom scheme "${e}" until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(e))throw Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);ow.customSchemes.push([e,t])}function tokenize(e){return ow.initialized||function(){ow.scanner=function(e=[]){let t={};State.groups=t;let n=new State;null==oh&&(oh=decodeTlds("aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2ntley5rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6logistics9properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3ncaster6d0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2psy3ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5m\xf6gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2")),null==op&&(op=decodeTlds("121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222")),tt(n,"'",iG),tt(n,"{",iE),tt(n,"}",iM),tt(n,"[",iP),tt(n,"]",iA),tt(n,"(",ij),tt(n,")",iD),tt(n,"<",iB),tt(n,">",iF),tt(n,"",iO),tt(n,"",iR),tt(n,"",iL),tt(n,"",iU),tt(n,"",iN),tt(n,"",iz),tt(n,"",iH),tt(n,"",i$),tt(n,"&",iV),tt(n,"*",iK),tt(n,"@","AT"),tt(n,"`",iZ),tt(n,"^",iq),tt(n,":",iY),tt(n,",",iX),tt(n,"$",iJ),tt(n,".","DOT"),tt(n,"=",iQ),tt(n,"!",i0),tt(n,"-",i1),tt(n,"%",i2),tt(n,"|",i3),tt(n,"+",i5),tt(n,"#",i4),tt(n,"?",i6),tt(n,'"',i7),tt(n,"/",oe),tt(n,";",i9),tt(n,"~",ot),tt(n,"_",on),tt(n,"\\",iW),tt(n,"",i8);let r=tr(n,oc,"NUM",{[iu]:!0});tr(r,oc,r);let i=tr(r,oa,iv,{[ig]:!0}),o=tr(r,ol,iT,{[im]:!0}),a=tr(n,oa,iw,{[ih]:!0});tr(a,oc,i),tr(a,oa,a),tr(i,oc,i),tr(i,oa,i);let l=tr(n,ol,iS,{[ip]:!0});tr(l,oa),tr(l,oc,o),tr(l,ol,l),tr(o,oc,o),tr(o,oa),tr(o,ol,o);let d=tt(n,"\n","NL",{[ix]:!0}),c=tt(n,"\r","WS",{[ix]:!0}),u=tr(n,ou,"WS",{[ix]:!0});tt(n,"",u),tt(c,"\n",d),tt(c,"",u),tr(c,ou,u),tt(u,"\r"),tt(u,"\n"),tr(u,ou,u),tt(u,"",u);let h=tr(n,od,oi,{[ib]:!0});tt(h,"#"),tr(h,od,h),tt(h,"",h);let p=tt(h,"");tt(p,"#"),tr(p,od,h);let f=[[oa,a],[oc,i]],g=[[oa,null],[ol,l],[oc,o]];for(let e=0;e<oh.length;e++)fastts(n,oh[e],"TLD",iw,f);for(let e=0;e<op.length;e++)fastts(n,op[e],i_,iS,g);addToGroups("TLD",{tld:!0,ascii:!0},t),addToGroups(i_,{utld:!0,alpha:!0},t),fastts(n,"file",iC,iw,f),fastts(n,"mailto",iC,iw,f),fastts(n,"http",iI,iw,f),fastts(n,"https",iI,iw,f),fastts(n,"ftp",iI,iw,f),fastts(n,"ftps",iI,iw,f),addToGroups(iC,{scheme:!0,ascii:!0},t),addToGroups(iI,{slashscheme:!0,ascii:!0},t),e=e.sort((e,t)=>e[0]>t[0]?1:-1);for(let t=0;t<e.length;t++){let r=e[t][0],i=e[t][1],o=i?{scheme:!0}:{slashscheme:!0};r.indexOf("-")>=0?o[iy]=!0:oa.test(r)?oc.test(r)?o[ig]=!0:o[ih]=!0:o[iu]=!0,ts(n,r,r,o)}return ts(n,"localhost",ik,{ascii:!0}),n.jd=new State("SYM"),{start:n,tokens:linkify_es_assign({groups:t},oo)}}(ow.customSchemes);for(let e=0;e<ow.tokenQueue.length;e++)ow.tokenQueue[e][1]({scanner:ow.scanner});ow.parser=function({groups:e}){let t=e.domain.concat([iV,iK,"AT",iW,iZ,iq,iJ,iQ,i1,"NUM",i2,i3,i5,i4,oe,"SYM",ot,on]),n=[iY,iX,"DOT",i0,i2,i6,i7,i9,iB,iF,iE,iM,iA,iP,ij,iD,iO,iR,iL,iU,iN,iz,iH,i$],r=[iV,iG,iK,iW,iZ,iq,iJ,iQ,i1,iE,iM,i2,i3,i5,i4,i6,oe,"SYM",ot,on],i=makeState(),o=tt(i,ot);ta(o,r,o),ta(o,e.domain,o);let a=makeState(),l=makeState(),d=makeState();ta(i,e.domain,a),ta(i,e.scheme,l),ta(i,e.slashscheme,d),ta(a,r,o),ta(a,e.domain,a);let c=tt(a,"AT");tt(o,"AT",c),tt(l,"AT",c),tt(d,"AT",c);let u=tt(o,"DOT");ta(u,r,o),ta(u,e.domain,o);let h=makeState();ta(c,e.domain,h),ta(h,e.domain,h);let p=tt(h,"DOT");ta(p,e.domain,h);let f=makeState(og);ta(p,e.tld,f),ta(p,e.utld,f),tt(c,ik,f);let g=tt(h,i1);tt(g,i1,g),ta(g,e.domain,h),ta(f,e.domain,h),tt(f,"DOT",p),tt(f,i1,g);let m=tt(f,iY);ta(m,e.numeric,og);let y=tt(a,i1),b=tt(a,"DOT");tt(y,i1,y),ta(y,e.domain,a),ta(b,r,o),ta(b,e.domain,a);let S=makeState(ob);ta(b,e.tld,S),ta(b,e.utld,S),ta(S,e.domain,a),ta(S,r,o),tt(S,"DOT",b),tt(S,i1,y),tt(S,"AT",c);let v=tt(S,iY),k=makeState(ob);ta(v,e.numeric,k);let _=makeState(ob),C=makeState();ta(_,t,_),ta(_,n,C),ta(C,t,_),ta(C,n,C),tt(S,oe,_),tt(k,oe,_);let E=tt(l,iY),M=tt(d,iY),P=tt(M,oe),A=tt(P,oe);ta(l,e.domain,a),tt(l,"DOT",b),tt(l,i1,y),ta(d,e.domain,a),tt(d,"DOT",b),tt(d,i1,y),ta(E,e.domain,_),tt(E,oe,_),tt(E,i6,_),ta(A,e.domain,_),ta(A,t,_),tt(A,oe,_);let j=[[iE,iM],[iP,iA],[ij,iD],[iB,iF],[iO,iR],[iL,iU],[iN,iz],[iH,i$]];for(let e=0;e<j.length;e++){let[r,i]=j[e],o=tt(_,r);tt(C,r,o),tt(o,i,_);let a=makeState(ob);ta(o,t,a);let l=makeState();ta(o,n),ta(a,t,a),ta(a,n,l),ta(l,t,a),ta(l,n,l),tt(a,i,_),tt(l,i,_)}return tt(i,ik,S),tt(i,"NL",oy),{start:i,tokens:oo}}(ow.scanner.tokens);for(let e=0;e<ow.pluginQueue.length;e++)ow.pluginQueue[e][1]({scanner:ow.scanner,parser:ow.parser});ow.initialized=!0}(),function(e,t,n){let r=n.length,i=0,o=[],a=[];for(;i<r;){let l=e,d=null,c=null,u=0,h=null,p=-1;for(;i<r&&!(d=l.go(n[i].t));)a.push(n[i++]);for(;i<r&&(c=d||l.go(n[i].t));)d=null,(l=c).accepts()?(p=0,h=l):p>=0&&p++,i++,u++;if(p<0)(i-=u)<r&&(a.push(n[i]),i++);else{a.length>0&&(o.push(initMultiToken(om,t,a)),a=[]),i-=p,u-=p;let e=h.t,r=n.slice(i-u,i);o.push(initMultiToken(e,t,r))}}return a.length>0&&o.push(initMultiToken(om,t,a)),o}(ow.parser.start,e,run$1(ow.scanner.start,e))}function find(e,t=null,n=null){if(t&&"object"==typeof t){if(n)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);n=t,t=null}let r=new Options(n),i=tokenize(e),o=[];for(let e=0;e<i.length;e++){let n=i[e];n.isLink&&(!t||n.t===t)&&r.check(n)&&o.push(n.toFormattedObject(r))}return o}tokenize.scan=run$1;var oS=n(87789);let ov=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g;function isAllowedUri(e,t){let n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach(e=>{let t="string"==typeof e?e:e.scheme;t&&n.push(t)}),!e||e.replace(ov,"").match(RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}let oT=tT.vc.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(e=>{if("string"==typeof e){registerCustomProtocol(e);return}registerCustomProtocol(e.scheme,e.optionalSlashes)})},onDestroy(){State.groups={},ow.scanner=null,ow.parser=null,ow.tokenQueue=[],ow.pluginQueue=[],ow.customSchemes=[],ow.initialized=!1},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(e,t)=>!!isAllowedUri(e,t.protocols),validate:e=>!!e,shouldAutoLink:e=>!!e}),addAttributes(){return{href:{default:null,parseHTML:e=>e.getAttribute("href")},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:e=>{let t=e.getAttribute("href");return!!(t&&this.options.isAllowedUri(t,{defaultValidate:e=>!!isAllowedUri(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol}))&&null}}]},renderHTML({HTMLAttributes:e}){return this.options.isAllowedUri(e.href,{defaultValidate:e=>!!isAllowedUri(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",(0,tT.P1)(this.options.HTMLAttributes,e),0]:["a",(0,tT.P1)(this.options.HTMLAttributes,{...e,href:""}),0]},addCommands(){return{setLink:e=>({chain:t})=>{let{href:n}=e;return!!this.options.isAllowedUri(n,{defaultValidate:e=>!!isAllowedUri(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&t().setMark(this.name,e).setMeta("preventAutolink",!0).run()},toggleLink:e=>({chain:t})=>{let{href:n}=e;return!!this.options.isAllowedUri(n,{defaultValidate:e=>!!isAllowedUri(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&t().toggleMark(this.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:e})=>e().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[(0,tT.K9)({find:e=>{let t=[];if(e){let{protocols:n,defaultProtocol:r}=this.options,i=find(e).filter(e=>e.isLink&&this.options.isAllowedUri(e.value,{defaultValidate:e=>!!isAllowedUri(e,n),protocols:n,defaultProtocol:r}));i.length&&i.forEach(e=>t.push({text:e.value,data:{href:e.href},index:e.start}))}return t},type:this.type,getAttributes:e=>{var t;return{href:null===(t=e.data)||void 0===t?void 0:t.href}}})]},addProseMirrorPlugins(){var e,t,n;let r=[],{protocols:i,defaultProtocol:o}=this.options;return this.options.autolink&&r.push((e={type:this.type,defaultProtocol:this.options.defaultProtocol,validate:e=>this.options.isAllowedUri(e,{defaultValidate:e=>!!isAllowedUri(e,i),protocols:i,defaultProtocol:o}),shouldAutoLink:this.options.shouldAutoLink},new oS.Sy({key:new oS.H$("autolink"),appendTransaction:(t,n,r)=>{let i=t.some(e=>e.docChanged)&&!n.doc.eq(r.doc),o=t.some(e=>e.getMeta("preventAutolink"));if(!i||o)return;let{tr:a}=r,l=(0,tT.XP)(n.doc,[...t]),d=(0,tT.QC)(l);if(d.forEach(({newRange:t})=>{let n,i;let o=(0,tT.b5)(r.doc,t,e=>e.isTextblock);if(o.length>1?(n=o[0],i=r.doc.textBetween(n.pos,n.pos+n.node.nodeSize,void 0," ")):o.length&&r.doc.textBetween(t.from,t.to," "," ").endsWith(" ")&&(n=o[0],i=r.doc.textBetween(n.pos,t.to,void 0," ")),n&&i){let t=i.split(" ").filter(e=>""!==e);if(t.length<=0)return!1;let o=t[t.length-1],l=n.pos+i.lastIndexOf(o);if(!o)return!1;let d=tokenize(o).map(t=>t.toObject(e.defaultProtocol));if(!(1===d.length?d[0].isLink:3===d.length&&!!d[1].isLink&&["()","[]"].includes(d[0].value+d[2].value)))return!1;d.filter(e=>e.isLink).map(e=>({...e,from:l+e.start+1,to:l+e.end+1})).filter(e=>!r.schema.marks.code||!r.doc.rangeHasMark(e.from,e.to,r.schema.marks.code)).filter(t=>e.validate(t.value)).filter(t=>e.shouldAutoLink(t.value)).forEach(t=>{(0,tT.tI)(t.from,t.to,r.doc).some(t=>t.mark.type===e.type)||a.addMark(t.from,t.to,e.type.create({href:t.href}))})}}),a.steps.length)return a}}))),!0===this.options.openOnClick&&r.push((t={type:this.type},new oS.Sy({key:new oS.H$("handleClickLink"),props:{handleClick:(e,n,r)=>{var i,o;if(0!==r.button||!e.editable)return!1;let a=r.target,l=[];for(;"DIV"!==a.nodeName;)l.push(a),a=a.parentNode;if(!l.find(e=>"A"===e.nodeName))return!1;let d=(0,tT.u9)(e.state,t.type.name),c=r.target,u=null!==(i=null==c?void 0:c.href)&&void 0!==i?i:d.href,h=null!==(o=null==c?void 0:c.target)&&void 0!==o?o:d.target;return!!c&&!!u&&(window.open(u,h),!0)}}}))),this.options.linkOnPaste&&r.push((n={editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type},new oS.Sy({key:new oS.H$("handlePasteLink"),props:{handlePaste:(e,t,r)=>{let{state:i}=e,{selection:o}=i,{empty:a}=o;if(a)return!1;let l="";r.content.forEach(e=>{l+=e.textContent});let d=find(l,{defaultProtocol:n.defaultProtocol}).find(e=>e.isLink&&e.value===l);return!!l&&!!d&&n.editor.commands.setMark(n.type,{href:d.href})}}}))),r}}),ok=/^\s*>\s$/,o_=tT.NB.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:e}){return["blockquote",(0,tT.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[(0,tT.S0)({find:ok,type:this.type})]}}),oC=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,oI=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,oE=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,oM=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,oP=tT.vc.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!==e.style.fontWeight&&null},{style:"font-weight=400",clearMark:e=>e.type.name===this.name},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}]},renderHTML({HTMLAttributes:e}){return["strong",(0,tT.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[(0,tT.Cf)({find:oC,type:this.type}),(0,tT.Cf)({find:oE,type:this.type})]},addPasteRules(){return[(0,tT.K9)({find:oI,type:this.type}),(0,tT.K9)({find:oM,type:this.type})]}}),oA="textStyle",oj=/^\s*([-+*])\s$/,oD=tT.NB.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:e}){return["ul",(0,tT.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(oA)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let e=(0,tT.S0)({find:oj,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=(0,tT.S0)({find:oj,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(oA),editor:this.editor})),[e]}}),oB=/^```([a-z]+)?[\s\n]$/,oF=/^~~~([a-z]+)?[\s\n]$/,oO=tT.NB.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:e=>{var t;let{languageClassPrefix:n}=this.options,r=[...(null===(t=e.firstElementChild)||void 0===t?void 0:t.classList)||[]],i=r.filter(e=>e.startsWith(n)).map(e=>e.replace(n,"")),o=i[0];return o||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:e,HTMLAttributes:t}){return["pre",(0,tT.P1)(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{let{empty:e,$anchor:t}=this.editor.state.selection,n=1===t.pos;return!!e&&t.parent.type.name===this.name&&(!!n||!t.parent.textContent.length)&&this.editor.commands.clearNodes()},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;let{state:t}=e,{selection:n}=t,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;let o=r.parentOffset===r.parent.nodeSize-2,a=r.parent.textContent.endsWith("\n\n");return!!o&&!!a&&e.chain().command(({tr:e})=>(e.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;let{state:t}=e,{selection:n,doc:r}=t,{$from:i,empty:o}=n;if(!o||i.parent.type!==this.type)return!1;let a=i.parentOffset===i.parent.nodeSize-2;if(!a)return!1;let l=i.after();if(void 0===l)return!1;let d=r.nodeAt(l);return d?e.commands.command(({tr:e})=>(e.setSelection(oS.Y1.near(r.resolve(l))),!0)):e.commands.exitCode()}}},addInputRules(){return[(0,tT.zK)({find:oB,type:this.type,getAttributes:e=>({language:e[1]})}),(0,tT.zK)({find:oF,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new oS.Sy({key:new oS.H$("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;let n=t.clipboardData.getData("text/plain"),r=t.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,o=null==i?void 0:i.mode;if(!n||!o)return!1;let{tr:a,schema:l}=e.state,d=l.text(n.replace(/\r\n?/g,"\n"));return a.replaceSelectionWith(this.type.create({language:o},d)),a.selection.$from.parent.type!==this.type&&a.setSelection(oS.Bs.near(a.doc.resolve(Math.max(0,a.selection.from-2)))),a.setMeta("paste",!0),e.dispatch(a),!0}}})]}}),oR=tT.NB.create({name:"doc",topNode:!0,content:"block+"});var oL=n(62312);let DropCursorView=class DropCursorView{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(n=t.width)&&void 0!==n?n:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(t=>{let handler=e=>{this[t](e)};return e.dom.addEventListener(t,handler),{name:t,handler}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t,n=this.editorView.state.doc.resolve(this.cursorPos),r=!n.parent.inlineContent,i,o=this.editorView.dom,a=o.getBoundingClientRect(),l=a.width/o.offsetWidth,d=a.height/o.offsetHeight;if(r){let e=n.nodeBefore,t=n.nodeAfter;if(e||t){let n=this.editorView.nodeDOM(this.cursorPos-(e?e.nodeSize:0));if(n){let r=n.getBoundingClientRect(),o=e?r.bottom:r.top;e&&t&&(o=(o+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let a=this.width/2*d;i={left:r.left,right:r.right,top:o-a,bottom:o+a}}}}if(!i){let e=this.editorView.coordsAtPos(this.cursorPos),t=this.width/2*l;i={left:e.left-t,right:e.left+t,top:e.top,bottom:e.bottom}}let c=this.editorView.dom.offsetParent;if(!this.element&&(this.element=c.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",r),this.element.classList.toggle("prosemirror-dropcursor-inline",!r),c&&(c!=document.body||"static"!=getComputedStyle(c).position)){let n=c.getBoundingClientRect(),r=n.width/c.offsetWidth,i=n.height/c.offsetHeight;e=n.left-c.scrollLeft*r,t=n.top-c.scrollTop*i}else e=-pageXOffset,t=-pageYOffset;this.element.style.left=(i.left-e)/l+"px",this.element.style.top=(i.top-t)/d+"px",this.element.style.width=(i.right-i.left)/l+"px",this.element.style.height=(i.bottom-i.top)/d+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),r=n&&n.type.spec.disableDropCursor,i="function"==typeof r?r(this.editorView,t,e):r;if(t&&!i){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let t=(0,oL.nj)(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=t&&(e=t)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}};let oU=tT.hj.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[function(e={}){return new oS.Sy({view:t=>new DropCursorView(t,e)})}(this.options)]}});var oN=n(13503),oz=n(109);let GapCursor=class GapCursor extends oS.Y1{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return GapCursor.valid(n)?new GapCursor(n):oS.Y1.near(n)}content(){return tk.p2.empty}eq(e){return e instanceof GapCursor&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw RangeError("Invalid input for GapCursor.fromJSON");return new GapCursor(e.resolve(t.pos))}getBookmark(){return new GapBookmark(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),r=e.node(t);if(0==n){if(r.type.spec.isolating)return!0;continue}for(let e=r.child(n-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),r=e.node(t);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let e=r.child(n);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}}return!0}(e))return!1;let n=t.type.spec.allowGapCursor;if(null!=n)return n;let r=t.contentMatchAt(e.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(e,t,n=!1){o:for(;;){if(!n&&GapCursor.valid(e))return e;let r=e.pos,i=null;for(let n=e.depth;;n--){let o=e.node(n);if(t>0?e.indexAfter(n)<o.childCount:e.index(n)>0){i=o.child(t>0?e.indexAfter(n):e.index(n)-1);break}if(0==n)return null;r+=t;let a=e.doc.resolve(r);if(GapCursor.valid(a))return a}for(;;){let o=t>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!oS.qv.isSelectable(i)){e=e.doc.resolve(r+i.nodeSize*t),n=!1;continue o}break}i=o,r+=t;let a=e.doc.resolve(r);if(GapCursor.valid(a))return a}return null}}};GapCursor.prototype.visible=!1,GapCursor.findFrom=GapCursor.findGapCursorFrom,oS.Y1.jsonID("gapcursor",GapCursor);let GapBookmark=class GapBookmark{constructor(e){this.pos=e}map(e){return new GapBookmark(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return GapCursor.valid(t)?new GapCursor(t):oS.Y1.near(t)}};let oH=(0,oN.$)({ArrowLeft:arrow("horiz",-1),ArrowRight:arrow("horiz",1),ArrowUp:arrow("vert",-1),ArrowDown:arrow("vert",1)});function arrow(e,t){let n="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,r,i){let o=e.selection,a=t>0?o.$to:o.$from,l=o.empty;if(o instanceof oS.Bs){if(!i.endOfTextblock(n)||0==a.depth)return!1;l=!1,a=e.doc.resolve(t>0?a.after():a.before())}let d=GapCursor.findGapCursorFrom(a,t,l);return!!d&&(r&&r(e.tr.setSelection(new GapCursor(d))),!0)}}function handleClick(e,t,n){if(!e||!e.editable)return!1;let r=e.state.doc.resolve(t);if(!GapCursor.valid(r))return!1;let i=e.posAtCoords({left:n.clientX,top:n.clientY});return!(i&&i.inside>-1&&oS.qv.isSelectable(e.state.doc.nodeAt(i.inside)))&&(e.dispatch(e.state.tr.setSelection(new GapCursor(r))),!0)}function beforeinput(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof GapCursor))return!1;let{$from:n}=e.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!r)return!1;let i=tk.HY.empty;for(let e=r.length-1;e>=0;e--)i=tk.HY.from(r[e].createAndFill(null,i));let o=e.state.tr.replace(n.pos,n.pos,new tk.p2(i,0,0));return o.setSelection(oS.Bs.near(o.doc.resolve(n.pos+1))),e.dispatch(o),!1}function drawGapCursor(e){if(!(e.selection instanceof GapCursor))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",oz.EH.create(e.doc,[oz.p.widget(e.selection.head,t,{key:"gapcursor"})])}let o$=tT.hj.create({name:"gapCursor",addProseMirrorPlugins:()=>[new oS.Sy({props:{decorations:drawGapCursor,createSelectionBetween:(e,t,n)=>t.pos==n.pos&&GapCursor.valid(n)?new GapCursor(n):null,handleClick,handleKeyDown:oH,handleDOMEvents:{beforeinput:beforeinput}}})],extendNodeSchema(e){var t;let n={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:null!==(t=(0,tT.nU)((0,tT.Nl)(e,"allowGapCursor",n)))&&void 0!==t?t:null}}}),oV=tT.NB.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:e}){return["br",(0,tT.P1)(this.options.HTMLAttributes,e)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:r})=>e.first([()=>e.exitCode(),()=>e.command(()=>{let{selection:e,storedMarks:i}=n;if(e.$from.parent.type.spec.isolating)return!1;let{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=i||e.$to.parentOffset&&e.$from.marks();return t().insertContent({type:this.name}).command(({tr:e,dispatch:t})=>{if(t&&l&&o){let t=l.filter(e=>a.includes(e.type.name));e.ensureMarks(t)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),oG=tT.NB.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map(e=>({tag:`h${e}`,attrs:{level:e}}))},renderHTML({node:e,HTMLAttributes:t}){let n=this.options.levels.includes(e.attrs.level),r=n?e.attrs.level:this.options.levels[0];return[`h${r}`,(0,tT.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.setNode(this.name,e),toggleHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return this.options.levels.reduce((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(e=>(0,tT.zK)({find:RegExp(`^(#{${Math.min(...this.options.levels)},${e}})\\s$`),type:this.type,getAttributes:{level:e}}))}});var RopeSequence=function(){};RopeSequence.prototype.append=function(e){return e.length?(e=RopeSequence.from(e),!this.length&&e||e.length<200&&this.leafAppend(e)||this.length<200&&e.leafPrepend(this)||this.appendInner(e)):this},RopeSequence.prototype.prepend=function(e){return e.length?RopeSequence.from(e).append(this):this},RopeSequence.prototype.appendInner=function(e){return new oW(this,e)},RopeSequence.prototype.slice=function(e,t){return(void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t)?RopeSequence.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},RopeSequence.prototype.get=function(e){if(!(e<0)&&!(e>=this.length))return this.getInner(e)},RopeSequence.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},RopeSequence.prototype.map=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length);var r=[];return this.forEach(function(t,n){return r.push(e(t,n))},t,n),r},RopeSequence.from=function(e){return e instanceof RopeSequence?e:e&&e.length?new oK(e):RopeSequence.empty};var oK=function(e){function Leaf(t){e.call(this),this.values=t}e&&(Leaf.__proto__=e),Leaf.prototype=Object.create(e&&e.prototype),Leaf.prototype.constructor=Leaf;var t={length:{configurable:!0},depth:{configurable:!0}};return Leaf.prototype.flatten=function(){return this.values},Leaf.prototype.sliceInner=function(e,t){return 0==e&&t==this.length?this:new Leaf(this.values.slice(e,t))},Leaf.prototype.getInner=function(e){return this.values[e]},Leaf.prototype.forEachInner=function(e,t,n,r){for(var i=t;i<n;i++)if(!1===e(this.values[i],r+i))return!1},Leaf.prototype.forEachInvertedInner=function(e,t,n,r){for(var i=t-1;i>=n;i--)if(!1===e(this.values[i],r+i))return!1},Leaf.prototype.leafAppend=function(e){if(this.length+e.length<=200)return new Leaf(this.values.concat(e.flatten()))},Leaf.prototype.leafPrepend=function(e){if(this.length+e.length<=200)return new Leaf(e.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(Leaf.prototype,t),Leaf}(RopeSequence);RopeSequence.empty=new oK([]);var oW=function(e){function Append(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(Append.__proto__=e),Append.prototype=Object.create(e&&e.prototype),Append.prototype.constructor=Append,Append.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},Append.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},Append.prototype.forEachInner=function(e,t,n,r){var i=this.left.length;if(t<i&&!1===this.left.forEachInner(e,t,Math.min(n,i),r)||n>i&&!1===this.right.forEachInner(e,Math.max(t-i,0),Math.min(this.length,n)-i,r+i))return!1},Append.prototype.forEachInvertedInner=function(e,t,n,r){var i=this.left.length;if(t>i&&!1===this.right.forEachInvertedInner(e,t-i,Math.max(n,i)-i,r+i)||n<i&&!1===this.left.forEachInvertedInner(e,Math.min(t,i),n,r))return!1},Append.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},Append.prototype.leafAppend=function(e){var t=this.right.leafAppend(e);if(t)return new Append(this.left,t)},Append.prototype.leafPrepend=function(e){var t=this.left.leafPrepend(e);if(t)return new Append(t,this.right)},Append.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new Append(this.left,new Append(this.right,e)):new Append(this,e)},Append}(RopeSequence);let Branch=class Branch{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){let n,r,i,o;if(0==this.eventCount)return null;let a=this.items.length;for(;;a--)if(this.items.get(a-1).selection){--a;break}t&&(r=(n=this.remapping(a,this.items.length)).maps.length);let l=e.tr,d=[],c=[];return this.items.forEach((e,t)=>{if(!e.step){n||(r=(n=this.remapping(a,t+1)).maps.length),r--,c.push(e);return}if(n){c.push(new Item(e.map));let t=e.step.map(n.slice(r)),i;t&&l.maybeStep(t).doc&&(i=l.mapping.maps[l.mapping.maps.length-1],d.push(new Item(i,void 0,void 0,d.length+c.length))),r--,i&&n.appendMap(i,r)}else l.maybeStep(e.step);if(e.selection)return i=n?e.selection.map(n.slice(r)):e.selection,o=new Branch(this.items.slice(0,a).append(c.reverse().concat(d)),this.eventCount-1),!1},this.items.length,0),{remaining:o,transform:l,selection:i}}addTransform(e,t,n,r){var i,o;let a,l=[],d=this.eventCount,c=this.items,u=!r&&c.length?c.get(c.length-1):null;for(let n=0;n<e.steps.length;n++){let i=e.steps[n].invert(e.docs[n]),o=new Item(e.mapping.maps[n],i,t),a;(a=u&&u.merge(o))&&(o=a,n?l.pop():c=c.slice(0,c.length-1)),l.push(o),t&&(d++,t=void 0),r||(u=o)}let h=d-n.depth;return h>oZ&&(i=c,o=h,i.forEach((e,t)=>{if(e.selection&&0==o--)return a=t,!1}),c=i.slice(a),d-=h),new Branch(c.append(l),d)}remapping(e,t){let n=new oL.vs;return this.items.forEach((t,r)=>{let i=null!=t.mirrorOffset&&r-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,i)},e,t),n}addMaps(e){return 0==this.eventCount?this:new Branch(this.items.append(e.map(e=>new Item(e))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-t),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(e=>{e.selection&&a--},r);let l=t;this.items.forEach(t=>{let r=i.getMirror(--l);if(null==r)return;o=Math.min(o,r);let d=i.maps[r];if(t.step){let o=e.steps[r].invert(e.docs[r]),c=t.selection&&t.selection.map(i.slice(l+1,r));c&&a++,n.push(new Item(d,o,c))}else n.push(new Item(d))},r);let d=[];for(let e=t;e<o;e++)d.push(new Item(i.maps[e]));let c=this.items.slice(0,r).append(d).append(n),u=new Branch(c,a);return u.emptyItemCount()>500&&(u=u.compress(this.items.length-n.length)),u}emptyItemCount(){let e=0;return this.items.forEach(t=>{!t.step&&e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,r=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)r.push(o),o.selection&&i++;else if(o.step){let e=o.step.map(t.slice(n)),a=e&&e.getMap();if(n--,a&&t.appendMap(a,n),e){let l=o.selection&&o.selection.map(t.slice(n));l&&i++;let d=new Item(a.invert(),e,l),c,u=r.length-1;(c=r.length&&r[u].merge(d))?r[u]=c:r.push(d)}}else o.map&&n--},this.items.length,0),new Branch(RopeSequence.from(r.reverse()),i)}};Branch.empty=new Branch(RopeSequence.empty,0);let Item=class Item{constructor(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new Item(t.getMap().invert(),t,this.selection)}}};let HistoryState=class HistoryState{constructor(e,t,n,r,i){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r,this.prevComposition=i}};let oZ=20;function rangesFor(e){let t=[];for(let n=e.length-1;n>=0&&0==t.length;n--)e[n].forEach((e,n,r,i)=>t.push(r,i));return t}function mapRanges(e,t){if(!e)return null;let n=[];for(let r=0;r<e.length;r+=2){let i=t.map(e[r],1),o=t.map(e[r+1],-1);i<=o&&n.push(i,o)}return n}let oq=!1,oY=null;function mustPreserveItems(e){let t=e.plugins;if(oY!=t){oq=!1,oY=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){oq=!0;break}}return oq}let oX=new oS.H$("history"),oJ=new oS.H$("closeHistory");function buildCommand(e,t){return(n,r)=>{let i=oX.getState(n);if(!i||0==(e?i.undone:i.done).eventCount)return!1;if(r){let o=function(e,t,n){let r=mustPreserveItems(t),i=oX.get(t).spec.config,o=(n?e.undone:e.done).popEvent(t,r);if(!o)return null;let a=o.selection.resolve(o.transform.doc),l=(n?e.done:e.undone).addTransform(o.transform,t.selection.getBookmark(),i,r),d=new HistoryState(n?l:o.remaining,n?o.remaining:l,null,0,-1);return o.transform.setSelection(a).setMeta(oX,{redo:n,historyState:d})}(i,n,e);o&&r(t?o.scrollIntoView():o)}return!0}}let oQ=buildCommand(!1,!0),o0=buildCommand(!0,!0);buildCommand(!1,!1),buildCommand(!0,!1);let o1=tT.hj.create({name:"history",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:e,dispatch:t})=>oQ(e,t),redo:()=>({state:e,dispatch:t})=>o0(e,t)}),addProseMirrorPlugins(){return[function(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new oS.Sy({key:oX,state:{init:()=>new HistoryState(Branch.empty,Branch.empty,null,0,-1),apply:(t,n,r)=>(function(e,t,n,r){let i=n.getMeta(oX),o;if(i)return i.historyState;n.getMeta(oJ)&&(e=new HistoryState(e.done,e.undone,null,0,-1));let a=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(a&&a.getMeta(oX))return a.getMeta(oX).redo?new HistoryState(e.done.addTransform(n,void 0,r,mustPreserveItems(t)),e.undone,rangesFor(n.mapping.maps),e.prevTime,e.prevComposition):new HistoryState(e.done,e.undone.addTransform(n,void 0,r,mustPreserveItems(t)),null,e.prevTime,e.prevComposition);if(!1===n.getMeta("addToHistory")||a&&!1===a.getMeta("addToHistory"))return(o=n.getMeta("rebased"))?new HistoryState(e.done.rebased(n,o),e.undone.rebased(n,o),mapRanges(e.prevRanges,n.mapping),e.prevTime,e.prevComposition):new HistoryState(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),mapRanges(e.prevRanges,n.mapping),e.prevTime,e.prevComposition);{let i=n.getMeta("composition"),o=0==e.prevTime||!a&&e.prevComposition!=i&&(e.prevTime<(n.time||0)-r.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach((e,r)=>{for(let i=0;i<t.length;i+=2)e<=t[i+1]&&r>=t[i]&&(n=!0)}),n}(n,e.prevRanges)),l=a?mapRanges(e.prevRanges,n.mapping):rangesFor(n.mapping.maps);return new HistoryState(e.done.addTransform(n,o?t.selection.getBookmark():void 0,r,mustPreserveItems(t)),Branch.empty,l,n.time,null==i?e.prevComposition:i)}})(n,r,t,e)},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,r="historyUndo"==n?oQ:"historyRedo"==n?o0:null;return!!r&&(t.preventDefault(),r(e.state,e.dispatch))}}}})}(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),o2=tT.NB.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{}}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:e}){return["hr",(0,tT.P1)(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e,state:t})=>{let{selection:n}=t,{$from:r,$to:i}=n,o=e();return 0===r.parentOffset?o.insertContentAt({from:Math.max(r.pos-1,0),to:i.pos},{type:this.name}):(0,tT.EG)(n)?o.insertContentAt(i.pos,{type:this.name}):o.insertContent({type:this.name}),o.command(({tr:e,dispatch:t})=>{var n;if(t){let{$to:t}=e.selection,r=t.end();if(t.nodeAfter)t.nodeAfter.isTextblock?e.setSelection(oS.Bs.create(e.doc,t.pos+1)):t.nodeAfter.isBlock?e.setSelection(oS.qv.create(e.doc,t.pos)):e.setSelection(oS.Bs.create(e.doc,t.pos));else{let i=null===(n=t.parent.type.contentMatch.defaultType)||void 0===n?void 0:n.create();i&&(e.insert(r,i),e.setSelection(oS.Bs.create(e.doc,r+1)))}e.scrollIntoView()}return!0}).run()}}},addInputRules(){return[(0,tT.x2)({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),o3=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,o5=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,o4=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,o6=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,o7=tT.vc.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:e=>"normal"!==e.style.fontStyle&&null},{style:"font-style=normal",clearMark:e=>e.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:e}){return["em",(0,tT.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[(0,tT.Cf)({find:o3,type:this.type}),(0,tT.Cf)({find:o4,type:this.type})]},addPasteRules(){return[(0,tT.K9)({find:o5,type:this.type}),(0,tT.K9)({find:o6,type:this.type})]}}),o8=tT.NB.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",(0,tT.P1)(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),o9="textStyle",ae=/^(\d+)\.\s$/,at=tT.NB.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1},type:{default:null,parseHTML:e=>e.getAttribute("type")}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:e}){let{start:t,...n}=e;return 1===t?["ol",(0,tT.P1)(this.options.HTMLAttributes,n),0]:["ol",(0,tT.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(o9)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let e=(0,tT.S0)({find:ae,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(e=(0,tT.S0)({find:ae,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(o9)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[e]}}),an=tT.NB.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:e}){return["p",(0,tT.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),ar=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,ai=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,ao=tT.vc.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("line-through")&&{}}],renderHTML({HTMLAttributes:e}){return["s",(0,tT.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[(0,tT.Cf)({find:ar,type:this.type})]},addPasteRules(){return[(0,tT.K9)({find:ai,type:this.type})]}}),aa=tT.NB.create({name:"text",group:"inline"}),as=tT.hj.create({name:"starterKit",addExtensions(){let e=[];return!1!==this.options.bold&&e.push(oP.configure(this.options.bold)),!1!==this.options.blockquote&&e.push(o_.configure(this.options.blockquote)),!1!==this.options.bulletList&&e.push(oD.configure(this.options.bulletList)),!1!==this.options.code&&e.push(is.configure(this.options.code)),!1!==this.options.codeBlock&&e.push(oO.configure(this.options.codeBlock)),!1!==this.options.document&&e.push(oR.configure(this.options.document)),!1!==this.options.dropcursor&&e.push(oU.configure(this.options.dropcursor)),!1!==this.options.gapcursor&&e.push(o$.configure(this.options.gapcursor)),!1!==this.options.hardBreak&&e.push(oV.configure(this.options.hardBreak)),!1!==this.options.heading&&e.push(oG.configure(this.options.heading)),!1!==this.options.history&&e.push(o1.configure(this.options.history)),!1!==this.options.horizontalRule&&e.push(o2.configure(this.options.horizontalRule)),!1!==this.options.italic&&e.push(o7.configure(this.options.italic)),!1!==this.options.listItem&&e.push(o8.configure(this.options.listItem)),!1!==this.options.orderedList&&e.push(at.configure(this.options.orderedList)),!1!==this.options.paragraph&&e.push(an.configure(this.options.paragraph)),!1!==this.options.strike&&e.push(ao.configure(this.options.strike)),!1!==this.options.text&&e.push(aa.configure(this.options.text)),e}}),al={tldraw_draw:{normal:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw",format:"woff2"},weight:"normal"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_bold",format:"woff2"},weight:"bold"}},italic:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_sans:{normal:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_serif:{normal:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_mono:{normal:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}}},ad=(0,B.UM)(al).flatMap(e=>(0,B.UM)(e).flatMap(e=>Object.values(e))),ac=tT.hj.create({name:"textDirection",addGlobalAttributes:()=>[{types:["heading","paragraph"],attributes:{dir:{default:"auto",parseHTML:e=>{let t=e.getAttribute("dir");return t&&["ltr","rtl","auto"].includes(t)?t:"auto"},renderHTML:e=>({dir:e.dir})}}}]}),au=tT.hj.create({name:"keyboardShiftEnterHandler",addKeyboardShortcuts:()=>({"Shift-Enter":({editor:e})=>e.commands.enter()})});is.config.excludes=void 0,ic.config.priority=1100;let ah=[as.configure({blockquote:!1,codeBlock:!1,horizontalRule:!1}),oT.configure({openOnClick:!1,autolink:!0}),ic,au,ac],ap=new B.kM;function renderHtmlFromRichText(e,t){return ap.get(t,()=>{let n=e.getTextOptions().tipTapConfig?.extensions??ah,r=(0,tT.ar)(t,n);return r.replaceAll('<p dir="auto"></p>',"<p><br /></p>")??""})}function renderHtmlFromRichTextForMeasurement(e,t){let n=renderHtmlFromRichText(e,t);return`<div class="tl-rich-text">${n}</div>`}let af=new B.kM;function isEmptyRichText(e){return 1===e.content.length&&!e.content[0].content}function renderPlaintextFromRichText(e,t){return isEmptyRichText(t)?"":af.get(t,()=>{let n=e.getTextOptions().tipTapConfig?.extensions??ah;return(0,tT._4)(t,n,{blockSeparator:"\n"})})}function renderRichTextFromHTML(e,t){let n=e.getTextOptions().tipTapConfig?.extensions??ah;return(0,tT.AW)(t,n)}function defaultAddFontsFromNode(e,t,n){for(let n of e.marks)"bold"===n.type.name&&"bold"!==t.weight&&(t={...t,weight:"bold"}),"italic"===n.type.name&&"italic"!==t.style&&(t={...t,style:"italic"}),"code"===n.type.name&&"tldraw_mono"!==t.family&&(t={...t,family:"tldraw_mono"});let r=(0,B.eg)(al,t.family);if(!r)return t;let i=(0,B.eg)(r,t.style);if(!i)return t;let o=(0,B.eg)(i,t.weight);return o&&n(o),t}let TextHelpers=class TextHelpers{static fixNewLines=/\r?\n|\r/g;static normalizeText(e){return e.replace(TextHelpers.fixNewLines,"\n")}static normalizeTextForDom(e){return e.replace(TextHelpers.fixNewLines,"\n").split("\n").map(e=>e||" ").join("\n")}};let ag=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/,am={"&amp;":"&","&quot;":'"',"&apos;":"'","&#27;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"","&#8212;":"","&#8216;":"","&#8217;":"","&#8220;":"","&#8221;":"","&#8230;":""},ay=RegExp(Object.keys(am).join("|"),"g");function convertCommonTitleHTMLEntities(e){return e.replace(ay,e=>am[e])}let truncateStringWithEllipsis=(e,t)=>e.length<=t?e:e.substring(0,t-3)+"...",ab=5e3,ax=10485760;function registerDefaultExternalContentHandlers(e,t){e.registerExternalAssetHandler("file",async n=>defaultHandleExternalFileAsset(e,n,t)),e.registerExternalAssetHandler("url",async n=>defaultHandleExternalUrlAsset(e,n,t)),e.registerExternalContentHandler("svg-text",async t=>defaultHandleExternalSvgTextContent(e,t)),e.registerExternalContentHandler("embed",t=>defaultHandleExternalEmbedContent(e,t)),e.registerExternalContentHandler("files",async n=>defaultHandleExternalFileContent(e,n,t)),e.registerExternalContentHandler("file-replace",async n=>defaultHandleExternalFileReplaceContent(e,n,t)),e.registerExternalContentHandler("text",async t=>defaultHandleExternalTextContent(e,t)),e.registerExternalContentHandler("url",async n=>defaultHandleExternalUrlContent(e,n,t)),e.registerExternalContentHandler("tldraw",async t=>defaultHandleExternalTldrawContent(e,t)),e.registerExternalContentHandler("excalidraw",async t=>defaultHandleExternalExcalidrawContent(e,t))}async function defaultHandleExternalFileAsset(e,{file:t,assetId:n},r){let i=runFileChecks(t,r);i||(0,B.hu)(!1,"File checks failed");let o=await getAssetInfo(t,r,n),a=await e.uploadAsset(o,t);return o.props.src=a.src,a.meta&&(o.meta={...o.meta,...a.meta}),L.Yk.create(o)}async function defaultHandleExternalFileReplaceContent(e,{file:t,shapeId:n,isImage:r},i){let o=runFileChecks(t,i);o||(0,B.hu)(!1,"File checks failed");let a=e.getShape(n);a||(0,B.hu)(!1,"Shape not found");let l=(0,B.Aq)(await t.arrayBuffer()),d=L.Yk.createId(l);e.createTemporaryAssetPreview(d,t);let c=await getMediaAssetInfoPartial(t,d,r,!r);if(e.createAssets([c]),"image"===a.type){let t=a.props.crop,n=c.props.w,r=c.props.h,i=a.x,o=a.y,l=t;if(t){let e=function(e,t,n){let r=getDefaultCrop(),i=e.props.crop||r,o=e.props.w,a=e.props.h,l=r,d=o,c=a,u=(0,B.Xy)(e.props.crop,r);if(u)d=o,c=o*n/t;else{let r,o;let{w:a,h:d}=getUncroppedSize(e.props,e.props.crop||getDefaultCrop()),{width:c,height:u}=getCropDimensions(i),h=c/u,p=getCropCenter(i);r=c;let f=t/n/(a/d)/h;if(o=r*f,f>1.5){if(1/o<1/r){let e=o/.3333333333333333;o/=e,r/=e}else{let e=r/.3333333333333333;r/=e,o/=e}}r=Math.max(0,Math.min(1,r)),o=Math.max(0,Math.min(1,o)),l=createCropAroundCenter(p.x,p.y,r,o,i.isCircle)}let h=e.x+o/2,p=e.y+a/2,f=h-d/2,g=p-c/2;return{crop:l,w:d,h:c,x:f,y:g}}(a,c.props.w,c.props.h);l=e.crop,n=e.w,r=e.h,i=e.x,o=e.y}e.updateShapes([{id:a.id,type:a.type,props:{assetId:d,crop:l,w:n,h:r},x:i,y:o}])}else"video"===a.type&&e.updateShapes([{id:a.id,type:a.type,props:{assetId:d,w:c.props.w,h:c.props.h}}]);let u=await e.getAssetForExternalContent({type:"file",file:t,assetId:d});return e.updateAssets([{...u,id:d}]),u}async function defaultHandleExternalUrlAsset(e,{url:t},{toasts:n,msg:r}){let i;try{let e=await (0,B.he)(t,{method:"GET",mode:"no-cors"}),n=await e.text(),r=new DOMParser().parseFromString(n,"text/html");(i={image:r.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",favicon:r.head.querySelector('link[rel="apple-touch-icon"]')?.getAttribute("href")??r.head.querySelector('link[rel="icon"]')?.getAttribute("href")??"",title:r.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??t,description:r.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""}).image.startsWith("http")||(i.image=new URL(i.image,t).href),i.favicon.startsWith("http")||(i.favicon=new URL(i.favicon,t).href)}catch(e){console.error(e),n.addToast({title:r("assets.url.failed"),severity:"error"}),i={image:"",favicon:"",title:"",description:""}}return{id:L.Yk.createId((0,B.jK)(t)),typeName:"asset",type:"bookmark",props:{src:t,description:i.description,image:i.image,favicon:i.favicon,title:i.title},meta:{}}}async function defaultHandleExternalSvgTextContent(e,{point:t,text:n}){let r=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),i=new DOMParser().parseFromString(n,"image/svg+xml").querySelector("svg");if(!i)throw Error("No <svg/> element present");let o=parseFloat(i.getAttribute("width")||"0"),a=parseFloat(i.getAttribute("height")||"0");if(!(o&&a)){document.body.appendChild(i);let e=i.getBoundingClientRect();document.body.removeChild(i),o=e.width,a=e.height}let l=await e.getAssetForExternalContent({type:"file",file:new File([n],"asset.svg",{type:"image/svg+xml"})});if(!l)throw Error("Could not create an asset");createShapesForAssets(e,[l],r)}function defaultHandleExternalEmbedContent(e,{point:t,url:n,embed:r}){let i=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),{width:o,height:a}=r,l=(0,L.F1)(),d=maybeSnapToGrid(new eF.B(i.x-(o||450)/2,i.y-(a||450)/2),e),c={id:l,type:"embed",x:d.x,y:d.y,props:{w:o,h:a,url:n}};e.canCreateShape(c)&&e.createShape(c).select(l)}async function defaultHandleExternalFileContent(e,{point:t,files:n},r){let{acceptedImageMimeTypes:i=B.Hj,toasts:o,msg:a}=r;if(n.length>e.options.maxFilesAtOnce){o.addToast({title:a("assets.files.amount-too-big"),severity:"error"});return}let l=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),d=new eF.B(l.x,l.y),c=[],u=[];for(let t of n){let n=runFileChecks(t,r);if(!n)continue;let o=await getAssetInfo(t,r);i.includes(t.type)&&e.createTemporaryAssetPreview(o.id,t),c.push(o),u.push({asset:o,file:t})}Promise.allSettled(u.map(async t=>{try{let n=await e.getAssetForExternalContent({type:"file",file:t.file});if(!n)throw Error("Could not create an asset");e.updateAssets([{...n,id:t.asset.id}])}catch(n){o.addToast({title:a("assets.files.upload-failed"),severity:"error"}),console.error(n),e.deleteAssets([t.asset.id]);return}})),createShapesForAssets(e,c,d)}async function defaultHandleExternalTextContent(e,{point:t,text:n,html:r}){let i,o,a;let l=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),d=e.getShapeUtil("text").getDefaultProps(),c=(function(e){let t=e.split("\n");for(;t[0]&&0===t[0].trim().length;)t.shift();let n=1/0;for(let e of t)if(e.trim().length>0){let t=e.length-e.trimStart().length;n=Math.min(n,t)}return t.map(e=>e.slice(n)).join("\n")})(n.replace(/\t/g,"  ")).replace(/[ \t]+$/gm,"").replace(/\n+$/,""),u=r?renderRichTextFromHTML(e,r):(0,L.Ak)(c),h="middle",p=r??c.replace(/\n/g,"<br>"),f=r?u.content.length>1:c.split("\n").length>1,g=ag.test(c);f&&(h=f?g?"end":"start":"middle");let m=e.textMeasure.measureHtml(p,{...rJ,fontFamily:r3[d.font],fontSize:r0[d.size],maxWidth:null}),y=Math.min(f?.9*e.getViewportPageBounds().width:920,Math.max(200,.9*e.getViewportPageBounds().width));if(m.w>y){let t=e.textMeasure.measureHtml(p,{...rJ,fontFamily:r3[d.font],fontSize:r0[d.size],maxWidth:y});i=t.w,o=t.h,a=!1,h=g?"end":"start"}else i=Math.max(m.w,10),o=Math.max(m.h,10),a=!0;l.y-o/2<e.getViewportPageBounds().minY+40&&(l.y=e.getViewportPageBounds().minY+40+o/2);let b=maybeSnapToGrid(new eF.B(l.x-i/2,l.y-o/2),e),S=(0,L.F1)();e.createShapes([{id:S,type:"text",x:b.x,y:b.y,props:{richText:u,textAlign:h,autoSize:a,w:i}}])}async function defaultHandleExternalUrlContent(e,{point:t,url:n},{toasts:r,msg:i}){let o=e.getShapeUtil("embed"),a=o?.getEmbedDefinition(n);if(a)return e.putExternalContent({type:"embed",url:a.url,point:t,embed:a.definition});let l=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),d=L.Yk.createId((0,B.jK)(n)),c=createEmptyBookmarkShape(e,n,l),u=e.getAsset(d),h=!1;if(!u){h=!0;try{let t=await e.getAssetForExternalContent({type:"url",url:n});if(!t)throw Error("Could not create an asset");u=t}catch{r.addToast({title:i("assets.url.failed"),severity:"error"});return}}e.run(()=>{h&&e.createAssets([u]),e.updateShapes([{id:c.id,type:c.type,props:{assetId:u.id}}])})}async function defaultHandleExternalTldrawContent(e,{point:t,content:n}){e.run(()=>{let r=e.getSelectionPageBounds();for(let t of(e.markHistoryStoppingPoint("paste"),n.shapes))n.rootShapeIds.includes(t.id)&&(t.isLocked=!1);e.putContentOntoCurrentPage(n,{point:t,select:!0});let i=e.getSelectionPageBounds();r&&i&&r?.collides(i)&&(e.updateInstanceState({isChangingStyle:!0}),e.timers.setTimeout(()=>{e.updateInstanceState({isChangingStyle:!1})},150))})}async function defaultHandleExternalExcalidrawContent(e,{point:t,content:n}){e.run(()=>{putExcalidrawContent(e,n,t)})}async function getMediaAssetInfoPartial(e,t,n,r,i){let o=e.type;"video/quicktime"===e.type&&(o="video/mp4");let a=n?await B.xe.getImageSize(e):await B.xe.getVideoSize(e),l=await B.xe.isAnimated(e)||r,d={id:t,type:n?"image":"video",typeName:"asset",props:{name:e.name,src:"",w:a.w,h:a.h,fileSize:e.size,mimeType:o,isAnimated:l},meta:{}};if(i&&isFinite(i)){let t={w:d.props.w,h:d.props.h},n=containBoxSize(t,{w:i,h:i});t!==n&&B.xe.isStaticImageType(e.type)&&(d.props.w=n.w,d.props.h=n.h)}return d}async function createShapesForAssets(e,t,n){if(!t.length)return[];let r=eF.B.From(n),i=[];for(let e=0;e<t.length;e++){let n=t[e];switch(n.type){case"image":i.push({id:(0,L.F1)(),type:"image",x:r.x,y:r.y,opacity:1,props:{assetId:n.id,w:n.props.w,h:n.props.h}}),r.x+=n.props.w;break;case"video":i.push({id:(0,L.F1)(),type:"video",x:r.x,y:r.y,opacity:1,props:{assetId:n.id,w:n.props.w,h:n.props.h}}),r.x+=n.props.w}}return e.run(()=>{let r=t.filter(t=>!e.getAsset(t.id));e.store.atomic(()=>{e.canCreateShapes(i)&&(r.length&&e.createAssets(r),e.createShapes(i).select(...i.map(e=>e.id)),centerSelectionAroundPoint(e,n))})}),i.map(e=>e.id)}function centerSelectionAroundPoint(e,t){let n=e.getViewportPageBounds(),r=e.getSelectionPageBounds();if(r){let n=r.center.sub(t);e.updateShapes(e.getSelectedShapes().map(t=>{let r=e.getShapeParentTransform(t).decompose().rotation,i=eF.B.Rot(n,-r);return{id:t.id,type:t.type,x:t.x-i.x,y:t.y-i.y}}))}if((r=e.getSelectionPageBounds())&&e.getInstanceState().isGridMode){let t=e.getDocumentSettings().gridSize,n=new eF.B(r.minX,r.minY),i=n.clone().snapToGrid(t),o=eF.B.Sub(n,i);e.updateShapes(e.getSelectedShapes().map(e=>{let t={x:e.x-o.x,y:e.y-o.y};return{id:e.id,type:e.type,x:t.x,y:t.y}}))}(r=e.getSelectionPageBounds())&&!n.contains(r)&&e.zoomToSelection({animation:{duration:e.options.animationMediumMs}})}function createEmptyBookmarkShape(e,t,n){let r={id:(0,L.F1)(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:t}};return e.run(()=>{e.createShape(r),e.getShape(r.id)&&(e.select(r.id),centerSelectionAroundPoint(e,n))}),e.getShape(r.id)}function runFileChecks(e,t){let{acceptedImageMimeTypes:n=B.Hj,acceptedVideoMimeTypes:r=B.B0,maxAssetSize:i=ax,toasts:o,msg:a}=t,l=n.includes(e.type),d=r.includes(e.type);return l||d?e.size>i?(o.addToast({title:a("assets.files.size-too-big"),severity:"error"}),!1):!!e.type||(o.addToast({title:a("assets.files.upload-failed"),severity:"error"}),console.error("No mime type"),!1):(o.addToast({title:a("assets.files.type-not-allowed"),severity:"error"}),!1)}async function getAssetInfo(e,t,n){let{acceptedImageMimeTypes:r=B.Hj,acceptedVideoMimeTypes:i=B.B0,maxImageDimension:o=ab}=t,a=r.includes(e.type),l=i.includes(e.type),d=(0,B.Aq)(await e.arrayBuffer());n??=L.Yk.createId(d);let c=await getMediaAssetInfoPartial(e,n,a,l,o);return c}let Idle_Idle=class Idle_Idle extends eL.n{static id="idle";isPrecise=!1;isPreciseTimerId=null;preciseTargetId=null;onPointerMove(){this.update()}onPointerDown(e){this.parent.transition("pointing",{...e,isPrecise:this.isPrecise})}onEnter(){this.editor.setCursor({type:"cross",rotation:0}),this.update()}onCancel(){this.editor.setCurrentTool("select")}onExit(){clearArrowTargetState(this.editor),null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId)}onKeyDown(){this.update()}onKeyUp(e){if(this.update(),"Enter"===e.key){if(this.editor.getIsReadonly())return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}}update(){let e=this.editor.getShapeUtil("arrow"),t=updateArrowTargetState({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0});t&&t.target.id!==this.preciseTargetId?(null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId),this.preciseTargetId=t.target.id,this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.isPrecise=!0,this.update()},e.options.hoverPreciseTimeout)):!t&&this.preciseTargetId&&(this.isPrecise=!1,this.preciseTargetId=null,null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId))}};let Pointing_Pointing=class Pointing_Pointing extends eL.n{static id="pointing";shape;isPrecise=!1;isPreciseTimerId=null;markId="";onEnter(e){this.markId="",this.isPrecise=!!e.isPrecise;let t=updateArrowTargetState({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0});if(!t&&(this.createArrowShape(),!this.shape)){this.cancel();return}this.startPreciseTimeout()}onExit(){this.shape=void 0,clearArrowTargetState(this.editor),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape){this.cancel();return}this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.parent.transition("idle")}createArrowShape(){let{originPagePoint:e}=this.editor.inputs,t=(0,L.F1)();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${t}`);let n=maybeSnapToGrid(e,this.editor);this.editor.createShape({id:t,type:"arrow",x:n.x,y:n.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});let r=this.editor.getShape(t);if(!r)return;let i=this.editor.getShapeHandles(r);if(!i)throw Error("expected handles for arrow");let o=this.editor.getShapeUtil("arrow"),a=this.shape,l=i.find(e=>"start"===e.id),d=o.onHandleDrag?.(r,{handle:{...l,x:0,y:0},isPrecise:!0,initial:a});d&&this.editor.updateShapes([d]),this.shape=this.editor.getShape(t),this.editor.select(t)}updateArrowShapeEndHandle(){let e=this.shape;if(!e)throw Error("expected shape");let t=this.editor.getShapeHandles(e);if(!t)throw Error("expected handles for arrow");{let n=this.editor.getShapeUtil("arrow"),r=this.shape,i=t.find(e=>"start"===e.id),o=n.onHandleDrag?.(e,{handle:{...i,x:0,y:0},isPrecise:this.isPrecise,initial:r});o&&this.editor.updateShapes([o])}{let n=this.editor.getShapeUtil("arrow"),r=this.shape,i=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),o=t.find(e=>"end"===e.id),a=n.onHandleDrag?.(this.editor.getShape(e),{handle:{...o,x:i.x,y:i.y},isPrecise:!1,initial:r});a&&this.editor.updateShapes([a])}this.shape=this.editor.getShape(e.id)}startPreciseTimeout(){let e=this.editor.getShapeUtil("arrow");this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.isPrecise=!0)},e.options.pointingPreciseTimeout)}clearPreciseTimeout(){null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId)}};let ArrowShapeTool=class ArrowShapeTool extends eL.n{static id="arrow";static initial="idle";static children(){return[Idle_Idle,Pointing_Pointing]}shapeType="arrow"};let Drawing=class Drawing extends eL.n{static id="drawing";info={};initialShape;shapeType="highlight"===this.parent.id?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;isPenOrStylus=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;markId=null;onEnter(e){this.markId=null,this.info=e,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){let{inputs:e}=this.editor;if(this.isPen&&!e.isPen&&this.markId){this.editor.bailToMark(this.markId),this.startShape();return}this.isPenOrStylus?eF.B.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(e){if("Shift"===e.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(e){if("Shift"===e.key)switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return"highlight"!==this.shapeType}getIsClosed(e,t,n){if(!this.canClose())return!1;let r=rQ[t],i=e[0].points[0],o=e[e.length-1],a=o.points[o.points.length-1];return i!==a&&this.currentLineLength>4*r*n&&eF.B.DistMin(i,a,2*r*n)}startShape(){let{inputs:{originPagePoint:e,isPen:t}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");let{z:n=.5}=this.info.point;this.isPen=t,this.isPenOrStylus=t||n>0&&n<.5||n>.5&&n<1;let r=this.isPenOrStylus?1.25*n:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){let t=this.editor.getShape(this.initialShape.id);if(t&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;let n=(0,B.Z$)(t.props.segments);if(!n)throw Error("Expected a previous segment!");let i=(0,B.Z$)(n.points);if(!i)throw Error("Expected a previous point!");let{x:o,y:a}=this.editor.getPointInShapeSpace(t,e).toFixed(),l={type:this.segmentMode,points:[{x:i.x,y:i.y,z:+r.toFixed(2)},{x:o,y:a,z:+r.toFixed(2)}]},d=tu._.applyToPoint(this.editor.getShapePageTransform(t.id),i);this.pagePointWhereCurrentSegmentChanged=d,this.pagePointWhereNextSegmentChanged=null;let c=[...t.props.segments,l];this.currentLineLength<4*rQ[t.props.size]&&(this.currentLineLength=this.getLineLength(c));let u={id:t.id,type:this.shapeType,props:{segments:c}};this.canClose()&&(u.props.isClosed=this.getIsClosed(c,t.props.size,t.props.scale)),this.editor.updateShapes([u]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();let i=(0,L.F1)();this.editor.createShape({id:i,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+r.toFixed(2)}]}]}});let o=this.editor.getShape(i);if(!o){this.cancel();return}this.currentLineLength=0,this.initialShape=this.editor.getShape(i)}updateDrawingShape(){let{initialShape:e}=this,{inputs:t}=this.editor;if(!e)return;let{id:n,props:{size:r,scale:i}}=e,o=this.editor.getShape(n);if(!o)return;let{segments:a}=o.props,{x:l,y:d,z:c}=this.editor.getPointInShapeSpace(o,t.currentPagePoint).toFixed(),u=this.isPenOrStylus?+(1.25*t.currentPagePoint.z).toFixed(2):.5,h={x:l,y:d,z:u};switch(this.segmentMode){case"starting_straight":{let{pagePointWhereNextSegmentChanged:e}=this;if(null===e)throw Error("We should have a point where the segment changed");let l=eF.B.Dist2(e,t.currentPagePoint)>this.editor.options.dragDistanceSquared;if(l){let e;this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";let t=(0,B.Z$)(a);if(!t)throw Error("Expected a previous segment!");let l=(0,B.Z$)(t.points);if(!l)throw Error("Expected a previous last point!");let d=this.editor.getPointInShapeSpace(o,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===t.type){this.currentLineLength+=eF.B.Dist(l,d),e={type:"straight",points:[{...l},d]};let t=this.editor.getShapePageTransform(o);this.pagePointWhereCurrentSegmentChanged=tu._.applyToPoint(t,l)}else e={type:"straight",points:[d,h]};let c={id:n,type:this.shapeType,props:{segments:[...a,e]}};this.canClose()&&(c.props.isClosed=this.getIsClosed(a,r,i)),this.editor.updateShapes([c])}break}case"starting_free":{let{pagePointWhereNextSegmentChanged:e}=this;if(null===e)throw Error("We should have a point where the segment changed");let l=eF.B.Dist2(e,t.currentPagePoint)>this.editor.options.dragDistanceSquared;if(l){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";let e=a.slice(),t=e[e.length-1],l=(0,B.Z$)(t.points);if(!l)throw Error("No previous point!");let d={type:"free",points:[...eF.B.PointsBetween(l,h,6).map(e=>({x:(0,ei.FH)(e.x),y:(0,ei.FH)(e.y),z:(0,ei.FH)(e.z)}))]},c=[...e,d];this.currentLineLength<4*rQ[o.props.size]&&(this.currentLineLength=this.getLineLength(c));let u={id:n,type:this.shapeType,props:{segments:c}};this.canClose()&&(u.props.isClosed=this.getIsClosed(c,r,i)),this.editor.updateShapes([u])}break}case"straight":{let e,t;let l=a.slice(),d=l[l.length-1],{pagePointWhereCurrentSegmentChanged:c}=this,{ctrlKey:u,currentPagePoint:h}=this.editor.inputs;if(!c)throw Error("We should have a point where the segment changed");let p=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(p=!u,this.didJustShiftClickToExtendPreviousShapeLine=!1):p=!u;let f=this.editor.getPointInShapeSpace(o,h).toFixed().toJson(),g=!1,m=this.editor.user.getIsSnapMode()?!u:u;if(m&&l.length>2){let e;let n=8/this.editor.getZoomLevel();for(let r=0,i=a.length-2;r<i;r++){let i=a[r];if(!i)break;if("free"===i.type)continue;let o=i.points[0],l=(0,B.Z$)(i.points);if(!(o&&l))continue;let d=eF.B.NearestPointOnLineSegment(o,l,f);if(eF.B.DistMin(d,f,n)){e=d.toFixed().toJson(),n=eF.B.Dist(d,f),t=i;break}}e&&(g=!0,f=e)}if(g&&t){let e=this.editor.getShapePageTransform(o),n=t.points[0],r=(0,B.Z$)(t.points);if(!r)throw Error("Expected a last point!");let i=tu._.applyToPoint(e,n),a=tu._.applyToPoint(e,r),l=tu._.applyToPoint(e,f);this.editor.snaps.setIndicators([{id:(0,B.EL)(),type:"points",points:[i,l,a]}])}else{if(this.editor.snaps.clearIndicators(),p){let t=eF.B.Angle(c,h),n=(0,ei.nD)(t,24),r=n-t;e=eF.B.RotWith(h,c,r)}else e=h;f=this.editor.getPointInShapeSpace(o,e).toFixed().toJson()}this.currentLineLength+=eF.B.Dist(d.points[0],f),l[l.length-1]={...d,type:"straight",points:[d.points[0],f]};let y={id:n,type:this.shapeType,props:{segments:l}};this.canClose()&&(y.props.isClosed=this.getIsClosed(a,r,i)),this.editor.updateShapes([y]);break}case"free":{let e=a.slice(),l=e[e.length-1],d=[...l.points];if(d.length&&this.mergeNextPoint){let{z:e}=d[d.length-1];d[d.length-1]={x:h.x,y:h.y,z:e?Math.max(e,h.z):h.z}}else this.currentLineLength+=eF.B.Dist(d[d.length-1],h),d.push(h);e[e.length-1]={...l,points:d},this.currentLineLength<4*rQ[o.props.size]&&(this.currentLineLength=this.getLineLength(e));let u={id:n,type:this.shapeType,props:{segments:e}};if(this.canClose()&&(u.props.isClosed=this.getIsClosed(e,r,i)),this.editor.updateShapes([u]),d.length>this.util.options.maxPointsPerShape){this.editor.updateShapes([{id:n,type:this.shapeType,props:{isComplete:!0}}]);let e=(0,L.F1)(),r=this.editor.getShape(n).props;if(!this.editor.canCreateShapes([e]))return this.cancel();this.editor.createShape({id:e,type:this.shapeType,x:(0,ei.FH)(t.currentPagePoint.x),y:(0,ei.FH)(t.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:r.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(1.25*c).toFixed():.5}]}]}});let i=this.editor.getShape(e);if(!i)return this.cancel();this.initialShape=(0,B.v4)(i),this.mergeNextPoint=!1,this.lastRecordedPoint=t.currentPagePoint.clone(),this.currentLineLength=0}}}}getLineLength(e){let t=0;for(let n of e)for(let e=0;e<n.points.length-1;e++){let r=n.points[e],i=n.points[e+1];t+=eF.B.Dist2(i,r)}return Math.sqrt(t)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){let{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}};let toolStates_Idle_Idle=class toolStates_Idle_Idle extends eL.n{static id="idle";onPointerDown(e){this.parent.transition("drawing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}};let DrawShapeTool=class DrawShapeTool extends eL.n{static id="draw";static initial="idle";static isLockable=!1;static useCoalescedEvents=!0;static children(){return[toolStates_Idle_Idle,Drawing]}shapeType="draw";onExit(){let e=this.children.drawing;e.initialShape=void 0}};let FrameShapeTool=class FrameShapeTool extends BaseBoxShapeTool{static id="frame";static initial="idle";shapeType="frame";onCreate(e){if(!e)return;let t=this.editor.getShapePageBounds(e),n=[],r=this.editor.getShapeAncestors(e).map(e=>e.id);this.editor.getSortedChildIdsForParent(e.parentId).map(i=>{let o=this.editor.getShape(i);if(!o||o.id===e.id||o.isLocked)return;let a=this.editor.getShapePageBounds(o);a&&t.contains(a)&&!r.includes(o.id)&&o.parentId===e.parentId&&n.push(o.id)}),this.editor.reparentShapes(n,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}};let geo_toolStates_Idle_Idle=class geo_toolStates_Idle_Idle extends eL.n{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(e){if("Enter"===e.key){if(this.editor.getIsReadonly())return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}}onCancel(){this.editor.setCurrentTool("select")}};let toolStates_Pointing_Pointing=class toolStates_Pointing_Pointing extends eL.n{static id="pointing";onPointerUp(){this.complete()}onPointerMove(e){if(this.editor.inputs.isDragging){let{originPagePoint:t}=this.editor.inputs,n=(0,L.F1)(),r=this.editor.markHistoryStoppingPoint(`creating_geo:${n}`),i=maybeSnapToGrid(t,this.editor);this.editor.createShapes([{id:n,type:"geo",x:i.x,y:i.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(L.Zu),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(n);let o=this.editor.getShape(n);if(!o){this.cancel();return}this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:r,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){let{originPagePoint:e}=this.editor.inputs,t=(0,L.F1)();this.editor.markHistoryStoppingPoint(`creating_geo:${t}`);let n=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,r=this.editor.getStyleForNextShape(L.Zu);this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(L.Zu),scale:n,..."star"===r?{w:200,h:190}:"cloud"===r?{w:300,h:180}:{w:200,h:200}}}]);let i=this.editor.getShape(t);if(!i){this.cancel();return}let{w:o,h:a}=i.props,l=new eF.B(o/2,a/2).mul(n),d=this.editor.getShapeParentTransform(i);d&&l.rot(-d.rotation());let c=maybeSnapToGrid(new eF.B(i.x-l.x,i.y-l.y),this.editor);this.editor.select(t),this.editor.updateShape({id:i.id,type:"geo",x:c.x,y:c.y,props:{geo:this.editor.getStyleForNextShape(L.Zu),w:o*n,h:a*n}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}};let GeoShapeTool=class GeoShapeTool extends eL.n{static id="geo";static initial="idle";static children(){return[geo_toolStates_Idle_Idle,toolStates_Pointing_Pointing]}shapeType="geo"};let HighlightShapeTool=class HighlightShapeTool extends eL.n{static id="highlight";static initial="idle";static useCoalescedEvents=!0;static children(){return[toolStates_Idle_Idle,Drawing]}static isLockable=!1;shapeType="highlight";onExit(){let e=this.children.drawing;e.initialShape=void 0}};let line_toolStates_Idle_Idle=class line_toolStates_Idle_Idle extends eL.n{static id="idle";shapeId="";onEnter(e){this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}};let line_toolStates_Pointing_Pointing=class line_toolStates_Pointing_Pointing extends eL.n{static id="pointing";shape={};markId;onEnter(e){let{inputs:t}=this.editor,{currentPagePoint:n}=t;this.markId=void 0;let r=e.shapeId&&this.editor.getShape(e.shapeId);if(r&&t.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${r.id}`),this.shape=r;let e=this.editor.getShapeHandles(this.shape);if(!e)return;let t=e.filter(e=>"vertex"===e.type).sort(B.hl),i=t[t.length-1],o=t[t.length-2],a=tu._.applyToPoint(this.editor.getShapeParentTransform(this.shape),new eF.B(this.shape.x,this.shape.y)),l=eF.B.Sub(n,a).addXY(.1,.1),d=maybeSnapToGrid(l,this.editor),c=(0,B.v4)(this.shape.props.points);if(eF.B.DistMin(i,o,2)||eF.B.DistMin(d,i,2))c[i.id]={id:i.id,index:i.index,x:d.x,y:d.y};else{let e=(0,B._L)(i.index);c[e]={id:e,index:e,x:d.x,y:d.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:c}}])}else{let e=(0,L.F1)();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${e}`);let t=maybeSnapToGrid(n,this.editor);if(this.editor.createShapes([{id:e,type:"line",x:t.x,y:t.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),!this.editor.getShape(e)){this.cancel();return}this.editor.select(e),this.shape=this.editor.getShape(e)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){let e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");let t=(0,B.Z$)(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...t,x:t.x-.1,y:t.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}};let LineShapeTool=class LineShapeTool extends eL.n{static id="line";static initial="idle";static children(){return[line_toolStates_Idle_Idle,line_toolStates_Pointing_Pointing]}shapeType="line"};let note_toolStates_Idle_Idle=class note_toolStates_Idle_Idle extends eL.n{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}};let aw=new eF.B(100,100),BASE_NOTE_POSITIONS=e=>[[["a1"],new eF.B(100,-100-e.options.adjacentShapeMargin)],[["a2"],new eF.B(300+e.options.adjacentShapeMargin,100)],[["a3"],new eF.B(100,300+e.options.adjacentShapeMargin)],[["a4"],new eF.B(-100-e.options.adjacentShapeMargin,100)]];function getNoteAdjacentPositions(e,t,n,r,i,o){return Object.fromEntries((function(e,t){if(1===t)return BASE_NOTE_POSITIONS(e);let n=200*t,r=e.options.adjacentShapeMargin*t;return[[["a1"],new eF.B(.5*n,-.5*n-r)],[["a2"],new eF.B(1.5*n+r,.5*n)],[["a3"],new eF.B(.5*n,1.5*n+r)],[["a4"],new eF.B(-.5*n-r,.5*n)]]})(e,o).map(([e,o],a)=>{let l=o.clone();return 0===a&&i?l.y-=i:2===a&&r&&(l.y+=r),[e,l.rot(n).add(t)]}))}function getAvailableNoteAdjacentPositions(e,t,n,r){let i;let o=new Set(e.getSelectedShapeIds()),a=(200+e.options.adjacentShapeMargin+r)**2,l=new Map,d=[];for(let i of e.getCurrentPageShapes()){if(!e.isShapeOfType(i,"note")||n!==i.props.scale||o.has(i.id))continue;let a=e.getShapePageTransform(i.id);t===a.rotation()&&(l.set(i,e.getShapePageBounds(i).center),d.push(...Object.values(getNoteAdjacentPositions(e,a.point(),t,i.props.growY,r,n))))}let c=d.length;for(let[t,n]of l)for(let r=0;r<c;r++)(i=d[r])&&!(eF.B.Dist2(n,i)>a)&&e.isPointInShape(t,i)&&(d[r]=void 0);return(0,B.oA)(d)}function getNoteShapeForAdjacentPosition(e,t,n,r,i=!1){let o;let a=e.getCurrentPageShapesSorted(),l=(200+e.options.adjacentShapeMargin**2)**t.props.scale;for(let r=a.length-1;r>=0;r--){let i=a[r];if("note"===i.type&&i.id!==t.id){let t=e.getShapePageBounds(i);if(t&&eF.B.Dist2(t.center,n)<l&&e.isPointInShape(i,n)){o=i;break}}}if(e.complete(),!o||i){e.markHistoryStoppingPoint("creating note shape");let i=(0,L.F1)();e.createShape({id:i,type:"note",x:n.x,y:n.y,rotation:r,opacity:t.opacity,props:{...t.props,richText:(0,L.Ak)(""),growY:0,fontSizeAdjustment:0,url:""}});let a=e.getShape(i);if(!a)return;let l=e.getPointInParentSpace(a,eF.B.Sub(n,eF.B.Rot(aw.clone().mul(a.props.scale),r)));e.updateShape({id:i,type:"note",x:l.x,y:l.y}),o=e.getShape(i)}return e.zoomToSelectionIfOffscreen(16,{animation:{duration:e.options.animationMediumMs},inset:0}),o}let note_toolStates_Pointing_Pointing=class note_toolStates_Pointing_Pointing extends eL.n{static id="pointing";dragged=!1;info={};markId="";shape={};onEnter(){let{editor:e}=this,t=(0,L.F1)();this.markId=e.markHistoryStoppingPoint(`creating_note:${t}`);let n=this.editor.inputs.originPagePoint.clone(),r=function(e,t,n){let r,i=10/e.getZoomLevel();for(let o of getAvailableNoteAdjacentPositions(e,0,n,0)){let e=eF.B.Sub(t,o),n=e.len();n<i&&(i=n,r=e)}return r}(this.editor,n,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);r&&n.sub(r);let i=function(e,t,n){e.createShape({id:t,type:"note",x:n.x,y:n.y,props:{scale:e.user.getIsDynamicResizeMode()?1/e.getZoomLevel():1}});let r=e.getShape(t);if(!r)return;e.select(t);let i=e.getShapeGeometry(r).bounds,o=maybeSnapToGrid(new eF.B(r.x-i.width/2,r.y-i.height/2),e);return e.updateShapes([{id:t,type:"note",x:o.x,y:o.y}]),e.getShape(t)}(this.editor,t,n);i?this.shape=i:this.cancel()}onPointerMove(e){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape}))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}};let NoteShapeTool=class NoteShapeTool extends eL.n{static id="note";static initial="idle";static children(){return[note_toolStates_Idle_Idle,note_toolStates_Pointing_Pointing]}shapeType="note"};let aS=(0,B.P2)(function(e){let t;let n=e.getShapeAtPoint(e.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:e.options.hitTestMargin/e.getZoomLevel(),renderingOnly:!0});if(!n)return e.setHoveredShape(null);let r=e.getOutermostSelectableShape(n);return t=r===n?n:r.id===e.getFocusedGroupId()||e.getSelectedShapeIds().includes(r.id)?n:r,e.setHoveredShape(t.id)},32);let text_toolStates_Idle_Idle=class text_toolStates_Idle_Idle extends eL.n{static id="idle";onPointerMove(e){switch(e.target){case"shape":case"canvas":aS(this.editor)}}onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){aS.cancel()}onKeyDown(e){if("Enter"===e.key){if(this.editor.getIsReadonly())return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}}onCancel(){this.editor.setCurrentTool("select")}};let text_toolStates_Pointing_Pointing=class text_toolStates_Pointing_Pointing extends eL.n{static id="pointing";shape;markId="";enterTime=0;onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(e){if(Date.now()-this.enterTime<150)return;let{editor:t}=this,{isPointing:n}=t.inputs;if(!n)return;let{originPagePoint:r,currentPagePoint:i}=t.inputs,o=Math.abs(r.x-i.x),a=Math.sqrt(t.getInstanceState().isCoarsePointer?t.options.coarseDragDistanceSquared:t.options.dragDistanceSquared),l=6*a/t.getZoomLevel();if(o>l){let n=(0,L.F1)();this.markId=t.markHistoryStoppingPoint(`creating_text:${n}`);let i=this.createTextShape(n,r,!1,o);if(!i){this.cancel();return}this.shape=t.getShape(i),t.select(n);let a=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1;t.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:o*a,y:1},onInteractionEnd:"text",onCreate:()=>{t.setEditingShape(i.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");let e=(0,L.F1)(),{originPagePoint:t}=this.editor.inputs,n=this.createTextShape(e,t,!0,20);n&&(this.editor.select(e),this.editor.setEditingShape(e))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(e,t,n,r){this.editor.createShape({id:e,type:"text",x:t.x,y:t.y,props:{richText:(0,L.Ak)(""),autoSize:n,w:r,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});let i=this.editor.getShape(e);if(!i){this.cancel();return}let o=this.editor.getShapePageBounds(i),a=new eF.B;if(n)switch(i.props.textAlign){case"start":a.x=0;break;case"middle":a.x=-o.width/2;break;case"end":a.x=-o.width}else a.x=0;if(a.y=-o.height/2,(0,L.YT)(i.parentId)){let e=this.editor.getShapeParentTransform(i);a.rot(-e.rotation())}let l=i.x+a.x,d=i.y+a.y;if(this.editor.getInstanceState().isGridMode){let e=new eF.B(l,d),t=maybeSnapToGrid(e,this.editor),n=eF.B.Sub(e,t);this.editor.updateShape({...i,x:l-n.x,y:d-n.y})}else this.editor.updateShape({...i,x:l,y:d});return i}};let TextShapeTool=class TextShapeTool extends eL.n{static id="text";static initial="idle";static children(){return[text_toolStates_Idle_Idle,text_toolStates_Pointing_Pointing]}shapeType="text"};let av=[TextShapeTool,DrawShapeTool,GeoShapeTool,NoteShapeTool,LineShapeTool,FrameShapeTool,ArrowShapeTool,HighlightShapeTool],aT=en.forwardRef(function({isEditing:e,text:t,handleFocus:n,handleChange:r,handleKeyDown:i,handlePaste:o,handleBlur:a,handleInputPointerDown:l,handleDoubleClick:d},c){return(0,et.jsx)("textarea",{ref:c,className:"tl-text tl-text-input",name:"text",tabIndex:-1,disabled:!e,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:t,onFocus:n,onChange:e=>{r({plaintext:e.target.value})},onKeyDown:e=>i(e.nativeEvent),onBlur:a,onTouchEnd:e0.be,onContextMenu:e?e0.be:void 0,onPointerDown:l,onPaste:o,onDoubleClick:d,onDragStart:e0.PF})});function isLegacyAlign(e){return"start-legacy"===e||"middle-legacy"===e||"end-legacy"===e}function useEditablePlainText(e,t,n){let r=useEditableTextCommon(e),i=r.isEditing,o=(0,eW.jE)(),a=(0,en.useRef)(null),l=0===(n||"").trim().length;(0,en.useEffect)(()=>{function selectAllIfEditing(t){t.shapeId===e&&a.current?.select?.()}return o.on("select-all-text",selectAllIfEditing),()=>{o.off("select-all-text",selectAllIfEditing)}},[o,e,i]),(0,en.useEffect)(()=>{i&&(document.activeElement!==a.current&&a.current?.focus(),o.getInstanceState().isCoarsePointer&&a.current?.select(),eH.a.isSafari&&(a.current?.blur(),a.current?.focus()))},[o,i]);let d=(0,en.useCallback)(t=>{o.getEditingShapeId()===e&&"Enter"===t.key&&(t.ctrlKey||t.metaKey)&&o.complete()},[o,e]),c=(0,en.useCallback)(({plaintext:n})=>{if(o.getEditingShapeId()!==e)return;let r=TextHelpers.normalizeText(n||"");o.updateShape({id:e,type:t,props:{text:r}})},[o,e,t]);return{rInput:a,handleKeyDown:d,handleChange:c,isEmpty:l,...r}}function useIsReadyForEditing(e,t){return(0,O.Hg)("isReadyForEditing",()=>{let n=e.getEditingShapeId();return null!==n&&(n===t||e.getHoveredShapeId()===t)},[e,t])}function useEditableTextCommon(e){let t=(0,eW.jE)(),n=(0,O.Hg)("isEditing",()=>t.getEditingShapeId()===e,[t]),r=useIsReadyForEditing(t,e),i=(0,en.useCallback)(n=>{t.dispatch({...(0,e6.Y)(n),type:"pointer",name:"pointer_down",target:"shape",shape:t.getShape(e)}),(0,e0.be)(n)},[t,e]),o=(0,en.useCallback)(n=>{if(t.getEditingShapeId()===e&&n.clipboardData){let e=n.clipboardData.getData("text/html");e&&e.includes("<div data-tldraw")&&(0,e0.PF)(n)}},[t,e]);return{handleFocus:B.ZT,handleBlur:B.ZT,handleInputPointerDown:i,handleDoubleClick:e0.be,handlePaste:o,isEditing:n,isReadyForEditing:r}}let ak=useEditablePlainText,a_=en.memo(function({shapeId:e,type:t,text:n,labelColor:r,font:i,fontSize:o,lineHeight:a,align:l,verticalAlign:d,wrap:c,isSelected:u,padding:h=0,onKeyDown:p,classNamePrefix:f,style:g,textWidth:m,textHeight:y}){let{rInput:b,isEmpty:S,isEditing:v,isReadyForEditing:k,..._}=useEditablePlainText(e,t,n),C=TextHelpers.normalizeTextForDom(n||""),E=C.length>0,M=isLegacyAlign(l);if(!v&&!E)return null;let P=f||"tl-text";return(0,et.jsx)("div",{className:`${P}-label tl-text-wrapper tl-plain-text-wrapper`,"aria-hidden":!v,"data-font":i,"data-align":l,"data-hastext":!S,"data-isediting":v,"data-is-ready-for-editing":k,"data-textwrap":!!c,"data-isselected":u,style:{justifyContent:"middle"===l||M?"center":l,alignItems:"middle"===d?"center":d,padding:h,...g},children:(0,et.jsxs)("div",{className:`${P}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:a.toString(),minHeight:Math.floor(o*a)+"px",minWidth:Math.ceil(m||0),color:r,width:m?Math.ceil(m):void 0,height:y?Math.ceil(y):void 0},children:[(0,et.jsx)("div",{className:`${P} tl-text tl-text-content`,dir:"auto",children:C.split("\n").map((e,t)=>(0,et.jsx)("div",{dir:"auto",children:e},t))}),(k||u)&&(0,et.jsx)(aT,{ref:b,text:n,isEditing:v,shapeId:e,..._,handleKeyDown:p??_.handleKeyDown})]})})}),aC=a_;function useDefaultColorTheme(){return(0,L.y6)({isDarkMode:(0,eJ.G)()})}function getFillDefForExport(e){return{key:`${L.Y8.id}:${e}`,getElement:async()=>"pattern"!==e?null:(0,et.jsx)(HashPatternForExport,{})}}function HashPatternForExport(){let e=useGetHashPatternZoomName(),t=(0,e4.Gj)(),n=useDefaultColorTheme(),r=8/12;return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)("mask",{id:t,children:[(0,et.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),(0,et.jsxs)("g",{strokeLinecap:"round",stroke:"black",children:[(0,et.jsx)("line",{x1:1*r,y1:3*r,x2:3*r,y2:1*r}),(0,et.jsx)("line",{x1:5*r,y1:7*r,x2:7*r,y2:5*r}),(0,et.jsx)("line",{x1:9*r,y1:11*r,x2:11*r,y2:9*r})]})]}),(0,et.jsx)("pattern",{id:e(1,n.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,et.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:n.solid,mask:`url(#${t})`})})]})}function getFillDefForCanvas(){return{key:`${L.Y8.id}:pattern`,component:PatternFillDefForCanvas}}let generateImage=(e,t,n)=>new Promise((r,i)=>{let o=8*t*e,a=document.createElement("canvas");a.width=o,a.height=o;let l=a.getContext("2d");if(!l)return;l.fillStyle=n?L.qi.darkMode.solid:L.qi.lightMode.solid,l.fillRect(0,0,o,o),l.globalCompositeOperation="destination-out",l.lineCap="round",l.lineWidth=1.25*t*e;let d=8/12,s=n=>n*t*e;l.beginPath(),l.moveTo(s(1*d),s(3*d)),l.lineTo(s(3*d),s(1*d)),l.moveTo(s(5*d),s(7*d)),l.lineTo(s(7*d),s(5*d)),l.moveTo(s(9*d),s(11*d)),l.lineTo(s(11*d),s(9*d)),l.stroke(),a.toBlob(e=>{!e||tg.hR.throwToBlob.get()?i():r(e)})}),canvasBlob=(e,t)=>{let n=document.createElement("canvas");n.width=e[0],n.height=e[1];let r=n.getContext("2d");return r?(t(r),n.toDataURL()):""},aI=null;function getPatternLodForZoomLevel(e){return Math.ceil(Math.log2(Math.max(1,e)))}function useGetHashPatternZoomName(){let e=(0,e4.Ws)("hash_pattern");return(0,en.useCallback)((t,n)=>{let r=getPatternLodForZoomLevel(t);return(0,e4.mq)(e,`${n}_${r}`)},[e])}function getPatternLodsToGenerate(e){let t=[],n=getPatternLodForZoomLevel(e);for(let e=0;e<=n;e++)t.push(Math.pow(2,e));return t}function PatternFillDefForCanvas(){let e=(0,eW.jE)(),t=(0,en.useRef)(null),{defs:n,isReady:r}=function(){let e=(0,eW.jE)(),t=(0,O.Hg)("devicePixelRatio",()=>e.getInstanceState().devicePixelRatio,[e]),n=(0,O.Hg)("maxZoom",()=>Math.ceil((0,B.Z$)(e.getCameraOptions().zoomSteps)),[e]),[r,i]=(0,en.useState)(!1),[o,a]=(0,en.useState)(()=>(function(e){let t=(aI||(aI={white:canvasBlob([1,1],e=>{e.fillStyle="#f8f9fa",e.fillRect(0,0,1,1)}),black:canvasBlob([1,1],e=>{e.fillStyle="#212529",e.fillRect(0,0,1,1)})}),aI);return getPatternLodsToGenerate(e).flatMap(e=>[{zoom:e,url:t.white,theme:"light"},{zoom:e,url:t.black,theme:"dark"}])})(n)),l=useGetHashPatternZoomName();(0,en.useEffect)(()=>{let e=Promise.all(getPatternLodsToGenerate(n).flatMap(e=>[generateImage(t,e,!1).then(t=>({zoom:e,theme:"light",url:URL.createObjectURL(t)})),generateImage(t,e,!0).then(t=>({zoom:e,theme:"dark",url:URL.createObjectURL(t)}))])),r=!1;return e.then(e=>{r||(a(e),i(!0))}),()=>{r=!0,i(!1),e.then(e=>{for(let{url:t}of e)URL.revokeObjectURL(t)})}},[t,n]);let d=(0,et.jsx)(et.Fragment,{children:o.map(e=>{let t=l(e.zoom,e.theme);return(0,et.jsx)("pattern",{id:t,width:8,height:8,patternUnits:"userSpaceOnUse",children:(0,et.jsx)("image",{href:e.url,width:8,height:8})},t)})});return{defs:d,isReady:r}}();return(0,en.useEffect)(()=>{if(r&&eH.a.isSafari){let n=function findHtmlLayerParent(e){return e.classList.contains("tl-html-layer")?e:e.parentElement?findHtmlLayerParent(e.parentElement):null}(t.current);n&&e.timers.requestAnimationFrame(()=>{n.style.display="none",e.timers.requestAnimationFrame(()=>{n.style.display=""})})}},[e,r]),(0,et.jsx)("g",{ref:t,"data-testid":r?"ready-pattern-fill-defs":void 0,children:n})}let aE=en.memo(function({theme:e,d:t,color:n,fill:r,scale:i}){switch(r){case"none":return null;case"solid":return(0,et.jsx)("path",{fill:e[n].semi,d:t});case"semi":return(0,et.jsx)("path",{fill:e.solid,d:t});case"fill":return(0,et.jsx)("path",{fill:e[n].fill,d:t});case"pattern":return(0,et.jsx)(PatternFill,{theme:e,color:n,fill:r,d:t,scale:i})}});function PatternFill({d:e,color:t,theme:n}){let r=(0,eW.jE)(),i=(0,eN.l8)(),o=(0,O.Hg)("zoomLevel",()=>r.getZoomLevel(),[r]),a=useGetHashPatternZoomName(),l=.18>=r.getZoomLevel();return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("path",{fill:n[t].pattern,d:e}),(0,et.jsx)("path",{fill:i?`url(#${a(1,n.id)})`:l?n[t].semi:`url(#${a(o,n.id)})`,d:e})]})}function createTextJsxFromSpans(e,t,n){let{padding:r=0}=n;if(0===t.length)return null;let i=e9.xu.From(t[0].box);for(let{box:e}of t)i.union(e);let o=r+(n.offsetX??0),a=(n.offsetY??0)+n.fontSize/2+("start"===n.verticalTextAlign?r:"end"===n.verticalTextAlign?n.height-r-i.height:(Math.ceil(n.height)-i.height)/2),l=null,d=[];for(let{text:e,box:n}of t){let t=null!==l&&n.y>l;t&&d.push((0,et.jsx)("tspan",{alignmentBaseline:"mathematical",x:o,y:n.y+a,children:"\n"},d.length)),d.push((0,et.jsx)("tspan",{alignmentBaseline:"mathematical",x:n.x+o,y:n.y+a,unicodeBidi:"plaintext",children:e.replace(/\s/g,"\xa0")},d.length)),l=n.y}return(0,et.jsx)("text",{fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:n.stroke,strokeWidth:n.strokeWidth,fill:n.fill,children:d})}function SvgTextLabel({fontSize:e,font:t,align:n,verticalAlign:r,text:i,labelColor:o,bounds:a,padding:l=16,stroke:d=!0,showTextOutline:c=!0}){let u=(0,eW.jE)(),h=useDefaultColorTheme(),p={fontSize:e,fontFamily:L.p6[t],textAlign:n,verticalTextAlign:r,width:Math.ceil(a.width),height:Math.ceil(a.height),padding:l,lineHeight:rJ.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:o,stroke:void 0,strokeWidth:void 0},f=u.textMeasure.measureTextSpans(i,p),g=function(e,t,n,r){if(("start-legacy"===e||"end-legacy"===e)&&0!==n.length){let i=e9.xu.From(n[0].box);for(let{box:e}of n)i.union(e);if("start-legacy"===e)return(r-2*t-i.width)/2;if("end-legacy"===e)return-(r-2*t-i.width)/2}}(n,l,f,a.width);g&&(p.offsetX=g),p.offsetX+=a.x,p.offsetY+=a.y;let m=createTextJsxFromSpans(u,f,p),y=null;return c&&d&&(p.fill=h.background,p.stroke=h.background,p.strokeWidth=3,y=createTextJsxFromSpans(u,f,p)),(0,et.jsxs)(et.Fragment,{children:[y,m]})}function getArrowBodyPath(e,t,n){switch(t.type){case"straight":return new PathBuilder().moveTo(t.start.point.x,t.start.point.y,{offset:0,roundness:0}).lineTo(t.end.point.x,t.end.point.y,{offset:0,roundness:0}).toSvg(n);case"arc":return new PathBuilder().moveTo(t.start.point.x,t.start.point.y,{offset:0,roundness:0}).circularArcTo(t.bodyArc.radius,!!t.bodyArc.largeArcFlag,!!t.bodyArc.sweepFlag,t.end.point.x,t.end.point.y,{offset:0,roundness:0}).toSvg(n);case"elbow":{let e=new PathBuilder;e.moveTo(t.start.point.x,t.start.point.y,{offset:0});for(let n=1;n<t.route.points.length;n++){let r=t.route.points[n];t.route.skipPointsWhenDrawing.has(r)||e.lineTo(r.x,r.y,{offset:n===t.route.points.length-1?0:void 0})}return e.toSvg(n)}default:(0,B.iP)(t,"type")}}function getArrowBodyGeometry(e,t){let n=shared_getArrowInfo(e,t);switch(n.type){case"straight":return new tl.W({start:eF.B.From(n.start.point),end:eF.B.From(n.end.point)});case"arc":return new Arc2d({center:eF.B.Cast(n.handleArc.center),start:eF.B.Cast(n.start.point),end:eF.B.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});case"elbow":return new to.q({points:n.route.points});default:(0,B.iP)(n,"type")}}let aM=(0,R.mV)("arrow label size",(e,t)=>{e.fonts.trackFontsForShape(t);let n=0,r=0,i=getArrowBodyGeometry(e,t),o=t.props.text||"i",a=i.bounds,l=getArrowLabelFontSize(t),{w:d,h:c}=e.textMeasure.measureText(o,{...rJ,fontFamily:r3[t.props.font],fontSize:l,maxWidth:null});n=d,r=c;let u=!1,h=shared_getArrowInfo(e,t),p=getLabelToArrowPadding(t),f="elbow"===h.type?Math.max(h.elbow.A.arrowheadOffset+p,32)+Math.max(h.elbow.B.arrowheadOffset+p,32):64;if(a.width>a.height?(n=Math.max(Math.min(d,f),Math.min(a.width-f,d)),u=!0):n>16*l&&(n=16*l,u=!0),u){let{w:i,h:a}=e.textMeasure.measureText(o,{...rJ,fontFamily:r3[t.props.font],fontSize:l,maxWidth:n});n=i,r=a}return new eF.B(n,r).addScalar(8.5*t.props.scale)},{areRecordsEqual:(e,t)=>{if(e.props===t.props)return!0;let n=(0,B.nu)(e.props,t.props);return 1===n.length&&"labelPosition"===n[0]}});function getArrowLabelSize(e,t){return aM.get(e,t.id)??new eF.B(0,0)}function getLabelToArrowPadding(e){let t=rQ[e.props.size],n=(20+(t-rQ.s)*2+(t===rQ.xl?20:0))*e.props.scale;return n}function getArrowLabelPosition(e,t){let n=[],r=shared_getArrowInfo(e,t),i={hasStartBinding:!!r.bindings.start,hasEndBinding:!!r.bindings.end,hasStartArrowhead:"none"!==r.start.arrowhead,hasEndArrowhead:"none"!==r.end.arrowhead},o=function(e,t,n){let r,i;let o=getArrowBodyGeometry(e,t),a=[],l=[new td.m({children:[o],debugColor:"lime"})],d=getArrowLabelSize(e,t),c=getLabelToArrowPadding(t),u=c/o.length;if("elbow"===n.type)a.push(n.start.point,n.end.point),r=e9.xu.FromCenter(n.start.point,d).expandBy(c),i=e9.xu.FromCenter(n.end.point,d).expandBy(c);else{let e=o.interpolateAlongEdge(u),t=o.interpolateAlongEdge(1-u);a.push(e,t),r=e9.xu.FromCenter(e,d),i=e9.xu.FromCenter(t,d)}let h=o.intersectPolygon(r.corners),p=o.intersectPolygon(i.corners),f=furthest(n.start.point,h),g=furthest(n.end.point,p),m=f?o.uninterpolateAlongEdge(f):.5,y=g?o.uninterpolateAlongEdge(g):.5;for(let e of(m>y&&(m=.5,y=.5),[...h,...p,...a]))l.push(new Circle2d({x:e.x-3,y:e.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));return l.push(new tc.w({points:r.corners,debugColor:"lime",isFilled:!1,ignore:!0}),new tc.w({points:i.corners,debugColor:"lime",isFilled:!1,ignore:!0})),{start:m,end:y,dbg:l}}(e,t,r);o.dbg&&n.push(...o.dbg);let a=function(e,t,n){let{hasEndArrowhead:r,hasEndBinding:i,hasStartBinding:o,hasStartArrowhead:a}=n,l=(0,ei.uZ)(e.props.labelPosition,a||o?t.start:0,r||i?t.end:1);return l}(t,o,i),l=getArrowBodyGeometry(e,t),d=l.interpolateAlongEdge(a),c=getArrowLabelSize(e,t);return{box:e9.xu.FromCenter(d,c),debugGeom:n}}function furthest(e,t){let n=null,r=-1/0;for(let i of t){let t=eF.B.Dist2(e,i);t>r&&(n=i,r=t)}return n}function getArrowLabelFontSize(e){return r2[e.props.size]*e.props.scale}function getArrowLabelDefaultPosition(e,t){let n=shared_getArrowInfo(e,t);switch(n.type){case"straight":case"arc":return .5;case"elbow":{let r=n.route.midpointHandle,i=getArrowBodyGeometry(e,t);if(r&&i)return i.uninterpolateAlongEdge(r.point);return .5}default:(0,B.iP)(n,"type")}}function getArrowheadPathForType(e,t,n){let r="end"===t?e.end.arrowhead:e.start.arrowhead;if("none"===r)return;let i=function(e,t,n){let r;let i="end"===t?e.end.point:e.start.point;switch(e.type){case"straight":{let o="end"===t?e.start.point:e.end.point,a=eF.B.Dist(o,i),l=(0,ei.uZ)(a/5,n,3*n);r=eF.B.Nudge(i,o,l);break}case"arc":{let o=Math.abs(e.bodyArc.length),a=(0,ei.uZ)(o/5,n,3*n),l=(0,tn.bO)(i,a,e.handleArc.center,e.handleArc.radius);r="end"===t?e.handleArc.sweepFlag?l[0]:l[1]:e.handleArc.sweepFlag?l[1]:l[0];break}case"elbow":{let o="end"===t?e.route.points[e.route.points.length-2]:e.route.points[1],a=eF.B.ManhattanDist(o,i),l=(0,ei.uZ)(a/2,n,3*n);r=o?eF.B.Nudge(i,o,l):i;break}default:(0,B.iP)(e,"type")}return eF.B.IsNaN(r)&&(r=i),{point:i,int:r}}(e,t,n);if(i){switch(r){case"bar":return function({int:e,point:t}){let n=eF.B.Sub(e,t).div(2),r=eF.B.Add(t,eF.B.Rot(n,ei.pj)),i=eF.B.Sub(t,eF.B.Rot(n,ei.pj));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}(i);case"square":return function({int:e,point:t}){let n=eF.B.Lrp(t,e,.85),r=eF.B.Sub(n,t).div(2),i=eF.B.Add(t,eF.B.Rot(r,ei.pj)),o=eF.B.Sub(t,eF.B.Rot(r,ei.pj)),a=eF.B.Add(n,eF.B.Rot(r,ei.pj)),l=eF.B.Sub(n,eF.B.Rot(r,ei.pj));return`M ${i.x} ${i.y} L ${a.x} ${a.y} L ${l.x} ${l.y} L ${o.x} ${o.y} Z`}(i);case"diamond":return function({point:e,int:t}){let n=eF.B.Lrp(e,t,.75),r=eF.B.RotWith(n,e,ei.PI/4),i=eF.B.RotWith(n,e,-ei.PI/4),o=eF.B.Lrp(r,i,.5);return o.add(eF.B.Sub(o,e)),`M ${o.x} ${o.y} L ${i.x} ${i.y} ${e.x} ${e.y} L ${r.x} ${r.y} Z`}(i);case"dot":return function({point:e,int:t}){let n=eF.B.Lrp(e,t,.45),r=eF.B.Dist(n,e);return`M ${n.x-r},${n.y}
  a ${r},${r} 0 1,0 ${2*r},0
  a ${r},${r} 0 1,0 -${2*r},0 `}(i);case"inverted":return function({point:e,int:t}){let n=eF.B.Sub(t,e).div(2),r=eF.B.Add(e,eF.B.Rot(n,ei.pj)),i=eF.B.Sub(e,eF.B.Rot(n,ei.pj));return`M ${r.x} ${r.y} L ${t.x} ${t.y} L ${i.x} ${i.y} Z`}(i);case"arrow":return function({point:e,int:t}){let n=eF.B.RotWith(t,e,ei.PI/6),r=eF.B.RotWith(t,e,-ei.PI/6);return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${r.x} ${r.y}`}(i);case"triangle":return function({point:e,int:t}){let n=eF.B.RotWith(t,e,ei.PI/6),r=eF.B.RotWith(t,e,-ei.PI/6);return`M ${n.x} ${n.y} L ${r.x} ${r.y} L ${e.x} ${e.y} Z`}(i)}return""}}function ElbowArrowDebug({arrow:e}){let t=(0,eW.jE)(),n=(0,O.Hg)("elbow arrow grid",()=>{try{let n=getElbowArrowInfo(t,t.getShape(e.id),getArrowBindings(t,e));return n}catch(e){console.error(e);return}},[t,e.id]);if(!n)return null;let r=e9.xu.Common([n.A.original,n.B.original]).expandBy(50),i=n.route?.name??"",o=n.route?.midpointHandle;return(0,et.jsxs)(et.Fragment,{children:[null!==n.midX&&(0,et.jsx)(DebugLine,{a:{x:n.midX,y:r.minY},b:{x:n.midX,y:r.maxY},stroke:"red"}),null!==n.midY&&(0,et.jsx)(DebugLine,{a:{x:r.minX,y:n.midY},b:{x:r.maxX,y:n.midY},stroke:"blue"}),o?.axis==="x"&&n.midXRange&&(0,et.jsx)(DebugLine,{a:{x:n.midXRange.lo,y:o.point.y},b:{x:n.midXRange.hi,y:o.point.y},stroke:"red",strokeDasharray:"0 2"}),o?.axis==="y"&&n.midYRange&&(0,et.jsx)(DebugLine,{a:{x:o.point.x,y:n.midYRange.lo},b:{x:o.point.x,y:n.midYRange.hi},stroke:"blue",strokeDasharray:"0 2"}),(0,et.jsx)(DebugBox,{box:n.A.original,stroke:"orange"}),(0,et.jsx)(DebugBox,{box:n.A.expanded,stroke:"orange",strokeWidth:.5}),(0,et.jsx)(DebugBox,{box:n.A.original.clone().expandBy(n.options.minElbowLegLength),stroke:"orange",strokeWidth:.5}),(0,et.jsx)(DebugBox,{box:n.B.original,stroke:"lightskyblue"}),(0,et.jsx)(DebugBox,{box:n.B.expanded,stroke:"lightskyblue",strokeWidth:.5}),(0,et.jsx)(DebugBox,{box:n.B.original.clone().expandBy(n.options.minElbowLegLength),stroke:"lightskyblue",strokeWidth:.5}),(0,et.jsx)(DebugEdge,{edge:n.A.edges.top,axis:"x",stroke:"orange"}),(0,et.jsx)(DebugEdge,{edge:n.B.edges.top,axis:"x",stroke:"lightskyblue"}),(0,et.jsx)(DebugEdge,{edge:n.A.edges.right,axis:"y",stroke:"orange"}),(0,et.jsx)(DebugEdge,{edge:n.B.edges.right,axis:"y",stroke:"lightskyblue"}),(0,et.jsx)(DebugEdge,{edge:n.A.edges.bottom,axis:"x",stroke:"orange"}),(0,et.jsx)(DebugEdge,{edge:n.B.edges.bottom,axis:"x",stroke:"lightskyblue"}),(0,et.jsx)(DebugEdge,{edge:n.A.edges.left,axis:"y",stroke:"orange"}),(0,et.jsx)(DebugEdge,{edge:n.B.edges.left,axis:"y",stroke:"lightskyblue"}),n.route&&(0,et.jsx)(DebugRoute,{route:n.route.points,strokeWidth:10}),(0,et.jsx)("text",{x:r.minX+5,y:r.minY-3,fontSize:10,fill:"black",stroke:"var(--color-background)",strokeWidth:2,paintOrder:"stroke",children:i}),(0,et.jsxs)("text",{x:n.A.expanded.x,y:n.A.expanded.y,fontSize:10,fill:"black",stroke:"var(--color-background)",strokeWidth:2,paintOrder:"stroke",children:["A",n.route&&`, ${n.route.aEdgePicking}`,n.A.isPoint&&", point"]}),(0,et.jsxs)("text",{x:n.B.expanded.x,y:n.B.expanded.y,fontSize:10,fill:"black",stroke:"var(--color-background)",strokeWidth:2,paintOrder:"stroke",children:["B",n.route&&`, ${n.route.bEdgePicking}`,n.B.isPoint&&", point"]})]})}function DebugLine({a:e,b:t,...n}){return(0,et.jsx)("line",{fill:"none",strokeWidth:1,strokeDasharray:"4,4",stroke:"green",x1:e.x,y1:e.y,x2:t.x,y2:t.y,...n})}function DebugRoute({route:e,...t}){return(0,et.jsx)("polyline",{fill:"none",stroke:"darkorchid",strokeWidth:3,opacity:.5,points:e.map(e=>`${e.x},${e.y}`).join(" "),...t})}function DebugEdge({edge:e,axis:t,...n}){if(!e||null===e.expanded)return null;let vec=e=>"x"===t?{x:e.y,y:e.x}:e;return(0,et.jsxs)("g",{children:[(0,et.jsx)(DebugLine,{a:vec({x:e.expanded,y:e.cross.min}),b:vec({x:e.expanded,y:e.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...n}),(0,et.jsx)(DebugLine,{a:vec({x:e.expanded-4,y:e.cross.min}),b:vec({x:e.expanded+4,y:e.cross.min}),strokeDasharray:"0",strokeWidth:1.5,...n}),(0,et.jsx)(DebugLine,{a:vec({x:e.expanded-4,y:e.cross.max}),b:vec({x:e.expanded+4,y:e.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...n})]})}function DebugBox({box:e,...t}){return(0,et.jsx)("rect",{x:e.minX,y:e.minY,width:e.width,height:e.height,strokeDasharray:"4,4",strokeWidth:1,fill:"none",...t})}let aP=new B.kM;function perpDistanceToLineAngle(e,t){let n=eF.B.FromAngle(t).per();return eF.B.Dpr(e,n)}var aA=((i=aA||{}).Start="start",i.Middle="middle",i.End="end",i);let ArrowShapeUtil=class ArrowShapeUtil extends eB.E{static type="arrow";static props=L.si;static migrations=L.Vm;options={expandElbowLegLength:{s:28,m:36,l:44,xl:66},minElbowLegLength:{s:3*rQ.s,m:3*rQ.m,l:3*rQ.l,xl:3*rQ.xl},minElbowHandleDistance:16,arcArrowCenterSnapDistance:16,elbowArrowCenterSnapDistance:24,elbowArrowEdgeSnapDistance:20,elbowArrowPointSnapDistance:24,elbowArrowAxisSnapDistance:16,labelCenterSnapDistance:10,elbowMidpointSnapDistance:10,elbowMinSegmentLengthToShowMidpointHandle:20,hoverPreciseTimeout:600,pointingPreciseTimeout:320,shouldBeExact:e=>e.inputs.altKey,shouldIgnoreTargets:e=>e.inputs.ctrlKey};canEdit(){return!0}canBind({toShapeType:e}){return"arrow"!==e}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}canBeLaidOut(e,t){if("flip"===t.type){let n=getArrowBindings(this.editor,e),{start:r,end:i}=n,{shapes:o=[]}=t;if(r&&!o.find(e=>e.id===r.toId)||i&&!o.find(e=>e.id===i.toId))return!1}return!0}getFontFaces(e){return e.props.text?[al[`tldraw_${e.props.font}`].normal.normal]:F.LZ}getDefaultProps(){return{kind:"arc",elbowMidPoint:.5,dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(e){let t;let n=this.editor.getEditingShapeId()===e.id,r=shared_getArrowInfo(this.editor,e),i=[],o="straight"===r.type?new tl.W({start:eF.B.From(r.start.point),end:eF.B.From(r.end.point)}):"arc"===r.type?new Arc2d({center:eF.B.Cast(r.handleArc.center),start:eF.B.Cast(r.start.point),end:eF.B.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag}):new to.q({points:r.route.points});if(n||e.props.text.trim()){let n=getArrowLabelPosition(this.editor,e);tg.hR.debugGeometry.get()&&i.push(...n.debugGeom),t=new eD.z({x:n.box.x,y:n.box.y,width:n.box.w,height:n.box.h,isFilled:!0,isLabel:!0})}return new td.m({children:[...t?[o,t]:[o],...i]})}getHandles(e){let t=shared_getArrowInfo(this.editor,e),n=[{id:"start",type:"vertex",index:"a1",x:t.start.handle.x,y:t.start.handle.y},{id:"end",type:"vertex",index:"a3",x:t.end.handle.x,y:t.end.handle.y}];if("arc"===e.props.kind&&("straight"===t.type||"arc"===t.type)&&n.push({id:"middle",type:"virtual",index:"a2",x:t.middle.x,y:t.middle.y}),"elbow"===e.props.kind&&"elbow"===t.type&&t.route.midpointHandle){let r=this.editor.getShapePageTransform(e.id),i=r.applyToPoint(t.route.midpointHandle.segmentStart),o=r.applyToPoint(t.route.midpointHandle.segmentEnd),a=eF.B.Dist(i,o)*this.editor.getZoomLevel();a>this.options.elbowMinSegmentLengthToShowMidpointHandle&&n.push({id:"middle",type:"vertex",index:"a2",x:t.route.midpointHandle.point.x,y:t.route.midpointHandle.point.y})}return n}getText(e){return e.props.text}onHandleDrag(e,t){let n=t.handle.id;switch(n){case"middle":switch(e.props.kind){case"arc":return this.onArcMidpointHandleDrag(e,t);case"elbow":return this.onElbowMidpointHandleDrag(e,t);default:(0,B.iP)(e.props.kind)}case"start":case"end":return this.onTerminalHandleDrag(e,t,n);default:(0,B.iP)(n)}}onArcMidpointHandleDrag(e,{handle:t}){let n=getArrowBindings(this.editor,e),{start:r,end:i}=getArrowTerminalsInArrowSpace(this.editor,e,n),o=eF.B.Sub(i,r),a=eF.B.Per(o),l=eF.B.Med(i,r),d=eF.B.Sub(l,a),c=eF.B.Add(l,a),u=eF.B.NearestPointOnLineSegment(d,c,t,!1),h=eF.B.Dist(u,l);return eF.B.Clockwise(u,i,l)&&(h*=-1),{id:e.id,type:e.type,props:{bend:h}}}onElbowMidpointHandleDrag(e,{handle:t}){var n;let r=shared_getArrowInfo(this.editor,e);if(r?.type!=="elbow")return;let i=this.editor.getShapePageTransform(e.id),o=i.applyToPoint(t),a=r.route.midpointHandle?.axis;if(!a)return;let l=rj[a],d=r.elbow[l.midRange];if(!d)return;let c=eF.B.Angle(i.applyToPoint(l.v(0,0)),i.applyToPoint(l.v(0,1)));c<0&&(c+=Math.PI);let u=perpDistanceToLineAngle(o,c),h=perpDistanceToLineAngle(i.applyToPoint(l.v(d.lo,0)),c),p=perpDistanceToLineAngle(i.applyToPoint(l.v(d.hi,0)),c),f=this.options.elbowMidpointSnapDistance/this.editor.getZoomLevel(),g=perpDistanceToLineAngle(i.applyToPoint(l.v((0,B.t7)(d.lo,d.hi,.5),0)),c),m=g,y=Math.abs(g-u);for(let[e,t]of(n=this.editor,aP.get(n,e=>{let t=(0,F.Fl)("current selected arrow shape",()=>{let t=e.getOnlySelectedShape();return t&&e.isShapeOfType(t,"arrow")?t.id:null}),n=e.store.query.ids("shape",()=>{let e=t.get();return e?{type:{eq:"arrow"},id:{neq:e}}:{type:{eq:"arrow"}}});return(0,F.Fl)("elbow arrow snap lines",()=>{let t=new Map,r=e.getCurrentPageShapeIds(),i=e.getViewportPageBounds();for(let o of n.get()){if(!r.has(o))continue;let n=e.getShape(o);if(n?.type!=="arrow")continue;let a=e.getShapePageBounds(o);if(!a||!i.includes(a))continue;let l=getArrowBindings(e,n),d=e.getShapePageTransform(o);if(!d)continue;let c=e.getShapeGeometry(o),u=d.applyToPoints(c.vertices);for(let e=1;e<u.length;e++){let n=u[e-1],r=u[e],i=eF.B.Angle(n,r);i<0&&(i+=Math.PI);let o=t.get(i);o||(o=new Set,t.set(i,o));let a=perpDistanceToLineAngle(n,i);o.add({perpDistance:a,startBoundShapeId:l.start?.toId,endBoundShapeId:l.end?.toId})}}return t})}).get())){let{isParallel:n,isFlippedParallel:i}=function(e,t,n=1e-4){let r=Math.abs(e-t),i=Math.abs(r-ei.yo)<n;return{isParallel:r<n||i,isFlippedParallel:Math.abs(r-Math.PI)<n}}(c,e);if(n||i)for(let e of t){let t=e.startBoundShapeId&&(e.startBoundShapeId===r.bindings.start?.toId||e.startBoundShapeId===r.bindings.end?.toId),n=e.endBoundShapeId&&(e.endBoundShapeId===r.bindings.start?.toId||e.endBoundShapeId===r.bindings.end?.toId);if(!t&&!n)continue;let o=i?-e.perpDistance:e.perpDistance,a=Math.abs(o-u);a<y&&(m=o,y=a)}}y>f&&(m=u);let b=(0,ei.uZ)((0,B.VN)(h,p,m),0,1);return{id:e.id,type:e.type,props:{elbowMidPoint:b}}}onTerminalHandleDrag(e,{handle:t,isPrecise:n},r){let i=getArrowBindings(this.editor,e),o={id:e.id,type:"arrow",props:{}},a=i[r],l="start"===r?"end":"start",d=i[l],c=updateArrowTargetState({editor:this.editor,pointInPageSpace:this.editor.getShapePageTransform(e.id).applyToPoint(t),arrow:e,isPrecise:n,currentBinding:a,oppositeBinding:d});if(!c){removeArrowBinding(this.editor,e,r);let n=maybeSnapToGrid(new eF.B(t.x,t.y),this.editor);return o.props[r]={x:n.x,y:n.y},o}let u={terminal:r,normalizedAnchor:c.normalizedAnchor,isPrecise:c.isPrecise,isExact:c.isExact,snap:c.snap};createOrUpdateArrowBinding(this.editor,e,c.target.id,u);let h=getArrowBindings(this.editor,e);return h.start&&h.end&&h.start.toId===h.end.toId&&eF.B.Equals(h.start.props.normalizedAnchor,h.end.props.normalizedAnchor)&&createOrUpdateArrowBinding(this.editor,e,h.end.toId,{...h.end.props,normalizedAnchor:{x:h.end.props.normalizedAnchor.x+.05,y:h.end.props.normalizedAnchor.y}}),o}onTranslateStart(e){let t=getArrowBindings(this.editor,e);if("elbow"===e.props.kind&&this.editor.getOnlySelectedShapeId()===e.id){let n=shared_getArrowInfo(this.editor,e);if(!n)return;let r={id:e.id,type:"arrow",props:{}};return t.start&&(r.props.start={x:n.start.point.x,y:n.start.point.y},removeArrowBinding(this.editor,e,"start")),t.end&&(r.props.end={x:n.end.point.x,y:n.end.point.y},removeArrowBinding(this.editor,e,"end")),r}let n=getArrowTerminalsInArrowSpace(this.editor,e,t),r=this.editor.getShapePageTransform(e.id),i=this.editor.getSelectedShapeIds();if(!(t.start&&(i.includes(t.start.toId)||this.editor.isAncestorSelected(t.start.toId))||t.end&&(i.includes(t.end.toId)||this.editor.isAncestorSelected(t.end.toId))))for(let i of(aD.set(e,{pagePosition:r.applyToPoint(e),terminalBindings:(0,B.Fm)(n,(e,n)=>{let i=t[e];return i?{binding:i,shapePosition:n,pagePosition:r.applyToPoint(n)}:null})}),t.start&&(updateArrowTerminal({editor:this.editor,arrow:e,terminal:"start",useHandle:!0}),e=this.editor.getShape(e.id)),t.end&&updateArrowTerminal({editor:this.editor,arrow:e,terminal:"end",useHandle:!0}),["start","end"])){let e=t[i];e&&this.editor.updateBinding({...e,props:{...e.props,isPrecise:!0}})}}onTranslate(e,t){let n=aD.get(e);if(!n)return;let r=this.editor.getShapePageTransform(t.id),i=eF.B.Sub(r.applyToPoint(t),n.pagePosition);for(let e of Object.values(n.terminalBindings)){if(!e)continue;let n=eF.B.Add(e.pagePosition,eF.B.Mul(i,.5)),r=this.editor.getShapeAtPoint(n,{hitInside:!0,hitFrameInside:!0,margin:0,filter:e=>!e.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:e,binding:"arrow"})});if(r?.id===e.binding.toId){let i=e9.xu.ZeroFix(this.editor.getShapeGeometry(r).bounds),o=this.editor.getPointInShapeSpace(r,n),a={x:(o.x-i.minX)/i.width,y:(o.y-i.minY)/i.height};createOrUpdateArrowBinding(this.editor,t,r.id,{...e.binding.props,normalizedAnchor:a,isPrecise:!0})}else removeArrowBinding(this.editor,t,e.binding.props.terminal)}}_resizeInitialBindings=new B.kM;onResize(e,t){let{scaleX:n,scaleY:r}=t,i=this._resizeInitialBindings.get(e,()=>getArrowBindings(this.editor,e)),o=getArrowTerminalsInArrowSpace(this.editor,e,i),{start:a,end:l}=(0,B.v4)(e.props),{bend:d}=e.props;i.start||(a.x=o.start.x*n,a.y=o.start.y*r),i.end||(l.x=o.end.x*n,l.y=o.end.y*r);let c=Math.abs(n),u=Math.abs(r),h=i?.start?eF.B.From(i.start.props.normalizedAnchor):null,p=i?.end?eF.B.From(i.end.props.normalizedAnchor):null;n<0&&r>=0?(0!==d&&(d*=-1*Math.max(c,u)),h&&(h.x=1-h.x),p&&(p.x=1-p.x)):n>=0&&r<0?(0!==d&&(d*=-1*Math.max(c,u)),h&&(h.y=1-h.y),p&&(p.y=1-p.y)):n>=0&&r>=0?0!==d&&(d*=Math.max(c,u)):n<0&&r<0&&(0!==d&&(d*=Math.max(c,u)),h&&(h.x=1-h.x,h.y=1-h.y),p&&(p.x=1-p.x,p.y=1-p.y)),i.start&&h&&createOrUpdateArrowBinding(this.editor,e,i.start.toId,{...i.start.props,normalizedAnchor:h.toJson()}),i.end&&p&&createOrUpdateArrowBinding(this.editor,e,i.end.toId,{...i.end.props,normalizedAnchor:p.toJson()});let f={props:{start:a,end:l,bend:d}};return f}onDoubleClickHandle(e,t){switch(t.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:"none"===e.props.arrowheadStart?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:"none"===e.props.arrowheadEnd?"arrow":"none"}}}}component(e){let t=useDefaultColorTheme(),n=this.editor.getOnlySelectedShape(),r=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),i=shared_getArrowInfo(this.editor,e);if(!i?.isValid)return null;let o=getArrowLabelPosition(this.editor,e),a=e.id===this.editor.getOnlySelectedShapeId(),l=this.editor.getEditingShapeId()===e.id,d=l||e.props.text;return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)(ef.g,{style:{minWidth:50,minHeight:50},children:[(0,et.jsx)(aj,{shape:e,shouldDisplayHandles:r&&n?.id===e.id}),"elbow"===e.props.kind&&tg.hR.debugElbowArrows.get()&&(0,et.jsx)(ElbowArrowDebug,{arrow:e})]}),d&&(0,et.jsx)(a_,{shapeId:e.id,classNamePrefix:"tl-arrow",type:"arrow",font:e.props.font,fontSize:getArrowLabelFontSize(e),lineHeight:rJ.lineHeight,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:t[e.props.labelColor].solid,textWidth:o.box.w-8.5*e.props.scale,isSelected:a,padding:0,style:{transform:`translate(${o.box.center.x}px, ${o.box.center.y}px)`}})]})}indicator(e){let t=useIsEditing(e.id),n=(0,e4.Ws)(e.id+"_clip"),r=shared_getArrowInfo(this.editor,e);if(!r)return null;let{start:i,end:o}=getArrowTerminalsInArrowSpace(this.editor,e,r?.bindings),a=this.editor.getShapeGeometry(e),l=a.bounds,d=t||e.props.text.trim()?a.children[1]:null;if(eF.B.Equals(i,o))return null;let c=rQ[e.props.size]*e.props.scale,u=r.start.arrowhead&&getArrowheadPathForType(r,"start",c),h=r.end.arrowhead&&getArrowheadPathForType(r,"end",c),p=u&&"arrow"!==r.start.arrowhead||h&&"arrow"!==r.end.arrowhead||!!d,f=d?d.getBounds():new e9.xu(0,0,0,0);if(t&&d)return(0,et.jsx)("rect",{x:(0,ei.$Z)(f.x),y:(0,ei.$Z)(f.y),width:f.w,height:f.h,rx:3.5*e.props.scale,ry:3.5*e.props.scale});let g=!("none"===r.start.arrowhead||"arrow"===r.start.arrowhead),m=!("none"===r.end.arrowhead||"arrow"===r.end.arrowhead);return(0,et.jsxs)("g",{children:[p&&(0,et.jsx)("defs",{children:(0,et.jsx)(ArrowClipPath,{radius:3.5*e.props.scale,hasText:e.props.text.trim().length>0,bounds:l,labelBounds:f,as:g&&u?u:"",ae:m&&h?h:""})}),(0,et.jsxs)("g",{style:{clipPath:p?`url(#${n})`:void 0,WebkitClipPath:p?`url(#${n})`:void 0},children:[p&&(0,et.jsx)("rect",{x:l.minX-100,y:l.minY-100,width:l.width+200,height:l.height+200,opacity:0}),getArrowBodyPath(e,r,"draw"===e.props.dash?{style:"draw",randomSeed:e.id,strokeWidth:1,passes:1,offset:0,roundness:2*c,props:{strokeWidth:void 0}}:{style:"solid",strokeWidth:1,props:{strokeWidth:void 0}})]}),u&&(0,et.jsx)("path",{d:u}),h&&(0,et.jsx)("path",{d:h}),d&&(0,et.jsx)("rect",{x:(0,ei.$Z)(f.x),y:(0,ei.$Z)(f.y),width:f.w,height:f.h,rx:3.5,ry:3.5})]})}onEditStart(e){if(""===e.props.text.trim()){let t=getArrowLabelDefaultPosition(this.editor,e);this.editor.updateShape({id:e.id,type:e.type,props:{labelPosition:t}})}}onEditEnd(e){let{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])}toSvg(e,t){t.addExportDef(getFillDefForExport(e.props.fill));let n=(0,L.y6)(t),r=1/e.props.scale;return(0,et.jsxs)("g",{transform:`scale(${r})`,children:[(0,et.jsx)(aj,{shape:e,shouldDisplayHandles:!1}),(0,et.jsx)(SvgTextLabel,{fontSize:getArrowLabelFontSize(e),font:e.props.font,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:n[e.props.labelColor].solid,bounds:getArrowLabelPosition(this.editor,e).box.clone().expandBy(-4.25*e.props.scale),padding:0,showTextOutline:!0})]})}getCanvasSvgDefs(){return[getFillDefForCanvas(),{key:"arrow:dot",component:ArrowheadDotDef},{key:"arrow:cross",component:ArrowheadCrossDef}]}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,scale:(0,B.t7)(e.props.scale,t.props.scale,n),start:{x:(0,B.t7)(e.props.start.x,t.props.start.x,n),y:(0,B.t7)(e.props.start.y,t.props.start.y,n)},end:{x:(0,B.t7)(e.props.end.x,t.props.end.x,n),y:(0,B.t7)(e.props.end.y,t.props.end.y,n)},bend:(0,B.t7)(e.props.bend,t.props.bend,n),labelPosition:(0,B.t7)(e.props.labelPosition,t.props.labelPosition,n)}}};let aj=(0,O.j)(function({shape:e,shouldDisplayHandles:t}){let n=(0,eW.jE)(),r=useDefaultColorTheme(),i=shared_getArrowInfo(n,e),o=(0,O.Hg)("force solid",()=>.2>n.getZoomLevel(),[n]),a=(0,e4.Ws)(e.id+"_clip"),l=(0,e4.Ws)("arrowhead-dot"),d=(0,e4.Ws)("arrowhead-cross"),c=useIsEditing(e.id),u=n.getShapeGeometry(e);if(!u)return null;let h=e9.xu.ZeroFix(u.bounds),p=getArrowBindings(n,e);if(!i?.isValid)return null;let f=rQ[e.props.size]*e.props.scale,g=i.start.arrowhead&&getArrowheadPathForType(i,"start",f),m=i.end.arrowhead&&getArrowheadPathForType(i,"end",f),y=null;t&&(p.start||p.end)&&(y=function(e,t){switch(e.type){case"straight":return new PathBuilder().moveTo(e.start.handle.x,e.start.handle.y).lineTo(e.end.handle.x,e.end.handle.y).toSvg(t);case"arc":return new PathBuilder().moveTo(e.start.handle.x,e.start.handle.y).circularArcTo(e.handleArc.radius,!!e.handleArc.largeArcFlag,!!e.handleArc.sweepFlag,e.end.handle.x,e.end.handle.y).toSvg(t);case"elbow":{let n=function(e,t){let n=e.swapOrder?e.B.target:e.A.target,r=e.swapOrder?e.A.target:e.B.target,i=eF.B.ManhattanDist(t.points[0],t.points[1]),o=eF.B.ManhattanDist(t.points[t.points.length-2],t.points[t.points.length-1]),a=eF.B.ManhattanDist(n,t.points[1]),l=eF.B.ManhattanDist(t.points[t.points.length-2],r),d=[n,...t.points,r];return{name:t.name,distance:t.distance+(i-a)+(o-l),points:d.filter(e=>!t.skipPointsWhenDrawing.has(e)),aEdgePicking:t.aEdgePicking,bEdgePicking:t.bEdgePicking,skipPointsWhenDrawing:t.skipPointsWhenDrawing,midpointHandle:t.midpointHandle}}(e.elbow,e.route);return PathBuilder.lineThroughPoints(n.points).toSvg(t)}default:(0,B.iP)(e,"type")}}(i,{style:"dashed",start:"skip",end:"skip",lengthRatio:2.5,strokeWidth:2/n.getZoomLevel(),props:{className:"tl-arrow-hint",markerStart:p.start?p.start.props.isExact?"":p.start.props.isPrecise?`url(#${d})`:`url(#${l})`:"",markerEnd:p.end?p.end.props.isExact?"":p.end.props.isPrecise?`url(#${d})`:`url(#${l})`:"",opacity:.16}}));let b=getArrowLabelPosition(n,e),S=!("none"===i.start.arrowhead||"arrow"===i.start.arrowhead),v=!("none"===i.end.arrowhead||"arrow"===i.end.arrowhead);return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("defs",{children:(0,et.jsx)("clipPath",{id:a,children:(0,et.jsx)(ArrowClipPath,{radius:3.5*e.props.scale,hasText:c||e.props.text.trim().length>0,bounds:h,labelBounds:b.box,as:S&&g?g:"",ae:v&&m?m:""})})}),(0,et.jsxs)("g",{fill:"none",stroke:r[e.props.color].solid,strokeWidth:f,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[y,(0,et.jsxs)("g",{style:{clipPath:`url(#${a})`,WebkitClipPath:`url(#${a})`},children:[(0,et.jsx)("rect",{x:(0,ei.$Z)(h.minX-100),y:(0,ei.$Z)(h.minY-100),width:(0,ei.$Z)(h.width+200),height:(0,ei.$Z)(h.height+200),opacity:0}),getArrowBodyPath(e,i,{style:e.props.dash,strokeWidth:f,forceSolid:o,randomSeed:e.id})]}),g&&S&&"none"!==e.props.fill&&(0,et.jsx)(aE,{theme:r,d:g,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),m&&v&&"none"!==e.props.fill&&(0,et.jsx)(aE,{theme:r,d:m,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),g&&(0,et.jsx)("path",{d:g}),m&&(0,et.jsx)("path",{d:m})]})]})});function ArrowClipPath({radius:e,hasText:t,bounds:n,labelBounds:r,as:i,ae:o}){let a=(0,en.useMemo)(()=>{let i=new PathBuilder;return i.moveTo(n.left-100,n.top-100).lineTo(n.right+100,n.top-100).lineTo(n.right+100,n.bottom+100).lineTo(n.left-100,n.bottom+100).close(),t&&i.moveTo(r.left,r.top+e).lineTo(r.left,r.bottom-e).circularArcTo(e,!1,!1,r.left+e,r.bottom).lineTo(r.right-e,r.bottom).circularArcTo(e,!1,!1,r.right,r.bottom-e).lineTo(r.right,r.top+e).circularArcTo(e,!1,!1,r.right-e,r.top).lineTo(r.left+e,r.top).circularArcTo(e,!1,!1,r.left,r.top+e).close(),i.toD()},[e,t,n.bottom,n.left,n.right,n.top,r.bottom,r.left,r.right,r.top]);return(0,et.jsx)("path",{d:`${a}${i}${o}`})}let aD=new WeakMap;function ArrowheadDotDef(){let e=(0,e4.Ws)("arrowhead-dot");return(0,et.jsx)("marker",{id:e,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:(0,et.jsx)("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function ArrowheadCrossDef(){let e=(0,e4.Ws)("arrowhead-cross");return(0,et.jsxs)("marker",{id:e,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[(0,et.jsx)("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),(0,et.jsx)("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}let aB="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function HyperlinkButton({url:e}){let t=(0,eW.jE)(),n=(0,O.Hg)("zoomLevel",()=>.32>t.getZoomLevel(),[t]),r=(0,en.useCallback)(e=>{t.inputs.shiftKey||(0,e0.be)(e)},[t]);return(0,et.jsx)("a",{className:eh("tl-hyperlink-button",{"tl-hyperlink-button__hidden":n}),href:e,target:"_blank",rel:"noopener noreferrer",onPointerDown:r,onPointerUp:r,title:e,draggable:!1,children:(0,et.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:`url("${aB}") center 100% / 100% no-repeat`,WebkitMask:`url("${aB}") center 100% / 100% no-repeat`}})})}let aF="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",aO=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function getRotatedBoxShadow(e){let t=aO.map(t=>{let{offsetX:n,offsetY:r,blur:i,spread:o,color:a}=t,l=new eF.B(n,r),{x:d,y:c}=l.rot(-e);return`${d}px ${c}px ${i}px ${o}px ${a}`});return t.join(", ")}let BookmarkShapeUtil=class BookmarkShapeUtil extends BaseBoxShapeUtil{static type="bookmark";static props=L.qU;static migrations=L.h9;canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(e){return e.props.url}getAriaDescriptor(e){let t=e.props.assetId?this.editor.getAsset(e.props.assetId):null;if(t?.props.title)return convertCommonTitleHTMLEntities(t.props.title)+(t.props.description?", "+t.props.description:"")}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(e){return(0,et.jsx)(BookmarkShapeComponent,{shape:e})}indicator(e){return(0,et.jsx)("rect",{width:(0,ei.$Z)(e.props.w),height:(0,ei.$Z)(e.props.h),rx:"6",ry:"6"})}onBeforeCreate(e){return getBookmarkSize(this.editor,e)}onBeforeUpdate(e,t){if(e.props.url!==t.props.url){if(!N.T.linkUrl.isValid(t.props.url))return{...t,props:{...t.props,url:e.props.url}};!function(e,t){let{url:n}=t.props,r=L.Yk.createId((0,B.jK)(n));e.getAsset(r)?t.props.assetId!==r&&e.updateShapes([{id:t.id,type:t.type,props:{assetId:r}}]):(e.updateShapes([{id:t.id,type:t.type,props:{assetId:null}}]),aR(e,t))}(this.editor,t)}if(e.props.assetId!==t.props.assetId)return getBookmarkSize(this.editor,t)}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:(0,B.t7)(e.props.w,t.props.w,n),h:(0,B.t7)(e.props.h,t.props.h,n)}}};function BookmarkShapeComponent({shape:e}){let t=(0,eW.jE)(),n=e.props.assetId?t.getAsset(e.props.assetId):null,r=!!(0,eN.l8)()&&eH.a.isSafari,i=t.getShapePageTransform(e).rotation(),o=getHumanReadableAddress(e),[a,l]=(0,en.useState)(!0),d=(0,en.useCallback)(e=>{t.inputs.shiftKey||(0,e0.be)(e)},[t]);return(0,et.jsx)(HTMLContainer,{children:(0,et.jsxs)("div",{className:eh("tl-bookmark__container",r&&"tl-bookmark__container--safariExport"),style:{boxShadow:r?void 0:getRotatedBoxShadow(i),maxHeight:e.props.h},children:[(!n||n.props.image)&&(0,et.jsxs)("div",{className:"tl-bookmark__image_container",children:[n?(0,et.jsx)("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:n?.props.image,alt:n?.props.title||""}):(0,et.jsx)("div",{className:"tl-bookmark__placeholder"}),n?.props.image&&(0,et.jsx)(HyperlinkButton,{url:e.props.url})]}),(0,et.jsxs)("div",{className:"tl-bookmark__copy_container",children:[n?.props.title?(0,et.jsx)("h2",{className:"tl-bookmark__heading",children:convertCommonTitleHTMLEntities(n.props.title)}):null,n?.props.description&&n?.props.image?(0,et.jsx)("p",{className:"tl-bookmark__description",children:n.props.description}):null,(0,et.jsxs)("a",{className:"tl-bookmark__link",href:e.props.url||"",target:"_blank",rel:"noopener noreferrer",draggable:!1,onPointerDown:d,onPointerUp:d,children:[a&&n?.props.favicon?(0,et.jsx)("img",{className:"tl-bookmark__favicon",src:n?.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:()=>l(!1),alt:`favicon of ${o}`}):(0,et.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:`url("${aF}") center 100% / 100% no-repeat`,WebkitMask:`url("${aF}") center 100% / 100% no-repeat`}}),(0,et.jsx)("span",{children:o})]})]})]})})}function getBookmarkSize(e,t){let n=t.props.assetId?e.getAsset(t.props.assetId):null,r=320;return n&&!n.props.image&&(r=n.props.title?101:46),{...t,props:{...t.props,h:r}}}let getHumanReadableAddress=e=>{try{let t=new URL(e.props.url);return t.hostname.replace(/^www\./,"")}catch{return e.props.url}},aR=(0,B.Ds)(async(e,t)=>{if(e.isDisposed)return;let{url:n}=t.props,r=await e.getAssetForExternalContent({type:"url",url:n});r&&e.run(()=>{e.createAssets([r]),e.updateShapes([{id:t.id,type:t.type,props:{assetId:r.id}}])})},500);function getSvgPathFromStrokePoints(e,t=!1){let n=e.length;if(n<2)return"";let r=e[0].point,i=e[1].point;if(2===n)return`M${(0,ei.Yk)(r)}L${(0,ei.Yk)(i)}`;let o="";for(let t=2,a=n-1;t<a;t++)r=e[t].point,i=e[t+1].point,o+=(0,ei.Y8)(r,i);return t?`M${(0,ei.Y8)(e[0].point,e[1].point)}Q${(0,ei.Yk)(e[1].point)}${(0,ei.Y8)(e[1].point,e[2].point)}T${o}${(0,ei.Y8)(e[n-1].point,e[0].point)}${(0,ei.Y8)(e[0].point,e[1].point)}Z`:`M${(0,ei.Yk)(e[0].point)}Q${(0,ei.Yk)(e[1].point)}${(0,ei.Y8)(e[1].point,e[2].point)}${e.length>3?"T":""}${o}L${(0,ei.Yk)(e[n-1].point)}`}function cleanUpPartition(e){let t,n;let r=e[0];for(;e.length>2;)if(t=e[1],eF.B.Dist2(r.point,t.point)<((r.radius+t.radius)/2*.5)**2)e.splice(1,1);else break;let i=e[e.length-1];for(;e.length>2;)if(n=e[e.length-2],eF.B.Dist2(i.point,n.point)<((i.radius+n.radius)/2*.5)**2)e.splice(e.length-2,1);else break;return e.length>1&&(e[0]={...e[0],vector:eF.B.Sub(e[0].point,e[1].point).uni()},e[e.length-1]={...e[e.length-1],vector:eF.B.Sub(e[e.length-2].point,e[e.length-1].point).uni()}),e}let interpolateSegments=(e,t,n)=>{let r=[],i=[];e.forEach(e=>r.push(...e.points)),t.forEach(e=>i.push(...e.points));let o=Math.max(r.length,i.length),a=[],l=[];for(let e=0;e<o;e++)a.push(r[e]||r[r.length-1]),l.push(i[e]||i[i.length-1]);let d=a.map((e,t)=>{let r=.5;return void 0!==l[t].z&&void 0!==e.z&&(r=(0,B.t7)(e.z,l[t].z,n)),{x:(0,B.t7)(e.x,l[t].x,n),y:(0,B.t7)(e.y,l[t].y,n),z:r}});return[{type:"free",points:d}]},PEN_EASING=e=>.65*e+.35*(0,ei.dv)(e*ei.PI/2),simulatePressureSettings=e=>({size:e,thinning:.5,streamline:(0,B.vm)(e,[9,16],[.64,.74],!0),smoothing:.62,easing:te.L.easeOutSine,simulatePressure:!0}),realPressureSettings=e=>({size:1+1.2*e,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:PEN_EASING}),solidSettings=e=>({size:e,thinning:0,streamline:(0,B.vm)(e,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:te.L.linear}),solidRealPressureSettings=e=>({size:e,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:te.L.linear});function getHighlightFreehandSettings({strokeWidth:e,showAsComplete:t}){return{size:1+e,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:te.L.easeOutSine,last:t}}function getFreehandOptions(e,t,n,r){let i=e.isComplete||n;return r?e.isPen?{...solidRealPressureSettings(t),last:i}:{...solidSettings(t),last:i}:"draw"===e.dash?e.isPen?{...realPressureSettings(t),last:i}:{...simulatePressureSettings(t),last:i}:{...solidSettings(t),last:i}}function getPointsFromSegments(e){let t=[];for(let n of e)if("free"===n.type||n.points.length<2)t.push(...n.points.map(eF.B.Cast));else{let e=Math.max(4,Math.floor(eF.B.Dist(n.points[0],n.points[1])/16));t.push(...eF.B.PointsBetween(n.points[0],n.points[1],e))}return t}let DrawShapeUtil=class DrawShapeUtil extends eB.E{static type="draw";static props=L.wu;static migrations=L._l;options={maxPointsPerShape:600};hideResizeHandles(e){return getIsDot(e)}hideRotateHandle(e){return getIsDot(e)}hideSelectionBoundsFg(e){return getIsDot(e)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){let t=getPointsFromSegments(e.props.segments),n=(rQ[e.props.size]+1)*e.props.scale;if(1===e.props.segments.length){let e=e9.xu.FromPoints(t);if(e.width<2*n&&e.height<2*n)return new Circle2d({x:-n,y:-n,radius:n,isFilled:!0})}let r=getStrokePoints(t,getFreehandOptions(e.props,n,e.props.isPen,!0)).map(e=>e.point);return e.props.isClosed&&r.length>2?new tc.w({points:r,isFilled:"none"!==e.props.fill}):1===r.length?new Circle2d({x:-n,y:-n,radius:n,isFilled:!0}):new to.q({points:r})}component(e){return(0,et.jsx)(ef.g,{children:(0,et.jsx)(DrawShapeSvg,{shape:e})})}indicator(e){let t=getPointsFromSegments(e.props.segments),n=(rQ[e.props.size]+1)*e.props.scale,r=(0,O.Hg)("force solid",()=>{let e=this.editor.getZoomLevel();return e<.5&&e<1.5/n},[this.editor,n]);r||e.props.isPen||"draw"!==e.props.dash||1!==t.length||(n+=(0,B.Vk)(e.id)()*(n/6));let i=e.props.isComplete||B.Z$(e.props.segments)?.type==="straight",o=getFreehandOptions(e.props,n,i,!0),a=getStrokePoints(t,o),l=a.length>1?getSvgPathFromStrokePoints(a,e.props.isClosed):getDot(t[0],n);return(0,et.jsx)("path",{d:l})}toSvg(e,t){t.addExportDef(getFillDefForExport(e.props.fill));let n=1/e.props.scale;return(0,et.jsx)("g",{transform:`scale(${n})`,children:(0,et.jsx)(DrawShapeSvg,{shape:e,zoomOverride:1})})}getCanvasSvgDefs(){return[getFillDefForCanvas()]}onResize(e,t){let{scaleX:n,scaleY:r}=t,i=[];for(let t of e.props.segments)i.push({...t,points:t.points.map(({x:e,y:t,z:i})=>({x:(0,ei.FH)(n*e),y:(0,ei.FH)(r*t),z:i}))});return{props:{segments:i}}}expandSelectionOutlinePx(e){let t="draw"===e.props.dash?1.6:1;return rQ[e.props.size]*t/2*e.props.scale}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,segments:interpolateSegments(e.props.segments,t.props.segments,n),scale:(0,B.t7)(e.props.scale,t.props.scale,n)}}};function getDot(e,t){let n=(t+1)*.5;return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}function getIsDot(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function DrawShapeSvg({shape:e,zoomOverride:t}){var n;let r=useDefaultColorTheme(),i=(0,eW.jE)(),o=getPointsFromSegments(e.props.segments),a=e.props.isComplete||B.Z$(e.props.segments)?.type==="straight",l=(rQ[e.props.size]+1)*e.props.scale,d=(0,O.Hg)("force solid",()=>{let e=t??i.getZoomLevel();return e<.5&&e<1.5/l},[i,l,t]),c=(0,O.Hg)("dot adjustment",()=>{let e=t??i.getZoomLevel();return e<.2?0:.1},[i,t]);d||e.props.isPen||"draw"!==e.props.dash||1!==o.length||(l+=(0,B.Vk)(e.id)()*(l/6));let u=getFreehandOptions(e.props,l,a,d);if(!d&&"draw"===e.props.dash)return(0,et.jsxs)(et.Fragment,{children:[e.props.isClosed&&e.props.fill&&o.length>1?(0,et.jsx)(aE,{d:getSvgPathFromStrokePoints(getStrokePoints(o,u),e.props.isClosed),theme:r,color:e.props.color,fill:e.props.isClosed?e.props.fill:"none",scale:e.props.scale}):null,(0,et.jsx)("path",{d:function(e,t={}){let{start:n={},end:r={}}=t,{cap:i=!0}=n,{cap:o=!0}=r;(0,B.hu)(!n.taper&&!r.taper,"cap taper not supported here"),(0,B.hu)(!n.easing&&!r.easing,"cap easing not supported here"),(0,B.hu)(i&&o,"cap must be true");let a=getStrokePoints(e,t);setStrokePointRadii(a,t);let l=function(e){let t,n,r,i,o;if(e.length<=2)return[e];let a=[],l=[e[0]],d=eF.B.Sub(e[1].point,e[0].point).uni();for(let c=1,u=e.length;c<u-1;c++){if(r=e[c-1],i=e[c],o=e[c+1],t=eF.B.Sub(o.point,i.point).uni(),n=eF.B.Dpr(d,t),d=t,n<-.8){let e={...i,point:i.input};l.push(e),a.push(cleanUpPartition(l)),l=[e];continue}if(l.push(i),!(n>.7)&&(eF.B.Dist2(r.point,i.point)+eF.B.Dist2(i.point,o.point))/((r.radius+i.radius+o.radius)/3)**2<1.5){l.push(i),a.push(cleanUpPartition(l)),l=[i];continue}}return l.push(e[e.length-1]),a.push(cleanUpPartition(l)),a}(a),d="";for(let e of l)d+=function(e,t={}){if(0===e.length)return"";if(1===e.length){var n;return"M "+e[0].point.x+" "+e[0].point.y+" m -"+(n=e[0].radius)+", 0 a "+n+","+n+" 0 1,1 "+2*n+",0 a "+n+","+n+" 0 1,1 -"+2*n+",0"}let{left:r,right:i}=getStrokeOutlineTracks(e,t);i.reverse();let o=`M${(0,ei.Yk)(r[0])}T`;for(let e=1;e<r.length;e++)o+=(0,ei.Y8)(r[e-1],r[e]);{let t=e[e.length-1],n=t.radius,r=t.vector.clone().per().neg(),i=eF.B.Add(t.point,eF.B.Mul(r,n)),a=eF.B.Add(t.point,eF.B.Mul(r,-n));o+=`${(0,ei.Yk)(i)}A${(0,ei.$Z)(n)},${(0,ei.$Z)(n)} 0 0 1 ${(0,ei.Yk)(a)}T`}for(let e=1;e<i.length;e++)o+=(0,ei.Y8)(i[e-1],i[e]);{let t=e[0],n=t.radius,r=t.vector.clone().per(),i=eF.B.Add(t.point,eF.B.Mul(r,n)),a=eF.B.Add(t.point,eF.B.Mul(r,-n));o+=`${(0,ei.Yk)(i)}A${(0,ei.$Z)(n)},${(0,ei.$Z)(n)} 0 0 1 ${(0,ei.Yk)(a)}Z`}return o}(e,t);return d}(o,u),strokeLinecap:"round",fill:r[e.props.color].solid})]});let h=getStrokePoints(o,u),p=h.length<2,f=p?getDot(o[0],0):getSvgPathFromStrokePoints(h,e.props.isClosed);return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(aE,{d:f,theme:r,color:e.props.color,fill:p||e.props.isClosed?e.props.fill:"none",scale:e.props.scale}),(0,et.jsx)("path",{d:f,strokeLinecap:"round",fill:p?r[e.props.color].solid:"none",stroke:r[e.props.color].solid,strokeWidth:l,strokeDasharray:p?"none":(n=l,({draw:"none",solid:"none",dotted:`${c} ${2*n}`,dashed:`${2*n} ${2*n}`})[e.props.dash]),strokeDashoffset:"0"})]})}let globlikeRegExp=e=>e.split("*").map(e=>(function(e){if("string"!=typeof e)throw TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")})(e)).join(".+"),checkHostnames=(e,t)=>!!e.find(e=>{let n=new RegExp(globlikeRegExp(e));return t.match(n)});function getEmbedInfo(e,t){try{return function(e,t){let n=(0,B.Ad)(t);if(!n)return;let r=n.host.replace("www.","");for(let n of e)if(checkHostnames(n.hostnames,r)){let e=n.toEmbedUrl(t);if(e)return{definition:n,embedUrl:e,url:t}}}(e,t)??function(e,t){let n=(0,B.Ad)(t);if(!n)return;let r=n.host.replace("www.","");for(let n of e)if(checkHostnames(n.hostnames,r)){let e=n.fromEmbedUrl(t);if(e)return{definition:n,url:e,embedUrl:t}}}(e,t)}catch{return}}let getSandboxPermissions=e=>Object.entries(e).filter(([e,t])=>t).map(([e])=>e).join(" ");let EmbedShapeUtil=class EmbedShapeUtil extends BaseBoxShapeUtil{static type="embed";static props=L.DW;static migrations=L.BF;static embedDefinitions=nd;static setEmbedDefinitions(e){EmbedShapeUtil.embedDefinitions=e}getEmbedDefinitions(){return EmbedShapeUtil.embedDefinitions}getEmbedDefinition(e){return getEmbedInfo(EmbedShapeUtil.embedDefinitions,e)}getText(e){return e.props.url}getAriaDescriptor(e){let t=this.getEmbedDefinition(e.props.url);return t?.definition.title}hideSelectionBoundsFg(e){return!this.canResize(e)}canEdit(){return!0}canResize(e){return!!this.getEmbedDefinition(e.props.url)?.definition?.doesResize}canEditInReadonly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked(e){let t=this.getEmbedDefinition(e.props.url);return t?.definition.isAspectRatioLocked??!1}onResize(e,t){let n=this.isAspectRatioLocked(e),r=this.getEmbedDefinition(e.props.url),i=r?.definition.minWidth??200,o=r?.definition.minHeight??200;if(n){let t=e.props.w/e.props.h;t>1?i*=t:o/=t}return resizeBox(e,t,{minWidth:i,minHeight:o})}component(e){let t=(0,eN.l8)(),{w:n,h:r,url:i}=e.props,o=useIsEditing(e.id),a=this.getEmbedDefinition(i),l=(0,O.Hg)("is hovering",()=>{let{editingShapeId:e,hoveredShapeId:t}=this.editor.getCurrentPageState();if(e&&t!==e){let t=this.editor.getShape(e);if(t&&this.editor.isShapeOfType(t,"embed"))return!0}return!1},[]),d=this.editor.getShapePageTransform(e).rotation();if(t)return(0,et.jsx)(HTMLContainer,{className:"tl-embed-container",id:e.id,children:(0,et.jsx)("div",{className:"tl-embed",style:{border:0,boxShadow:getRotatedBoxShadow(d),borderRadius:a?.definition.overrideOutlineRadius??8,background:a?.definition.backgroundColor??"var(--color-background)",width:n,height:r}})});let c=o||l,u="undefined"!=typeof window&&(window!==window.top||window.self!==window.parent);if(u&&a?.definition.type==="tldraw")return null;if(a?.definition.type==="github_gist"){let t=a.url.split("/").pop();if(!t)throw Error("No gist id!");return(0,et.jsx)(HTMLContainer,{className:"tl-embed-container",id:e.id,children:(0,et.jsx)(Gist,{id:t,width:(0,ei.$Z)(n),height:(0,ei.$Z)(r),isInteractive:c,pageRotation:d})})}let h=getSandboxPermissions({...nc,...a?.definition.overridePermissions??{}});return(0,et.jsx)(HTMLContainer,{className:"tl-embed-container",id:e.id,children:a?.definition?(0,et.jsx)("iframe",{className:"tl-embed",sandbox:h,src:a.embedUrl,width:(0,ei.$Z)(n),height:(0,ei.$Z)(r),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",tabIndex:o?0:-1,style:{border:0,pointerEvents:c?"auto":"none",zIndex:c?"":"-1",boxShadow:getRotatedBoxShadow(d),borderRadius:a?.definition.overrideOutlineRadius??8,background:a?.definition.backgroundColor}}):null})}indicator(e){let t=this.getEmbedDefinition(e.props.url);return(0,et.jsx)("rect",{width:(0,ei.$Z)(e.props.w),height:(0,ei.$Z)(e.props.h),rx:t?.definition.overrideOutlineRadius??8,ry:t?.definition.overrideOutlineRadius??8})}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:(0,B.t7)(e.props.w,t.props.w,n),h:(0,B.t7)(e.props.h,t.props.h,n)}}};function Gist({id:e,isInteractive:t,width:n,height:r,style:i,pageRotation:o}){if(!e.match(/^[0-9a-f]+$/))throw Error("No gist id!");return(0,et.jsx)("iframe",{className:"tl-embed",draggable:!1,width:(0,ei.$Z)(n),height:(0,ei.$Z)(r),frameBorder:"0",scrolling:"no",referrerPolicy:"no-referrer-when-downgrade",tabIndex:t?0:-1,style:{...i,pointerEvents:t?"all":"none",zIndex:t?"":"-1",boxShadow:getRotatedBoxShadow(o)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=https://gist.github.com/${e}.js></script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}function getFrameHeadingSide(e,t){let n=(0,ei.f5)(e.getShapePageTransform(t.id).rotation());return Math.floor(((n+Math.PI/4)*(2/Math.PI)+4)%4)}let aL=new WeakMap;function getFrameHeadingSize(e,t,n){let r=aL.get(t.props);if(!r){let i=defaultEmptyAs(t.props.name,"Frame")+String.fromCharCode(8203),o=e.textMeasure.measureTextSpans(i,n),a=o[0],l=(0,B.Z$)(o);r=l.box.w+l.box.x-a.box.x,aL.set(t.props,r)}return new e9.xu(0,-n.height,r,n.height)}function getFrameHeadingOpts(e,t){return{fontSize:12,fontFamily:t?"Arial":"Inter, sans-serif",textAlign:"start",width:e,height:24,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",offsetY:-34,offsetX:0}}function getFrameHeadingTranslation(e,t,n){let r;let i=n?"":"px",o=n?"":"deg";switch(t){case 0:r="";break;case 3:r=`translate(${(0,ei.$Z)(e.props.w)}${i}, 0${i}) rotate(90${o})`;break;case 2:r=`translate(${(0,ei.$Z)(e.props.w)}${i}, ${(0,ei.$Z)(e.props.h)}${i}) rotate(180${o})`;break;case 1:r=`translate(0${i}, ${(0,ei.$Z)(e.props.h)}${i}) rotate(270${o})`;break;default:throw Error("labelSide out of bounds")}return r}let aU=(0,en.forwardRef)(({id:e,name:t,isEditing:n},r)=>{let i=(0,eW.jE)(),o=(0,en.useCallback)(e=>{"Enter"!==e.key||e.nativeEvent.isComposing||((0,e0.be)(e),e.currentTarget.blur(),i.setEditingShape(null))},[i]),a=(0,en.useCallback)(t=>{let n=i.getShape(e);if(!n)return;let r=n.props.name,o=t.currentTarget.value.trim();r!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}])},[e,i]),l=(0,en.useCallback)(t=>{let n=i.getShape(e);if(!n)return;let r=n.props.name,o=t.currentTarget.value;r!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}])},[e,i]);return(0,et.jsxs)("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[(0,et.jsx)("input",{className:"tl-frame-name-input",ref:r,disabled:!n,readOnly:!n,style:{display:n?void 0:"none"},value:t,autoFocus:!0,onKeyDown:o,onBlur:a,onChange:l,onPointerDown:n?e0.be:void 0,draggable:!1}),defaultEmptyAs(t,"Frame")+String.fromCharCode(8203)]})}),aN=(0,en.memo)(function({id:e,name:t,width:n,height:r,fill:i,stroke:o,color:a,offsetX:l,showColors:d}){let c=(0,eW.jE)(),{side:u,translation:h}=(0,O.Hg)("shape rotation",()=>{let t=c.getShape(e);if(!t)return{side:0,translation:"translate(0, 0)"};let n=getFrameHeadingSide(c,t);return{side:n,translation:getFrameHeadingTranslation(t,n,!1)}},[c,l,e]),p=(0,en.useRef)(null),f=useIsEditing(e);return(0,en.useEffect)(()=>{let e=p.current;e&&f&&(e.focus(),e.select())},[p,f]),(0,et.jsx)("div",{className:"tl-frame-heading",style:{overflow:f?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${0===u||2===u?Math.ceil(n):Math.ceil(r)}px + ${d?"0px":"var(--frame-offset-width)"})`,bottom:"100%",transform:`${h} scale(var(--tl-scale)) translateX(${l}px)`},children:(0,et.jsx)("div",{className:"tl-frame-heading-hit-area",style:{color:a,backgroundColor:i,boxShadow:`inset 0px 0px 0px 1px ${o}`},children:(0,et.jsx)(aU,{ref:p,id:e,name:t,isEditing:f})})})});function defaultEmptyAs(e,t){return e.match(/^\s*$/)?t:e}let FrameShapeUtil=class FrameShapeUtil extends BaseBoxShapeUtil{static type="frame";static props=L.k7;static migrations=L.gR;options={showColors:!1};static configure(e){let t=super.configure.call(this,e);return e.showColors&&(t.props={...t.props,color:L.R_}),t}canEdit(){return!0}canResize(){return!0}canResizeChildren(){return!1}getDefaultProps(){return{w:320,h:180,name:"",color:"black"}}getAriaDescriptor(e){return e.props.name}getGeometry(e){let t,n;let{editor:r}=this,i=r.getZoomLevel(),o=getFrameHeadingSide(r,e),a=o%2==1,l=a?e.props.h:e.props.w,d=getFrameHeadingOpts(l,!1),c=getFrameHeadingSize(r,e,d),u=this.options.showColors,h=12/i,p=l+(u?1:h),f=c.w/i,g=c.h/i,m=(0,ei.uZ)(f+h,32/i,p),y=(u?-1:-7)/i,b=4/i,S=a?g:m,v=a?m:g;switch(o){case 0:t=y,n=-(g+b);break;case 1:t=-(g+b),n=e.props.h-(y+m);break;case 2:t=e.props.w-(y+m),n=e.props.h+b;break;case 3:t=e.props.w+b,n=y}return new td.m({children:[new eD.z({width:e.props.w,height:e.props.h,isFilled:!1}),new eD.z({x:t,y:n,width:S,height:v,isFilled:!0,isLabel:!0})]})}getText(e){return e.props.name}component(e){let t=useDefaultColorTheme(),n=(0,O.Hg)("is creating this shape",()=>{let t=this.editor.getStateDescendant("select.resizing");if(!t||!t.getIsActive())return!1;let n=t?.info;return!!n&&n.isCreating&&this.editor.getOnlySelectedShapeId()===e.id},[e.id]),r=this.options.showColors,i=t[e.props.color],o=r?i.frame.fill:t.black.frame.fill,a=r?i.frame.stroke:t.black.frame.stroke,l=r?i.frame.headingStroke:t.background,d=r?i.frame.headingFill:t.background,c=r?i.frame.text:t.text;return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(ef.g,{children:(0,et.jsx)("rect",{className:eh("tl-frame__body",{"tl-frame__creating":n}),fill:o,stroke:a,style:{width:`calc(${e.props.w}px + 1px / var(--tl-zoom))`,height:`calc(${e.props.h}px + 1px / var(--tl-zoom))`,transform:"translate(calc(-0.5px / var(--tl-zoom)), calc(-0.5px / var(--tl-zoom)))"}})}),n?null:(0,et.jsx)(aN,{id:e.id,name:e.props.name,fill:d,stroke:l,color:c,width:e.props.w,height:e.props.h,offsetX:r?-1:-7,showColors:this.options.showColors})]})}toSvg(e,t){let n=(0,L.y6)({isDarkMode:t.isDarkMode}),r=getFrameHeadingSide(this.editor,e),i=r%2==1,o=i?e.props.h:e.props.w,a=getFrameHeadingTranslation(e,r,!0),l=getFrameHeadingOpts(o-12,!0),d=defaultEmptyAs(e.props.name,"Frame")+String.fromCharCode(8203),c=getFrameHeadingSize(this.editor,e,l),u=this.editor.textMeasure.measureTextSpans(d,l),h=createTextJsxFromSpans(this.editor,u,l),p=this.options.showColors,f=n[e.props.color],g=p?f.frame.fill:n.black.frame.fill,m=p?f.frame.stroke:n.black.frame.stroke,y=p?f.frame.headingStroke:n.background,b=p?f.frame.headingFill:n.background,S=p?f.frame.text:n.text;return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("rect",{width:e.props.w,height:e.props.h,fill:g,stroke:m,strokeWidth:1,x:0,rx:0,ry:0}),(0,et.jsxs)("g",{fill:S,transform:a,children:[(0,et.jsx)("rect",{x:c.x-(p?0:6),y:c.y-6,width:Math.min(o,c.width+12),height:c.height,fill:b,stroke:y,rx:4,ry:4}),(0,et.jsx)("g",{transform:`translate(${p?8:0}, 4)`,children:h})]})]})}indicator(e){return(0,et.jsx)("rect",{width:(0,ei.$Z)(e.props.w),height:(0,ei.$Z)(e.props.h),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}canReceiveNewChildrenOfType(e){return!e.isLocked}onResize(e,t){return resizeBox(e,t)}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:(0,B.t7)(e.props.w,t.props.w,n),h:(0,B.t7)(e.props.h,t.props.h,n)}}onDoubleClickEdge(e,t){if("selection"!==t.target)return;let{handle:n}=t;if(!n)return;let r="left"===n||"right"===n,i="top"===n||"bottom"===n,o=this.editor.getSortedChildIdsForParent(e.id),a=(0,B.oA)(o.map(e=>this.editor.getShape(e)));if(!a.length)return;let{dx:l,dy:d,w:c,h:u}=getFrameChildrenBounds(a,this.editor,{padding:10});return this.editor.run(()=>{let e=o.map(e=>{let t=this.editor.getShape(e);return{id:t.id,type:t.type,x:r?t.x+l:t.x,y:i?t.y+d:t.y}});this.editor.updateShapes(e)}),{id:e.id,type:e.type,props:{w:r?c:e.props.w,h:i?u:e.props.h}}}onDoubleClickCorner(e){return fitFrameToContent(this.editor,e.id,{padding:10}),{id:e.id,type:e.type}}onDragShapesIn(e,t,{initialParentIds:n,initialIndices:r}){let{editor:i}=this;if(t.every(t=>t.parentId===e.id))return;let o=!1,a=t.filter(t=>e.id===n.get(t.id));if(a.length>0){let t=(0,B.oA)(i.getSortedChildIdsForParent(e).map(e=>i.getShape(e)));a.every(e=>!t.find(t=>t.index===e.index))&&(o=!0)}if(!t.some(t=>i.hasAncestor(e,t.id))&&(i.reparentShapes(t,e.id),o))for(let e of a)i.updateShape({id:e.id,type:e.type,index:r.get(e.id)})}onDragShapesOut(e,t,n){let{editor:r}=this;n.nextDraggingOverShapeId||r.reparentShapes(t.filter(t=>t.parentId===e.id&&this.canReceiveNewChildrenOfType(t)),r.getCurrentPageId())}};let az=en.forwardRef(function({shapeId:e,isEditing:t,richText:n,handleFocus:r,handleChange:i,handleBlur:o,handleKeyDown:a,handleDoubleClick:l,hasCustomTabBehavior:d,handlePaste:c},u){let h=(0,eW.jE)(),p=(0,e4.Gj)("tip-tap-editor"),f=h.getTextOptions().tipTapConfig,g=(0,en.useRef)(n),m=(0,en.useRef)(null),y=(0,en.useRef)(null);(0,en.useLayoutEffect)(()=>{m.current?g.current!==n&&m.current.commands.setContent(n):g.current=n},[n]);let b=(0,en.useRef)({selectAll:!1,caretPosition:null});(0,en.useLayoutEffect)(()=>{function selectAllIfEditing(e){e.shapeId===h.getEditingShapeId()&&(b.current.selectAll=!0)}function placeCaret(e){e.shapeId===h.getEditingShapeId()&&(b.current.caretPosition=e.point)}return h.on("select-all-text",selectAllIfEditing),h.on("place-caret",placeCaret),()=>{h.off("select-all-text",selectAllIfEditing),h.off("place-caret",placeCaret)}},[h,t]);let S=(0,eY.z)(i),v=(0,eY.z)(a),k=(0,eY.z)(r),_=(0,eY.z)(o),C=(0,eY.z)(l),E=(0,eY.z)(c);return((0,en.useLayoutEffect)(()=>{if(!t||!f||!y.current)return;let{editorProps:n,...r}=f,i=new tT.ML({element:y.current,autofocus:!0,editable:t,onUpdate:e=>{let t=e.editor.state.doc.toJSON();g.current=t,S({richText:t})},onFocus:k,onBlur:_,onCreate:t=>{if(h.getEditingShapeId()!==e)return;let n=t.editor;h.setRichTextEditor(n);let{selectAll:r,caretPosition:i}=b.current;if(r)n.chain().focus().selectAll().run();else if(i){let e=n.view.posAtCoords({left:i.x,top:i.y})?.pos;e?n.chain().focus().setTextSelection(e).run():n.chain().focus().selectAll().run()}},editorProps:{handleKeyDown:(e,t)=>{d||"Tab"!==t.key||function(e,t,n){n.preventDefault();let r=e.getRichTextEditor();if(r?.isActive("bulletList")||r?.isActive("orderedList"))return;let{state:i,dispatch:o}=t,{$from:a,$to:l}=i.selection,d=n.shiftKey,c=i.tr,u=l.end();for(;u>=a.start();){let e=i.doc.resolve(u).blockRange();if(!e)break;let t=e.start,n=e.end,r=i.doc.textBetween(t,n,"\n"),o=!1;i.doc.nodesBetween(t,n,e=>{if("bulletList"===e.type.name||"orderedList"===e.type.name)return o=!0,!1}),!o&&(d?r.startsWith("	")&&(c=c.delete(t+1,t+2)):c=c.insertText("	",t+1)),u=t-1}let h=i.selection.map(c.doc,c.mapping);c.setSelection(h),c.docChanged&&o(c)}(h,e,t),v(t)},handlePaste:(e,t)=>{if(E(t),t.defaultPrevented)return!0},handleDoubleClick:(e,t,n)=>C(n),...n},coreExtensionOptions:{clipboardTextSerializer:{blockSeparator:"\n"}},...r,content:g.current}),o=h.timers.setTimeout(()=>{b.current.caretPosition||b.current.selectAll?i.commands.focus():i.commands.focus("end"),b.current.selectAll=!1,b.current.caretPosition=null},100);return m.current=i,()=>{m.current=null,clearTimeout(o),i.destroy()}},[t,f,k,_,C,S,E,v,h,e,d]),t&&f)?(0,et.jsx)("div",{id:p,ref:u,tabIndex:-1,"data-testid":"rich-text-area",className:"tl-rich-text tl-text tl-text-input",onContextMenu:t?e0.be:void 0,onPointerDownCapture:e0.be,onTouchEnd:e0.be,onDragStart:e0.PF,children:(0,et.jsx)("div",{className:"tl-rich-text",ref:y})}):null});function useEditableRichText(e,t,n){let r=useEditableTextCommon(e),i=r.isEditing,o=(0,eW.jE)(),a=(0,en.useRef)(null),l=n&&isEmptyRichText(n);(0,en.useEffect)(()=>{if(!i)return;let e=a.current?.querySelector("[contenteditable]");e&&document.activeElement!==a.current&&e.focus()},[o,i]);let d=(0,en.useCallback)(t=>{o.getEditingShapeId()===e&&"Enter"===t.key&&(0,tw.q)(t)&&o.complete()},[o,e]),c=(0,en.useCallback)(({richText:n})=>{o.getEditingShapeId()===e&&o.updateShape({id:e,type:t,props:{richText:n}})},[o,e,t]);return{rInput:a,handleKeyDown:d,handleChange:c,isEmpty:l,...r}}let aH=en.memo(function({shapeId:e,type:t,richText:n,labelColor:r,font:i,fontSize:o,lineHeight:a,align:l,verticalAlign:d,wrap:c,isSelected:u,padding:h=0,onKeyDown:p,classNamePrefix:f,style:g,textWidth:m,textHeight:y,hasCustomTabBehavior:b}){let S=(0,eW.jE)(),v=en.useRef(!1),{rInput:k,isEmpty:_,isEditing:C,isReadyForEditing:E,...M}=useEditableRichText(e,t,n),P=(0,en.useMemo)(()=>{if(n)return renderHtmlFromRichText(S,n)},[S,n]),A=(0,O.Hg)("isSelectToolActive",()=>"select"===S.getCurrentToolId(),[S]);(0,O.vC)("isDragging",()=>{S.getInstanceState(),v.current=S.inputs.isDragging},[S]);let j=isLegacyAlign(l);if(!C&&_)return null;let D=f||"tl-text";return(0,et.jsx)("div",{className:`${D}-label tl-text-wrapper tl-rich-text-wrapper`,"aria-hidden":!C,"data-font":i,"data-align":l,"data-hastext":!_,"data-isediting":C,"data-textwrap":!!c,"data-isselected":u,style:{justifyContent:"middle"===l||j?"center":l,alignItems:"middle"===d?"center":d,padding:h,...g},children:(0,et.jsxs)("div",{className:`${D}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:a.toString(),minHeight:Math.floor(o*a)+"px",minWidth:Math.ceil(m||0),color:r,width:m?Math.ceil(m):void 0,height:y?Math.ceil(y):void 0},children:[(0,et.jsx)("div",{className:`${D} tl-text tl-text-content`,dir:"auto",children:n&&(0,et.jsx)("div",{className:"tl-rich-text","data-is-select-tool-active":A,dangerouslySetInnerHTML:{__html:P||""},onPointerDown:e=>{if(e.target instanceof HTMLElement&&("A"===e.target.tagName||e.target.closest("a"))){if((0,e0.PF)(e),!A)return;let t=e.target.closest("a")?.getAttribute("href")??"",handlePointerUp=e=>{"pointer_up"===e.name&&(v.current||window.open(t,"_blank","noopener, noreferrer"),S.off("event",handlePointerUp))};S.on("event",handlePointerUp)}},"data-is-ready-for-editing":E})}),(E||u)&&(0,et.jsx)(az,{ref:k,richText:n,isEditing:C,shapeId:e,...M,hasCustomTabBehavior:b,handleKeyDown:p??M.handleKeyDown})]})})});function RichTextSVG({bounds:e,richText:t,fontSize:n,font:r,align:i,verticalAlign:o,wrap:a,labelColor:l,padding:d,showTextOutline:c=!0}){let u=(0,eW.jE)(),h=renderHtmlFromRichText(u,t),p={display:"flex",fontFamily:L.p6[r],height:"100%",justifyContent:"middle"===i?"center":"start"===i?"flex-start":"flex-end",alignItems:"middle"===o?"center":"start"===o?"flex-start":"flex-end",padding:`${d}px`},f={fontSize:`${n}px`,wrap:a?"wrap":"nowrap",color:l,lineHeight:rJ.lineHeight,textAlign:"middle"===i?"center":"start"===i?"start":"end",width:"100%",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap",textShadow:c?"var(--tl-text-outline)":"none"};return(0,et.jsx)("foreignObject",{x:e.minX,y:e.minY,width:e.w,height:e.h,className:"tl-export-embed-styles tl-rich-text tl-rich-text-svg",children:(0,et.jsx)("div",{style:p,children:(0,et.jsx)("div",{dangerouslySetInnerHTML:{__html:h},style:f})})})}let a$=new B.kM;function getGeoShapePath(e){return a$.get(e,_getGeoPath)}function _getGeoPath(e){let t=Math.max(1,e.props.w),n=Math.max(1,e.props.h+e.props.growY),r=t/2,i=n/2,o=rz[e.props.size]*e.props.scale,a="none"!==e.props.fill;switch(e.props.geo){case"arrow-down":{let e=.16*t,r=.38*Math.min(t,n);return new PathBuilder().moveTo(e,0,{geometry:{isFilled:a}}).lineTo(t-e,0).lineTo(t-e,n-r).lineTo(t,n-r).lineTo(t/2,n).lineTo(0,n-r).lineTo(e,n-r).close()}case"arrow-left":{let e=.38*Math.min(t,n),r=.16*n;return new PathBuilder().moveTo(e,0,{geometry:{isFilled:a}}).lineTo(e,r).lineTo(t,r).lineTo(t,n-r).lineTo(e,n-r).lineTo(e,n).lineTo(0,n/2).close()}case"arrow-right":{let e=.38*Math.min(t,n),r=.16*n;return new PathBuilder().moveTo(0,r,{geometry:{isFilled:a}}).lineTo(t-e,r).lineTo(t-e,0).lineTo(t,n/2).lineTo(t-e,n).lineTo(t-e,n-r).lineTo(0,n-r).close()}case"arrow-up":{let e=.16*t,r=.38*Math.min(t,n);return new PathBuilder().moveTo(t/2,0,{geometry:{isFilled:a}}).lineTo(t,r).lineTo(t-e,r).lineTo(t-e,n).lineTo(e,n).lineTo(e,r).lineTo(0,r).close()}case"check-box":{let e=.82*Math.min(t,n),r=(t-e)/2,i=(n-e)/2;return new PathBuilder().moveTo(0,0,{geometry:{isFilled:a}}).lineTo(t,0).lineTo(t,n).lineTo(0,n).close().moveTo((0,ei.uZ)(r+.25*e,0,t),(0,ei.uZ)(i+.52*e,0,n),{geometry:{isInternal:!0,isFilled:!1},offset:0}).lineTo((0,ei.uZ)(r+.45*e,0,t),(0,ei.uZ)(i+.82*e,0,n)).lineTo((0,ei.uZ)(r+.82*e,0,t),(0,ei.uZ)(i+.22*e,0,n),{offset:0})}case"diamond":return new PathBuilder().moveTo(r,0,{geometry:{isFilled:a}}).lineTo(t,i).lineTo(r,n).lineTo(0,i).close();case"ellipse":return new PathBuilder().moveTo(0,i,{geometry:{isFilled:a}}).arcTo(r,i,!1,!0,0,t,i).arcTo(r,i,!1,!0,0,0,i).close();case"heart":{let e=t/4,i=n/4;return new PathBuilder().moveTo(r,n,{geometry:{isFilled:a}}).cubicBezierTo(0,1.2*i,1.5*e,3*i,0,2.5*i).cubicBezierTo(r,.9*i,0,-(.32*i),1.85*e,-(.32*i)).cubicBezierTo(t,1.2*i,2.15*e,-(.32*i),t,-(.32*i)).cubicBezierTo(r,n,t,2.5*i,2.5*e,3*i).close()}case"hexagon":return PathBuilder.lineThroughPoints((0,ei.Oe)(t,n,6),{geometry:{isFilled:a}}).close();case"octagon":return PathBuilder.lineThroughPoints((0,ei.Oe)(t,n,8),{geometry:{isFilled:a}}).close();case"oval":return function(e,t,n){if(t>e){let r=e/2;return new PathBuilder().moveTo(0,r,{geometry:{isFilled:n}}).arcTo(r,r,!1,!0,0,e,r).lineTo(e,t-r).arcTo(r,r,!1,!0,0,0,t-r).close()}let r=t/2;return new PathBuilder().moveTo(r,t,{geometry:{isFilled:n}}).arcTo(r,r,!1,!0,0,r,0).lineTo(e-r,0).arcTo(r,r,!1,!0,0,e-r,t).close()}(t,n,a);case"pentagon":return PathBuilder.lineThroughPoints((0,ei.Oe)(t,n,5),{geometry:{isFilled:a}}).close();case"rectangle":return new PathBuilder().moveTo(0,0,{geometry:{isFilled:a}}).lineTo(t,0).lineTo(t,n).lineTo(0,n).close();case"rhombus":{let e=Math.min(.38*t,.38*n);return new PathBuilder().moveTo(e,0,{geometry:{isFilled:a}}).lineTo(t,0).lineTo(t-e,n).lineTo(0,n).close()}case"rhombus-2":{let e=Math.min(.38*t,.38*n);return new PathBuilder().moveTo(0,0,{geometry:{isFilled:a}}).lineTo(t-e,0).lineTo(t,n).lineTo(e,n).close()}case"star":return function(e,t,n){let r=ei.yo/5/2,i=2*Math.floor(5/4),o=Math.cos(-ei.pj+i*r)*e/2,a=Math.cos(-ei.pj+(10-i)*r)*e/2,l=Math.sin(-ei.pj+0*r)*t/2,d=Math.sin(-ei.pj+2*Math.floor(2.5)*r)*t/2,c=(e-(e/2+a-(e/2-o)))/2,u=(t-(t/2+l-(t/2-d)))/2,h=(e+(e-Math.abs(o-a)))/2,p=(t+(t-Math.abs(d-l)))/2,f=1*h/2,g=1*p/2;return PathBuilder.lineThroughPoints(Array.from(Array(10),(e,t)=>{let n=-ei.pj+t*r;return new eF.B(c+(t%2?f:h)*Math.cos(n),u+(t%2?g:p)*Math.sin(n))}),{geometry:{isFilled:n}}).close()}(t,n,a);case"trapezoid":{let e=Math.min(.38*t,.38*n);return new PathBuilder().moveTo(e,0,{geometry:{isFilled:a}}).lineTo(t-e,0).lineTo(t,n).lineTo(0,n).close()}case"triangle":return new PathBuilder().moveTo(r,0,{geometry:{isFilled:a}}).lineTo(t,n).lineTo(0,n).close();case"x-box":return function(e,t,n,r,i){let o=e/2,a=t/2,l=new PathBuilder().moveTo(0,0,{geometry:{isFilled:i}}).lineTo(e,0).lineTo(e,t).lineTo(0,t).close();if("dashed"===r||"dotted"===r)return l.moveTo(0,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(o,a).moveTo(e,t,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(o,a).moveTo(0,t,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(o,a).moveTo(e,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(o,a);let d="draw"===r?.62:0;return l.moveTo((0,ei.uZ)(n*d,0,e),(0,ei.uZ)(n*d,0,t),{geometry:{isInternal:!0,isFilled:!1}}).lineTo((0,ei.uZ)(e-n*d,0,e),(0,ei.uZ)(t-n*d,0,t)).moveTo((0,ei.uZ)(e-n*d,0,e),(0,ei.uZ)(n*d,0,t)).lineTo((0,ei.uZ)(n*d,0,e),(0,ei.uZ)(t-n*d,0,t)),l}(t,n,o,e.props.dash,a);case"cloud":return function(e,t,n,r,i,o){let a=new PathBuilder,l=(0,B.Vk)(n),d=getOvalPerimeter(e,t),c=Math.max(Math.ceil(d/aV[r]),6,Math.ceil(d/Math.min(e,t))),u=d/c*.2,h=Math.max(e-2*u,1),p=Math.max(t-2*u,1),f=getOvalPerimeter(h,p),g=f/c,m=(e-h)/2,y=(t-p)/2,b=(function(e,t,n){let r=Math.min(e,t)/2,i=Math.max(e,t)-2*r,o=Math.PI*(2*r)+2*i,a=o/n,l=e>t?[{type:"straight",start:new eF.B(r,0),delta:new eF.B(1,0)},{type:"arc",center:new eF.B(e-r,r),startAngle:-ei.PI/2},{type:"straight",start:new eF.B(e-r,t),delta:new eF.B(-1,0)},{type:"arc",center:new eF.B(r,r),startAngle:ei.PI/2}]:[{type:"straight",start:new eF.B(e,r),delta:new eF.B(0,1)},{type:"arc",center:new eF.B(r,t-r),startAngle:0},{type:"straight",start:new eF.B(0,t-r),delta:new eF.B(0,-1)},{type:"arc",center:new eF.B(r,r),startAngle:ei.PI}],d=0,c=[];for(let e=0;e<n;e++){let e=l[0];"straight"===e.type?c.push(eF.B.Add(e.start,eF.B.Mul(e.delta,d))):c.push((0,ei.XD)(e.center,r,e.startAngle+d/r)),d+=a;let t="straight"===e.type?i:ei.PI*r;for(;d>t;)d-=t,l.push(l.shift()),t="straight"===l[0].type?i:ei.PI*r}return c})(h,p,c).map(e=>e.addXY(m,y)),S=e<20?0:.3*u,v=t<20?0:.3*u,k=b.slice(0);for(let e=0;e<Math.floor(c/2);e++)k[e]=eF.B.AddXY(k[e],l()*S*i,l()*v*i),k[c-e-1]=eF.B.AddXY(k[c-e-1],l()*S*i,l()*v*i);for(let n=0;n<k.length;n++){let r=n===k.length-1?0:n+1,i=k[n],l=k[r],d=b[n],c=b[r],u=eF.B.Dist(d,c),h=g-u,p=eF.B.Dist(i,l),f=p/u,S=(Math.max(m,y)+h)*f,v=eF.B.Lrp(d,c,.5).add(eF.B.Sub(c,d).uni().per().mul(S));v.x<0?v.x=0:v.x>e&&(v.x=e),v.y<0?v.y=0:v.y>t&&(v.y=t);let _=(0,ei.fn)(i,l,v),C=eF.B.Dist(_||eF.B.Average([i,l]),i);0===n&&a.moveTo(i.x,i.y,{geometry:{isFilled:o}}),a.circularArcTo(C,!1,!0,l.x,l.y)}return a.close()}(t,n,e.id,e.props.size,e.props.scale,a);default:(0,B.iP)(e.props.geo)}}function getOvalPerimeter(e,t){return e>t?(ei.PI*(t/2)+(e-t))*2:(ei.PI*(e/2)+(t-e))*2}let aV={s:50,m:70,l:100,xl:130};function GeoShapeBody({shape:e,shouldScale:t,forceSolid:n}){let r=t?e.props.scale:1,i=useDefaultColorTheme(),{props:o}=e,{color:a,fill:l,dash:d,size:c}=o,u=rQ[c]*r,h=getGeoShapePath(e),p="draw"!==d||n?h.toD({onlyFilled:!0}):h.toDrawD({strokeWidth:u,randomSeed:e.id,passes:1,offset:0,onlyFilled:!0});return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(aE,{theme:i,d:p,color:a,fill:l,scale:r}),h.toSvg({style:d,strokeWidth:u,forceSolid:n,randomSeed:e.id,props:{fill:"none",stroke:i[a].solid}})]})}let GeoShapeUtil=class GeoShapeUtil extends BaseBoxShapeUtil{static type="geo";static props=L.eG;static migrations=L.P3;canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",dash:"draw",growY:0,url:"",scale:1,color:"black",labelColor:"black",fill:"none",size:"m",font:"draw",align:"middle",verticalAlign:"middle",richText:(0,L.Ak)("")}}getGeometry(e){let t=Math.max(1,e.props.w),n=Math.max(1,e.props.h+e.props.growY),r=getGeoShapePath(e),i=getUnscaledLabelSize(this.editor,e),o=t/e.props.scale,a=n/e.props.scale,l=Math.min(r1[e.props.size]*rJ.lineHeight+32,a/2),d=Math.min(o,Math.max(i.w,Math.min(Math.min(100,o/2),Math.max(1,o-8)))),c=Math.min(a,Math.max(i.h,Math.min(l,Math.max(1,a-8))));return new td.m({children:[r.toGeometry(),new eD.z({x:"start"===e.props.align?0:"end"===e.props.align?(o-d)*e.props.scale:(o-d)/2*e.props.scale,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?(a-c)*e.props.scale:(a-c)/2*e.props.scale,width:d*e.props.scale,height:c*e.props.scale,isFilled:!0,isLabel:!0,isEmptyLabel:isEmptyRichText(e.props.richText)})]})}getHandleSnapGeometry(e){let t=this.getGeometry(e),n=t.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:n,points:[...n.vertices,t.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:n,points:[t.bounds.center]};default:(0,B.iP)(e.props.geo)}}getText(e){return renderPlaintextFromRichText(this.editor,e.props.richText)}getFontFaces(e){return isEmptyRichText(e.props.richText)?F.LZ:getFontsFromRichText(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}component(e){let{id:t,type:n,props:r}=e,{fill:i,font:o,align:a,verticalAlign:l,size:d,richText:c}=r,u=useDefaultColorTheme(),{editor:h}=this,p=(0,O.Hg)("isGeoOnlySelected",()=>e.id===h.getOnlySelectedShapeId(),[h]),f=useIsReadyForEditing(h,e.id),g=isEmptyRichText(e.props.richText),m=(0,O.Hg)("force solid",()=>.2>h.getZoomLevel(),[h]);return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(ef.g,{children:(0,et.jsx)(GeoShapeBody,{shape:e,shouldScale:!0,forceSolid:m})}),(f||!g)&&(0,et.jsx)(HTMLContainer,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+r.growY},children:(0,et.jsx)(aH,{shapeId:t,type:n,font:o,fontSize:r1[d]*e.props.scale,lineHeight:rJ.lineHeight,padding:16*e.props.scale,fill:i,align:a,verticalAlign:l,richText:c,isSelected:p,labelColor:u[r.labelColor].solid,wrap:!0})}),e.props.url&&(0,et.jsx)(HyperlinkButton,{url:e.props.url})]})}indicator(e){let t=(0,O.Hg)("isZoomedOut",()=>.25>this.editor.getZoomLevel(),[this.editor]),{size:n,dash:r,scale:i}=e.props,o=rQ[n],a=getGeoShapePath(e);return a.toSvg({style:"draw"===r?"draw":"solid",strokeWidth:1,passes:1,randomSeed:e.id,offset:0,roundness:2*o*i,props:{strokeWidth:void 0},forceSolid:t})}toSvg(e,t){let n;let r=e.props.scale,i={...e,props:{...e.props,w:e.props.w/r,h:(e.props.h+e.props.growY)/r,growY:0}},o=i.props;if(t.addExportDef(getFillDefForExport(o.fill)),!isEmptyRichText(o.richText)){let i=(0,L.y6)(t),a=new e9.xu(0,0,o.w,(e.props.h+e.props.growY)/r);n=(0,et.jsx)(RichTextSVG,{fontSize:r1[o.size],font:o.font,align:o.align,verticalAlign:o.verticalAlign,richText:o.richText,labelColor:i[o.labelColor].solid,bounds:a,padding:16})}return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(GeoShapeBody,{shouldScale:!1,shape:i,forceSolid:!1}),n]})}getCanvasSvgDefs(){return[getFillDefForCanvas()]}onResize(e,{handle:t,newPoint:n,scaleX:r,scaleY:i,initialShape:o}){let a=o.props.w/o.props.scale,l=o.props.h/o.props.scale,d=o.props.growY/o.props.scale,c=a*r,u=(l+d)*i,h=0,p=0;if(!isEmptyRichText(e.props.richText)){let t=Math.max(Math.abs(c),51),n=Math.max(Math.abs(u),51);t<51&&51===n&&(t=51),51===t&&n<51&&(n=51);let r=getUnscaledLabelSize(this.editor,{...e,props:{...e.props,w:t*e.props.scale,h:n*e.props.scale}}),i=Math.max(Math.abs(c),r.w)*Math.sign(c),o=Math.max(Math.abs(u),r.h)*Math.sign(u);h=Math.abs(i)-Math.abs(c),p=Math.abs(o)-Math.abs(u),c=i,u=o}let f=c*e.props.scale,g=u*e.props.scale,m=new eF.B(0,0);r<0&&(m.x+=f),("left"===t||"top_left"===t||"bottom_left"===t)&&(m.x+=r<0?h:-h),i<0&&(m.y+=g),("top"===t||"top_left"===t||"top_right"===t)&&(m.y+=i<0?p:-p);let{x:y,y:b}=m.rot(e.rotation).add(n);return{x:y,y:b,props:{w:Math.max(Math.abs(f),1),h:Math.max(Math.abs(g),1),growY:0}}}onBeforeCreate(e){if(isEmptyRichText(e.props.richText))return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;let t=e.props.h/e.props.scale,n=getUnscaledLabelSize(this.editor,e).h,r=null;if(n>t?r=n-t:e.props.growY&&(r=0),null!==r)return{...e,props:{...e.props,growY:r*e.props.scale}}}onBeforeUpdate(e,t){if((0,B.Xy)(e.props.richText,t.props.richText)&&e.props.font===t.props.font&&e.props.size===t.props.size)return;let n=isEmptyRichText(e.props.richText),r=isEmptyRichText(t.props.richText);if(!n&&r)return{...t,props:{...t.props,growY:0}};let i=e.props.w/e.props.scale,o=e.props.h/e.props.scale,a=e.props.growY/e.props.scale,l=getUnscaledLabelSize(this.editor,t);if(n&&!r&&renderPlaintextFromRichText(this.editor,t.props.richText)){let e=Math.max(i,l.w),n=Math.max(o,l.h);return i<51&&o<51&&(n=Math.max(e=Math.max(e=Math.max(e,51),n=Math.max(n,51)),n)),{...t,props:{...t.props,w:e*t.props.scale,h:n*t.props.scale,growY:0}}}let d=null;if(l.h>o?d=l.h-o:a&&(d=0),null!==d){let e=t.props.w/t.props.scale;return{...t,props:{...t.props,growY:d*t.props.scale,w:Math.max(e,l.w)*t.props.scale}}}if(l.w>i)return{...t,props:{...t.props,w:l.w*t.props.scale}}}onDoubleClick(e){if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:(0,B.t7)(e.props.w,t.props.w,n),h:(0,B.t7)(e.props.h,t.props.h,n),scale:(0,B.t7)(e.props.scale,t.props.scale,n)}}};let aG={s:12,m:14,l:16,xl:20},aK={s:2,m:3.5,l:5,xl:10};function getUnscaledLabelSize(e,t){let{richText:n,font:r,size:i,w:o}=t.props;if(!n||isEmptyRichText(n))return{w:0,h:0};let a=aG[i],l=renderHtmlFromRichTextForMeasurement(e,n),d=e.textMeasure.measureHtml(l,{...rJ,fontFamily:r3[r],fontSize:r1[i],minWidth:a,maxWidth:Math.max(0,Math.ceil(a+aK[i]),Math.ceil(o/t.props.scale-32))});return{w:d.w+32,h:d.h+32}}let HighlightShapeUtil=class HighlightShapeUtil extends eB.E{static type="highlight";static props=L.VW;static migrations=L.J1;options={maxPointsPerShape:600,underlayOpacity:.82,overlayOpacity:.35};hideResizeHandles(e){return HighlightShapeUtil_getIsDot(e)}hideRotateHandle(e){return HighlightShapeUtil_getIsDot(e)}hideSelectionBoundsFg(e){return HighlightShapeUtil_getIsDot(e)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){let t=getStrokeWidth(e);if(HighlightShapeUtil_getIsDot(e))return new Circle2d({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});let{strokePoints:n,sw:r}=getHighlightStrokePoints(e,t,!0),i=getHighlightFreehandSettings({strokeWidth:r,showAsComplete:!0});return setStrokePointRadii(n,i),new tc.w({points:getStrokeOutlinePoints(n,i),isFilled:!0})}component(e){let t=useHighlightForceSolid(this.editor,e),n=getStrokeWidth(e);return(0,et.jsx)(ef.g,{children:(0,et.jsx)(HighlightRenderer,{shape:e,forceSolid:t,strokeWidth:n,opacity:this.options.overlayOpacity})})}backgroundComponent(e){let t=useHighlightForceSolid(this.editor,e),n=getStrokeWidth(e);return(0,et.jsx)(ef.g,{children:(0,et.jsx)(HighlightRenderer,{shape:e,forceSolid:t,strokeWidth:n,opacity:this.options.underlayOpacity})})}indicator(e){let t;let n=useHighlightForceSolid(this.editor,e),r=getStrokeWidth(e),{strokePoints:i,sw:o}=getHighlightStrokePoints(e,r,n),a=getPointsFromSegments(e.props.segments);return t=i.length<2?function(e,t){let n=t/2;return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}(a[0],o):getSvgPathFromStrokePoints(i,!1),(0,et.jsx)("path",{d:t})}toSvg(e){let t=getStrokeWidth(e),n=t<1.5,r=1/e.props.scale;return(0,et.jsx)("g",{transform:`scale(${r})`,children:(0,et.jsx)(HighlightRenderer,{forceSolid:n,strokeWidth:t,shape:e,opacity:this.options.overlayOpacity})})}toBackgroundSvg(e){let t=getStrokeWidth(e),n=t<1.5,r=1/e.props.scale;return(0,et.jsx)("g",{transform:`scale(${r})`,children:(0,et.jsx)(HighlightRenderer,{forceSolid:n,strokeWidth:t,shape:e,opacity:this.options.underlayOpacity})})}onResize(e,t){let{scaleX:n,scaleY:r}=t,i=[];for(let t of e.props.segments)i.push({...t,points:t.points.map(({x:e,y:t,z:i})=>({x:n*e,y:r*t,z:i}))});return{props:{segments:i}}}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,...t.props,segments:interpolateSegments(e.props.segments,t.props.segments,n),scale:(0,B.t7)(e.props.scale,t.props.scale,n)}}};function getHighlightStrokePoints(e,t,n){let r=getPointsFromSegments(e.props.segments),i=e.props.isComplete||B.Z$(e.props.segments)?.type==="straight",o=t;n||e.props.isPen||1!==r.length||(o+=(0,B.Vk)(e.id)()*(t/6));let a=getHighlightFreehandSettings({strokeWidth:o,showAsComplete:i}),l=getStrokePoints(r,a);return{strokePoints:l,sw:o}}function getStrokeWidth(e){return 1.12*r0[e.props.size]*e.props.scale}function HighlightShapeUtil_getIsDot(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function HighlightRenderer({strokeWidth:e,forceSolid:t,shape:n,opacity:r}){var i;let o=useDefaultColorTheme(),a=getPointsFromSegments(n.props.segments),l=e;t||n.props.isPen||1!==a.length||(l+=(0,B.Vk)(n.id)()*(l/6));let d=getHighlightFreehandSettings({strokeWidth:l,showAsComplete:n.props.isComplete||B.Z$(n.props.segments)?.type==="straight"}),c=getStrokePoints(a,d),u=c.length>1?getSvgPathFromStrokePoints(c,!1):(i=n.props.segments[0].points[0],`M ${i.x} ${i.y} m -0.1, 0 a 0.1,0.1 0 1,0 0.2,0 a 0.1,0.1 0 1,0 -0.2,0`),h=function(){let[e,t]=(0,en.useState)(!1);(0,en.useEffect)(()=>{let e=CSS.supports("color","color(display-p3 1 1 1)"),n=matchMedia("(color-gamut: p3)");t(e&&n.matches);let onChange=()=>t(e&&n.matches);return n.addEventListener("change",onChange),()=>n.removeEventListener("change",onChange)},[]);let n=(0,O.Hg)(tg.hR.forceSrgb);return n||!e?"srgb":"p3"}(),p=o[n.props.color].highlight[h];return(0,et.jsx)("path",{d:u,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:p,strokeWidth:l,opacity:r})}function useHighlightForceSolid(e,t){return(0,O.Hg)("forceSolid",()=>{let n=getStrokeWidth(t),r=e.getZoomLevel();return n/r<1.5},[e])}function BrokenAssetIcon(){return(0,et.jsxs)("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,et.jsx)("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),(0,et.jsx)("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),(0,et.jsx)("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function useImageOrVideoAsset({shapeId:e,assetId:t,width:n}){let r=(0,eW.jE)(),i=(0,eN.l8)(),o=(0,eN.OR)(),[a,l]=(0,en.useState)(()=>({asset:t?r.getAsset(t)??null:null,url:null})),d=(0,en.useRef)(!1),c=(0,en.useRef)(null);return(0,en.useEffect)(()=>{let a;if(!t)return;let u=!1,h=(0,F.Ym)("update state",()=>{if(!i&&e&&r.getCulledShapes().has(e))return;let h=r.getAsset(t);if(!h){l(e=>({...e,asset:null,url:null}));return}if(!h.props.src){let e=r.getTemporaryAssetPreview(h.id);if(e){c.current!==e&&(c.current=e,l(t=>({...t,isPlaceholder:!0,url:e})),o());return}}let p=i?i.scale*(n/h.props.w):r.getZoomLevel()*(n/h.props.w);function resolve(e,t){u||c.current===t||(d.current=!0,c.current=t,l({asset:e,url:t}),o())}if(d.current){let e=0,resolveAssetAfterAWhile=()=>{++e>31.25&&(resolveAssetUrl(r,t,p,i,e=>resolve(h,e)),a?.())};a?.(),r.on("tick",resolveAssetAfterAWhile),a=()=>r.off("tick",resolveAssetAfterAWhile)}else resolveAssetUrl(r,t,p,i,e=>resolve(h,e))});return()=>{h(),a?.(),u=!0}},[r,t,i,o,e,n]),a}function resolveAssetUrl(e,t,n,r,i){e.resolveAssetUrl(t,{screenScale:n,shouldResolveToOriginal:!!r&&null===r.pixelRatio,dpr:r?.pixelRatio??void 0}).then(e=>{i(e)})}let aW=useImageOrVideoAsset;async function getDataURIFromURL(e){let t=await (0,B.he)(e),n=await t.blob();return B.P6.blobToDataUrl(n)}let aZ=new B.kM;let ImageShapeUtil=class ImageShapeUtil extends BaseBoxShapeUtil{static type="image";static props=L.Fc;static migrations=L.y5;isAspectRatioLocked(){return!0}canCrop(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1,altText:""}}getGeometry(e){return e.props.crop?.isCircle?new Ellipse2d({width:e.props.w,height:e.props.h,isFilled:!0}):new eD.z({width:e.props.w,height:e.props.h,isFilled:!0})}getAriaDescriptor(e){return e.props.altText}onResize(e,t){let n=resizeBox(e,t),{flipX:r,flipY:i}=t.initialShape.props,{scaleX:o,scaleY:a,mode:l}=t;if(n={...n,props:{...n.props,flipX:o<0!==r,flipY:a<0!==i}},!e.props.crop)return n;let d="scale_shape"===l&&-1===o||"resize_bounds"===l&&r!==n.props.flipX,c="scale_shape"===l&&-1===a||"resize_bounds"===l&&i!==n.props.flipY,{topLeft:u,bottomRight:h}=e.props.crop;return n.props.crop={topLeft:{x:d?1-h.x:u.x,y:c?1-h.y:u.y},bottomRight:{x:d?1-u.x:h.x,y:c?1-u.y:h.y},isCircle:e.props.crop.isCircle},n}component(e){return(0,et.jsx)(aq,{shape:e})}indicator(e){let t=this.editor.getCroppingShapeId()===e.id;return t?null:e.props.crop?.isCircle?(0,et.jsx)("ellipse",{cx:(0,ei.$Z)(e.props.w/2),cy:(0,ei.$Z)(e.props.h/2),rx:(0,ei.$Z)(e.props.w/2),ry:(0,ei.$Z)(e.props.h/2)}):(0,et.jsx)("rect",{width:(0,ei.$Z)(e.props.w),height:(0,ei.$Z)(e.props.h)})}async toSvg(e,t){let n=e.props;if(!n.assetId)return null;let r=this.editor.getAsset(n.assetId);if(!r)return null;let{w:i}=getUncroppedSize(e.props,n.crop),o=await aZ.get(r,async()=>{let e=await t.resolveAssetUrl(r.id,i);if(!e)return null;if((e.startsWith("blob:")||e.startsWith("http")||e.startsWith("/")||e.startsWith("./"))&&(e=await getDataURIFromURL(e)||""),getIsAnimated(this.editor,r.id)){let{promise:t}=getFirstFrameOfAnimatedImage(e);e=await t}return e});return o?(0,et.jsx)(SvgImage,{shape:e,src:o}):null}onDoubleClickEdge(e){let t=e.props;if(!t||this.editor.getCroppingShapeId()!==e.id)return;let n=(0,B.v4)(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},{w:r,h:i}=getUncroppedSize(e.props,n),o=new eF.B(n.topLeft.x*r,n.topLeft.y*i).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:r,h:i}};this.editor.updateShapes([a])}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:(0,B.t7)(e.props.w,t.props.w,n),h:(0,B.t7)(e.props.h,t.props.h,n),crop:function(e,t){if(null===e.props.crop&&null===t.props.crop)return null;let r=e.props.crop?.topLeft||{x:0,y:0},i=e.props.crop?.bottomRight||{x:1,y:1},o=t.props.crop?.topLeft||{x:0,y:0},a=t.props.crop?.bottomRight||{x:1,y:1};return{topLeft:{x:(0,B.t7)(r.x,o.x,n),y:(0,B.t7)(r.y,o.y,n)},bottomRight:{x:(0,B.t7)(i.x,a.x,n),y:(0,B.t7)(i.y,a.y,n)}}}(e,t)}}};let aq=(0,en.memo)(function({shape:e}){let t=(0,eW.jE)(),{w:n}=getUncroppedSize(e.props,e.props.crop),{asset:r,url:i}=useImageOrVideoAsset({shapeId:e.id,assetId:e.props.assetId,width:n}),o=usePrefersReducedMotion(),[a,l]=(0,en.useState)(""),[d,c]=(0,en.useState)(null),u=r&&getIsAnimated(t,r.id);(0,en.useEffect)(()=>{if(i&&u){let{promise:e,cancel:t}=getFirstFrameOfAnimatedImage(i);return e.then(e=>{l(e),c(i)}),()=>{t()}}},[t,u,o,i]);let h=(0,O.Hg)("show crop preview",()=>e.id===t.getOnlySelectedShapeId()&&t.getCroppingShapeId()===e.id&&t.isIn("select.crop"),[t,e.id]),p=o&&(r?.props.mimeType?.includes("video")||u),f=getCroppedContainerStyle(e),g=i===d?null:i,m=p?a:d;if(!i&&!r?.props.src)return(0,et.jsxs)(HTMLContainer,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:"var(--color-low)",border:"1px solid var(--color-low-border)"},children:[(0,et.jsx)("div",{className:eh("tl-image-container",r&&"tl-image-container-loading"),style:f,children:r?null:(0,et.jsx)(BrokenAssetIcon,{})}),"url"in e.props&&e.props.url&&(0,et.jsx)(HyperlinkButton,{url:e.props.url})]});let y=u?"anonymous":void 0;return(0,et.jsxs)(et.Fragment,{children:[h&&m&&(0,et.jsx)("div",{style:f,children:(0,et.jsx)("img",{className:"tl-image",style:{...getFlipStyle(e),opacity:.1},crossOrigin:y,src:m,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""})}),(0,et.jsxs)(HTMLContainer,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,borderRadius:e.props.crop?.isCircle?"50%":void 0},children:[(0,et.jsxs)("div",{className:eh("tl-image-container"),style:f,children:[m&&(0,et.jsx)("img",{className:"tl-image",style:getFlipStyle(e),crossOrigin:y,src:m,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""},m),g&&(0,et.jsx)("img",{className:"tl-image",style:getFlipStyle(e),crossOrigin:y,src:g,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:e.props.altText,onLoad:()=>c(g)},g)]}),e.props.url&&(0,et.jsx)(HyperlinkButton,{url:e.props.url})]})]})});function getIsAnimated(e,t){let n=t?e.getAsset(t):void 0;return!!n&&("mimeType"in n.props&&B.xe.isAnimatedImageType(n?.props.mimeType)||"isAnimated"in n.props&&n.props.isAnimated)}function getCroppedContainerStyle(e){let t=e.props.crop,n=t?.topLeft;if(!n)return{width:e.props.w,height:e.props.h};let{w:r,h:i}=getUncroppedSize(e.props,t),o=-n.x*r,a=-n.y*i;return{transform:`translate(${o}px, ${a}px)`,width:r,height:i}}function getFlipStyle(e,t){let n,r;let{flipX:i,flipY:o,crop:a}=e.props;if(!i&&!o)return;if(a){let{w:t,h:i}=getUncroppedSize(e.props,a),o=a.bottomRight.x-a.topLeft.x,l=a.bottomRight.y-a.topLeft.y;n=(0,B.vm)(a.topLeft.x,[0,1-o],[0,t-e.props.w]),r=(0,B.vm)(a.topLeft.y,[0,1-l],[0,i-e.props.h])}let l=`scale(${i?-1:1}, ${o?-1:1})`,d=t?`translate(${(i?t.width:0)-(n||0)}px,
		             ${(o?t.height:0)-(r||0)}px)`:"";return{transform:`${d} ${l}`,transformOrigin:t?"0 0":"center center"}}function SvgImage({shape:e,src:t}){let n=(0,e4.Gj)(),r=getCroppedContainerStyle(e),i=e.props.crop;if(!r.transform||!i)return(0,et.jsx)("image",{href:t,width:e.props.w,height:e.props.h,"aria-label":e.props.altText,style:getFlipStyle(e,{width:e.props.w,height:e.props.h})});{let{transform:o,width:a,height:l}=r,d=(i.bottomRight.x-i.topLeft.x)*a,c=(i.bottomRight.y-i.topLeft.y)*l,u=[new eF.B(0,0),new eF.B(d,0),new eF.B(d,c),new eF.B(0,c)],h=getFlipStyle(e,{width:a,height:l});return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("defs",{children:(0,et.jsx)("clipPath",{id:n,children:i.isCircle?(0,et.jsx)("ellipse",{cx:d/2,cy:c/2,rx:d/2,ry:c/2}):(0,et.jsx)("polygon",{points:u.map(e=>`${e.x},${e.y}`).join(" ")})})}),(0,et.jsx)("g",{clipPath:`url(#${n})`,children:(0,et.jsx)("image",{href:t,width:a,height:l,"aria-label":e.props.altText,style:h?{...h}:{transform:o}})})]})}}function getFirstFrameOfAnimatedImage(e){let t=!1,n=new Promise(n=>{let r=(0,B.Ee)();r.onload=()=>{if(t)return;let e=document.createElement("canvas");e.width=r.width,e.height=r.height;let i=e.getContext("2d");i&&(i.drawImage(r,0,0),n(e.toDataURL()))},r.crossOrigin="anonymous",r.src=e});return{promise:n,cancel:()=>t=!0}}let aY=new B.kM;let LineShapeUtil=class LineShapeUtil extends eB.E{static type="line";static props=L.BG;static migrations=L.FH;hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}getDefaultProps(){let[e,t]=(0,B.H$)(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[t]:{id:t,index:t,x:.1,y:.1}},scale:1}}getGeometry(e){let t=getPathForLineShape(e).toGeometry();return(0,B.hu)(t instanceof PathBuilderGeometry2d),t}getHandles(e){return aY.get(e.props,()=>{let t=this.getGeometry(e),n=linePointsToArray(e),r=n.map(e=>({...e,id:e.index,type:"vertex",canSnap:!0}));for(let e=0;e<n.length-1;e++){let i=(0,B.eI)(n[e].index,n[e+1].index),o=t.getSegments()[e],a=o.interpolateAlongEdge(.5);r.push({id:i,type:"create",index:i,x:a.x,y:a.y,canSnap:!0})}return r.sort(B.hl)})}onResize(e,t){let{scaleX:n,scaleY:r}=t;return{props:{points:(0,B.Fm)(e.props.points,(e,{id:t,index:i,x:o,y:a})=>({id:t,index:i,x:o*n,y:a*r}))}}}onBeforeCreate(e){let{props:{points:t}}=e,n=Object.keys(t);if(n.length<2)return;let r=t[n[0]],i=n.every(e=>{let n=t[e];return n.x===r.x&&n.y===r.y});if(i){let r=n[n.length-1];return t[r]={...t[r],x:t[r].x+.1,y:t[r].y+.1},e}}onHandleDrag(e,{handle:t}){let n=maybeSnapToGrid(new eF.B(t.x,t.y),this.editor);return{...e,props:{...e.props,points:{...e.props.points,[t.id]:{id:t.id,index:t.index,x:n.x,y:n.y}}}}}onHandleDragStart(e,{handle:t}){if("create"===t.type)return{...e,props:{...e.props,points:{...e.props.points,[t.index]:{id:t.index,index:t.index,x:t.x,y:t.y}}}}}component(e){return(0,et.jsx)(ef.g,{style:{minWidth:50,minHeight:50},children:(0,et.jsx)(LineShapeSvg,{shape:e})})}indicator(e){let t=rz[e.props.size]*e.props.scale,n=getPathForLineShape(e),{dash:r}=e.props;return n.toSvg({style:"draw"===r?"draw":"solid",strokeWidth:1,passes:1,randomSeed:e.id,offset:0,roundness:2*t,props:{strokeWidth:void 0}})}toSvg(e){return(0,et.jsx)(LineShapeSvg,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){let t=linePointsToArray(e);return{points:t,getSelfSnapPoints:n=>{let r=this.getHandles(e).filter(e=>"vertex"===e.type).findIndex(e=>e.id===n.id);return t.filter((e,t)=>Math.abs(t-r)>1).map(eF.B.From)},getSelfSnapOutline:t=>{let n=this.getHandles(e).filter(e=>"vertex"===e.type).findIndex(e=>e.id===t.id),r=this.getGeometry(e).getSegments().filter((e,t)=>t!==n-1&&t!==n);return r.length?new td.m({children:r}):null}}}getInterpolatedProps(e,t,n){let r=linePointsToArray(e),i=linePointsToArray(t),o=[],a=[],l=B.R4;if(r.length>i.length)for(let e=0;e<r.length;e++)o[e]={...r[e]},void 0===i[e]?a[e]={...i[i.length-1],id:l}:a[e]={...i[e],id:l},l=(0,B._L)(l);else if(i.length>r.length)for(let e=0;e<i.length;e++)a[e]={...i[e]},void 0===r[e]?o[e]={...r[r.length-1],id:l}:o[e]={...r[e],id:l},l=(0,B._L)(l);else for(let e=0;e<i.length;e++)o[e]=r[e],a[e]=i[e];return{...n>.5?t.props:e.props,points:Object.fromEntries(o.map((e,t)=>{let r=a[t];return[e.id,{...e,x:(0,B.t7)(e.x,r.x,n),y:(0,B.t7)(e.y,r.y,n)}]})),scale:(0,B.t7)(e.props.scale,t.props.scale,n)}}};function linePointsToArray(e){return Object.values(e.props.points).sort(B.hl)}let aX=new B.kM;function getPathForLineShape(e){return aX.get(e,()=>{let t=linePointsToArray(e).map(eF.B.From);switch(e.props.spline){case"cubic":return PathBuilder.cubicSplineThroughPoints(t,{endOffsets:0});case"line":return PathBuilder.lineThroughPoints(t,{endOffsets:0})}})}function LineShapeSvg({shape:e,shouldScale:t=!1,forceSolid:n=!1}){let r=useDefaultColorTheme(),i=getPathForLineShape(e),{dash:o,color:a,size:l}=e.props,d=1/e.props.scale,c=rz[l]*e.props.scale;return i.toSvg({style:o,strokeWidth:c,forceSolid:n,randomSeed:e.id,props:{transform:`scale(${t?d:1})`,stroke:r[a].solid,fill:"none"}})}function startEditingShapeWithLabel(e,t,n=!1){e.select(t),e.setEditingShape(t),e.setCurrentTool("select.editing_shape",{target:"shape",shape:t}),n&&e.emit("select-all-text",{shapeId:t.id})}let NoteShapeUtil=class NoteShapeUtil extends eB.E{static type="note";static props=L.m0;static migrations=L.C_;options={resizeMode:"none"};canEdit(){return!0}hideResizeHandles(){let{resizeMode:e}=this.options;switch(e){case"none":return!0;case"scale":return!1;default:throw(0,B.iP)(e)}}isAspectRatioLocked(){return"scale"===this.options.resizeMode}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",richText:(0,L.Ak)(""),size:"m",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){let{labelHeight:t,labelWidth:n}=getLabelSize(this.editor,e),{scale:r}=e.props,i=t*r,o=n*r,a=200*r,l=getNoteHeight(e);return new td.m({children:[new eD.z({width:a,height:l,isFilled:!0}),new eD.z({x:"start"===e.props.align?0:"end"===e.props.align?a-o:(a-o)/2,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?l-i:(l-i)/2,width:o,height:i,isFilled:!0,isLabel:!0})]})}getHandles(e){let{scale:t}=e.props,n=this.editor.getInstanceState().isCoarsePointer;if(n)return[];let r=this.editor.getZoomLevel();if(r*t<.25)return[];let i=getNoteHeight(e),o=200*t,a=0/r*t;return r*t<.5?[{id:"bottom",index:"a3",type:"clone",x:o/2,y:i+a}]:[{id:"top",index:"a1",type:"clone",x:o/2,y:-a},{id:"right",index:"a2",type:"clone",x:o+a,y:i/2},{id:"bottom",index:"a3",type:"clone",x:o/2,y:i+a},{id:"left",index:"a4",type:"clone",x:-a,y:i/2}]}onResize(e,t){let{resizeMode:n}=this.options;switch(n){case"none":return;case"scale":return resizeScaled(e,t);default:throw(0,B.iP)(n)}}getText(e){return renderPlaintextFromRichText(this.editor,e.props.richText)}getFontFaces(e){return isEmptyRichText(e.props.richText)?F.LZ:getFontsFromRichText(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}component(e){let{id:t,type:n,props:{labelColor:r,scale:i,color:o,font:a,size:l,align:d,richText:c,verticalAlign:u,fontSizeAdjustment:h}}=e,p=function(e){let t=(0,eW.jE)(),n=useCurrentTranslation();return(0,en.useCallback)(r=>{let i=t.getShape(e);if(!i)return;let o="Tab"===r.key,a=(r.metaKey||r.ctrlKey)&&"Enter"===r.key;if(o||a){var l;r.preventDefault();let d=t.getShapePageTransform(e),c=d.rotation(),u=!!("rtl"===n.dir||(l=renderPlaintextFromRichText(t,i.props.richText),ag.test(l))),h=(200+t.options.adjacentShapeMargin+(a&&!r.shiftKey?i.props.growY:0))*i.props.scale,p=new eF.B(o?r.shiftKey!=u?-1:1:0,a?r.shiftKey?-1:1:0).mul(h).add(aw.clone().mul(i.props.scale)).rot(c).add(d.point()),f=getNoteShapeForAdjacentPosition(t,i,p,c);f&&startEditingShapeWithLabel(t,f,!0)}},[e,t,n.dir])}(t),f=useDefaultColorTheme(),g=200*i,m=getNoteHeight(e),y=(0,O.Hg)("shape rotation",()=>this.editor.getShapePageTransform(t)?.rotation()??0,[this.editor]),b=(0,O.Hg)("zoom",()=>this.editor.getZoomLevel()<.35/i,[i,this.editor]),S=(0,O.Hg)("dark mode",()=>this.editor.user.getIsDarkMode(),[this.editor]),v=e.id===this.editor.getOnlySelectedShapeId(),k=useIsReadyForEditing(this.editor,e.id),_=isEmptyRichText(c);return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("div",{id:t,className:"tl-note__container",style:{width:g,height:m,backgroundColor:f[o].note.fill,borderBottom:b?S?`${2*i}px solid rgb(20, 20, 20)`:`${2*i}px solid rgb(144, 144, 144)`:"none",boxShadow:b?"none":function(e,t,n){let r=(0,B.Vk)(e),i=Math.abs(r())+.5,o=Math.cos(t),a=5*n,l=4*n,d=6*n,c=7*n;return`0px ${a-i}px ${a}px -${a}px rgba(15, 23, 31, .6),
	0px ${(l+i*c)*Math.max(0,o)}px ${d+i*c}px -${l+i*d}px rgba(15, 23, 31, ${(.3+.1*i).toFixed(2)}), 
	0px ${48*n}px ${10*n}px -${10*n}px inset rgba(15, 23, 44, ${((.022+.005*r())*((1+o)/2)).toFixed(2)})`}(e.id,y,i)},children:(v||k||!_)&&(0,et.jsx)(aH,{shapeId:t,type:n,font:a,fontSize:(h||r1[l])*i,lineHeight:rJ.lineHeight,align:d,verticalAlign:u,richText:c,isSelected:v,labelColor:"black"===r?f[o].note.text:f[r].fill,wrap:!0,padding:16*i,hasCustomTabBehavior:!0,onKeyDown:p})}),"url"in e.props&&e.props.url&&(0,et.jsx)(HyperlinkButton,{url:e.props.url})]})}indicator(e){let{scale:t}=e.props;return(0,et.jsx)("rect",{rx:t,width:(0,ei.$Z)(200*t),height:(0,ei.$Z)(getNoteHeight(e))})}toSvg(e,t){let n=(0,L.y6)({isDarkMode:t.isDarkMode}),r=new e9.xu(0,0,200,200+e.props.growY),i=(0,et.jsx)(RichTextSVG,{fontSize:e.props.fontSizeAdjustment||r1[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,richText:e.props.richText,labelColor:n[e.props.color].note.text,bounds:r,padding:16,showTextOutline:!1});return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("rect",{x:5,y:5,rx:1,width:190,height:r.h,fill:"rgba(0,0,0,.1)"}),(0,et.jsx)("rect",{rx:1,width:200,height:r.h,fill:n[e.props.color].note.fill}),i]})}onBeforeCreate(e){return getNoteSizeAdjustments(this.editor,e)}onBeforeUpdate(e,t){if(!(0,B.Xy)(e.props.richText,t.props.richText)||e.props.font!==t.props.font||e.props.size!==t.props.size)return getNoteSizeAdjustments(this.editor,t)}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,scale:(0,B.t7)(e.props.scale,t.props.scale,n)}}};function getNoteSizeAdjustments(e,t){let{labelHeight:n,fontSizeAdjustment:r}=getLabelSize(e,t),i=Math.max(0,n-200);if(i!==t.props.growY||r!==t.props.fontSizeAdjustment)return{...t,props:{...t.props,growY:i,fontSizeAdjustment:r}}}let aJ=new B.kM;function getLabelSize(e,t){return aJ.get(t,()=>(function(e,t){let{richText:n}=t.props;if(isEmptyRichText(n)){let e=r1[t.props.size]*rJ.lineHeight+32;return{labelHeight:e,labelWidth:100,fontSizeAdjustment:0}}let r=r1[t.props.size],i=0,o=0,a=200,l=200;do{i=Math.min(r,r-o);let d=renderHtmlFromRichTextForMeasurement(e,n),c=e.textMeasure.measureHtml(d,{...rJ,fontFamily:r3[t.props.font],fontSize:i,maxWidth:167,disableOverflowWrapBreaking:!0,measureScrollWidth:!0});if(a=c.h+32,l=c.w+32,i<=14){let r=renderHtmlFromRichTextForMeasurement(e,n),o=e.textMeasure.measureHtml(r,{...rJ,fontFamily:r3[t.props.font],fontSize:i,maxWidth:167});a=o.h+32,l=o.w+32;break}if(c.scrollWidth.toFixed(0)===c.w.toFixed(0))break}while(o++<50);return{labelHeight:a,labelWidth:l,fontSizeAdjustment:i}})(e,t))}function getNoteHeight(e){return(200+e.props.growY)*e.props.scale}let aQ=(0,R.mV)("text size",(e,t)=>(e.fonts.trackFontsForShape(t),getTextSize(e,t.props)),{areRecordsEqual:(e,t)=>e.props===t.props});let TextShapeUtil=class TextShapeUtil extends eB.E{static type="text";static props=L.XB;static migrations=L.pL;options={extraArrowHorizontalPadding:10};getDefaultProps(){return{color:"black",size:"m",w:8,font:"draw",textAlign:"start",autoSize:!0,scale:1,richText:(0,L.Ak)("")}}getMinDimensions(e){return aQ.get(this.editor,e.id)}getGeometry(e,t){let{scale:n}=e.props,{width:r,height:i}=this.getMinDimensions(e),o=t?.context??"none";return new eD.z({x:("@tldraw/arrow-without-arrowhead"===o?-this.options.extraArrowHorizontalPadding:0)*n,width:(r+("@tldraw/arrow-without-arrowhead"===o?2*this.options.extraArrowHorizontalPadding:0))*n,height:i*n,isFilled:!0,isLabel:!0})}getFontFaces(e){return getFontsFromRichText(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}getText(e){return renderPlaintextFromRichText(this.editor,e.props.richText)}canEdit(){return!0}isAspectRatioLocked(){return!0}component(e){let{id:t,props:{font:n,size:r,richText:i,color:o,scale:a,textAlign:l}}=e,{width:d,height:c}=this.getMinDimensions(e),u=e.id===this.editor.getOnlySelectedShapeId(),h=useDefaultColorTheme(),p=function(e){let t=(0,eW.jE)();return(0,en.useCallback)(n=>{t.getEditingShapeId()===e&&"Enter"===n.key&&(n.ctrlKey||n.metaKey)&&t.complete()},[t,e])}(t);return(0,et.jsx)(aH,{shapeId:t,classNamePrefix:"tl-text-shape",type:"text",font:n,fontSize:r0[r],lineHeight:rJ.lineHeight,align:l,verticalAlign:"middle",richText:i,labelColor:h[o].solid,isSelected:u,textWidth:d,textHeight:c,style:{transform:`scale(${a})`,transformOrigin:"top left"},wrap:!0,onKeyDown:p})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds,n=(0,eW.jE)();return e.props.autoSize&&n.getEditingShapeId()===e.id?null:(0,et.jsx)("rect",{width:(0,ei.$Z)(t.width),height:(0,ei.$Z)(t.height)})}toSvg(e,t){let n=this.editor.getShapeGeometry(e).bounds,r=n.width/(e.props.scale??1),i=n.height/(e.props.scale??1),o=(0,L.y6)(t),a=new e9.xu(0,0,r,i);return(0,et.jsx)(RichTextSVG,{fontSize:r0[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",richText:e.props.richText,labelColor:o[e.props.color].solid,bounds:a,padding:0})}onResize(e,t){let{newPoint:n,initialBounds:r,initialShape:i,scaleX:o,handle:a}=t;if("scale_shape"===t.mode||"right"!==a&&"left"!==a)return{id:e.id,type:e.type,...resizeScaled(e,t)};{let t=Math.max(1,Math.abs(r.width*o)),{x:a,y:l}=o<0?eF.B.Sub(n,eF.B.FromAngle(e.rotation).mul(t)):n;return{id:e.id,type:e.type,x:a,y:l,props:{w:t/i.props.scale,autoSize:!1}}}}onEditEnd(e){let t=renderPlaintextFromRichText(this.editor,e.props.richText).trimEnd();0===t.length&&this.editor.deleteShapes([e.id])}onBeforeUpdate(e,t){let n;if(!t.props.autoSize)return;let r=e.props.size!==t.props.size||e.props.textAlign!==t.props.textAlign||e.props.font!==t.props.font||1!==e.props.scale&&1===t.props.scale,i=!(0,B.Xy)(e.props.richText,t.props.richText);if(!r&&!i)return;let o=this.getMinDimensions(e),a=getTextSize(this.editor,t.props),l=o.width*e.props.scale,d=o.height*e.props.scale,c=a.width*t.props.scale,u=a.height*t.props.scale;switch(t.props.textAlign){case"middle":n=new eF.B((c-l)/2,i?0:(u-d)/2);break;case"end":n=new eF.B(c-l,i?0:(u-d)/2);break;default:if(i)break;n=new eF.B(0,(u-d)/2)}if(!n)return{...t,props:{...t.props,w:c}};{n.rot(t.rotation);let{x:e,y:r}=t;return{...t,x:e-n.x,y:r-n.y,props:{...t.props,w:c}}}}};function getTextSize(e,t){let{font:n,richText:r,size:i,w:o}=t,a=r0[i],l=t.autoSize?null:Math.max(16,Math.floor(o)),d=renderHtmlFromRichTextForMeasurement(e,r),c=e.textMeasure.measureHtml(d,{...rJ,fontFamily:r3[n],fontSize:a,maxWidth:l});return{width:l??Math.max(16,c.w+1),height:Math.max(a,c.h)}}let a0=new B.kM;let VideoShapeUtil=class VideoShapeUtil extends BaseBoxShapeUtil{static type="video";static props=L.p$;static migrations=L.lY;options={autoplay:!0};canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,autoplay:this.options.autoplay,url:"",altText:"",time:0,playing:!0}}getAriaDescriptor(e){return e.props.altText}component(e){return(0,et.jsx)(a1,{shape:e})}indicator(e){return(0,et.jsx)("rect",{width:(0,ei.$Z)(e.props.w),height:(0,ei.$Z)(e.props.h)})}async toSvg(e,t){let n=e.props;if(!n.assetId)return null;let r=this.editor.getAsset(n.assetId);if(!r)return null;let i=await a0.get(r,async()=>{let e=await t.resolveAssetUrl(r.id,n.w);if(!e)return null;let i=await B.xe.loadVideo(e);return await B.xe.getVideoFrameAsDataUrl(i,0)});return i?(0,et.jsx)("image",{href:i,width:n.w,height:n.h,"aria-label":e.props.altText}):null}};let a1=(0,en.memo)(function({shape:e}){let t=(0,eW.jE)(),n=t.getShapeGeometry(e).bounds.w*t.getZoomLevel()>=110,r=useIsEditing(e.id),i=usePrefersReducedMotion(),{Spinner:o}=(0,eZ.o)(),{asset:a,url:l}=useImageOrVideoAsset({shapeId:e.id,assetId:e.props.assetId,width:e.props.w}),d=(0,en.useRef)(null),[c,u]=(0,en.useState)(!1),h=(0,en.useCallback)(e=>{let t=e.currentTarget;t&&u(!0)},[]),[p,f]=(0,en.useState)(!1);return(0,en.useEffect)(()=>{let fullscreenChange=()=>f(document.fullscreenElement===d.current);return document.addEventListener("fullscreenchange",fullscreenChange),()=>document.removeEventListener("fullscreenchange",fullscreenChange)}),(0,en.useEffect)(()=>{let e=d.current;e&&r&&document.activeElement!==e&&e.focus()},[r,c]),(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(HTMLContainer,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:a?"transparent":"var(--color-low)",border:a?"none":"1px solid var(--color-low-border)"},children:(0,et.jsx)("div",{className:"tl-counter-scaled",children:(0,et.jsx)("div",{className:"tl-video-container",children:a?o&&!a.props.src?(0,et.jsx)(o,{}):l?(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("video",{ref:d,style:r?{pointerEvents:"all"}:c?void 0:{display:"none"},className:eh("tl-video",`tl-video-shape-${e.id.split(":")[1]}`,{"tl-video-is-fullscreen":p}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:e.props.autoplay&&!i,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:r&&n,onLoadedData:h,hidden:!c,"aria-label":e.props.altText,children:(0,et.jsx)("source",{src:l})},l),!c&&o&&(0,et.jsx)(o,{})]}):null:(0,et.jsx)(BrokenAssetIcon,{})})})}),"url"in e.props&&e.props.url&&(0,et.jsx)(HyperlinkButton,{url:e.props.url})]})}),a2=[TextShapeUtil,BookmarkShapeUtil,DrawShapeUtil,GeoShapeUtil,NoteShapeUtil,LineShapeUtil,FrameShapeUtil,ArrowShapeUtil,HighlightShapeUtil,EmbedShapeUtil,ImageShapeUtil,VideoShapeUtil];function registerDefaultSideEffects(e){return e.sideEffects.register({instance_page_state:{afterChange:(t,n)=>{if(t.croppingShapeId!==n.croppingShapeId){let r=e.isIn("select.crop");!t.croppingShapeId&&n.croppingShapeId?r||e.setCurrentTool("select.crop.idle"):t.croppingShapeId&&!n.croppingShapeId&&r&&e.setCurrentTool("select.idle")}if(t.editingShapeId!==n.editingShapeId){if(!t.editingShapeId&&n.editingShapeId){if(!e.isIn("select.editing_shape")){let t=e.getEditingShape();t&&"text"===t.type&&e.isInAny("text.pointing","select.resizing")&&e.getInstanceState().isToolLocked?e.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):e.setCurrentTool("select.editing_shape")}}else t.editingShapeId&&!n.editingShapeId&&e.isIn("select.editing_shape")&&e.setCurrentTool("select.idle")}}}})}let Erasing=class Erasing extends eL.n{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;onEnter(e){this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=e;let{originPagePoint:t}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(e=>{if(this.editor.isShapeOrAncestorLocked(e))return!0;if(this.editor.isShapeOfType(e,"group")||this.editor.isShapeOfType(e,"frame")){let n=this.editor.getPointInShapeSpace(e,t),r=this.editor.getShapeGeometry(e);return r.bounds.containsPoint(n)}return!1}).map(e=>e.id));let n=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=n.id,this.update()}pushPointToScribble(){let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}update(){let{editor:e,excludedShapeIds:t}=this,n=e.getErasingShapeIds(),r=e.getZoomLevel(),i=e.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:o,previousPagePoint:a}}=e;this.pushPointToScribble();let l=new Set(n),d=this.editor.options.hitTestMargin/r;for(let t of i){if(e.isShapeOfType(t,"group"))continue;let n=e.getShapeMask(t.id);if(n&&!(0,ei.Of)(o,n))continue;let r=e.getShapeGeometry(t),i=e.getShapePageTransform(t);if(!r||!i)continue;let c=i.clone().invert(),u=c.applyToPoint(a),h=c.applyToPoint(o),{bounds:p}=r;!(p.minX-d>Math.max(u.x,h.x)||p.minY-d>Math.max(u.y,h.y)||p.maxX+d<Math.min(u.x,h.x)||p.maxY+d<Math.min(u.y,h.y))&&r.hitTestLineSegment(u,h,d)&&l.add(e.getOutermostSelectableShape(t).id)}this.editor.setErasingShapes([...l].filter(e=>!t.has(e)))}complete(){let{editor:e}=this;e.deleteShapes(e.getCurrentPageState().erasingShapeIds),this.parent.transition("idle")}cancel(){let{editor:e}=this;e.bailToMark(this.markId),this.parent.transition("idle",this.info)}};let childStates_Idle_Idle=class childStates_Idle_Idle extends eL.n{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}};let childStates_Pointing_Pointing=class childStates_Pointing_Pointing extends eL.n{static id="pointing";onEnter(){let e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:n}}=this.editor,r=new Set,i=r.size;for(let o=t.length,a=o-1;a>=0;a--){let o=t[a];if(!(this.editor.isShapeOrAncestorLocked(o)||this.editor.isShapeOfType(o,"group"))&&this.editor.isPointInShape(o,n,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){let e=this.editor.getOutermostSelectableShape(o);if(this.editor.isShapeOfType(e,"frame")&&r.size>i)break;r.add(e.id)}}this.editor.setErasingShapes([...r])}onLongPress(e){this.startErasing(e)}onExit(e,t){"erasing"!==t&&this.editor.setErasingShapes([])}onPointerMove(e){this.editor.inputs.isDragging&&this.startErasing(e)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(e){this.parent.transition("erasing",e)}complete(){let e=this.editor.getErasingShapeIds();e.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(e)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}};let EraserTool=class EraserTool extends eL.n{static id="eraser";static initial="idle";static isLockable=!1;static children(){return[childStates_Idle_Idle,childStates_Pointing_Pointing,Erasing]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}};let Dragging=class Dragging extends eL.n{static id="dragging";initialCamera=new eF.B;onEnter(){this.initialCamera=eF.B.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){let{initialCamera:e,editor:t}=this,{currentScreenPoint:n,originScreenPoint:r}=t.inputs,i=eF.B.Sub(n,r).div(t.getZoomLevel());0!==i.len2()&&t.setCamera(e.clone().add(i))}complete(){let{editor:e}=this,{pointerVelocity:t}=e.inputs,n=Math.min(t.len(),2);n>.1&&this.editor.slideCamera({speed:n,direction:t}),this.parent.transition("idle")}};let HandTool_childStates_Idle_Idle=class HandTool_childStates_Idle_Idle extends eL.n{static id="idle";onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}};let HandTool_childStates_Pointing_Pointing=class HandTool_childStates_Pointing_Pointing extends eL.n{static id="pointing";onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}};let HandTool=class HandTool extends eL.n{static id="hand";static initial="idle";static isLockable=!1;static children(){return[HandTool_childStates_Idle_Idle,HandTool_childStates_Pointing_Pointing,Dragging]}onDoubleClick(e){if("settle"===e.phase){let{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomIn(e,{animation:{duration:220,easing:te.L.easeOutQuint}})}}onTripleClick(e){if("settle"===e.phase){let{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomOut(e,{animation:{duration:320,easing:te.L.easeOutQuint}})}}onQuadrupleClick(e){if("settle"===e.phase){let e=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:t}}=this.editor;1===e?this.editor.zoomToFit({animation:{duration:400,easing:te.L.easeOutQuint}}):this.editor.resetZoom(t,{animation:{duration:320,easing:te.L.easeOutQuint}})}}};let LaserTool_childStates_Idle_Idle=class LaserTool_childStates_Idle_Idle extends eL.n{static id="idle";onCancel(){this.editor.setCurrentTool("select")}onPointerDown(e){this.parent.transition("lasering",e)}};let Lasering=class Lasering extends eL.n{static id="lasering";scribbleId="id";onEnter(){let e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}};let LaserTool=class LaserTool extends eL.n{static id="laser";static initial="idle";static children(){return[LaserTool_childStates_Idle_Idle,Lasering]}static isLockable=!1;onEnter(){this.editor.setCursor({type:"cross",rotation:0})}};let Brushing=class Brushing extends eL.n{static id="brushing";info={};initialSelectedShapeIds=[];excludedShapeIds=new Set;isWrapMode=!1;viewportDidChange=!1;cleanupViewportChangeReactor(){}onEnter(e){let{editor:t}=this,{altKey:n}=t.inputs;this.isWrapMode=t.user.getIsWrapMode(),this.viewportDidChange=!1;let r=!0;if(this.cleanupViewportChangeReactor=(0,F.Ym)("viewport change while brushing",()=>{t.getViewportPageBounds(),r||this.viewportDidChange||(this.viewportDidChange=!0)}),n){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(t.getCurrentPageShapes().filter(e=>t.isShapeOfType(e,"group")||t.isShapeOrAncestorLocked(e)).map(e=>e.id)),this.info=e,this.initialSelectedShapeIds=t.getSelectedShapeIds().slice(),this.hitTestShapes(),r=!1}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null}),this.cleanupViewportChangeReactor()}onTick({elapsed:e}){let{editor:t}=this;t.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(e){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",e)}onKeyDown(e){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){let e,t,n,r,i,o;let{editor:a,excludedShapeIds:l,isWrapMode:d}=this,{inputs:{originPagePoint:c,currentPagePoint:u,shiftKey:h,ctrlKey:p}}=a,f=new Set(h?this.initialSelectedShapeIds:[]),g=d?!p:p,m=e9.xu.FromPoints([c,u]),{corners:y}=m,b=a.getViewportPageBounds().contains(m),S=b&&!this.viewportDidChange?a.getCurrentPageRenderingShapesSorted():a.getCurrentPageShapesSorted(),v=a.getCurrentPageId();for(let d=0,c=S.length;d<c;d++)if(n=S[d],!(l.has(n.id)||f.has(n.id))&&(r=a.getShapePageBounds(n))){if(m.contains(r)){this.handleHit(n,u,v,f,y);continue}if(!(g||a.isShapeOfType(n,"frame"))&&m.collides(r)){if(!(i=a.getShapePageTransform(n)))continue;o=i.clone().invert().applyToPoints(y);let r=a.getShapeGeometry(n);for(let i=0;i<4;i++)if(e=o[i],t=o[(i+1)%4],r.hitTestLineSegment(e,t,0)){this.handleHit(n,u,v,f,y);break}}}let k=a.getInstanceState().brush;k&&m.equals(k)||a.updateInstanceState({brush:{...m.toJson()}});let _=a.getSelectedShapeIds();(_.length!==f.size||_.some(e=>!f.has(e)))&&a.setSelectedShapes(Array.from(f))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(e,t,n,r,i){if(e.parentId===n){r.add(e.id);return}let o=this.editor.getOutermostSelectableShape(e),a=this.editor.getShapeMask(o.id);(!a||(0,tn.UQ)(a,i)||(0,ei.Of)(t,a))&&r.add(o.id)}};let a3={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};let PointingResizeHandle=class PointingResizeHandle extends eL.n{static id="pointing_resize_handle";info={};updateCursor(){let e=this.editor.getSelectedShapes(),t=a3[this.info.handle];this.editor.setCursor({type:t,rotation:1===e.length?this.editor.getSelectionRotation():0})}onEnter(e){this.info=e,this.updateCursor()}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}};let Cropping=class Cropping extends eL.n{static id="cropping";info={};markId="";snapshot={};onEnter(e){this.info=e,this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}updateCursor(){let e=this.editor.getSelectedShapes()[0];if(!e)return;let t=a3[this.info.handle];this.editor.setCursor({type:t,rotation:this.editor.getSelectionRotation()})}updateShapes(){let{shape:e,cursorHandleOffset:t}=this.snapshot;if(!e)return;let n=this.editor.getShapeUtil(e.type);if(!n)return;let{shiftKey:r}=this.editor.inputs,i=this.editor.inputs.currentPagePoint.clone().sub(t),o=this.editor.inputs.originPagePoint.clone().sub(t),a=i.clone().sub(o).rot(-e.rotation),l=e.props.crop??getDefaultCrop(),d=getUncroppedSize(e.props,l),c=n.onCrop?.bind(n)??getCropBox,u=c(e,{handle:this.info.handle,change:a,crop:l,uncroppedSize:d,initialShape:this.snapshot.shape,aspectRatioLocked:r});u&&(this.editor.updateShapes([{id:e.id,type:e.type,...u}]),this.updateCursor())}complete(){this.updateShapes(),kickoutOccludedShapes(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){let e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:t}}=this.editor,n=this.editor.getOnlySelectedShape(),r=this.editor.getSelectionRotatedPageBounds(),i=eF.B.RotWith(r.getHandlePoint(this.info.handle),r.point,e),o=eF.B.Sub(t,i);return{shape:n,cursorHandleOffset:o}}};function getHitShapeOnCanvasPointerDown(e,t=!1){let n=e.getZoomLevel(),{inputs:{currentPagePoint:r}}=e;return e.getShapeAtPoint(r,{hitInside:!1,hitLabels:t,margin:e.options.hitTestMargin/n,renderingOnly:!0})??e.getSelectedShapeAtPoint(r)}function getTranslateCroppedImageChange(e,t,n){if(!t)throw Error("Needs to translate a cropped shape!");let{crop:r}=t.props;if(!r)return;let i=e.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;"x"===i?n.x=0:"y"===i&&(n.y=0),n.rot(-t.rotation);let{w:o,h:a}=getUncroppedSize(t.props,r),l=r.bottomRight.x-r.topLeft.x,d=r.bottomRight.y-r.topLeft.y,c=(0,B.v4)(r);c.topLeft.x=(0,ei.uZ)(c.topLeft.x-n.x/o,0,1-l),c.topLeft.y=(0,ei.uZ)(c.topLeft.y-n.y/a,0,1-d),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+d;let u={id:t.id,type:t.type,props:{crop:c}};return u}let children_Idle_Idle=class children_Idle_Idle extends eL.n{static id="idle";onEnter(){this.editor.setCursor({type:"default",rotation:0});let e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(e){if(e.accelKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{let t=getHitShapeOnCanvasPointerDown(this.editor);if(t&&!this.editor.isShapeOfType(t,"group")){this.onPointerDown({...e,shape:t,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}this.editor.getShapeUtil(e.shape)?.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break;default:this.cancel()}}}onDoubleClick(e){if(this.editor.inputs.shiftKey||"up"!==e.phase)return;let t=this.editor.getCroppingShapeId();if(!t)return;let n=this.editor.getShape(t);if(!n)return;let r=this.editor.getShapeUtil(n);if(r){if("selection"===e.target){r.onDoubleClickEdge?.(n,e);return}this.cancel(),this.editor.root.handleEvent(e)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(e){"Enter"===e.code&&(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{}))}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){let{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),r=new eF.B(0,0);if(t.has("ArrowLeft")&&(r.x+=1),t.has("ArrowRight")&&(r.x-=1),t.has("ArrowUp")&&(r.y+=1),t.has("ArrowDown")&&(r.y-=1),r.equals(new eF.B(0,0)))return;n&&r.mul(10);let i=this.editor.getShape(this.editor.getCroppingShapeId());if(!i)return;let o=getTranslateCroppedImageChange(this.editor,i,r);o&&(e||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([o]))}};let PointingCrop=class PointingCrop extends eL.n{static id="pointing_crop";onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(e){this.editor.inputs.isDragging&&this.startDragging(e)}onLongPress(e){this.startDragging(e)}onPointerUp(e){this.editor.setCurrentTool("select.crop.idle",e)}startDragging(e){this.editor.setCurrentTool("select.crop.translating_crop",e)}};let PointingCropHandle=class PointingCropHandle extends eL.n{static id="pointing_crop_handle";info={};onEnter(e){this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd);let t=this.editor.getSelectedShapes()[0];if(!t)return;let n=a3[this.info.handle];this.editor.setCursor({type:n,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(t.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}};let TranslatingCrop=class TranslatingCrop extends eL.n{static id="translating_crop";info={};markId="";snapshot={};onEnter(e){this.info=e,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(e){switch(e.key){case"Alt":case"Shift":this.updateShapes();return}}onKeyUp(e){switch(e.key){case"Enter":this.complete();return;case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){let e=this.editor.getOnlySelectedShape();return{shape:e}}updateShapes(){let e=this.snapshot.shape;if(!e)return;let{originPagePoint:t,currentPagePoint:n}=this.editor.inputs,r=n.clone().sub(t),i=getTranslateCroppedImageChange(this.editor,e,r);i&&this.editor.updateShapes([i])}};let Crop=class Crop extends eL.n{static id="crop";static initial="idle";static children(){return[children_Idle_Idle,TranslatingCrop,PointingCrop,PointingCropHandle,Cropping]}markId="";onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}didExit=!1;onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}};let DraggingHandle=class DraggingHandle extends eL.n{static id="dragging_handle";shapeId;initialHandle;initialAdjacentHandle;initialPagePoint;markId;initialPageTransform;initialPageRotation;info;isPrecise=!1;isPreciseId=null;pointingId=null;onEnter(e){let{shape:t,isCreating:n,creatingMarkId:r,handle:i}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=t.id,this.markId="",n){if(r)this.markId=r;else{let e=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);e&&(this.markId=e)}}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");this.initialHandle=(0,B.v4)(i),this.initialPageTransform=this.editor.getShapePageTransform(t),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:n?"cross":"grabbing",rotation:0});let o=this.editor.getShapeHandles(t).sort(B.hl),a=o.findIndex(t=>t.id===e.handle.id);this.initialAdjacentHandle=null;for(let t=a+1;t<o.length;t++){let n=o[t];if("vertex"===n.type&&"middle"!==n.id&&n.id!==e.handle.id){this.initialAdjacentHandle=n;break}}if(!this.initialAdjacentHandle)for(let t=o.length-1;t>=0;t--){let n=o[t];if("vertex"===n.type&&"middle"!==n.id&&n.id!==e.handle.id){this.initialAdjacentHandle=n;break}}if(this.editor.isShapeOfType(t,"arrow")){let n=getArrowBindings(this.editor,t)[e.handle.id];this.isPrecise=!1,n&&(this.isPrecise=n.props.isPrecise,this.isPrecise?this.isPreciseId=n.toId:this.resetExactTimeout())}let l={handle:this.initialHandle,isPrecise:this.isPrecise,initial:t},d=this.editor.getShapeUtil(t),c=d.onHandleDragStart?.(t,l);c&&this.editor.updateShapes([{...c,id:t.id,type:t.type}]),this.update(),this.editor.select(this.shapeId)}exactTimeout=-1;resetExactTimeout(){-1!==this.exactTimeout&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){-1!==this.exactTimeout&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),clearArrowTargetState(this.editor),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),kickoutOccludedShapes(this.editor,[this.shapeId]);let e=this.editor.getShape(this.shapeId);if(e){let t=this.editor.getShapeUtil(e),n={handle:this.initialHandle,isPrecise:this.isPrecise,initial:this.info.shape},r=t.onHandleDragEnd?.(e,n);r&&this.editor.updateShapes([{...r,id:e.id,type:e.type}])}let{onInteractionEnd:t}=this.info;if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){let e=this.editor.getShape(this.shapeId);if(e){let t=this.editor.getShapeUtil(e),n={handle:this.initialHandle,isPrecise:this.isPrecise,initial:this.info.shape};t.onHandleDragCancel?.(e,n)}this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();let{onInteractionEnd:t}=this.info;if(t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){let{editor:e,shapeId:t,initialPagePoint:n}=this,{initialHandle:r,initialPageRotation:i,initialAdjacentHandle:o}=this,a=this.editor.user.getIsSnapMode(),{snaps:l,inputs:{currentPagePoint:d,shiftKey:c,ctrlKey:u,altKey:h,pointerVelocity:p}}=e,f=this.info.shape,g=e.getShape(t);if(!g)return;let m=e.getShapeUtil(g),y=e.isShapeOfType(g,"arrow")?getArrowBindings(e,g)[r.id]:void 0,b=d.clone().sub(n).rot(-i).add(r);if(c&&o&&"middle"!==r.id){let e=eF.B.Angle(o,b),t=(0,ei.nD)(e,24),n=t-e;b=eF.B.RotWith(b,o,n)}e.snaps.clearIndicators();let S={...r,x:b.x,y:b.y};if(r.canSnap&&(a?!u:u)){let n=e.getShapePageTransform(g.id);if(!n)throw Error("Expected a page transform");let i=l.handles.snapHandle({currentShapeId:t,handle:S});i&&(i.nudge.rot(-e.getShapeParentTransform(g).rotation()),b.add(i.nudge),S={...r,x:b.x,y:b.y})}let v=m.onHandleDrag?.(g,{handle:S,isPrecise:this.isPrecise||h,initial:f}),k={id:g.id,type:g.type,...v};if("vertex"===r.type&&this.editor.isShapeOfType(g,"arrow")){let t=getArrowBindings(e,g)[r.id];t?y?.toId!==t.toId&&(this.pointingId=t.toId,this.isPrecise=.5>p.len()||h,this.isPreciseId=this.isPrecise?t.toId:null,this.resetExactTimeout()):y&&(this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}v&&e.updateShapes([k])}};function getTextLabels(e){return e.isLabel?[e]:e instanceof td.m?e.children.filter(e=>e.isLabel):[]}let EditingShape=class EditingShape extends eL.n{static id="editing_shape";hitShapeForPointerUp=null;info={};onEnter(e){let t=this.editor.getEditingShape();if(!t)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=e,e.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),aS(this.editor),this.editor.select(t)}onExit(){let{editingShapeId:e}=this.editor.getCurrentPageState();e&&(this.editor.setEditingShape(null),aS.cancel(),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{})))}onPointerMove(e){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly()||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",e),this.hitShapeForPointerUp=null;return}switch(e.target){case"shape":case"canvas":aS(this.editor);return}}onPointerDown(e){switch(this.hitShapeForPointerUp=null,e.target){case"canvas":{let t=getHitShapeOnCanvasPointerDown(this.editor,!0);if(t){this.onPointerDown({...e,shape:t,target:"shape"});return}break}case"shape":{let{shape:t}=e,n=this.editor.getEditingShape();if(!n)throw Error("Expected an editing shape!");let r=this.editor.getShapeUtil(t).getGeometry(t),i=getTextLabels(r),o=1===i.length?i[0]:void 0,a=this.editor.isShapeOfType(n,"text")&&""===renderPlaintextFromRichText(this.editor,n.props.richText).trim();if(o&&!a){let e=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(o.bounds.containsPoint(e,0)&&o.hitTestPoint(e)){if(t.id===n.id)return;this.hitShapeForPointerUp=t,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(t.id);return}}else{t.id===n.id?this.editor.isShapeOfType(t,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",e)):this.parent.transition("pointing_shape",e);return}}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)}onPointerUp(e){let t=this.hitShapeForPointerUp;if(!t)return;this.hitShapeForPointerUp=null;let n=this.editor.getShapeUtil(t);if(t.isLocked)return;if(this.editor.getIsReadonly()&&!n.canEditInReadonly(t)){this.parent.transition("pointing_shape",e);return}this.editor.select(t.id);let r=this.editor.getEditingShape(),i=r&&r.id!==t.id;this.editor.setEditingShape(t.id);let o=eH.a.isIos||eH.a.isAndroid;o&&i?o&&i&&this.editor.emit("select-all-text",{shapeId:t.id}):this.editor.emit("place-caret",{shapeId:t.id,point:e.point}),aS(this.editor)}onComplete(e){this.editor.getContainer().focus(),this.parent.transition("idle",e)}onCancel(e){this.editor.getContainer().focus(),this.parent.transition("idle",e)}};function getShouldEnterCropMode(e){let t=e.getOnlySelectedShape();return!!(t&&!e.isShapeOrAncestorLocked(t)&&e.getShapeUtil(t).canCrop(t))}function selectOnCanvasPointerUp(e,t){let n=e.getSelectedShapeIds(),{currentPagePoint:r}=e.inputs,{shiftKey:i,altKey:o,accelKey:a}=t,l=i||a,d=e.getShapeAtPoint(r,{hitInside:!1,margin:e.options.hitTestMargin/e.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:e=>!e.isLocked});if(d){let t=e.getOutermostSelectableShape(d);if(l&&!o)e.cancelDoubleClick(),n.includes(t.id)?(e.markHistoryStoppingPoint("deselecting shape"),e.deselect(t)):(e.markHistoryStoppingPoint("shift selecting shape"),e.setSelectedShapes([...n,t.id]));else{let r;(r=t===d?d:t.id===e.getFocusedGroupId()||n.includes(t.id)?d:t)&&!n.includes(r.id)&&(e.markHistoryStoppingPoint("selecting shape"),e.select(r.id))}}else{if(l)return;{n.length>0&&(e.markHistoryStoppingPoint("selecting none"),e.selectNone());let t=e.getFocusedGroupId();if((0,L.YT)(t)){let n=e.getShape(t);e.isPointInShape(n,r,{margin:0,hitInside:!0})||e.setFocusedGroup(null)}}}}let a5=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];let SelectTool_childStates_Idle_Idle=class SelectTool_childStates_Idle_Idle extends eL.n{static id="idle";selectedShapesOnKeyDown=[];onEnter(){this.parent.setCurrentToolIdMask(void 0),aS(this.editor),this.selectedShapesOnKeyDown=[],this.editor.setCursor({type:"default",rotation:0})}onExit(){aS.cancel()}onPointerMove(){aS(this.editor)}onPointerDown(e){let t=e.ctrlKey&&getShouldEnterCropMode(this.editor);switch(e.target){case"canvas":{let t=getHitShapeOnCanvasPointerDown(this.editor);if(t&&!t.isLocked){this.onPointerDown({...e,shape:t,target:"shape"});return}let n=this.editor.getSelectedShapeIds(),r=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:i}}=this.editor;if((n.length>1||r&&!this.editor.getShapeUtil(r).hideSelectionBoundsBg(r))&&isPointInRotatedSelectionBounds(this.editor,i)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{let{shape:t}=e;if(this.isOverArrowLabelTest(t)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_rotate_handle",e);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":if(t)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_resize_handle",e)}break;default:{let t=this.editor.getHoveredShape();if(t&&!this.editor.getSelectedShapeIds().includes(t.id)&&!t.isLocked){this.onPointerDown({...e,shape:t,target:"shape"});return}this.parent.transition("pointing_selection",e)}}}}onDoubleClick(e){if(!this.editor.inputs.shiftKey&&"up"===e.phase&&!e.ctrlKey&&!e.shiftKey)switch(e.target){case"canvas":{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),r=this.editor.getFocusedGroupId();if(n){if(this.editor.isShapeOfType(n,"group")){selectOnCanvasPointerUp(this.editor,e);return}{let t=this.editor.getShape(n.parentId);if(t&&this.editor.isShapeOfType(t,"group")){if(r&&t.id===r);else{selectOnCanvasPointerUp(this.editor,e);return}}}this.onDoubleClick({...e,shape:n,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getIsReadonly())break;let t=this.editor.getOnlySelectedShape();if(t){let n=this.editor.getShapeUtil(t);if(!this.canInteractWithShapeInReadOnly(t))return;if("right"===e.handle||"left"===e.handle||"top"===e.handle||"bottom"===e.handle){let r=n.onDoubleClickEdge?.(t,e);if(r){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([r]),kickoutOccludedShapes(this.editor,[t.id]);return}}if("top_left"===e.handle||"top_right"===e.handle||"bottom_right"===e.handle||"bottom_left"===e.handle){let r=n.onDoubleClickCorner?.(t,e);if(r){this.editor.markHistoryStoppingPoint("double click corner"),this.editor.updateShapes([r]),kickoutOccludedShapes(this.editor,[t.id]);return}}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(t)&&this.startEditingShape(t,e,!0)}break}case"shape":{let{shape:t}=e,n=this.editor.getShapeUtil(t);if("video"!==t.type&&"embed"!==t.type&&this.editor.getIsReadonly())break;if(n.onDoubleClick){let e=n.onDoubleClick?.(t);if(e){this.editor.updateShapes([e]);return}}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select(e.shape?.id),this.parent.transition("crop",e);return}this.shouldStartEditingShape(t)?this.startEditingShape(t,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getIsReadonly())break;let{shape:t,handle:n}=e,r=this.editor.getShapeUtil(t),i=r.onDoubleClickHandle?.(t,n);i?this.editor.updateShapes([i]):this.shouldStartEditingShape(t)&&this.startEditingShape(t,e,!0)}}}onRightClick(e){switch(e.target){case"canvas":{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(n){this.onRightClick({...e,shape:n,target:"shape"});return}let r=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((r.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&isPointInRotatedSelectionBounds(this.editor,o)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{let{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:n}=e,r=this.editor.getOutermostSelectableShape(n,e=>!t.includes(e.id));t.includes(r.id)||this.editor.findShapeAncestor(r,e=>t.includes(e.id))||(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([r.id]))}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(e){switch(this.selectedShapesOnKeyDown=this.editor.getSelectedShapes(),e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(e.accelKey){e.shiftKey?"ArrowDown"===e.code?this.editor.selectFirstChildShape():"ArrowUp"===e.code&&this.editor.selectParentShape():this.editor.selectAdjacentShape(e.code.replace("Arrow","").toLowerCase());return}this.nudgeSelectedShapes(!1);return}if(tg.hR.editOnType.get()&&!a5.includes(e.key)&&!e.altKey&&!e.ctrlKey){let t=this.editor.getOnlySelectedShape();if(t&&this.editor.isShapeOfType(t,"note")&&this.shouldStartEditingShape(t)){this.startEditingShape(t,{...e,target:"shape",shape:t},!0);return}}}onKeyRepeat(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(e.accelKey){this.editor.selectAdjacentShape(e.code.replace("Arrow","").toLowerCase());return}this.nudgeSelectedShapes(!0);break;case"Tab":{let t=this.editor.getSelectedShapes();t.length&&this.editor.selectAdjacentShape(e.shiftKey?"prev":"next")}}}onKeyUp(e){switch(e.code){case"Enter":{if(!this.selectedShapesOnKeyDown.length)return;let t=this.editor.getSelectedShapes();if(t.every(e=>this.editor.isShapeOfType(e,"group"))){this.editor.setSelectedShapes(t.flatMap(e=>this.editor.getSortedChildIdsForParent(e.id)));return}let n=this.editor.getOnlySelectedShape();if(n&&this.shouldStartEditingShape(n)){this.startEditingShape(n,{...e,target:"shape",shape:n},!0);return}getShouldEnterCropMode(this.editor)&&this.parent.transition("crop",e);break}case"Tab":{let t=this.editor.getSelectedShapes();t.length&&this.editor.selectAdjacentShape(e.shiftKey?"prev":"next")}}}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!(!e||this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type)&&!!this.canInteractWithShapeInReadOnly(e)&&this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t,n){this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type||(this.editor.markHistoryStoppingPoint("editing shape"),startEditingShapeWithLabel(this.editor,e,n),this.parent.transition("editing_shape",t))}isOverArrowLabelTest(e){if(!e)return!1;if(this.editor.isShapeOfType(e,"arrow")){let t=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),n=this.editor.getShapeGeometry(e).children[1];if(n&&(0,ei.Of)(t,n.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getIsReadonly()||!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");let t=(0,L.F1)(),{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:r,props:{richText:(0,L.Ak)(""),autoSize:!0}}]);let i=this.editor.getShape(t);if(!i)return;let o=this.editor.getShapeUtil(i);(!this.editor.getIsReadonly()||o.canEditInReadonly(i))&&(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){let{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),r=new eF.B(0,0);if(t.has("ArrowLeft")&&(r.x-=1),t.has("ArrowRight")&&(r.x+=1),t.has("ArrowUp")&&(r.y-=1),t.has("ArrowDown")&&(r.y+=1),r.equals(new eF.B(0,0)))return;e||this.editor.markHistoryStoppingPoint("nudge shapes");let{gridSize:i}=this.editor.getDocumentSettings(),o=this.editor.getInstanceState().isGridMode?n?i*a7:i:n?a4:a6,a=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(a,r.mul(o)),kickoutOccludedShapes(this.editor,a)}canInteractWithShapeInReadOnly(e){if(!this.editor.getIsReadonly())return!0;let t=this.editor.getShapeUtil(e);return!!t.canEditInReadonly(e)}};let a4=10,a6=1,a7=5;function isPointInRotatedSelectionBounds(e,t){let n=e.getSelectionRotatedPageBounds();if(!n)return!1;let r=e.getSelectionRotation();return r?(0,ei.Of)(t,n.corners.map(e=>eF.B.RotWith(e,n.point,r))):n.containsPoint(t)}let PointingArrowLabel=class PointingArrowLabel extends eL.n{static id="pointing_arrow_label";shapeId="";markId="";wasAlreadySelected=!1;didDrag=!1;didCtrlOnEnter=!1;info={};updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(e){let{shape:t}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=t.id,this.didDrag=!1,this.didCtrlOnEnter=e.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===t.id,this.updateCursor();let n=this.editor.getShapeGeometry(t),r=n.children[1];if(!r)throw Error(`Expected to find an arrow label geometry for shape: ${t.id}`);let{currentPagePoint:i}=this.editor.inputs,o=this.editor.getPointInShapeSpace(t,i);this._labelDragOffset=eF.B.Sub(r.center,o),this.markId=this.editor.markHistoryStoppingPoint("label-drag start");let a=e.shiftKey||e.accelKey;if(a){let e=this.editor.getSelectedShapeIds();this.editor.setSelectedShapes([...e,this.shapeId]);return}this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}_labelDragOffset=new eF.B(0,0);onPointerMove(){let{isDragging:e}=this.editor.inputs;if(!e)return;if(this.didCtrlOnEnter){this.parent.transition("brushing",this.info);return}let t=this.editor.getShape(this.shapeId);if(!t)return;let n=this.editor.getShapeUtil("arrow").options,r=getArrowBodyGeometry(this.editor,t),i=this.editor.getShapePageTransform(t.id),o=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint).add(this._labelDragOffset),a=getArrowLabelDefaultPosition(this.editor,t),l=r.uninterpolateAlongEdge(o);isNaN(l)&&(l=a);let d=i.applyToPoint(r.interpolateAlongEdge(l)),c=i.applyToPoint(r.interpolateAlongEdge(a));eF.B.DistMin(d,c,n.labelCenterSnapDistance/this.editor.getZoomLevel())&&(l=a),this.didDrag=!0,this.editor.updateShape({id:t.id,type:t.type,props:{labelPosition:l}})}onPointerUp(){let e=this.editor.getShape(this.shapeId);e&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}};let PointingCanvas=class PointingCanvas extends eL.n{static id="pointing_canvas";onEnter(e){let t=e.shiftKey||e.accelKey;!t&&this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(e){this.editor.inputs.isDragging&&this.parent.transition("brushing",e)}onPointerUp(e){selectOnCanvasPointerUp(this.editor,e),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}};let PointingHandle=class PointingHandle extends eL.n{static id="pointing_handle";didCtrlOnEnter=!1;info={};onEnter(e){this.info=e,this.didCtrlOnEnter=e.accelKey;let{shape:t}=e;if(this.editor.isShapeOfType(t,"arrow")){let n=getArrowBindings(this.editor,t),r=n[e.handle.id],i=n["start"===e.handle.id?"end":"start"],o=this.editor.getShapePageTransform(t.id);r&&updateArrowTargetState({editor:this.editor,pointInPageSpace:o.applyToPoint(e.handle),arrow:t,isPrecise:r.props.isPrecise,currentBinding:r,oppositeBinding:i})}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){let{shape:e,handle:t}=this.info;if(this.editor.isShapeOfType(e,"note")){let{editor:n}=this,r=getNoteForAdjacentPosition(n,e,t,!1);if(r){startEditingShapeWithLabel(n,r,!0);return}}this.parent.transition("idle",this.info)}onPointerMove(e){let{editor:t}=this;t.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",e):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){let{editor:e}=this;if(e.getIsReadonly())return;let{shape:t,handle:n}=this.info;if(e.isShapeOfType(t,"note")){let r=getNoteForAdjacentPosition(e,t,n,!0);if(r){let n=e.getPointInParentSpace(r,e.inputs.originPagePoint).sub(eF.B.Rot(aw.clone().mul(t.props.scale),r.rotation));e.updateShape({...r,x:n.x,y:n.y}),e.setHoveredShape(r.id).select(r.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:e.getShape(r),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{startEditingShapeWithLabel(e,r,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}};function getNoteForAdjacentPosition(e,t,n,r){let i=e.getShapePageTransform(t.id),o=i.point(),a=i.rotation(),l=getNoteAdjacentPositions(e,o,a,t.props.growY*t.props.scale,0,t.props.scale),d=l[n.index];if(d)return getNoteShapeForAdjacentPosition(e,t,d,a,r)}let PointingRotateHandle=class PointingRotateHandle extends eL.n{static id="pointing_rotate_handle";info={};updateCursor(){this.editor.setCursor({type:a3[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(e){this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}};let PointingSelection=class PointingSelection extends eL.n{static id="pointing_selection";info={};onEnter(e){this.info=e}onPointerUp(e){selectOnCanvasPointerUp(this.editor,e),this.parent.transition("idle",e)}onPointerMove(e){this.editor.inputs.isDragging&&this.startTranslating(e)}onLongPress(e){this.startTranslating(e)}startTranslating(e){this.editor.getIsReadonly()||this.parent.transition("translating",e)}onDoubleClick(e){let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(n){this.parent.transition("idle"),this.parent.onDoubleClick?.({...e,target:"shape",shape:this.editor.getShape(n)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}};let PointingShape=class PointingShape extends eL.n{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};isDoubleClick=!1;didCtrlOnEnter=!1;didSelectOnEnter=!1;onEnter(e){let t=this.editor.getSelectedShapeIds(),n=this.editor.getSelectionRotatedPageBounds(),r=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:i}}=this.editor,{shiftKey:o,altKey:a,accelKey:l}=e;this.hitShape=e.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=l;let d=this.editor.getOutermostSelectableShape(e.shape),c=this.editor.findShapeAncestor(d,e=>t.includes(e.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(e.shape).onClick||d.id===r||t.includes(d.id)||c||t.length>1&&n?.containsPoint(i)){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=d;return}this.didSelectOnEnter=!0,o&&!a?(this.editor.cancelDoubleClick(),t.includes(d.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...t,d.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([d.id]))}onPointerUp(e){let t=this.editor.getSelectedShapeIds(),n=this.editor.getFocusedGroupId(),r=this.editor.getZoomLevel(),{inputs:{currentPagePoint:i}}=this.editor,o=e.shiftKey||e.accelKey,a=this.editor.getShapeAtPoint(i,{margin:this.editor.options.hitTestMargin/r,hitInside:!0,renderingOnly:!0})??this.hitShape,l=a?this.editor.getOutermostSelectableShape(a):this.hitShapeForPointerUp;if(l){let r=this.editor.getShapeUtil(l);if(r.onClick){let t=r.onClick?.(l);if(t){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([t]),this.parent.transition("idle",e);return}}if(l.id===n){t.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",e);return}}if(!this.didSelectOnEnter){let n=this.editor.getOutermostSelectableShape(a,e=>!t.includes(e.id));if(t.includes(n.id)){if(o)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(l);else if(t.includes(l.id)){if(1===t.length){let t=this.editor.getShapeUtil(l).getGeometry(l),n=getTextLabels(t),r=1===n.length?n[0]:void 0;if(r){let t=this.editor.getPointInShapeSpace(l,i);if(r.bounds.containsPoint(t,0)&&r.hitTestPoint(t)){this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(l.id);let t=this.editor.getShapeUtil(l);(!this.editor.getIsReadonly()||t.canEditInReadonly(l))&&(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick?this.editor.emit("select-all-text",{shapeId:l.id}):this.editor.emit("place-caret",{shapeId:l.id,point:e.point}))});return}}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l)}else if(o){let e=this.editor.getShapeAncestors(n);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(t=>!e.find(e=>e.id===t)),n.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([n.id])}this.parent.transition("idle",e)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(e){this.editor.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",e):this.startTranslating(e))}onLongPress(e){this.startTranslating(e)}startTranslating(e){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",e))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}};let Resizing=class Resizing extends eL.n{static id="resizing";info={};markId="";didHoldCommand=!1;creationCursorOffset={x:0,y:0};snapshot={};onEnter(e){let{isCreating:t=!1,creatingMarkId:n,creationCursorOffset:r={x:0,y:0}}=e;this.info=e,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=r;try{this.snapshot=this._createSnapshot()}catch(e){console.error(e),this.cancel();return}if(this.markId="",t){if(n)this.markId=n;else{let e=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);e&&(this.markId=e)}}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");t&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:e}){let{editor:t}=this;t.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){let{shapeSnapshots:e}=this.snapshot;e.forEach(({shape:e})=>{let t=this.editor.getShape(e.id);if(t){let n=this.editor.getShapeUtil(e);n.onResizeCancel?.(e,t)}}),this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){if(kickoutOccludedShapes(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){this.info.onCreate?.(this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){let{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:e})=>{let n=this.editor.getShapeUtil(e),r=n.onResizeStart?.(e);r&&t.push(r)}),t.length>0&&this.editor.updateShapes(t)}handleResizeEnd(){let{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:e})=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onResizeEnd?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){let{altKey:e,shiftKey:t}=this.editor.inputs,{frames:n,shapeSnapshots:r,selectionBounds:i,cursorHandleOffset:o,selectedShapeIds:a,selectionRotation:l,canShapesDeform:d}=this.snapshot,c=t||!d;if(1===r.size){let e=[...r.values()][0];this.editor.isShapeOfType(e.shape,"text")&&(c=!("left"===this.info.handle||"right"===this.info.handle))}let u=(0,tw.q)(this.editor.inputs),h=this.editor.inputs.currentPagePoint.clone().sub(o).sub(this.creationCursorOffset),p=this.editor.inputs.originPagePoint.clone().sub(o);if(this.editor.getInstanceState().isGridMode&&!u){let{gridSize:e}=this.editor.getDocumentSettings();h.snapToGrid(e)}let f=this.info.handle,g=rotateSelectionHandle(f,Math.PI);this.editor.snaps.clearIndicators();let m=this.editor.user.getIsSnapMode()?!u:u;if(m&&l%ei.pj==0){let{nudge:t}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:eF.B.Sub(h,p),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:rotateSelectionHandle(f,l),isAspectRatioLocked:c,isResizingFromCenter:e});h.add(t)}let y=eF.B.RotWith(e?i.center:i.getHandlePoint(g),i.point,l),b=eF.B.Sub(h,y).rot(-l),S=eF.B.Sub(p,y).rot(-l),v=eF.B.DivV(b,S);Number.isFinite(v.x)||(v.x=1),Number.isFinite(v.y)||(v.y=1);let k="top"===f||"bottom"===f,_="left"===f||"right"===f;for(let e of(c?_?v.y=Math.abs(v.x):k?v.x=Math.abs(v.y):Math.abs(v.x)>Math.abs(v.y)?v.y=Math.abs(v.x)*(v.y<0?-1:1):v.x=Math.abs(v.y)*(v.x<0?-1:1):(k&&(v.x=1),_&&(v.y=1)),this.info.isCreating||this.updateCursor({dragHandle:f,isFlippedX:v.x<0,isFlippedY:v.y<0,rotation:l}),r.keys())){let t=r.get(e);this.editor.resizeShape(e,v,{initialShape:t.shape,initialBounds:t.bounds,initialPageTransform:t.pageTransform,dragHandle:f,mode:1===a.length&&e===a[0]?"resize_bounds":"scale_shape",scaleOrigin:y,isAspectRatioLocked:c,scaleAxisRotation:l,skipStartAndEndCallbacks:!0})}if(u)for(let{id:e,children:t}of(this.didHoldCommand=!0,n)){if(!t.length)continue;let n=r.get(e).shape,i=this.editor.getShape(e);if(!(n&&i))continue;let o=i.x-n.x,a=i.y-n.y,l=new eF.B(o,a).rot(-n.rotation);if(0!==l.x||0!==l.y)for(let e of t)this.editor.updateShape({id:e.id,type:e.type,x:e.x-l.x,y:e.y-l.y})}else if(this.didHoldCommand){for(let{children:e}of(this.didHoldCommand=!1,n))if(e.length)for(let t of e)this.editor.updateShape({id:t.id,type:t.type,x:t.x,y:t.y})}}updateCursor({dragHandle:e,isFlippedX:t,isFlippedY:n,rotation:r}){let i={...this.editor.getInstanceState().cursor};switch(e){case"top_left":case"bottom_right":i.type="nwse-resize",t!==n&&(i.type="nesw-resize");break;case"top_right":case"bottom_left":i.type="nesw-resize",t!==n&&(i.type="nwse-resize")}i.rotation=r,this.editor.setCursor(i)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){let{editor:e}=this,t=e.getSelectedShapeIds(),n=e.getSelectionRotation(),{inputs:{originPagePoint:r}}=e,i=e.getSelectionRotatedPageBounds();if(!i)throw Error("Resizing but nothing is selected");let o=eF.B.RotWith(i.getHandlePoint(this.info.handle),i.point,n),a=eF.B.Sub(r,o),l=new Map,d=[],populateResizingShapes=t=>{let n=e.getShape(t);if(!n)return!1;let r=e.getShapeUtil(n);if(r.canResize(n)){let t=e.getShapePageTransform(n);l.set(n.id,{shape:n,bounds:e.getShapeGeometry(n).bounds,pageTransform:t,pageRotation:tu._.Decompose(t).rotation,isAspectRatioLocked:r.isAspectRatioLocked(n)})}if(e.isShapeOfType(n,"frame")&&d.push({id:n.id,children:(0,B.oA)(e.getSortedChildIdsForParent(n).map(t=>e.getShape(t)))}),!r.canResizeChildren(n))return!1};t.forEach(t=>{let n=populateResizingShapes(t);!1!==n&&e.visitDescendants(t,populateResizingShapes)});let c=![...l.values()].some(e=>!(0,ei._G)(e.pageRotation,n)||e.isAspectRatioLocked);return{shapeSnapshots:l,selectionBounds:i,cursorHandleOffset:a,selectionRotation:n,selectedShapeIds:t,canShapesDeform:c,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:d}}};let a8=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function rotateSelectionHandle(e,t){t%=ei.yo;let n=Math.round(t/(ei.PI/4)),r=a8.indexOf(e);return a8[(r+n)%a8.length]}let a9=Math.PI/180;let Rotating=class Rotating extends eL.n{static id="rotating";snapshot={};info={};markId="";onEnter(e){this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");let t=(0,tC.o)({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!t)return this.parent.transition("idle",this.info);this.snapshot=t;let n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});(0,tC.Z)({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:a3[this.info.handle],rotation:n+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){let e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});(0,tC.Z)({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:a3[this.info.handle],rotation:e+this.snapshot.initialShapesRotation})}cancel(){let{shapeSnapshots:e}=this.snapshot;e.forEach(({shape:e})=>{let t=this.editor.getShape(e.id);if(t){let n=this.editor.getShapeUtil(e);n.onRotateCancel?.(e,t)}}),this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}complete(){(0,tC.Z)({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),kickoutOccludedShapes(this.editor,this.snapshot.shapeSnapshots.map(e=>e.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:e}){let{inputs:{shiftKey:t,currentPagePoint:n}}=this.editor,{initialCursorAngle:r,initialShapesRotation:i,initialPageCenter:o}=this.snapshot,a=o.angle(n)-r,l=i+a;if(t)l=(0,ei.nD)(l,24);else if(e&&(l=Math.round(l/a9)*a9,this.editor.getInstanceState().isCoarsePointer)){let e=(0,ei.nD)(l,4),t=(0,ei.Z7)(l,e);Math.abs(t)<(0,ei.Ht)(5)&&(l=e)}return l-i}};let ScribbleBrushing=class ScribbleBrushing extends eL.n{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();let e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)}updateScribbleSelection(e){let t,n,r,i;let{editor:o}=this,a=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:l,originPagePoint:d,previousPagePoint:c,currentPagePoint:u}}=this.editor,{newlySelectedShapeIds:h,initialSelectedShapeIds:p}=this;e&&this.pushPointToScribble();for(let e=0,l=a.length;e<l;e++){if(t=a[e],o.isShapeOfType(t,"group")||h.has(t.id)||o.isShapeOrAncestorLocked(t)||(n=o.getShapeGeometry(t),o.isShapeOfType(t,"frame")&&n.bounds.containsPoint(o.getPointInShapeSpace(t,d))))continue;let l=o.getShapePageTransform(t);if(!n||!l)continue;let p=l.clone().invert();r=p.applyToPoint(c),i=p.applyToPoint(u);let{bounds:f}=n;if(!(f.minX-0>Math.max(r.x,i.x)||f.minY-0>Math.max(r.y,i.y)||f.maxX+0<Math.min(r.x,i.x)||f.maxY+0<Math.min(r.y,i.y))&&n.hitTestLineSegment(r,i,0)){let e=this.editor.getOutermostSelectableShape(t),n=this.editor.getShapeMask(e.id);if(n){let e=(0,tn.qZ)(c,u,n);if(null!==e){let e=(0,ei.Of)(u,n);if(!e)continue}}h.add(e.id)}}let f=o.getSelectedShapeIds(),g=new Set(l?[...h,...p]:[...h]);(f.length!==g.size||f.some(e=>!g.has(e)))&&this.editor.setSelectedShapes(Array.from(g))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}};var se=Object.create,st=Object.defineProperty,sn=Object.getOwnPropertyDescriptor,__knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,n)=>t in e?st(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__name=(e,t)=>st(e,"name",{value:t,configurable:!0}),sr=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=e=>void 0!==e&&"function"!=typeof e?__typeError("Function expected"):e,__decoratorContext=(e,t,n,r,i)=>({kind:sr[e],name:t,metadata:r,addInitializer:e=>n._?__typeError("Already initialized"):i.push(__expectFn(e||null))}),__decoratorMetadata=(e,t)=>__defNormalProp(t,__knownSymbol("metadata"),e[3]),__runInitializers=(e,t,n,r)=>{for(var i=0,o=e[t>>1],a=o&&o.length;i<a;i++)1&t?o[i].call(n):r=o[i].call(n,r);return r},__publicField=(e,t,n)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),__accessCheck=(e,t,n)=>t.has(e)||__typeError("Cannot "+n),__privateIn=(e,t)=>Object(t)!==t?__typeError('Cannot use the "in" operator on this value'):e.has(t),__privateGet=(e,t,n)=>(__accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),__privateSet=(e,t,n,r)=>(__accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),__privateMethod=(e,t,n)=>(__accessCheck(e,t,"access private method"),n);f=[B.ak];let DragAndDropManager=class DragAndDropManager{constructor(e){this.editor=e,__runInitializers(g,5,this),__publicField(this,"shapesToActuallyMove",[]),__publicField(this,"draggedOverShapeIds",new Set),__publicField(this,"initialGroupIds",new Map),__publicField(this,"initialParentIds",new Map),__publicField(this,"initialIndices",new Map),__publicField(this,"initialDraggingOverShape"),__publicField(this,"prevDraggingOverShape"),__publicField(this,"prevPagePoint",new eF.B),__publicField(this,"intervalTimerId",-1),e.disposables.add(this.dispose)}startDraggingShapes(e,t,n){let{editor:r}=this;if(-1!==this.intervalTimerId)return;let i=new Set(e),o=new Set;for(let e of i){let t=r.getShapeParent(e);t&&r.isShapeOfType(t,"group")&&!o.has(t)&&o.add(t)}for(let e of o){let t=(0,B.oA)(r.getSortedChildIdsForParent(e).map(e=>r.getShape(e)));for(let n of(i.add(e),t))i.delete(n)}for(let e of(this.initialParentIds.clear(),i)){let t=r.getShapeParent(e);t&&this.initialParentIds.set(e.id,t.id),this.initialIndices.set(e.id,e.index);let n=r.findShapeAncestor(e,e=>r.isShapeOfType(e,"group"));n&&this.initialGroupIds.set(e.id,n.id)}let a=r.getCurrentPageShapesSorted();this.shapesToActuallyMove=Array.from(i).filter(e=>!e.isLocked).sort((e,t)=>a.indexOf(e)-a.indexOf(t)),this.initialDraggingOverShape=r.getDraggingOverShape(t,this.shapesToActuallyMove),this.prevDraggingOverShape=this.initialDraggingOverShape,this.updateDraggingShapes(t,n);let l=0;this.intervalTimerId=this.editor.timers.setInterval(()=>{++l%3&&this.editor.inputs.pointerVelocity.len()>.5||this.updateDraggingShapes(r.inputs.currentPagePoint,n)},e.length>10?320:60)}dropShapes(e){let{editor:t}=this;this.updateDraggingShapes(t.inputs.currentPagePoint);let n=t.getDraggingOverShape(t.inputs.currentPagePoint,e);if(n){let r=t.getShapeUtil(n);r.onDropShapesOver?.(n,e,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}this.dispose()}clear(){clearInterval(this.intervalTimerId),this.intervalTimerId=-1,this.initialParentIds.clear(),this.initialIndices.clear(),this.shapesToActuallyMove=[],this.initialDraggingOverShape=void 0,this.prevDraggingOverShape=void 0,this.editor.setHintingShapes([])}dispose(){this.clear()}updateDraggingShapes(e,t){let{editor:n}=this,r=(0,B.oA)(this.shapesToActuallyMove.map(e=>n.getShape(e)));if(!r.length)return;let i=n.getDraggingOverShape(e,this.shapesToActuallyMove),o=!this.prevPagePoint.equals(n.inputs.currentPagePoint);this.prevPagePoint.setTo(n.inputs.currentPagePoint),n.run(()=>{if(this.prevDraggingOverShape?.id===i?.id){if(o&&i&&(0,L.YT)(i.id)&&!n.inputs.previousPagePoint.equals(n.inputs.currentPagePoint)){let e=n.getShapeUtil(i);e.onDragShapesOver?.(i,r,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}return}if(this.prevDraggingOverShape){let e=n.getShapeUtil(this.prevDraggingOverShape);e.onDragShapesOut?.(this.editor.getShape(this.prevDraggingOverShape),r,{nextDraggingOverShapeId:i?.id??null,initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}if(i){let e=n.getShapeUtil(i);e.onDragShapesIn?.(i,r,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,prevDraggingOverShapeId:this.prevDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices}),n.setHintingShapes([i.id])}else this.prevDraggingOverShape&&n.setHintingShapes([]);t?.()}),this.prevDraggingOverShape=i}};((e,t,n,r,i,o)=>{var a,l,d,c,u,h=7&t,p=!!(8&t),f=!!(16&t),g=h>3?e.length+1:h?p?1:2:0,m=sr[h+5],y=h>3&&(e[g-1]=[]),b=e[g]||(e[g]=[]),S=h&&(f||p||(i=i.prototype),h<5&&(h>3||!f)&&sn(h<4?i:{get[n](){return __privateGet(this,o)},set[n](x){return __privateSet(this,o,x)}},n));h?f&&h<4&&__name(o,(h>2?"set ":h>1?"get ":"")+n):__name(i,n);for(var v=r.length-1;v>=0;v--)c=__decoratorContext(h,n,d={},e[3],b),h&&(c.static=p,c.private=f,u=c.access={has:f?e=>__privateIn(i,e):e=>n in e},3^h&&(u.get=f?e=>(1^h?__privateGet:__privateMethod)(e,i,4^h?o:S.get):e=>e[n]),h>2&&(u.set=f?(e,t)=>__privateSet(e,i,t,4^h?o:S.set):(e,t)=>e[n]=t)),l=(0,r[v])(h?h<4?f?o:S[m]:h>4?void 0:{get:S.get,set:S.set}:i,c),d._=1,4^h||void 0===l?__expectFn(l)&&(h>4?y.unshift(l):h?f?o=l:S[m]=l:i=l):"object"!=typeof l||null===l?__typeError("Object expected"):(__expectFn(a=l.get)&&(S.get=a),__expectFn(a=l.set)&&(S.set=a),__expectFn(a=l.init)&&y.unshift(a));return h||__decoratorMetadata(e,i),S&&st(i,n,S),f?4^h?o:S:i})(g=[,,,se((void 0)??null)],1,"dispose",f,DragAndDropManager),__decoratorMetadata(g,DragAndDropManager);var si=Object.create,so=Object.defineProperty,sa=Object.getOwnPropertyDescriptor,Translating_knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),Translating_typeError=e=>{throw TypeError(e)},Translating_defNormalProp=(e,t,n)=>t in e?so(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Translating_name=(e,t)=>so(e,"name",{value:t,configurable:!0}),ss=["class","method","getter","setter","accessor","field","value","get","set"],Translating_expectFn=e=>void 0!==e&&"function"!=typeof e?Translating_typeError("Function expected"):e,Translating_decoratorContext=(e,t,n,r,i)=>({kind:ss[e],name:t,metadata:r,addInitializer:e=>n._?Translating_typeError("Already initialized"):i.push(Translating_expectFn(e||null))}),Translating_decoratorMetadata=(e,t)=>Translating_defNormalProp(t,Translating_knownSymbol("metadata"),e[3]),Translating_runInitializers=(e,t,n,r)=>{for(var i=0,o=e[t>>1],a=o&&o.length;i<a;i++)1&t?o[i].call(n):r=o[i].call(n,r);return r},Translating_publicField=(e,t,n)=>Translating_defNormalProp(e,"symbol"!=typeof t?t+"":t,n),Translating_accessCheck=(e,t,n)=>t.has(e)||Translating_typeError("Cannot "+n),Translating_privateIn=(e,t)=>Object(t)!==t?Translating_typeError('Cannot use the "in" operator on this value'):e.has(t),Translating_privateGet=(e,t,n)=>(Translating_accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),Translating_privateSet=(e,t,n,r)=>(Translating_accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),Translating_privateMethod=(e,t,n)=>(Translating_accessCheck(e,t,"access private method"),n);let Translating=class Translating extends(y=eL.n,m=[B.ak],y){constructor(){super(...arguments),Translating_runInitializers(b,5,this),Translating_publicField(this,"info",{}),Translating_publicField(this,"selectionSnapshot",{}),Translating_publicField(this,"snapshot",{}),Translating_publicField(this,"markId",""),Translating_publicField(this,"isCloning",!1),Translating_publicField(this,"isCreating",!1),Translating_publicField(this,"dragAndDropManager",new DragAndDropManager(this.editor))}onCreate(e){}onEnter(e){let{isCreating:t=!1,creatingMarkId:n,onCreate:r=()=>void 0}=e;if(!this.editor.getSelectedShapeIds()?.length){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=t,this.markId="",t){if(n)this.markId=n;else{let e=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);e&&(this.markId=e)}}else this.markId=this.editor.markHistoryStoppingPoint("translating");this.onCreate=r,this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=getTranslatingSnapshot(this.editor),!this.isCreating&&this.editor.inputs.altKey&&(this.startCloning(),this.isCloning)||(this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes())}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:e}){let{editor:t}=this;t.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){this.editor.inputs.altKey&&!this.isCloning&&(this.startCloning(),this.isCloning)||this.updateShapes()}onKeyUp(){if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){if(this.isCreating)return;let e=Array.from(this.editor.getSelectedShapeIds());this.editor.canCreateShapes(e)&&(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=getTranslatingSnapshot(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),kickoutOccludedShapes(this.editor,this.snapshot.movingShapes.map(e=>e.id)),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){let{movingShapes:e}=this.snapshot;e.forEach(e=>{let t=this.editor.getShape(e.id);if(t){let n=this.editor.getShapeUtil(e);n.onTranslateCancel?.(e,t)}}),this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){let{movingShapes:e}=this.snapshot,t=[];e.forEach(e=>{let n=this.editor.getShapeUtil(e),r=n.onTranslateStart?.(e);r&&t.push(r)}),t.length>0&&this.editor.updateShapes(t),this.dragAndDropManager.startDraggingShapes((0,B.oA)(this.snapshot.movingShapes.map(e=>this.editor.getShape(e.id))),this.editor.inputs.originPagePoint,this.updateParentTransforms),this.editor.setHoveredShape(null)}handleEnd(){let{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){let t=eF.B.Average(e.map(e=>this.editor.getShapePageTransform(e.id).point())),n=eF.B.Sub(t,this.selectionSnapshot.averagePagePoint);eF.B.IsNaN(n)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(e=>e.id),offset:{x:n.x,y:n.y}}})}let t=[];e.forEach(e=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onTranslateEnd?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){let{snapshot:e}=this;this.dragAndDropManager.startDraggingShapes(e.movingShapes,this.editor.inputs.originPagePoint,this.updateParentTransforms),function({editor:e,snapshot:t}){let{inputs:n}=e,{noteSnapshot:r,noteAdjacentPositions:i,initialPageBounds:o,initialSnapPoints:a,shapeSnapshots:l,averagePagePoint:d}=t,c=e.getInstanceState().isGridMode,u=e.getDocumentSettings().gridSize,h=eF.B.Sub(n.currentPagePoint,n.originPagePoint),p=e.inputs.shiftKey?Math.abs(h.x)<Math.abs(h.y)?"x":"y":null;"x"===p?h.x=0:"y"===p&&(h.y=0),e.snaps.clearIndicators();let f=e.user.getIsSnapMode()?!n.ctrlKey:n.ctrlKey,g=!1;if(f&&.5>e.inputs.pointerVelocity.len()){let{nudge:t}=e.snaps.shapeBounds.snapTranslateShapes({dragDelta:h,initialSelectionPageBounds:o,lockedAxis:p,initialSelectionSnapPoints:a});h.add(t)}else if(r&&i){let{scale:t}=r.shape.props,n=r.pagePoint.clone().add(h).add(aw.clone().mul(t).rot(r.pageRotation)),o=10/e.getZoomLevel(),a=new eF.B(0,0);for(let e of i){let t=eF.B.Sub(n,e),r=t.len();r<o&&(g=!0,o=r,a=t)}h.sub(a)}let m=eF.B.Add(d,h),y=e.snaps.getIndicators();!c||n.ctrlKey||g||0!==y.length||m.snapToGrid(u);let b=eF.B.Sub(m,d);e.updateShapes((0,B.oA)(l.map(({shape:e,pagePoint:t,parentTransform:n})=>{let r=eF.B.Add(t,b),i=n?tu._.applyToPoint(n,r):r;return{id:e.id,type:e.type,x:i.x,y:i.y}})))}({editor:this.editor,snapshot:e});let{movingShapes:t}=e,n=[];t.forEach(e=>{let t=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onTranslate?.(e,t);i&&n.push(i)}),n.length>0&&this.editor.updateShapes(n)}updateParentTransforms(){let{editor:e,snapshot:{shapeSnapshots:t}}=this,n=[];t.forEach(t=>{let r=e.getShape(t.shape.id);if(!r)return null;n.push(r);let i=(0,L.r5)(r.parentId)?null:tu._.Inverse(e.getShapePageTransform(r.parentId));t.parentTransform=i})}};function getTranslatingSnapshot(e){let t,n;let r=[],i=[],o=e.getSelectedShapeIds(),a=(0,B.oA)(o.map(t=>{let n=e.getShape(t);if(!n)return null;r.push(n);let o=e.getShapePageTransform(t),a=o.point(),l=o.rotation();i.push(a);let d=L.ez.isId(n.parentId)?null:tu._.Inverse(e.getShapePageTransform(n.parentId));return{shape:n,pagePoint:a,pageRotation:l,parentTransform:d}})),l=e.getOnlySelectedShape(),d=[];if(l)d=e.snaps.shapeBounds.getSnapPoints(l.id);else{let t=e.getSelectionPageBounds();t&&(d=t.cornersAndCenter.map((e,t)=>({id:"selection:"+t,x:e.x,y:e.y})))}let{originPagePoint:c}=e.inputs,u=a.filter(t=>e.isShapeOfType(t.shape,"note")&&e.isPointInShape(t.shape,c));if(0===u.length);else if(1===u.length)n=u[0];else{let t=e.getCurrentPageShapesSorted();n=u.map(e=>({snapshot:e,index:t.findIndex(t=>t.id===e.shape.id)})).sort((e,t)=>t.index-e.index)[0]?.snapshot}return n&&(t=getAvailableNoteAdjacentPositions(e,n.pageRotation,n.shape.props.scale,n.shape.props.growY??0)),{averagePagePoint:eF.B.Average(i),movingShapes:r,shapeSnapshots:a,initialPageBounds:e.getSelectionPageBounds(),initialSnapPoints:d,noteAdjacentPositions:t,noteSnapshot:n}}((e,t,n,r,i,o)=>{var a,l,d,c,u,h=7&t,p=!!(8&t),f=!!(16&t),g=h>3?e.length+1:h?p?1:2:0,m=ss[h+5],y=h>3&&(e[g-1]=[]),b=e[g]||(e[g]=[]),S=h&&(f||p||(i=i.prototype),h<5&&(h>3||!f)&&sa(h<4?i:{get[n](){return Translating_privateGet(this,o)},set[n](x){return Translating_privateSet(this,o,x)}},n));h?f&&h<4&&Translating_name(o,(h>2?"set ":h>1?"get ":"")+n):Translating_name(i,n);for(var v=r.length-1;v>=0;v--)c=Translating_decoratorContext(h,n,d={},e[3],b),h&&(c.static=p,c.private=f,u=c.access={has:f?e=>Translating_privateIn(i,e):e=>n in e},3^h&&(u.get=f?e=>(1^h?Translating_privateGet:Translating_privateMethod)(e,i,4^h?o:S.get):e=>e[n]),h>2&&(u.set=f?(e,t)=>Translating_privateSet(e,i,t,4^h?o:S.set):(e,t)=>e[n]=t)),l=(0,r[v])(h?h<4?f?o:S[m]:h>4?void 0:{get:S.get,set:S.set}:i,c),d._=1,4^h||void 0===l?Translating_expectFn(l)&&(h>4?y.unshift(l):h?f?o=l:S[m]=l:i=l):"object"!=typeof l||null===l?Translating_typeError("Object expected"):(Translating_expectFn(a=l.get)&&(S.get=a),Translating_expectFn(a=l.set)&&(S.set=a),Translating_expectFn(a=l.init)&&y.unshift(a));return h||Translating_decoratorMetadata(e,i),S&&so(i,n,S),f?4^h?o:S:i})(b=[,,,si(y?.[Translating_knownSymbol("metadata")]??null)],1,"updateParentTransforms",m,Translating),Translating_decoratorMetadata(b,Translating),Translating_publicField(Translating,"id","translating"),n(25566);let SelectTool=class SelectTool extends eL.n{static id="select";static initial="idle";static isLockable=!1;reactor=void 0;static children(){return[Crop,Cropping,SelectTool_childStates_Idle_Idle,PointingCanvas,PointingShape,Translating,Brushing,ScribbleBrushing,PointingCropHandle,PointingSelection,PointingResizeHandle,EditingShape,Resizing,Rotating,PointingRotateHandle,PointingArrowLabel,PointingHandle,DraggingHandle]}cleanUpDuplicateProps(){let e=this.editor.getSelectedShapeIds(),t=this.editor.getInstanceState();if(!t.duplicateProps)return;let n=new Set(t.duplicateProps.shapeIds);e.length===n.size&&e.every(e=>n.has(e))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=(0,F.Ym)("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}})}onExit(){this.reactor?.(),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}};let ZoomTool_childStates_Idle_Idle=class ZoomTool_childStates_Idle_Idle extends eL.n{static id="idle";info={};onEnter(e){this.info=e}onPointerDown(){this.parent.transition("pointing",this.info)}};let ZoomTool_childStates_Pointing_Pointing=class ZoomTool_childStates_Pointing_Pointing extends eL.n{static id="pointing";info={};onEnter(e){this.info=e}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){let{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}};let ZoomBrushing=class ZoomBrushing extends eL.n{static id="zoom_brushing";info={};zoomBrush=new e9.xu;onEnter(e){this.info=e,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){let{inputs:{originPagePoint:e,currentPagePoint:t}}=this.editor;this.zoomBrush.setTo(e9.xu.FromPoints([e,t])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){let{zoomBrush:e}=this,t=8/this.editor.getZoomLevel();if(e.width<t&&e.height<t){let e=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}})}else{let t=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,{targetZoom:t,animation:{duration:220}})}this.parent.transition("idle",this.info)}};let ZoomTool=class ZoomTool extends eL.n{static id="zoom";static initial="idle";static children(){return[ZoomTool_childStates_Idle_Idle,ZoomBrushing,ZoomTool_childStates_Pointing_Pointing]}static isLockable=!1;info={};onEnter(e){this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(e){this.updateCursor(),"KeyZ"===e.code&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&"select"!==this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}};let sl=[EraserTool,HandTool,LaserTool,ZoomTool,SelectTool];function FollowingIndicator(){let e=(0,eW.jE)(),t=(0,O.Hg)("follow",()=>e.getInstanceState().followingUserId,[e]);return t?(0,et.jsx)(FollowingIndicatorInner,{userId:t}):null}function FollowingIndicatorInner({userId:e}){let t=(0,e3.o)(e);return t?(0,et.jsx)("div",{className:"tlui-following-indicator",style:{borderColor:t.color}}):null}let sd={fonts:{tldraw_mono:`${(0,tp.M)()}/fonts/IBMPlexMono-Medium.woff2`,tldraw_mono_italic:`${(0,tp.M)()}/fonts/IBMPlexMono-MediumItalic.woff2`,tldraw_mono_bold:`${(0,tp.M)()}/fonts/IBMPlexMono-Bold.woff2`,tldraw_mono_italic_bold:`${(0,tp.M)()}/fonts/IBMPlexMono-BoldItalic.woff2`,tldraw_serif:`${(0,tp.M)()}/fonts/IBMPlexSerif-Medium.woff2`,tldraw_serif_italic:`${(0,tp.M)()}/fonts/IBMPlexSerif-MediumItalic.woff2`,tldraw_serif_bold:`${(0,tp.M)()}/fonts/IBMPlexSerif-Bold.woff2`,tldraw_serif_italic_bold:`${(0,tp.M)()}/fonts/IBMPlexSerif-BoldItalic.woff2`,tldraw_sans:`${(0,tp.M)()}/fonts/IBMPlexSans-Medium.woff2`,tldraw_sans_italic:`${(0,tp.M)()}/fonts/IBMPlexSans-MediumItalic.woff2`,tldraw_sans_bold:`${(0,tp.M)()}/fonts/IBMPlexSans-Bold.woff2`,tldraw_sans_italic_bold:`${(0,tp.M)()}/fonts/IBMPlexSans-BoldItalic.woff2`,tldraw_draw:`${(0,tp.M)()}/fonts/Shantell_Sans-Informal_Regular.woff2`,tldraw_draw_italic:`${(0,tp.M)()}/fonts/Shantell_Sans-Informal_Regular_Italic.woff2`,tldraw_draw_bold:`${(0,tp.M)()}/fonts/Shantell_Sans-Informal_Bold.woff2`,tldraw_draw_italic_bold:`${(0,tp.M)()}/fonts/Shantell_Sans-Informal_Bold_Italic.woff2`}};function setDefaultEditorAssetUrls(e){sd=e}function useDefaultEditorAssetsWithOverrides(e){return(0,en.useMemo)(()=>e?{fonts:{...sd.fonts,...e?.fonts}}:sd,[e])}let sc={...sd,icons:Object.fromEntries(["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","alt","arrow-arc","arrow-cycle","arrow-elbow","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bold","bookmark","bring-forward","bring-to-front","broken","bulletList","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","color","comment","corners","crop","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","download","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","heading","help-circle","highlight","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","italic","leading","link","list","lock","manual","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","strike","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","underline","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"].map(e=>[e,`${(0,tp.M)()}/icons/icon/0_merged.svg#${e}`])),translations:Object.fromEntries(L.a2.map(e=>[e.locale,`${(0,tp.M)()}/translations/${e.locale}.json`])),embedIcons:Object.fromEntries(nd.map(e=>[e.type,`${(0,tp.M)()}/embed-icons/${e.type}.png`]))};function setDefaultUiAssetUrls(e){sc=e}function useDefaultUiAssetUrlsWithOverrides(e){return(0,en.useMemo)(()=>e?{fonts:Object.assign({...sc.fonts},{...e?.fonts}),icons:Object.assign({...sc.icons},{...e?.icons}),embedIcons:Object.assign({...sc.embedIcons},{...e?.embedIcons}),translations:Object.assign({...sc.translations},{...e?.translations})}:sc,[e])}var su=n(65050);function TldrawUiPopover({id:e,children:t,onOpenChange:n,open:r}){let[i,o]=useMenuIsOpen(e,n);return(0,et.jsx)(su.fC,{onOpenChange:o,open:r||i,children:(0,et.jsx)("div",{className:"tlui-popover",children:t})})}function TldrawUiPopoverTrigger({children:e}){return(0,et.jsx)(su.xz,{asChild:!0,dir:"ltr",children:e})}function TldrawUiPopoverContent({side:e,children:t,align:n="center",sideOffset:r=8,alignOffset:i=0,disableEscapeKeyDown:o=!1,autoFocusFirstButton:a=!0}){let l=(0,eG.uK)(),d=en.useRef(null),c=en.useCallback(()=>{if(!a)return;let e=d.current?.querySelectorAll("button:not([disabled])")??[],t=[...e].filter(e=>e.offsetWidth||e.offsetHeight),n=t[0];n&&n.focus()},[a]);return(0,et.jsx)(su.h_,{container:l,children:(0,et.jsx)(su.VY,{className:"tlui-popover__content",side:e,sideOffset:r,align:n,alignOffset:i,dir:"ltr",ref:d,onOpenAutoFocus:c,onEscapeKeyDown:e=>o&&e.preventDefault(),children:t})})}let useThreeStackableItems=()=>{let e=(0,eW.jE)();return(0,O.Hg)("threeStackableItems",()=>(function(e){let t=e.getSelectedShapeIds(),n=t.map(t=>e.getShape(t));return n.filter(t=>{if(!t)return!1;if(e.isShapeOfType(t,"arrow")){let n=getArrowBindings(e,t);if(n.start||n.end)return!1}return!0})})(e).length>2,[e])},useIsInSelectState=()=>{let e=(0,eW.jE)();return(0,O.Hg)("isInSelectState",()=>e.isIn("select"),[e])},useAllowGroup=()=>{let e=(0,eW.jE)();return(0,O.Hg)("allow group",()=>{let t=e.getSelectedShapes();if(t.length<2)return!1;for(let n of t)if(e.isShapeOfType(n,"arrow")){let r=getArrowBindings(e,n);if(r.start&&!t.some(e=>e.id===r.start.toId)||r.end&&!t.some(e=>e.id===r.end.toId))return!1}return!0},[e])},useAllowUngroup=()=>{let e=(0,eW.jE)();return(0,O.Hg)("allowUngroup",()=>e.getSelectedShapeIds().some(t=>e.getShape(t)?.type==="group"),[e])},sh="undefined"!=typeof window&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function useAnySelectedShapesCount(e,t){let n=(0,eW.jE)();return(0,O.Hg)("selectedShapes",()=>{let r=n.getSelectedShapes().length;return void 0===e?void 0===t?r:r<=t:void 0===t?r>=e:r>=e&&r<=t},[n,e,t])}function useUnlockedSelectedShapesCount(e,t){let n=(0,eW.jE)();return(0,O.Hg)("selectedShapes",()=>{let r=n.getSelectedShapes().filter(e=>!n.isShapeOrAncestorLocked(e)).length;return void 0===e?void 0===t?r:r<=t:void 0===t?r>=e:r>=e&&r<=t},[n])}function useHasLinkShapeSelected(){let e=(0,eW.jE)();return(0,O.Hg)("hasLinkShapeSelected",()=>{let t=e.getOnlySelectedShape();return!!(t&&"embed"!==t.type&&"url"in t.props&&!t.isLocked)},[e])}function useCanRedo(){let e=(0,eW.jE)();return(0,O.Hg)("useCanRedo",()=>e.getCanRedo(),[e])}function useCanUndo(){let e=(0,eW.jE)();return(0,O.Hg)("useCanUndo",()=>e.getCanUndo(),[e])}function DefaultActionsMenuContent(){return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(AlignMenuItems,{}),(0,et.jsx)(DistributeMenuItems,{}),(0,et.jsx)(StackMenuItems,{}),(0,et.jsx)(ReorderMenuItems,{}),(0,et.jsx)(ZoomOrRotateMenuItem,{}),(0,et.jsx)(RotateCWMenuItem,{}),(0,et.jsx)(EditLinkMenuItem,{}),(0,et.jsx)(GroupOrUngroupMenuItem,{})]})}function AlignMenuItems(){let e=useUnlockedSelectedShapesCount(2),t=useIsInSelectState(),n=e&&t;return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-left",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-center-horizontal",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-right",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"stretch-horizontal",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-top",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-center-vertical",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-bottom",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"stretch-vertical",disabled:!n})]})}function DistributeMenuItems(){let e=useUnlockedSelectedShapesCount(3),t=useIsInSelectState(),n=e&&t;return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"distribute-horizontal",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"distribute-vertical",disabled:!n})]})}function StackMenuItems(){let e=useThreeStackableItems(),t=useIsInSelectState(),n=e&&t;return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"stack-horizontal",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"stack-vertical",disabled:!n})]})}function ReorderMenuItems(){let e=useUnlockedSelectedShapesCount(1),t=useIsInSelectState(),n=e&&t;return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"send-to-back",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"send-backward",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"bring-forward",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"bring-to-front",disabled:!n})]})}function ZoomOrRotateMenuItem(){let e=useBreakpoint();return e<nf.TABLET_SM?(0,et.jsx)(ZoomTo100MenuItem,{}):(0,et.jsx)(RotateCCWMenuItem,{})}function ZoomTo100MenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("zoom is 1",()=>1===e.getZoomLevel(),[e]);return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-to-100",disabled:t})}function RotateCCWMenuItem(){let e=useUnlockedSelectedShapesCount(1),t=useIsInSelectState();return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"rotate-ccw",disabled:!(e&&t)})}function RotateCWMenuItem(){let e=useUnlockedSelectedShapesCount(1),t=useIsInSelectState();return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"rotate-cw",disabled:!(e&&t)})}function EditLinkMenuItem(){let e=useHasLinkShapeSelected(),t=useIsInSelectState();return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"edit-link",disabled:!(e&&t)})}function GroupOrUngroupMenuItem(){let e=useAllowGroup(),t=useAllowUngroup();return e?(0,et.jsx)(GroupMenuItem,{}):t?(0,et.jsx)(UngroupMenuItem,{}):(0,et.jsx)(GroupMenuItem,{})}function GroupMenuItem(){let e=useUnlockedSelectedShapesCount(2),t=useIsInSelectState();return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"group",disabled:!(e&&t)})}function UngroupMenuItem(){return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"ungroup"})}let sp=(0,en.memo)(function({children:e}){let t=useTranslation(),n=useBreakpoint(),r=useReadonly(),i=(0,en.useRef)(null);(0,e1.O)(i);let o=(0,eW.jE)(),a=(0,O.Hg)("should display quick actions when in readonly",()=>o.isInAny("hand","zoom"),[o]),l=e??(0,et.jsx)(DefaultActionsMenuContent,{});if(!r||a)return(0,et.jsxs)(TldrawUiPopover,{id:"actions-menu",children:[(0,et.jsx)(TldrawUiPopoverTrigger,{children:(0,et.jsx)(nU,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"dots-vertical",small:!0})})}),(0,et.jsx)(TldrawUiPopoverContent,{side:n>=nf.TABLET?"bottom":"top",sideOffset:6,children:(0,et.jsx)(nL,{ref:i,label:t("actions-menu.title"),className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"icons",sourceId:"actions-menu",children:l})})})]})});function ToggleAutoSizeMenuItem(){let e=function(){let e=(0,eW.jE)();return(0,O.Hg)("showAutoSizeToggle",()=>{let t=e.getSelectedShapes();return 1===t.length&&e.isShapeOfType(t[0],"text")&&!1===t[0].props.autoSize},[e])}();return e?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"toggle-auto-size"}):null}function menu_items_EditLinkMenuItem(){let e=useHasLinkShapeSelected();return e?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"edit-link"}):null}function DuplicateMenuItem(){let e=useUnlockedSelectedShapesCount(1);return e?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"duplicate"}):null}function FlattenMenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("should display flatten option",()=>{let t=e.getSelectedShapeIds();if(0===t.length)return!1;let n=e.getOnlySelectedShape();return!(n&&e.isShapeOfType(n,"image"))},[e]);return t?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"flatten-to-image"}):null}function DownloadOriginalMenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("should display download original option",()=>{let t=e.getSelectedShapes();return 0!==t.length&&t.some(t=>supportsDownloadingOriginal(t,e))},[e]);return t?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"download-original"}):null}function menu_items_GroupMenuItem(){let e=useAllowGroup();return e?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"group"}):null}function menu_items_UngroupMenuItem(){let e=useAllowUngroup();return e?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"ungroup"}):null}function RemoveFrameMenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("allow unframe",()=>{let t=e.getSelectedShapes();return 0!==t.length&&t.every(t=>e.isShapeOfType(t,"frame"))},[e]);return t?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"remove-frame"}):null}function FitFrameToContentMenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("allow fit frame to content",()=>{let t=e.getOnlySelectedShape();return!!t&&e.isShapeOfType(t,"frame")&&e.getSortedChildIdsForParent(t).length>0},[e]);return t?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"fit-frame-to-content"}):null}function ToggleLockMenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("selected shapes",()=>e.getSelectedShapes().length>0,[e]);return t?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"toggle-lock"}):null}function ToggleTransparentBgMenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("isTransparentBg",()=>!e.getInstanceState().exportBackground,[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-transparent",checked:t,toggle:!0})}function UnlockAllMenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("any shapes",()=>e.getCurrentPageShapeIds().size>0,[e]);return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"unlock-all",disabled:!t})}function menu_items_ZoomTo100MenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("zoomed to 100",()=>1===e.getZoomLevel(),[e]);return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-to-100",noClose:!0,disabled:t})}function ZoomToFitMenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("has shapes",()=>e.getCurrentPageShapeIds().size>0,[e]);return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-to-fit",disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function ZoomToSelectionMenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("has shapes",()=>e.getSelectedShapeIds().length>0,[e]);return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-to-selection",disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function ClipboardMenuGroup(){return(0,et.jsxs)(TldrawUiMenuGroup,{id:"clipboard",children:[(0,et.jsx)(CutMenuItem,{}),(0,et.jsx)(CopyMenuItem,{}),(0,et.jsx)(PasteMenuItem,{}),(0,et.jsx)(DuplicateMenuItem,{}),(0,et.jsx)(DeleteMenuItem,{})]})}function CopyAsMenuGroup(){let e=(0,eW.jE)(),t=(0,O.Hg)("atLeastOneShapeOnPage",()=>e.getCurrentPageShapeIds().size>0,[e]);return(0,et.jsxs)(TldrawUiMenuSubmenu,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!t,children:[(0,et.jsxs)(TldrawUiMenuGroup,{id:"copy-as-group",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"copy-as-svg"}),!!window.navigator.clipboard?.write&&(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"copy-as-png"})]}),(0,et.jsx)(TldrawUiMenuGroup,{id:"copy-as-bg",children:(0,et.jsx)(ToggleTransparentBgMenuItem,{})})]})}function CutMenuItem(){let e=useUnlockedSelectedShapesCount(1);return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"cut",disabled:!e})}function CopyMenuItem(){let e=useAnySelectedShapesCount(1);return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"copy",disabled:!e})}function PasteMenuItem(){return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"paste",disabled:!sh})}function ConversionsMenuGroup(){let e=(0,eW.jE)(),t=(0,O.Hg)("atLeastOneShapeOnPage",()=>e.getCurrentPageShapeIds().size>0,[e]);return t?(0,et.jsxs)(TldrawUiMenuGroup,{id:"conversions",children:[(0,et.jsx)(CopyAsMenuGroup,{}),(0,et.jsxs)(TldrawUiMenuSubmenu,{id:"export-as",label:"context-menu.export-as",size:"small",children:[(0,et.jsxs)(TldrawUiMenuGroup,{id:"export-as-group",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"export-as-svg"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"export-as-png"})]}),(0,et.jsx)(TldrawUiMenuGroup,{id:"export-as-bg",children:(0,et.jsx)(ToggleTransparentBgMenuItem,{})})]}),(0,et.jsx)(DownloadOriginalMenuItem,{})]}):null}function SelectAllMenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("atLeastOneShapeOnPage",()=>e.getCurrentPageShapeIds().size>0,[e]);return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"select-all",disabled:!t})}function DeleteMenuItem(){let e=useUnlockedSelectedShapesCount(1);return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"delete",disabled:!e})}function EditMenuSubmenu(){let e=useReadonly();return!useAnySelectedShapesCount(1)||e?null:(0,et.jsxs)(TldrawUiMenuSubmenu,{id:"edit",label:"context-menu.edit",size:"small",children:[(0,et.jsx)(menu_items_GroupMenuItem,{}),(0,et.jsx)(menu_items_UngroupMenuItem,{}),(0,et.jsx)(FlattenMenuItem,{}),(0,et.jsx)(menu_items_EditLinkMenuItem,{}),(0,et.jsx)(FitFrameToContentMenuItem,{}),(0,et.jsx)(RemoveFrameMenuItem,{}),(0,et.jsx)(ConvertToEmbedMenuItem,{}),(0,et.jsx)(ConvertToBookmarkMenuItem,{}),(0,et.jsx)(ToggleAutoSizeMenuItem,{}),(0,et.jsx)(ToggleLockMenuItem,{})]})}function ArrangeMenuSubmenu(){let e=useUnlockedSelectedShapesCount(2),t=function(){let e=(0,eW.jE)();return(0,O.Hg)("onlyFlippableShape",()=>{let t=e.getOnlySelectedShape();return t&&(e.isShapeOfType(t,"group")||e.isShapeOfType(t,"image")||e.isShapeOfType(t,"arrow")||e.isShapeOfType(t,"line")||e.isShapeOfType(t,"draw"))},[e])}(),n=useReadonly();return n||!(e||t)?null:(0,et.jsxs)(TldrawUiMenuSubmenu,{id:"arrange",label:"context-menu.arrange",size:"small",children:[e&&(0,et.jsxs)(TldrawUiMenuGroup,{id:"align",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-left"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-center-horizontal"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-right"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-top"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-center-vertical"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"align-bottom"})]}),(0,et.jsx)(DistributeMenuGroup,{}),e&&(0,et.jsxs)(TldrawUiMenuGroup,{id:"stretch",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"stretch-horizontal"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"stretch-vertical"})]}),(e||t)&&(0,et.jsxs)(TldrawUiMenuGroup,{id:"flip",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"flip-horizontal"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"flip-vertical"})]}),(0,et.jsx)(OrderMenuGroup,{})]})}function DistributeMenuGroup(){let e=useUnlockedSelectedShapesCount(3);return e?(0,et.jsxs)(TldrawUiMenuGroup,{id:"distribute",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"distribute-horizontal"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"distribute-vertical"})]}):null}function OrderMenuGroup(){let e=useUnlockedSelectedShapesCount(2),t=useThreeStackableItems();return e?(0,et.jsxs)(TldrawUiMenuGroup,{id:"order",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"pack"}),t&&(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"stack-horizontal"}),t&&(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"stack-vertical"})]}):null}function ReorderMenuSubmenu(){let e=useReadonly(),t=useUnlockedSelectedShapesCount(1);return e||!t?null:(0,et.jsx)(TldrawUiMenuSubmenu,{id:"reorder",label:"context-menu.reorder",size:"small",children:(0,et.jsxs)(TldrawUiMenuGroup,{id:"reorder",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"bring-to-front"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"bring-forward"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"send-backward"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"send-to-back"})]})})}function MoveToPageMenu(){let e=(0,eW.jE)(),t=(0,O.Hg)("pages",()=>e.getPages(),[e]),n=(0,O.Hg)("current page id",()=>e.getCurrentPageId(),[e]),{addToast:r}=useToasts(),i=useUiEvents(),o=useReadonly(),a=useUnlockedSelectedShapesCount(1);return!a||o?null:(0,et.jsxs)(TldrawUiMenuSubmenu,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[(0,et.jsx)(TldrawUiMenuGroup,{id:"pages",children:t.map(t=>(0,et.jsx)(TldrawUiMenuItem,{id:t.id,disabled:n===t.id,label:t.name.length>30?`${t.name.slice(0,30)}\u2026`:t.name,onSelect:()=>{e.markHistoryStoppingPoint("move_shapes_to_page"),e.moveShapesToPage(e.getSelectedShapeIds(),t.id);let o=e.getPage(t.id);o&&r({title:"Changed Page",description:`Moved to ${o.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{e.markHistoryStoppingPoint("change-page"),e.setCurrentPage(n)}}]}),i("move-to-page",{source:"context-menu"})}},t.id))}),(0,et.jsx)(TldrawUiMenuGroup,{id:"new-page",children:(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"move-to-new-page"})})]})}function ConvertToBookmarkMenuItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("oneEmbedSelected",()=>{let t=e.getOnlySelectedShape();return!!t&&!!(e.isShapeOfType(t,"embed")&&t.props.url&&!e.isShapeOrAncestorLocked(t))},[e]);return t?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"convert-to-bookmark"}):null}function ConvertToEmbedMenuItem(){let e=(0,eW.jE)(),t=useGetEmbedDefinition(),n=(0,O.Hg)("oneEmbeddableBookmarkSelected",()=>{let n=e.getOnlySelectedShape();return!!n&&!!(e.isShapeOfType(n,"bookmark")&&n.props.url&&t(n.props.url)&&!e.isShapeOrAncestorLocked(n))},[e]);return n?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"convert-to-embed"}):null}function ToggleSnapModeItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("isSnapMode",()=>e.user.getIsSnapMode(),[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-snap-mode",checked:t})}function ToggleToolLockItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("isToolLock",()=>e.getInstanceState().isToolLocked,[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-tool-lock",checked:t})}function ToggleGridItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("isGridMode",()=>e.getInstanceState().isGridMode,[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-grid",checked:t})}function ToggleWrapModeItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("isWrapMode",()=>e.user.getIsWrapMode(),[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-wrap-mode",checked:t})}function ToggleFocusModeItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("isFocusMode",()=>e.getInstanceState().isFocusMode,[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-focus-mode",checked:t})}function ToggleEdgeScrollingItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("edgeScrollSpeed",()=>e.user.getEdgeScrollSpeed(),[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-edge-scrolling",checked:1===t})}function ToggleReduceMotionItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("animationSpeed",()=>e.user.getAnimationSpeed(),[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-reduce-motion",checked:0===t})}function ToggleKeyboardShortcutsItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("keyboardShortcuts",()=>e.user.getAreKeyboardShortcutsEnabled(),[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-keyboard-shortcuts",checked:t})}function ToggleDebugModeItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("isDebugMode",()=>e.getInstanceState().isDebugMode,[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-debug-mode",checked:t})}function ToggleDynamicSizeModeItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("dynamic resize",()=>e.user.getIsDynamicResizeMode(),[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-dynamic-size-mode",checked:t})}function TogglePasteAtCursorItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("paste at cursor",()=>e.user.getIsPasteAtCursorMode(),[e]);return(0,et.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-paste-at-cursor",checked:t})}function PrintItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("emptyPage",()=>0===e.getCurrentPageShapeIds().size,[e]);return(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"print",disabled:t})}function CursorChatItem(){let e=(0,eW.jE)(),t=(0,O.Hg)("show cursor chat",()=>"select"===e.getCurrentToolId()&&!e.getInstanceState().isCoarsePointer,[e]);return t?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"open-cursor-chat"}):null}function DefaultContextMenuContent(){let e=(0,eW.jE)(),t=useShowCollaborationUi(),n=(0,O.Hg)("isSelectToolActive",()=>"select"===e.getCurrentToolId(),[e]),r=(0,O.Hg)("isSinglePageMode",()=>e.options.maxPages<=1,[e]);return n?(0,et.jsxs)(et.Fragment,{children:[t&&(0,et.jsx)(CursorChatItem,{}),(0,et.jsxs)(TldrawUiMenuGroup,{id:"modify",children:[(0,et.jsx)(EditMenuSubmenu,{}),(0,et.jsx)(ArrangeMenuSubmenu,{}),(0,et.jsx)(ReorderMenuSubmenu,{}),!r&&(0,et.jsx)(MoveToPageMenu,{})]}),(0,et.jsx)(ClipboardMenuGroup,{}),(0,et.jsx)(ConversionsMenuGroup,{}),(0,et.jsx)(TldrawUiMenuGroup,{id:"select-all",children:(0,et.jsx)(SelectAllMenuItem,{})})]}):null}let sf=(0,en.memo)(function({children:e,disabled:t=!1}){let n=(0,eW.jE)(),r=useTranslation(),{Canvas:i}=(0,eZ.o)(),o=(0,en.useCallback)(e=>{"Escape"===e.key&&(e.stopPropagation(),n.getContainer().focus())},[n]);(0,en.useEffect)(()=>()=>{document.body.removeEventListener("keydown",o,{capture:!0})},[o]);let a=(0,en.useCallback)(e=>{if(e){if(document.body.addEventListener("keydown",o,{capture:!0}),n.getInstanceState().isCoarsePointer){let e=n.getSelectedShapes(),{inputs:{currentPagePoint:t}}=n,r=n.getShapesAtPoint(t);if(!n.getSelectedShapes().length||!r.some(t=>e.includes(t))){let e=r.filter(e=>n.isShapeOrAncestorLocked(e));e.length&&n.select(...e.map(e=>e.id))}}}else{let e=n.getOnlySelectedShape();e&&n.isShapeOrAncestorLocked(e)&&n.setSelectedShapes([]),n.timers.requestAnimationFrame(()=>{document.body.removeEventListener("keydown",o,{capture:!0})})}},[n,o]),l=(0,eG.uK)(),[d,c]=useMenuIsOpen("context menu",a),u=e??(0,et.jsx)(DefaultContextMenuContent,{});return(0,et.jsxs)(ContextMenu,{dir:"ltr",onOpenChange:c,modal:!1,children:[(0,et.jsx)(t5,{onContextMenu:void 0,dir:"ltr",disabled:t,children:i?(0,et.jsx)(i,{}):null}),d&&(0,et.jsx)(ContextMenuPortal,{container:l,children:(0,et.jsx)(t6,{className:"tlui-menu tlui-scrollable","data-testid":"context-menu","aria-label":r("context-menu.title"),alignOffset:-4,collisionPadding:4,onContextMenu:e0.PF,children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"context-menu",sourceId:"context-menu",children:u})})})]})}),sg=(0,O.j)(function(){let e=(0,eW.jE)(),{isChatting:t,chatMessage:n}=e.getInstanceState(),r=(0,en.useRef)(-1),[i,o]=(0,en.useState)("");return((0,en.useEffect)(()=>{let i=!t&&n;if(i||t){let n=t?5e3:2e3;r.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),o(""),e.focus()},n)}return()=>{clearTimeout(r.current)}},[e,n,t]),t)?(0,et.jsx)(sm,{value:i,setValue:o,chatMessage:n}):n.trim()?(0,et.jsx)(NotEditingChatMessage,{chatMessage:n}):null});function usePositionBubble(e){let t=(0,eW.jE)();(0,en.useLayoutEffect)(()=>{let n=e.current;if(!n)return;let{x:r,y:i}=t.inputs.currentScreenPoint;function positionChatBubble(n){let{minX:r,minY:i}=t.getViewportScreenBounds();e.current?.style.setProperty("transform",`translate(${n.clientX-r}px, ${n.clientY-i}px)`)}return e.current?.style.setProperty("transform",`translate(${r}px, ${i}px)`),window.addEventListener("pointermove",positionChatBubble),()=>{window.removeEventListener("pointermove",positionChatBubble)}},[e,t])}let NotEditingChatMessage=({chatMessage:e})=>{let t=(0,eW.jE)(),n=(0,en.useRef)(null);return usePositionBubble(n),(0,et.jsx)("div",{ref:n,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:t.user.getColor()},children:e})},sm=(0,O.j)(function({chatMessage:e,value:t,setValue:n}){let r=(0,eW.jE)(),i=useTranslation(),o=(0,en.useRef)(null),a=e||i("cursor-chat.type-to-chat");usePositionBubble(o),(0,en.useLayoutEffect)(()=>{let e=o.current;if(!e)return;let n=r.textMeasure.measureText(t||a,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});e.style.setProperty("width",n.w+"px")},[r,t,a]),(0,en.useLayoutEffect)(()=>{let e=r.timers.requestAnimationFrame(()=>{o.current?.focus()});return()=>{cancelAnimationFrame(e)}},[r]);let l=(0,en.useCallback)(()=>{r.updateInstanceState({isChatting:!1}),r.focus()},[r]),d=(0,en.useCallback)(e=>{let{value:t}=e.target;n(t.slice(0,64)),r.updateInstanceState({chatMessage:t})},[r,n]),c=(0,en.useCallback)(e=>{let t=o.current;if(!t)return;let{value:r}=t;switch(e.key){case"Enter":if((0,e0.PF)(e),e.stopPropagation(),!r){l();return}n("");break;case"Escape":(0,e0.PF)(e),e.stopPropagation(),l()}},[l,n]),u=(0,en.useCallback)(e=>{e.stopPropagation()},[]);return(0,et.jsx)("input",{ref:o,className:"tl-cursor-chat",style:{backgroundColor:r.user.getColor()},onBlur:l,onChange:d,onKeyDown:c,onPaste:u,value:t,placeholder:a,spellCheck:!1})});function TldrawUiButtonCheck({checked:e}){let t=useTranslation();return(0,et.jsx)(nr,{"data-checked":!!e,label:t(e?"ui.checked":"ui.unchecked"),icon:e?"check":"none",className:"tlui-button__icon",small:!0})}function DefaultDebugMenuContent(){let e=(0,eW.jE)(),{addToast:t}=useToasts(),{addDialog:n}=useDialogs(),[r,i]=en.useState(!1);return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)(TldrawUiMenuGroup,{id:"items",children:[(0,et.jsx)(TldrawUiMenuItem,{id:"hard-reset",onSelect:tx.W,label:"Hard reset"}),(0,et.jsx)(TldrawUiMenuItem,{id:"add-toast",onSelect:()=>{t({id:(0,B.EL)(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),t({id:(0,B.EL)(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:(0,B.EL)(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:(0,B.EL)(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),(0,et.jsx)(TldrawUiMenuItem,{id:"show-dialog",label:"Show dialog",onSelect:()=>{n({component:({onClose:e})=>(0,et.jsx)(ExampleDialog,{displayDontShowAgain:!0,onCancel:()=>e(),onContinue:()=>e()}),onClose:()=>{}})}}),(0,et.jsx)(TldrawUiMenuItem,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>(function(e,t){let n=e.options.adjacentShapeMargin,r=Array(t),i=Math.floor(Math.sqrt(t));for(let e=0;e<t;e++)sb++,r[e]={id:(0,L.F1)("box"+sb),type:"geo",x:e%i*(100+n),y:Math.floor(e/i)*(100+n)};e.run(()=>{e.createShapes(r).setSelectedShapes(r.map(e=>e.id))})})(e,100)}),(0,et.jsx)(TldrawUiMenuItem,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{let t=e.getSelectedShapes(),n=0===t.length?e.getRenderingShapes():t;window.alert(`Shapes ${n.length}, DOM nodes:${document.querySelector(".tl-shapes").querySelectorAll("*")?.length}`)}}),(()=>{if(r)throw Error("oh no!");return null})(),(0,et.jsx)(TldrawUiMenuItem,{id:"throw-error",onSelect:()=>i(!0),label:"Throw error"})]}),(0,et.jsxs)(TldrawUiMenuGroup,{id:"flags",children:[(0,et.jsx)(DebugFlags,{}),(0,et.jsx)(FeatureFlags,{})]})]})}function DebugFlags(){let e=Object.values(tg.hR);return e.length?(0,et.jsx)(TldrawUiMenuSubmenu,{id:"debug flags",label:"Debug Flags",children:(0,et.jsx)(TldrawUiMenuGroup,{id:"debug flags",children:e.map(e=>(0,et.jsx)(sy,{flag:e},e.name))})}):null}function FeatureFlags(){let e=Object.values(tg.VH);return e.length?(0,et.jsx)(TldrawUiMenuSubmenu,{id:"feature flags",label:"Feature Flags",children:(0,et.jsx)(TldrawUiMenuGroup,{id:"feature flags",children:e.map(e=>(0,et.jsx)(sy,{flag:e},e.name))})}):null}function ExampleDialog({title:e="title",body:t="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,maxWidth:o="350",onCancel:a,onContinue:l}){let[d,c]=en.useState(!1);return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)(TldrawUiDialogHeader,{children:[(0,et.jsx)(TldrawUiDialogTitle,{children:e}),(0,et.jsx)(TldrawUiDialogCloseButton,{})]}),(0,et.jsx)(TldrawUiDialogBody,{style:{maxWidth:o},children:t}),(0,et.jsxs)(TldrawUiDialogFooter,{className:"tlui-dialog__footer__actions",children:[i&&(0,et.jsxs)(tz,{type:"normal",onClick:()=>c(!d),style:{marginRight:"auto"},children:[(0,et.jsx)(TldrawUiButtonCheck,{checked:d}),(0,et.jsx)(TldrawUiButtonLabel,{children:"Dont show again"})]}),(0,et.jsx)(tz,{type:"normal",onClick:a,children:(0,et.jsx)(TldrawUiButtonLabel,{children:n})}),(0,et.jsx)(tz,{type:"primary",onClick:async()=>l(),children:(0,et.jsx)(TldrawUiButtonLabel,{children:r})})]})]})}let sy=(0,O.j)(function({flag:e,onChange:t}){let n=e.get();return(0,et.jsx)(TldrawUiMenuCheckboxItem,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,e=>`${e[0]} ${e[1].toLowerCase()}`).replace(/^[a-z]/,e=>e.toUpperCase()),checked:n,onSelect:()=>{e.set(!n),t?.(!n)}})}),sb=0;function DefaultDebugMenu({children:e}){let t=e??(0,et.jsx)(DefaultDebugMenuContent,{});return(0,et.jsxs)(TldrawUiDropdownMenuRoot,{id:"debug",children:[(0,et.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,et.jsx)(tz,{type:"icon",title:"Debug menu",children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"dots-horizontal"})})}),(0,et.jsx)(TldrawUiDropdownMenuContent,{side:"top",align:"end",alignOffset:0,children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"debug-panel",children:t})})]})}let sx=(0,en.memo)(function(){let{DebugMenu:e}=useTldrawUiComponents(),t=(0,en.useRef)(null);return(0,e1.O)(t),(0,et.jsxs)("footer",{ref:t,className:"tlui-debug-panel",children:[(0,et.jsx)(sw,{}),(0,et.jsx)(FPS,{}),e&&(0,et.jsx)(e,{})]})}),sw=(0,O.j)(function(){!function(e=!0){let[t,n]=(0,en.useState)(0),r=(0,eW.jE)();(0,en.useEffect)(()=>{if(!e)return;let update=()=>n(e=>e+1);return r.on("tick",update),()=>{r.off("tick",update)}},[r,e])}();let e=(0,eW.jE)(),t=e.getPath(),n=e.getHoveredShape(),r=e.getOnlySelectedShape(),i="select.idle"!==t&&t.includes("select.")?r:n,o=i&&t.includes("select.")?` / ${i.type||""}${"geo"in i.props?" / "+i.props.geo:""} / [${eF.B.ToInt(e.getPointInShapeSpace(i,e.inputs.currentPagePoint))}]`:"",a=t.startsWith("select.")&&!t.includes(".idle")?` / [${eF.B.ToInt(e.inputs.originPagePoint)}] \u2192 [${eF.B.ToInt(e.inputs.currentPagePoint)}] = ${eF.B.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return(0,et.jsx)("div",{className:"tlui-debug-panel__current-state",children:`${t}${o}${a}`})});function FPS(){let e=(0,eW.jE)(),t=(0,O.Hg)("show_fps",()=>tg.hR.showFps.get(),[tg.hR]),n=(0,en.useRef)(null);return((0,en.useEffect)(()=>{if(!t)return;let r=0,i=-1,o=performance.now(),a=0,l=0,d=!1;return function loop(){if(l++,(a=performance.now()-o)>250){let e=Math.round(l*(250/a)*4);e>r&&(r=e);let t=.75*r;(e<t&&!d||e>=t&&d)&&(d=!d),n.current.innerHTML=`FPS ${e.toString()}`,n.current.className="tlui-debug-panel__fps"+(d?" tlui-debug-panel__fps__slow":""),a-=250,l=0,o=performance.now()}i=e.timers.requestAnimationFrame(loop)}(),()=>{cancelAnimationFrame(i)}},[t,e]),t)?(0,et.jsx)("div",{ref:n}):null}let sS=(0,en.memo)(function(){let e=useBreakpoint(),t=useTranslation(),n=(0,en.useRef)(null);(0,e1.O)(n);let{MainMenu:r,QuickActions:i,ActionsMenu:o,PageMenu:a}=useTldrawUiComponents(),l=(0,eW.jE)(),d=(0,O.Hg)("isSinglePageMode",()=>l.options.maxPages<=1,[l]),c="menu"===l.options.actionShortcutsLocation||"toolbar"!==l.options.actionShortcutsLocation&&e>=nf.TABLET;return r||a||c?(0,et.jsx)("nav",{ref:n,className:"tlui-menu-zone",children:(0,et.jsxs)("div",{className:"tlui-buttons__horizontal",children:[r&&(0,et.jsx)(r,{}),a&&!d&&(0,et.jsx)(a,{}),c?(0,et.jsxs)(nL,{className:"tlui-buttons__horizontal",label:t("actions-menu.title"),children:[i&&(0,et.jsx)(i,{}),o&&(0,et.jsx)(o,{})]}):null]})}):null});function BackToContent(){let e=(0,eW.jE)(),t=useActions(),[n,r]=(0,en.useState)(!1),i=(0,en.useRef)(!1);return((0,O.BK)("toggle showback to content",()=>{let t=i.current,n=e.getCurrentPageShapeIds(),o=!1;n.size&&(o=n.size===e.getCulledShapes().size),t!==o&&(r(o),i.current=o)},[e]),n)?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"back-to-content",onSelect:()=>{t["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function ExitPenMode(){let e=(0,eW.jE)(),t=(0,O.Hg)("is pen mode",()=>e.getInstanceState().isPenMode,[e]);return t?(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"exit-pen-mode"}):null}function StopFollowing(){let e=(0,eW.jE)(),t=useActions(),n=(0,O.Hg)("is following user",()=>!!e.getInstanceState().followingUserId,[e]);return n?(0,et.jsx)(TldrawUiMenuItem,{...t["stop-following"]}):null}function DefaultHelperButtonsContent(){return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(ExitPenMode,{}),(0,et.jsx)(BackToContent,{}),(0,et.jsx)(StopFollowing,{})]})}function DefaultHelperButtons({children:e}){let t=e??(0,et.jsx)(DefaultHelperButtonsContent,{});return(0,et.jsx)("div",{className:"tlui-helper-buttons",children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"helper-buttons",sourceId:"helper-buttons",children:t})})}function LanguageMenu(){let e=(0,eW.Z2)(),t=useUiEvents(),n=(0,O.Hg)("locale",()=>e?.user.getLocale(),[e]);return e?(0,et.jsx)(TldrawUiMenuSubmenu,{id:"help menu language",label:"menu.language",children:(0,et.jsx)(TldrawUiMenuGroup,{id:"languages",className:"tlui-language-menu",children:L.a2.map(({locale:r,label:i})=>(0,et.jsx)(TldrawUiMenuCheckboxItem,{id:`language-${r}`,title:r,label:i,checked:r===n,readonlyOk:!0,onSelect:()=>{e.user.updateUserPreferences({locale:r}),t("change-language",{source:"menu",locale:r})}},r))})}):null}function DefaultHelpMenuContent(){return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(LanguageMenu,{}),(0,et.jsx)(KeyboardShortcutsMenuItem,{})]})}function KeyboardShortcutsMenuItem(){let{KeyboardShortcutsDialog:e}=useTldrawUiComponents(),{addDialog:t}=useDialogs(),n=(0,en.useCallback)(()=>{e&&t({component:e})},[t,e]);return e?(0,et.jsx)(TldrawUiMenuItem,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:n}):null}function DefaultMainMenuContent(){return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)(TldrawUiMenuGroup,{id:"basic",children:[(0,et.jsx)(EditSubmenu,{}),(0,et.jsx)(ViewSubmenu,{}),(0,et.jsx)(ExportFileContentSubMenu,{}),(0,et.jsx)(ExtrasGroup,{})]}),(0,et.jsx)(PreferencesGroup,{})]})}function ExportFileContentSubMenu(){return(0,et.jsxs)(TldrawUiMenuSubmenu,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[(0,et.jsxs)(TldrawUiMenuGroup,{id:"export-all-as-group",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"export-all-as-svg"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"export-all-as-png"})]}),(0,et.jsx)(TldrawUiMenuGroup,{id:"export-all-as-bg",children:(0,et.jsx)(ToggleTransparentBgMenuItem,{})})]})}function EditSubmenu(){return(0,et.jsxs)(TldrawUiMenuSubmenu,{id:"edit",label:"menu.edit",children:[(0,et.jsx)(UndoRedoGroup,{}),(0,et.jsx)(ClipboardMenuGroup,{}),(0,et.jsx)(ConversionsMenuGroup,{}),(0,et.jsx)(MiscMenuGroup,{}),(0,et.jsx)(LockGroup,{}),(0,et.jsx)(TldrawUiMenuGroup,{id:"select-all",children:(0,et.jsx)(SelectAllMenuItem,{})})]})}function MiscMenuGroup(){return(0,et.jsxs)(TldrawUiMenuGroup,{id:"misc",children:[(0,et.jsx)(menu_items_GroupMenuItem,{}),(0,et.jsx)(menu_items_UngroupMenuItem,{}),(0,et.jsx)(menu_items_EditLinkMenuItem,{}),(0,et.jsx)(ToggleAutoSizeMenuItem,{}),(0,et.jsx)(RemoveFrameMenuItem,{}),(0,et.jsx)(FitFrameToContentMenuItem,{}),(0,et.jsx)(ConvertToEmbedMenuItem,{}),(0,et.jsx)(ConvertToBookmarkMenuItem,{}),(0,et.jsx)(FlattenMenuItem,{})]})}function LockGroup(){return(0,et.jsxs)(TldrawUiMenuGroup,{id:"lock",children:[(0,et.jsx)(ToggleLockMenuItem,{}),(0,et.jsx)(UnlockAllMenuItem,{})]})}function UndoRedoGroup(){let e=useCanUndo(),t=useCanRedo();return(0,et.jsxs)(TldrawUiMenuGroup,{id:"undo-redo",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"undo",disabled:!e}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"redo",disabled:!t})]})}function ViewSubmenu(){return(0,et.jsx)(TldrawUiMenuSubmenu,{id:"view",label:"menu.view",children:(0,et.jsxs)(TldrawUiMenuGroup,{id:"view-actions",children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-in"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-out"}),(0,et.jsx)(menu_items_ZoomTo100MenuItem,{}),(0,et.jsx)(ZoomToFitMenuItem,{}),(0,et.jsx)(ZoomToSelectionMenuItem,{})]})})}function ExtrasGroup(){return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"insert-embed"}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"insert-media"})]})}function PreferencesGroup(){return(0,et.jsxs)(TldrawUiMenuGroup,{id:"preferences",children:[(0,et.jsxs)(TldrawUiMenuSubmenu,{id:"preferences",label:"menu.preferences",children:[(0,et.jsxs)(TldrawUiMenuGroup,{id:"preferences-actions",children:[(0,et.jsx)(ToggleSnapModeItem,{}),(0,et.jsx)(ToggleToolLockItem,{}),(0,et.jsx)(ToggleGridItem,{}),(0,et.jsx)(ToggleWrapModeItem,{}),(0,et.jsx)(ToggleFocusModeItem,{}),(0,et.jsx)(ToggleEdgeScrollingItem,{}),(0,et.jsx)(ToggleReduceMotionItem,{}),(0,et.jsx)(ToggleKeyboardShortcutsItem,{}),(0,et.jsx)(ToggleDynamicSizeModeItem,{}),(0,et.jsx)(TogglePasteAtCursorItem,{}),(0,et.jsx)(ToggleDebugModeItem,{})]}),(0,et.jsx)(TldrawUiMenuGroup,{id:"color-scheme",children:(0,et.jsx)(ColorSchemeMenu,{})})]}),(0,et.jsx)(LanguageMenu,{}),(0,et.jsx)(KeyboardShortcutsMenuItem,{})]})}let sv=(0,en.memo)(function({children:e}){let t=(0,eG.uK)(),[n,r]=useMenuIsOpen("main menu"),i=useTranslation(),o=e??(0,et.jsx)(DefaultMainMenuContent,{});return(0,et.jsxs)(tV.fC,{dir:"ltr",open:n,onOpenChange:r,modal:!1,children:[(0,et.jsx)(tV.xz,{asChild:!0,dir:"ltr",children:(0,et.jsx)(tz,{type:"icon","data-testid":"main-menu.button",title:i("menu.title"),children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"menu",small:!0})})}),(0,et.jsx)(tV.Uv,{container:t,children:(0,et.jsx)(tV.VY,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"main-menu",children:o})})})]})}),sT={};function getRgba(e){if(sT[e])return sT[e];let t=document.createElement("canvas"),n=t.getContext("2d");n.fillStyle=e,n.fillRect(0,0,1,1);let[r,i,o,a]=n.getImageData(0,0,1,1).data,l=new Float32Array([r/255,i/255,o/255,a/255]);return sT[e]=l,l}function pie(e,{center:t,radius:n,numArcSegments:r=20,startAngle:i=0,endAngle:o=ei.yo,offset:a=0}){let l=(o-i)/r,d=a;for(let r=i;r<o;r+=l)e[d++]=t.x,e[d++]=t.y,e[d++]=t.x+Math.cos(r)*n,e[d++]=t.y+Math.sin(r)*n,e[d++]=t.x+Math.cos(r+l)*n,e[d++]=t.y+Math.sin(r+l)*n;return e}function rectangle(e,t,n,r,i,o){e[t++]=n,e[t++]=r,e[t++]=n,e[t++]=r+o,e[t++]=n+i,e[t++]=r,e[t++]=n+i,e[t++]=r,e[t++]=n,e[t++]=r+o,e[t++]=n+i,e[t++]=r+o}function allocateBuffer(e,t){let n=e.createBuffer();if(!n)throw Error("Failed to create buffer");return{buffer:n,vertices:new Float32Array(t)}}function appendVertices(e,t,n){let r=e.vertices.length;for(;r<t+n.length;)r*=2;if(r!=e.vertices.length){let t=new Float32Array(r);t.set(e.vertices),e.vertices=t}e.vertices.set(n,t)}var sk=Object.create,s_=Object.defineProperty,sC=Object.getOwnPropertyDescriptor,MinimapManager_knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),MinimapManager_typeError=e=>{throw TypeError(e)},MinimapManager_defNormalProp=(e,t,n)=>t in e?s_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,MinimapManager_name=(e,t)=>s_(e,"name",{value:t,configurable:!0}),sI=["class","method","getter","setter","accessor","field","value","get","set"],MinimapManager_expectFn=e=>void 0!==e&&"function"!=typeof e?MinimapManager_typeError("Function expected"):e,MinimapManager_decoratorContext=(e,t,n,r,i)=>({kind:sI[e],name:t,metadata:r,addInitializer:e=>n._?MinimapManager_typeError("Already initialized"):i.push(MinimapManager_expectFn(e||null))}),MinimapManager_decoratorMetadata=(e,t)=>MinimapManager_defNormalProp(t,MinimapManager_knownSymbol("metadata"),e[3]),MinimapManager_runInitializers=(e,t,n,r)=>{for(var i=0,o=e[t>>1],a=o&&o.length;i<a;i++)1&t?o[i].call(n):r=o[i].call(n,r);return r},MinimapManager_decorateElement=(e,t,n,r,i,o)=>{var a,l,d,c,u,h=7&t,p=!!(8&t),f=!!(16&t),g=h>3?e.length+1:h?p?1:2:0,m=sI[h+5],y=h>3&&(e[g-1]=[]),b=e[g]||(e[g]=[]),S=h&&(f||p||(i=i.prototype),h<5&&(h>3||!f)&&sC(h<4?i:{get[n](){return MinimapManager_privateGet(this,o)},set[n](x){return MinimapManager_privateSet(this,o,x)}},n));h?f&&h<4&&MinimapManager_name(o,(h>2?"set ":h>1?"get ":"")+n):MinimapManager_name(i,n);for(var v=r.length-1;v>=0;v--)c=MinimapManager_decoratorContext(h,n,d={},e[3],b),h&&(c.static=p,c.private=f,u=c.access={has:f?e=>MinimapManager_privateIn(i,e):e=>n in e},3^h&&(u.get=f?e=>(1^h?MinimapManager_privateGet:MinimapManager_privateMethod)(e,i,4^h?o:S.get):e=>e[n]),h>2&&(u.set=f?(e,t)=>MinimapManager_privateSet(e,i,t,4^h?o:S.set):(e,t)=>e[n]=t)),l=(0,r[v])(h?h<4?f?o:S[m]:h>4?void 0:{get:S.get,set:S.set}:i,c),d._=1,4^h||void 0===l?MinimapManager_expectFn(l)&&(h>4?y.unshift(l):h?f?o=l:S[m]=l:i=l):"object"!=typeof l||null===l?MinimapManager_typeError("Object expected"):(MinimapManager_expectFn(a=l.get)&&(S.get=a),MinimapManager_expectFn(a=l.set)&&(S.set=a),MinimapManager_expectFn(a=l.init)&&y.unshift(a));return h||MinimapManager_decoratorMetadata(e,i),S&&s_(i,n,S),f?4^h?o:S:i},MinimapManager_publicField=(e,t,n)=>MinimapManager_defNormalProp(e,"symbol"!=typeof t?t+"":t,n),MinimapManager_accessCheck=(e,t,n)=>t.has(e)||MinimapManager_typeError("Cannot "+n),MinimapManager_privateIn=(e,t)=>Object(t)!==t?MinimapManager_typeError('Cannot use the "in" operator on this value'):e.has(t),MinimapManager_privateGet=(e,t,n)=>(MinimapManager_accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),MinimapManager_privateSet=(e,t,n,r)=>(MinimapManager_accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),MinimapManager_privateMethod=(e,t,n)=>(MinimapManager_accessCheck(e,t,"access private method"),n);j=[B.ak],A=[F.Fl],P=[F.Fl],M=[F.Fl],E=[F.Fl],C=[F.Fl],_=[F.Fl],k=[F.Fl],v=[F.Fl],S=[B.ak];let MinimapManager=class MinimapManager{constructor(e,t,n){this.editor=e,this.elem=t,this.container=n,MinimapManager_runInitializers(D,5,this),MinimapManager_publicField(this,"disposables",[]),MinimapManager_publicField(this,"gl"),MinimapManager_publicField(this,"shapeGeometryCache"),MinimapManager_publicField(this,"colors"),MinimapManager_publicField(this,"id",(0,B.EL)()),MinimapManager_publicField(this,"canvasBoundingClientRect",(0,F.cn)("canvasBoundingClientRect",new e9.xu)),MinimapManager_publicField(this,"originPagePoint",new eF.B),MinimapManager_publicField(this,"originPageCenter",new eF.B),MinimapManager_publicField(this,"isInViewport",!1),this.gl=function(e){if(!e)throw Error("Canvas element not found");let t=e.getContext("webgl2",{premultipliedAlpha:!1});if(!t)throw Error("Failed to get webgl2 context");let n=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,r=t.createShader(t.VERTEX_SHADER);if(!r)throw Error("Failed to create vertex shader");if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw Error("Failed to compile vertex shader");let i=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,o=t.createShader(t.FRAGMENT_SHADER);if(!o)throw Error("Failed to create fragment shader");if(t.shaderSource(o,i),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw Error("Failed to compile fragment shader");let a=t.createProgram();if(!a)throw Error("Failed to create program");if(t.attachShader(a,r),t.attachShader(a,o),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw Error("Failed to link program");t.useProgram(a);let l=t.getAttribLocation(a,"shapeVertexPosition");if(l<0)throw Error("Failed to get shapeVertexPosition attribute location");t.enableVertexAttribArray(l);let d=t.getUniformLocation(a,"canvasPageBounds"),c=t.getUniformLocation(a,"fillColor"),u=t.createBuffer();if(!u)throw Error("Failed to create buffer");let h=t.createBuffer();if(!h)throw Error("Failed to create buffer");return{context:t,selectedShapes:allocateBuffer(t,1024),unselectedShapes:allocateBuffer(t,4096),viewport:allocateBuffer(t,300),collaborators:allocateBuffer(t,1024),prepareTriangles(e,n){t.bindBuffer(t.ARRAY_BUFFER,e.buffer),t.bufferData(t.ARRAY_BUFFER,e.vertices,t.STATIC_DRAW,0,n),t.enableVertexAttribArray(l),t.vertexAttribPointer(l,2,t.FLOAT,!1,0,0)},drawTrianglesTransparently(e){t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLES,0,e/2),t.disable(t.BLEND)},drawTriangles(e){t.drawArrays(t.TRIANGLES,0,e/2)},setFillColor(e){t.uniform4fv(c,e)},setCanvasPageBounds(e){t.uniform4fv(d,e)}}}(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",t=>{let n=e.getShapeMaskedPageBounds(t.id);if(!n)return null;let r=new Float32Array(12);return rectangle(r,0,n.x,n.y,n.w,n.h),r}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),(0,F.Ym)("minimap render",this.render))}close(){return this.disposables.forEach(e=>e())}_getColors(){let e=getComputedStyle(this.editor.getContainer());return{shapeFill:getRgba(e.getPropertyValue("--color-text-3").trim()),selectFill:getRgba(e.getPropertyValue("--color-selected").trim()),viewportFill:getRgba(e.getPropertyValue("--color-muted-1").trim()),background:getRgba(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){let e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?e9.xu.Expand(t,e):e}getContentScreenBounds(){let e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),n=this.editor.pageToScreen(new eF.B(e.maxX,e.maxY));return new e9.xu(t.x,t.y,n.x-t.x,n.y-t.y)}_getCanvasBoundingRect(){let{x:e,y:t,width:n,height:r}=this.elem.getBoundingClientRect();return new e9.xu(e,t,n,r)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){let e=new ResizeObserver(()=>{let e=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(e)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){let e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new eF.B(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){let e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),n=e.width/e.height,r=t.width,i=r/n;i<t.height&&(r=(i=t.height)*n);let o=new e9.xu(0,0,r,i);return o.center=t.center,o}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){let{x:e,y:t,w:n,h:r}=this.getCanvasPageBounds();return new Float32Array([e,t,n,r])}getMinimapPagePoint(e,t){let n=this.getCanvasPageBounds(),r=this.getCanvasScreenBounds(),i=e-r.x,o=t-r.y;return i*=n.width/r.width,o*=n.height/r.height,i+=n.minX,o+=n.minY,new eF.B(i,o,1)}minimapScreenPointToPagePoint(e,t,n=!1,r=!1){let{editor:i}=this,o=i.getViewportPageBounds(),{x:a,y:l}=this.getMinimapPagePoint(e,t);if(r){let e=this.editor.getCurrentPageBounds()??new e9.xu,t=e.minX-o.width/2,n=e.maxX+o.width/2,r=e.minY-o.height/2,i=e.maxY+o.height/2,d=Math.max(0,t+o.width-a),c=Math.max(0,-(n-o.width-a)),u=Math.max(0,r+o.height-l),h=Math.max(0,-(i-o.height-l));a+=(d-c)/2,l+=(u-h)/2,a=(0,ei.uZ)(a,t,n),l=(0,ei.uZ)(l,r,i)}if(n){let{originPagePoint:e}=this,t=Math.abs(a-e.x),n=Math.abs(l-e.y);t>n?l=e.y:a=e.x}return new eF.B(a,l)}render(){let e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);let n=new Set(this.editor.getSelectedShapeIds()),r=this.colors,i=0,o=0,a=this.editor.getCurrentPageShapeIdsSorted();for(let e=0,t=a.length;e<t;e++){let t=a[e],r=this.shapeGeometryCache.get(t);if(!r)continue;let l=r.length;n.has(t)?(appendVertices(this.gl.selectedShapes,i,r),i+=l):(appendVertices(this.gl.unselectedShapes,o,r),o+=l)}this.drawShapes(this.gl.unselectedShapes,o,r.shapeFill),this.drawShapes(this.gl.selectedShapes,i,r.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(e,t,n){this.gl.prepareTriangles(e,t),this.gl.setFillColor(n),this.gl.drawTriangles(t)}drawViewport(){let e=this.editor.getViewportPageBounds(),t=function(e,t,n){n=Math.min(n,Math.min(t.w,t.h)/2);let r=e9.xu.ExpandBy(t,-n);if(r.w<=0||r.h<=0)return pie(e,{center:t.center,radius:n,numArcSegments:40}),240;let i=0;return rectangle(e,0,r.minX,r.minY,r.w,r.h),rectangle(e,i+=12,r.minX,t.minY,r.w,n),rectangle(e,i+=12,r.maxX,r.minY,n,r.h),rectangle(e,i+=12,r.minX,r.maxY,r.w,n),rectangle(e,i+=12,t.minX,r.minY,n,r.h),pie(e,{numArcSegments:10,offset:i+=12,center:r.point,radius:n,startAngle:ei.PI,endAngle:1.5*ei.PI}),pie(e,{numArcSegments:10,offset:i+=60,center:eF.B.Add(r.point,new eF.B(r.w,0)),radius:n,startAngle:1.5*ei.PI,endAngle:ei.yo}),pie(e,{numArcSegments:10,offset:i+=60,center:eF.B.Add(r.point,r.size),radius:n,startAngle:0,endAngle:ei.pj}),pie(e,{numArcSegments:10,offset:i+=60,center:eF.B.Add(r.point,new eF.B(0,r.h)),radius:n,startAngle:ei.pj,endAngle:ei.PI}),300}(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),eH.a.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){let e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;let t=120*e.length;this.gl.collaborators.vertices.length<t&&(this.gl.collaborators.vertices=new Float32Array(t));let n=this.gl.collaborators.vertices,r=0,i=this.getZoom();for(let{cursor:t}of e)t&&(pie(n,{center:eF.B.From(t),radius:3*i,offset:r,numArcSegments:20}),r+=120);for(let{color:n}of(this.gl.prepareTriangles(this.gl.collaborators,t),r=0,e))this.gl.setFillColor(getRgba(n)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,r/2,60),r+=120}};function DefaultMinimap(){let e=(0,eW.jE)(),t=(0,eG.uK)(),n=useTranslation(),r=en.useRef(null),i=en.useRef(!1),o=en.useRef();en.useEffect(()=>{try{let n=new MinimapManager(e,r.current,t);return o.current=n,o.current.close}catch(t){e.annotateError(t,{origin:"minimap",willCrashApp:!1}),e.timers.setTimeout(()=>{throw t})}},[e,t]);let a=en.useCallback(t=>{if(!e.getCurrentPageShapeIds().size||!o.current)return;let n=o.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!1),r=o.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!0);o.current.originPagePoint.setTo(r),o.current.originPageCenter.setTo(e.getViewportPageBounds().center),e.centerOnPoint(n,{animation:{duration:e.options.animationMediumMs}})},[e]),l=en.useCallback(t=>{if(!o.current)return;let n=t.currentTarget;if((0,e0.I5)(n,t),!e.getCurrentPageShapeIds().size)return;i.current=!0,o.current.isInViewport=!1;let r=o.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!1),a=e.getViewportPageBounds(),l=o.current.getContentPageBounds(),d=new e9.xu(l.x-a.width/2,l.y-a.height/2,l.width+a.width,l.height+a.height);if(d.containsPoint(r)&&!a.containsPoint(r)){o.current.isInViewport=a.containsPoint(r);let t=eF.B.Sub(a.center,a.point),n=eF.B.Add(r,t);o.current.originPagePoint.setTo(n),o.current.originPageCenter.setTo(r),e.centerOnPoint(r,{animation:{duration:e.options.animationMediumMs}})}else{let e=o.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!0);o.current.isInViewport=a.containsPoint(e),o.current.originPagePoint.setTo(e),o.current.originPageCenter.setTo(a.center)}document.body.addEventListener("pointerup",function release(e){n&&(0,e0.XE)(n,e),i.current=!1,document.body.removeEventListener("pointerup",release)})},[e]),d=en.useCallback(t=>{if(!o.current)return;let n=o.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,t.shiftKey,!0);if(i.current){if(o.current.isInViewport){let t=o.current.originPagePoint.clone().sub(o.current.originPageCenter);e.centerOnPoint(eF.B.Sub(n,t));return}e.centerOnPoint(n)}let r=o.current.getMinimapPagePoint(t.clientX,t.clientY),a=e.pageToScreen(r),l={type:"pointer",target:"canvas",name:"pointer_move",...(0,e6.Y)(t),point:a,isPen:e.getInstanceState().isPenMode};e.dispatch(l)},[e]),c=en.useCallback(t=>{let n=(0,tS.f)(t);e.dispatch({type:"wheel",name:"wheel",delta:n,point:new eF.B(t.clientX,t.clientY),shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,metaKey:t.metaKey,accelKey:(0,tw.q)(t)})},[e]),u=(0,eJ.G)();return en.useEffect(()=>{e.timers.setTimeout(()=>{o.current?.updateColors(),o.current?.render()})},[u,e]),(0,et.jsx)("div",{className:"tlui-minimap",children:(0,et.jsx)("canvas",{role:"img","aria-label":n("navigation-zone.minimap"),ref:r,className:"tlui-minimap__canvas",onDoubleClick:a,onPointerMove:d,onPointerDown:l,onWheelCapture:c})})}function useLocalStorageState(e,t){let[n,r]=en.useState(t);en.useLayoutEffect(()=>{let t=(0,B.fp)(e);if(t)try{r(JSON.parse(t))}catch{console.error(`Could not restore value ${e} from local storage.`)}},[e]);let i=en.useCallback(t=>{r(n=>{let r="function"==typeof t?t(n):t;return(0,B._m)(e,JSON.stringify(r)),r})},[e]);return[n,i]}MinimapManager_decorateElement(D=[,,,sk((void 0)??null)],1,"close",j,MinimapManager),MinimapManager_decorateElement(D,1,"getDpr",A,MinimapManager),MinimapManager_decorateElement(D,1,"getContentPageBounds",P,MinimapManager),MinimapManager_decorateElement(D,1,"getContentScreenBounds",M,MinimapManager),MinimapManager_decorateElement(D,1,"getCanvasSize",E,MinimapManager),MinimapManager_decorateElement(D,1,"getCanvasClientPosition",C,MinimapManager),MinimapManager_decorateElement(D,1,"getCanvasPageBounds",_,MinimapManager),MinimapManager_decorateElement(D,1,"getZoom",k,MinimapManager),MinimapManager_decorateElement(D,1,"getCanvasPageBoundsArray",v,MinimapManager),MinimapManager_decorateElement(D,1,"render",S,MinimapManager),MinimapManager_decoratorMetadata(D,MinimapManager);let sE=(0,en.memo)(function(){let e=useActions(),t=useTranslation(),n=useBreakpoint(),r=(0,en.useRef)(null);(0,e1.O)(r);let[i,o]=useLocalStorageState("minimap",!0),a=(0,en.useCallback)(()=>{o(e=>!e)},[o]),{ZoomMenu:l,Minimap:d}=useTldrawUiComponents();return n<nf.MOBILE?null:(0,et.jsxs)("div",{ref:r,className:"tlui-navigation-panel",children:[(0,et.jsx)(nL,{className:"tlui-buttons__horizontal",label:t("navigation-zone.title"),children:l&&n<nf.TABLET?(0,et.jsx)(l,{}):(0,et.jsxs)(et.Fragment,{children:[!i&&(0,et.jsx)(nU,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(unwrapLabel(e["zoom-out"].label))} ${kbdStr(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"minus"})}),l&&(0,et.jsx)(l,{},"zoom-menu"),!i&&(0,et.jsx)(nU,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(unwrapLabel(e["zoom-in"].label))} ${kbdStr(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"plus"})}),d&&(0,et.jsx)(nU,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),onClick:a,children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:i?"chevron-right":"chevron-left"})})]})}),d&&n>=nf.TABLET&&!i&&(0,et.jsx)(d,{})]})}),PageItemInput=function({name:e,id:t,isCurrentPage:n,onCancel:r,onComplete:i}){let o=(0,eW.jE)(),a=useUiEvents(),l=(0,en.useRef)(null),d=(0,en.useRef)(null),c=(0,en.useCallback)(()=>{d.current=o.markHistoryStoppingPoint("rename page")},[o]),u=(0,en.useCallback)(e=>{o.renamePage(t,e||"New Page"),a("rename-page",{source:"page-menu"})},[o,t,a]),h=(0,en.useCallback)(()=>{d.current&&o.bailToMark(d.current),r()},[o,r]);return(0,et.jsx)(ni,{className:"tlui-page-menu__item__input",ref:e=>l.current=e,defaultValue:e,onValueChange:u,onComplete:i,onCancel:h,onFocus:c,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:n,autoSelect:!0})},onMovePage=(e,t,n,r,i)=>{let o;let a=e.getPages(),l=n>r?a[r-1]:a[r],d=n>r?a[r]:a[r+1];(o=l&&!d?(0,B._L)(l.index):!l&&d?(0,B.Xg)(a[0].index):(0,B.eI)(l.index,d.index))!==a[n].index&&(e.markHistoryStoppingPoint("moving page"),e.updatePage({id:t,index:o}),i("move-page",{source:"page-menu"}))},sM=(0,O.j)(function({index:e,listSize:t,item:n,onRename:r}){let i=(0,eW.jE)(),o=useTranslation(),a=i.getPages(),l=useUiEvents(),d=(0,en.useCallback)(()=>{i.markHistoryStoppingPoint("creating page");let e=L.ez.createId();i.duplicatePage(n.id,e),l("duplicate-page",{source:"page-menu"})},[i,n,l]),c=(0,en.useCallback)(()=>{onMovePage(i,n.id,e,e-1,l)},[i,n,e,l]),u=(0,en.useCallback)(()=>{onMovePage(i,n.id,e,e+1,l)},[i,n,e,l]),h=(0,en.useCallback)(()=>{i.markHistoryStoppingPoint("deleting page"),i.deletePage(n.id),l("delete-page",{source:"page-menu"})},[i,n,l]);return(0,et.jsxs)(TldrawUiDropdownMenuRoot,{id:`page item submenu ${e}`,children:[(0,et.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,et.jsx)(tz,{type:"icon",title:o("page-menu.submenu.title"),children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"dots-vertical",small:!0})})}),(0,et.jsx)(TldrawUiDropdownMenuContent,{alignOffset:0,side:"right",sideOffset:-4,children:(0,et.jsxs)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"page-menu",children:[(0,et.jsxs)(TldrawUiMenuGroup,{id:"modify",children:[r&&(0,et.jsx)(TldrawUiMenuItem,{id:"rename",label:"page-menu.submenu.rename",onSelect:r}),(0,et.jsx)(TldrawUiMenuItem,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:d,disabled:a.length>=i.options.maxPages}),e>0&&(0,et.jsx)(TldrawUiMenuItem,{id:"move-up",onSelect:c,label:"page-menu.submenu.move-up"}),e<t-1&&(0,et.jsx)(TldrawUiMenuItem,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:u})]}),t>1&&(0,et.jsx)(TldrawUiMenuGroup,{id:"delete",children:(0,et.jsx)(TldrawUiMenuItem,{id:"delete",onSelect:h,label:"page-menu.submenu.delete"})})]})})]})}),sP=(0,en.memo)(function(){let e=(0,eW.jE)(),t=useUiEvents(),n=useTranslation(),r=useBreakpoint(),i=(0,en.useCallback)(()=>m(!1),[]),[o,a]=useMenuIsOpen("page-menu",i),l=(0,en.useRef)(null),d=(0,O.Hg)("pages",()=>e.getPages(),[e]),c=(0,O.Hg)("currentPage",()=>e.getCurrentPage(),[e]),u=(0,O.Hg)("currentPageId",()=>e.getCurrentPageId(),[e]),h=useReadonly(),p=(0,O.Hg)("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),f=(0,O.Hg)("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[g,m]=(0,en.useState)(!1);(0,en.useEffect)(function(){function handleKeyDown2(){g||document.activeElement!==document.body||e.menus.clearOpenMenus()}return document.addEventListener("keydown",handleKeyDown2,{passive:!0}),()=>{document.removeEventListener("keydown",handleKeyDown2)}},[e,g]);let y=(0,en.useCallback)(()=>{h||m(e=>!e)},[h]),b=(0,en.useRef)({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[S,v]=(0,en.useState)(Object.fromEntries(d.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}])));(0,en.useLayoutEffect)(()=>{v(Object.fromEntries(d.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}])))},[36,d]),(0,en.useEffect)(()=>{o&&e.timers.requestAnimationFrame(()=>{let e=document.querySelector(`[data-pageid="${u}"]`);if(e){e.querySelector("button")?.focus();let t=l.current;if(!t)return;let n=e.offsetTop,r=t.scrollTop;n<r&&t.scrollTo({top:n});let i=n+36,o=t.scrollTop+t.offsetHeight;i>o&&t.scrollTo({top:i-t.offsetHeight})}})},[36,u,o,e]);let k=(0,en.useCallback)(e=>{let{clientY:t,currentTarget:n}=e,{dataset:{id:r,index:i}}=n;if(!r||!i)return;let o=b.current;(0,e0.I5)(e.currentTarget,e),o.status="pointing",o.pointing={id:r,index:+i};let a=S[r],l=a.y;o.startY=t,o.startIndex=Math.max(0,Math.min(Math.round(l/36),d.length-1))},[36,d.length,S]),_=(0,en.useCallback)(e=>{let t=b.current;if("pointing"===t.status){let{clientY:n}=e,r=n-t.startY;Math.abs(r)>5&&(t.status="dragging")}if("dragging"===t.status){let{clientY:n}=e,r=n-t.startY,i=S[t.pointing.id],{startIndex:o,pointing:a}=t,l=i.y+r,c=Math.max(0,Math.min(Math.round(l/36),d.length-1)),u={...S};if(u[a.id]={y:i.y,offsetY:r,isSelected:!0},c!==t.dragIndex){t.dragIndex=c;for(let e=0;e<d.length;e++){let n=d[e];if(n.id===t.pointing.id)continue;let{y:r}=u[n.id];c===o?r=36*e:c<o?r=c<=e&&e<o?(e+1)*36:36*e:c>o&&(r=c>=e&&e>o?(e-1)*36:36*e),r!==u[n.id].y&&(u[n.id]={y:r,offsetY:0,isSelected:!0})}}v(u)}},[36,d,S]),C=(0,en.useCallback)(n=>{let r=b.current;if("dragging"===r.status){let{id:n,index:i}=r.pointing;onMovePage(e,n,i,r.dragIndex,t)}(0,e0.XE)(n.currentTarget,n),r.status="idle"},[e,t]),E=(0,en.useCallback)(e=>{let t=b.current;"Escape"===e.key&&("dragging"===t.status&&v(Object.fromEntries(d.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}]))),t.status="idle")},[36,d]),M=(0,en.useCallback)(()=>{h||(e.run(()=>{e.markHistoryStoppingPoint("creating page");let t=L.ez.createId();e.createPage({name:n("page-menu.new-page-initial-name"),id:t}),e.setCurrentPage(t),m(!0),e.timers.requestAnimationFrame(()=>{let e=document.querySelector(`[data-pageid="${t}"]`);e&&e.querySelector("button")?.focus()})}),t("new-page",{source:"page-menu"}))},[e,n,h,t]),P=(0,en.useCallback)(n=>{e.setCurrentPage(n),t("change-page",{source:"page-menu"})},[e,t]),A=(0,en.useCallback)((n,r)=>{e.renamePage(n,r),t("rename-page",{source:"page-menu"})},[e,t]);return(0,et.jsxs)(TldrawUiPopover,{id:"pages",onOpenChange:a,open:o,children:[(0,et.jsx)(TldrawUiPopoverTrigger,{"data-testid":"main.page-menu",children:(0,et.jsxs)(tz,{type:"menu",title:c.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[(0,et.jsx)("div",{className:"tlui-page-menu__name",children:c.name}),(0,et.jsx)(TldrawUiButtonIcon,{icon:"chevron-down",small:!0})]})}),(0,et.jsx)(TldrawUiPopoverContent,{side:"bottom",align:"start",sideOffset:0,disableEscapeKeyDown:g,children:(0,et.jsxs)("div",{className:"tlui-page-menu__wrapper",children:[(0,et.jsxs)("div",{className:"tlui-page-menu__header",children:[(0,et.jsx)("div",{className:"tlui-page-menu__header__title",children:n("page-menu.title")}),!h&&(0,et.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,et.jsx)(tz,{type:"icon","data-testid":"page-menu.edit",title:n(g?"page-menu.edit-done":"page-menu.edit-start"),onClick:y,children:(0,et.jsx)(TldrawUiButtonIcon,{icon:g?"check":"edit"})}),(0,et.jsx)(tz,{type:"icon","data-testid":"page-menu.create",title:n(p?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:p,onClick:M,children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"plus"})})]})]}),(0,et.jsx)("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:36*d.length+4},ref:l,children:d.map((e,t)=>{let i=S[e.id]??{position:40*t,offsetY:0};return g?(0,et.jsxs)("div",{"data-testid":"page-menu.item","data-pageid":e.id,className:"tlui-page_menu__item__sortable",style:{zIndex:e.id===c.id?888:t,transform:`translate(0px, ${i.y+i.offsetY}px)`},children:[(0,et.jsx)(tz,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:k,onPointerUp:C,onPointerMove:_,onKeyDown:E,"data-id":e.id,"data-index":t,children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"drag-handle-dots"})}),r<nf.TABLET_SM&&f?(0,et.jsxs)(tz,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{let t=window.prompt("Rename page",e.name);t&&t!==e.name&&A(e.id,t)},onDoubleClick:y,children:[(0,et.jsx)(TldrawUiButtonCheck,{checked:e.id===c.id}),(0,et.jsx)(TldrawUiButtonLabel,{children:e.name})]}):(0,et.jsx)("div",{className:"tlui-page_menu__item__sortable__title",style:{height:36},children:(0,et.jsx)(PageItemInput,{id:e.id,name:e.name,isCurrentPage:e.id===c.id,onComplete:()=>{m(!1)},onCancel:()=>{m(!1)}})}),!h&&(0,et.jsx)("div",{className:"tlui-page_menu__item__submenu","data-isediting":g,children:(0,et.jsx)(sM,{index:t,item:e,listSize:d.length})})]},e.id+"_editing"):(0,et.jsxs)("div",{"data-pageid":e.id,"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[(0,et.jsxs)(tz,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>P(e.id),onDoubleClick:y,title:n("page-menu.go-to-page"),onKeyDown:t=>{"Enter"===t.key&&e.id===c.id&&(y(),(0,e0.be)(t))},children:[(0,et.jsx)(TldrawUiButtonCheck,{checked:e.id===c.id}),(0,et.jsx)(TldrawUiButtonLabel,{children:e.name})]}),!h&&(0,et.jsx)("div",{className:"tlui-page_menu__item__submenu",children:(0,et.jsx)(sM,{index:t,item:e,listSize:d.length,onRename:()=>{if(eH.a.isIos){let t=window.prompt("Rename page",e.name);t&&t!==e.name&&A(e.id,t)}else m(!0),u!==e.id&&P(e.id)}})})]},e.id)})})]})})]})});function DefaultQuickActionsContent(){let e=(0,eW.jE)(),t=useReadonly(),n=(0,O.Hg)("should display quick actions",()=>e.isInAny("select","hand","zoom"),[e]);if(!t||n)return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(DefaultQuickActionsContent_UndoRedoGroup,{}),(0,et.jsx)(DeleteDuplicateGroup,{})]})}function DeleteDuplicateGroup(){let e=useUnlockedSelectedShapesCount(1),t=useIsInSelectState(),n=e&&t;return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"delete",disabled:!n}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"duplicate",disabled:!n})]})}function DefaultQuickActionsContent_UndoRedoGroup(){let e=useCanUndo(),t=useCanRedo();return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"undo",disabled:!e}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"redo",disabled:!t})]})}let sA=(0,en.memo)(function({children:e}){let t=e??(0,et.jsx)(DefaultQuickActionsContent,{});return(0,et.jsx)(TldrawUiMenuContextProvider,{type:"small-icons",sourceId:"quick-actions",children:t})});function PeopleMenuAvatar({userId:e}){let t=(0,e3.o)(e);return t?(0,et.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:t.color},children:t.userName?.[0]??""},e):null}let sj=(0,O.j)(function({userId:e}){let t=(0,eW.jE)(),n=useTranslation(),r=useUiEvents(),i=(0,e3.o)(e),o=(0,en.useCallback)(()=>{t.getInstanceState().followingUserId===e?(t.stopFollowingUser(),r("stop-following",{source:"people-menu"})):(t.startFollowingUser(e),r("start-following",{source:"people-menu"}))},[t,e,r]),a=i?.followingUserId===t.user.getId(),l=t.getInstanceState().followingUserId===e;return i?(0,et.jsxs)("div",{className:"tlui-people-menu__item tlui-buttons__horizontal","data-follow":l||a,children:[(0,et.jsxs)(tz,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>t.zoomToUser(e),onDoubleClick:o,children:[(0,et.jsx)(nr,{label:n("people-menu.avatar-color"),icon:"color",color:i.color}),(0,et.jsx)("div",{className:"tlui-people-menu__name",children:i.userName?.trim()||n("people-menu.anonymous-user")})]}),(0,et.jsx)(tz,{type:"icon",className:"tlui-people-menu__item__follow",title:n(a?"people-menu.leading":l?"people-menu.following":"people-menu.follow"),onClick:o,disabled:a,children:(0,et.jsx)(TldrawUiButtonIcon,{icon:a?"leading":l?"following":"follow"})})]}):null});function PeopleMenuMore({count:e}){return(0,et.jsx)("div",{className:"tlui-people-menu__avatar tlui-people-menu__more",children:Math.abs(e)})}let sD=(0,O.j)(function(){let e=(0,eW.jE)(),t=(0,eG.uK)(),n=useTranslation(),r=useUiEvents(),i=(0,en.useRef)(!1),[o,a]=(0,en.useState)(!1),l=(0,en.useCallback)(e=>{a(e)},[]),d=e.user.getColor(),c=(0,en.useCallback)(t=>{e.user.updateUserPreferences({color:t}),r("set-color",{source:"people-menu"})},[e,r]),{handleButtonClick:u,handleButtonPointerDown:h,handleButtonPointerEnter:p,handleButtonPointerUp:f}=en.useMemo(()=>{let handlePointerUp=()=>{i.current=!1,window.removeEventListener("pointerup",handlePointerUp)};return{handleButtonClick:e=>{let{id:t}=e.currentTarget.dataset;t&&d!==t&&c(t)},handleButtonPointerDown:e=>{let{id:t}=e.currentTarget.dataset;t&&(c(t),i.current=!0,window.addEventListener("pointerup",handlePointerUp))},handleButtonPointerEnter:e=>{if(!i.current)return;let{id:t}=e.currentTarget.dataset;t&&c(t)},handleButtonPointerUp:e=>{let{id:t}=e.currentTarget.dataset;t&&c(t)}}},[d,c]);return(0,et.jsxs)(su.fC,{onOpenChange:l,open:o,children:[(0,et.jsx)(su.xz,{dir:"ltr",asChild:!0,children:(0,et.jsx)(tz,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:n("people-menu.change-color"),children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"color"})})}),(0,et.jsx)(su.h_,{container:t,children:(0,et.jsx)(su.VY,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:(0,et.jsx)("div",{className:"tlui-buttons__grid",children:ew.A6.map(e=>(0,et.jsx)(tz,{type:"icon","data-id":e,"data-testid":e,"aria-label":e,isActive:d===e,title:e,className:"tlui-button-grid__button",style:{color:e},onPointerEnter:p,onPointerDown:h,onPointerUp:f,onClick:u,children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"color"})},e))})})})]})});function UserPresenceEditor(){let e=(0,eW.jE)(),t=useUiEvents(),n=(0,O.Hg)("userName",()=>e.user.getName(),[]),r=useTranslation(),i=(0,en.useRef)(n),o=(0,en.useRef)(n),[a,l]=(0,en.useState)(!1),d=(0,en.useCallback)(()=>{l(e=>!e)},[]),c=(0,en.useCallback)(t=>{o.current=t,e.user.updateUserPreferences({name:t})},[e]),u=(0,en.useCallback)(()=>{i.current!==o.current&&(t("change-user-name",{source:"people-menu"}),i.current=o.current)},[t]),h=(0,en.useCallback)(()=>{l(!1),e.user.updateUserPreferences({name:i.current}),e.menus.clearOpenMenus()},[e]);return(0,et.jsxs)("div",{className:"tlui-people-menu__user",children:[(0,et.jsx)(sD,{}),a?(0,et.jsx)(ni,{className:"tlui-people-menu__user__input",defaultValue:n,onValueChange:c,onComplete:d,onCancel:h,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{a||l(!0)},children:n||r("people-menu.anonymous-user")}),n?null:(0,et.jsx)("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")})]}),(0,et.jsx)(tz,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:d,children:(0,et.jsx)(TldrawUiButtonIcon,{icon:a?"check":"edit"})})]})}function PeopleMenu({children:e}){let t=useTranslation(),n=(0,eG.uK)(),r=(0,eW.jE)(),i=(0,e2.k)(),o=(0,O.Hg)("user",()=>r.user.getColor(),[r]),a=(0,O.Hg)("user",()=>r.user.getName(),[r]),[l,d]=useMenuIsOpen("people menu");return i.length?(0,et.jsxs)(su.fC,{onOpenChange:d,open:l,children:[(0,et.jsx)(su.xz,{dir:"ltr",asChild:!0,children:(0,et.jsx)("button",{className:"tlui-people-menu__avatars-button",title:t("people-menu.title"),children:(0,et.jsxs)("div",{className:"tlui-people-menu__avatars",children:[i.slice(-5).map(e=>(0,et.jsx)(PeopleMenuAvatar,{userId:e},e)),i.length>0&&(0,et.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:o},children:a?.[0]??""}),i.length>5&&(0,et.jsx)(PeopleMenuMore,{count:i.length-5})]})})}),(0,et.jsx)(su.h_,{container:n,children:(0,et.jsx)(su.VY,{dir:"ltr",className:"tlui-menu",side:"bottom",sideOffset:2,collisionPadding:4,children:(0,et.jsxs)("div",{className:"tlui-people-menu__wrapper",children:[(0,et.jsx)("div",{className:"tlui-people-menu__section",children:(0,et.jsx)(UserPresenceEditor,{})}),i.length>0&&(0,et.jsx)("div",{className:"tlui-people-menu__section",children:i.map(e=>(0,et.jsx)(sj,{userId:e},e+"_presence"))}),e]})})})]}):null}function DefaultSharePanel(){return(0,et.jsx)("div",{className:"tlui-share-zone",draggable:!1,children:(0,et.jsx)(PeopleMenu,{})})}let sB=Object.freeze([L.R_,L.ci,L.pp,L.ST]);function useRelevantStyles(e=sB){let t=(0,eW.jE)();return(0,O.Hg)("getRelevantStyles",()=>{let n=new tE.o(t.getSharedStyles()),r=!!t.root.getCurrent()?.shapeType,i=t.isIn("select")&&t.getSelectedShapeIds().length>0;if(0===n.size&&t.isIn("select")&&0===t.getSelectedShapeIds().length)for(let r of e)n.applyValue(r,t.getStyleForNextShape(r));return r||i||n.size>0?n:null},[t])}let sF={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowKind:[{value:"arc",icon:"arrow-arc"},{value:"elbow",icon:"arrow-elbow"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},sO=(0,en.memo)(function(e){let{uiType:t,items:n,title:r,style:i,value:o,onValueChange:a,onHistoryMark:l,theme:d}=e,c=(0,eW.jE)(),u=useTranslation(),h=useBreakpoint(),p=(0,en.useRef)(!1),f=(0,en.useRef)(null),{handleButtonClick:g,handleButtonPointerDown:m,handleButtonPointerEnter:y,handleButtonPointerUp:b}=(0,en.useMemo)(()=>{let handlePointerUp=()=>{p.current=!1,window.removeEventListener("pointerup",handlePointerUp);let e=f.current;e&&(["TEXTAREA","INPUT"].includes(e.nodeName)||e.isContentEditable)?e.focus():h>=nf.TABLET_SM&&c.getContainer().focus(),f.current=null};return{handleButtonClick:e=>{let{id:t}=e.currentTarget.dataset;("shared"!==o.type||o.value!==t)&&(l?.("point picker item"),a(i,t))},handleButtonPointerDown:e=>{let{id:t}=e.currentTarget.dataset;l?.("point picker item"),a(i,t),p.current=!0,f.current=document.activeElement,window.addEventListener("pointerup",handlePointerUp)},handleButtonPointerEnter:e=>{if(!p.current)return;let{id:t}=e.currentTarget.dataset;a(i,t)},handleButtonPointerUp:e=>{let{id:t}=e.currentTarget.dataset;("shared"!==o.type||o.value!==t)&&a(i,t)}}},[c,h,o,l,a,i]);return(0,et.jsx)(TldrawUiToolbarToggleGroup,{"data-testid":`style.${t}`,type:"single",className:eh("tlui-buttons__grid"),value:"shared"===o.type?o.value:void 0,children:n.map(e=>{let n=r+"  "+u(`${t}-style.${e.value}`);return(0,et.jsx)(TldrawUiToolbarToggleItem,{type:"icon","data-id":e.value,"data-testid":`style.${t}.${e.value}`,"aria-label":n,value:e.value,"data-state":"shared"===o.type&&o.value===e.value?"on":"off","data-isactive":"shared"===o.type&&o.value===e.value,title:n,className:eh("tlui-button-grid__button"),style:i===L.R_?{color:d[e.value].solid}:void 0,onPointerEnter:y,onPointerDown:m,onPointerUp:b,onClick:g,children:(0,et.jsx)(TldrawUiButtonIcon,{icon:e.icon})},e.value)})})});var sR=n(80760),sL=n(85184),sU=n(94977),sN=["PageUp","PageDown"],sz=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],sH={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},s$="Slider",[sV,sG,sK]=(0,n$.B)(s$),[sW,sZ]=(0,tK.b)(s$,[sK]),[sq,sY]=sW(s$),sX=en.forwardRef((e,t)=>{let{name:n,min:r=0,max:i=100,step:o=1,orientation:a="horizontal",disabled:l=!1,minStepsBetweenThumbs:d=0,defaultValue:c=[r],value:u,onValueChange:h=()=>{},onValueCommit:p=()=>{},inverted:f=!1,form:g,...m}=e,y=en.useRef(new Set),b=en.useRef(0),S="horizontal"===a,v=S?s0:s1,[k=[],_]=(0,tY.T)({prop:u,defaultProp:c,onChange:e=>{let t=[...y.current];t[b.current]?.focus(),h(e)}}),C=en.useRef(k);function updateValues(e,t,{commit:n}={commit:!1}){let a=(String(o).split(".")[1]||"").length,l=function(e,t){let n=Math.pow(10,t);return Math.round(e*n)/n}(Math.round((e-r)/o)*o+r,a),c=(0,sR.u)(l,[r,i]);_((e=[])=>{let r=function(e=[],t,n){let r=[...e];return r[n]=t,r.sort((e,t)=>e-t)}(e,c,t);if(!function(e,t){if(t>0){let n=e.slice(0,-1).map((t,n)=>e[n+1]-t);return Math.min(...n)>=t}return!0}(r,d*o))return e;{b.current=r.indexOf(c);let t=String(r)!==String(e);return t&&n&&p(r),t?r:e}})}return(0,et.jsx)(sq,{scope:e.__scopeSlider,name:n,disabled:l,min:r,max:i,valueIndexToChangeRef:b,thumbs:y.current,values:k,orientation:a,form:g,children:(0,et.jsx)(sV.Provider,{scope:e.__scopeSlider,children:(0,et.jsx)(sV.Slot,{scope:e.__scopeSlider,children:(0,et.jsx)(v,{"aria-disabled":l,"data-disabled":l?"":void 0,...m,ref:t,onPointerDown:(0,tG.Mj)(m.onPointerDown,()=>{l||(C.current=k)}),min:r,max:i,inverted:f,onSlideStart:l?void 0:function(e){let t=function(e,t){if(1===e.length)return 0;let n=e.map(e=>Math.abs(e-t)),r=Math.min(...n);return n.indexOf(r)}(k,e);updateValues(e,t)},onSlideMove:l?void 0:function(e){updateValues(e,b.current)},onSlideEnd:l?void 0:function(){let e=C.current[b.current],t=k[b.current];t!==e&&p(k)},onHomeKeyDown:()=>!l&&updateValues(r,0,{commit:!0}),onEndKeyDown:()=>!l&&updateValues(i,k.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!l){let n=sN.includes(e.key),r=n||e.shiftKey&&sz.includes(e.key),i=b.current,a=k[i],l=o*(r?10:1)*t;updateValues(a+l,i,{commit:!0})}}})})})})});sX.displayName=s$;var[sJ,sQ]=sW(s$,{startEdge:"left",endEdge:"right",size:"width",direction:1}),s0=en.forwardRef((e,t)=>{let{min:n,max:r,dir:i,inverted:o,onSlideStart:a,onSlideMove:l,onSlideEnd:d,onStepKeyDown:c,...u}=e,[h,p]=en.useState(null),f=(0,nH.e)(t,e=>p(e)),g=en.useRef(void 0),m=(0,nk.gm)(i),y="ltr"===m,b=y&&!o||!y&&o;function getValueFromPointer(e){let t=g.current||h.getBoundingClientRect(),i=[0,t.width],o=linearScale(i,b?[n,r]:[r,n]);return g.current=t,o(e-t.left)}return(0,et.jsx)(sJ,{scope:e.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width",children:(0,et.jsx)(s2,{dir:m,"data-orientation":"horizontal",...u,ref:f,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{let t=getValueFromPointer(e.clientX);a?.(t)},onSlideMove:e=>{let t=getValueFromPointer(e.clientX);l?.(t)},onSlideEnd:()=>{g.current=void 0,d?.()},onStepKeyDown:e=>{let t=sH[b?"from-left":"from-right"].includes(e.key);c?.({event:e,direction:t?-1:1})}})})}),s1=en.forwardRef((e,t)=>{let{min:n,max:r,inverted:i,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:d,...c}=e,u=en.useRef(null),h=(0,nH.e)(t,u),p=en.useRef(void 0),f=!i;function getValueFromPointer(e){let t=p.current||u.current.getBoundingClientRect(),i=[0,t.height],o=linearScale(i,f?[r,n]:[n,r]);return p.current=t,o(e-t.top)}return(0,et.jsx)(sJ,{scope:e.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:(0,et.jsx)(s2,{"data-orientation":"vertical",...c,ref:h,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{let t=getValueFromPointer(e.clientY);o?.(t)},onSlideMove:e=>{let t=getValueFromPointer(e.clientY);a?.(t)},onSlideEnd:()=>{p.current=void 0,l?.()},onStepKeyDown:e=>{let t=sH[f?"from-bottom":"from-top"].includes(e.key);d?.({event:e,direction:t?-1:1})}})})}),s2=en.forwardRef((e,t)=>{let{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:a,onEndKeyDown:l,onStepKeyDown:d,...c}=e,u=sY(s$,n);return(0,et.jsx)(tW.WV.span,{...c,ref:t,onKeyDown:(0,tG.Mj)(e.onKeyDown,e=>{"Home"===e.key?(a(e),e.preventDefault()):"End"===e.key?(l(e),e.preventDefault()):sN.concat(sz).includes(e.key)&&(d(e),e.preventDefault())}),onPointerDown:(0,tG.Mj)(e.onPointerDown,e=>{let t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),u.thumbs.has(t)?t.focus():r(e)}),onPointerMove:(0,tG.Mj)(e.onPointerMove,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&i(e)}),onPointerUp:(0,tG.Mj)(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),o(e))})})}),s3="SliderTrack",s5=en.forwardRef((e,t)=>{let{__scopeSlider:n,...r}=e,i=sY(s3,n);return(0,et.jsx)(tW.WV.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:t})});s5.displayName=s3;var s4="SliderRange",s6=en.forwardRef((e,t)=>{let{__scopeSlider:n,...r}=e,i=sY(s4,n),o=sQ(s4,n),a=en.useRef(null),l=(0,nH.e)(t,a),d=i.values.length,c=i.values.map(e=>convertValueToPercentage(e,i.min,i.max));return(0,et.jsx)(tW.WV.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:l,style:{...e.style,[o.startEdge]:(d>1?Math.min(...c):0)+"%",[o.endEdge]:100-Math.max(...c)+"%"}})});s6.displayName=s4;var s7="SliderThumb",s8=en.forwardRef((e,t)=>{let n=sG(e.__scopeSlider),[r,i]=en.useState(null),o=(0,nH.e)(t,e=>i(e)),a=en.useMemo(()=>r?n().findIndex(e=>e.ref.current===r):-1,[n,r]);return(0,et.jsx)(s9,{...e,ref:o,index:a})}),s9=en.forwardRef((e,t)=>{var n;let{__scopeSlider:r,index:i,name:o,...a}=e,l=sY(s7,r),d=sQ(s7,r),[c,u]=en.useState(null),h=(0,nH.e)(t,e=>u(e)),p=!c||l.form||!!c.closest("form"),f=(0,sU.t)(c),g=l.values[i],m=void 0===g?0:convertValueToPercentage(g,l.min,l.max),y=(n=l.values.length)>2?`Value ${i+1} of ${n}`:2===n?["Minimum","Maximum"][i]:void 0,b=f?.[d.size],S=b?function(e,t,n){let r=e/2,i=linearScale([0,50],[0,r]);return(r-i(t)*n)*n}(b,m,d.direction):0;return en.useEffect(()=>{if(c)return l.thumbs.add(c),()=>{l.thumbs.delete(c)}},[c,l.thumbs]),(0,et.jsxs)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[d.startEdge]:`calc(${m}% + ${S}px)`},children:[(0,et.jsx)(sV.ItemSlot,{scope:e.__scopeSlider,children:(0,et.jsx)(tW.WV.span,{role:"slider","aria-label":e["aria-label"]||y,"aria-valuemin":l.min,"aria-valuenow":g,"aria-valuemax":l.max,"aria-orientation":l.orientation,"data-orientation":l.orientation,"data-disabled":l.disabled?"":void 0,tabIndex:l.disabled?void 0:0,...a,ref:h,style:void 0===g?{display:"none"}:e.style,onFocus:(0,tG.Mj)(e.onFocus,()=>{l.valueIndexToChangeRef.current=i})})}),p&&(0,et.jsx)(le,{name:o??(l.name?l.name+(l.values.length>1?"[]":""):void 0),form:l.form,value:g},i)]})});s8.displayName=s7;var le=en.forwardRef(({__scopeSlider:e,value:t,...n},r)=>{let i=en.useRef(null),o=(0,nH.e)(i,r),a=(0,sL.D)(t);return en.useEffect(()=>{let e=i.current;if(!e)return;let n=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(n,"value"),o=r.set;if(a!==t&&o){let n=new Event("input",{bubbles:!0});o.call(e,t),e.dispatchEvent(n)}},[a,t]),(0,et.jsx)(tW.WV.input,{style:{display:"none"},...n,ref:o,defaultValue:t})});function convertValueToPercentage(e,t,n){return(0,sR.u)(100/(n-t)*(e-t),[0,100])}function linearScale(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}le.displayName="RadioBubbleInput";let lt=en.forwardRef(function({onHistoryMark:e,title:t,min:n,steps:r,value:i,label:o,onValueChange:a,"data-testid":l,ariaValueModifier:d=1},c){let u=useTranslation(),[h,p]=(0,en.useState)(-1);(0,en.useEffect)(()=>{p(0)},[]);let f=(0,en.useCallback)(e=>{a(e[0])},[a]),g=(0,en.useCallback)(()=>{e("click slider")},[e]),m=(0,en.useCallback)(e=>{"Tab"===e.key&&e.stopPropagation()},[]);return(0,et.jsx)("div",{className:"tlui-slider__container",children:(0,et.jsxs)(sX,{"data-testid":l,className:"tlui-slider",dir:"ltr",min:n??0,max:r,step:1,value:null!==i?[i]:void 0,onPointerDown:g,onValueChange:f,onKeyDownCapture:m,onKeyUpCapture:m,title:t+"  "+u(o),children:[(0,et.jsx)(s5,{className:"tlui-slider__track",dir:"ltr",children:null!==i&&(0,et.jsx)(s6,{className:"tlui-slider__range",dir:"ltr"})}),null!==i&&(0,et.jsx)(s8,{"aria-valuemin":(n??0)*d,"aria-valuenow":i*d,"aria-valuemax":r*d,className:"tlui-slider__thumb",dir:"ltr",ref:c,tabIndex:h})]})})}),ln=en.memo(function({label:e,uiTypeA:t,uiTypeB:n,labelA:r,labelB:i,itemsA:o,itemsB:a,styleA:l,styleB:d,valueA:c,valueB:u,onValueChange:h}){let p=(0,eW.jE)(),f=useTranslation(),[g,m]=en.useState(!1),[y,b]=en.useState(!1),S=en.useMemo(()=>o.find(e=>"shared"===c.type&&c.value===e.value)?.icon??"mixed",[o,c]),v=en.useMemo(()=>a.find(e=>"shared"===u.type&&u.value===e.value)?.icon??"mixed",[a,u]);if(void 0===c&&void 0===u)return null;let k=`style panel ${t} A`,_=`style panel ${n} B`;return(0,et.jsxs)("div",{className:"tlui-style-panel__double-select-picker",children:[(0,et.jsx)("div",{title:f(e),className:"tlui-style-panel__double-select-picker-label",children:f(e)}),(0,et.jsxs)(nL,{label:f(e),className:"tlui-buttons__horizontal",children:[(0,et.jsxs)(TldrawUiPopover,{id:k,open:g,onOpenChange:m,children:[(0,et.jsx)(TldrawUiPopoverTrigger,{children:(0,et.jsx)(nU,{type:"icon","data-testid":`style.${t}`,title:f(r)+"  "+(null===c||"mixed"===c.type?f("style-panel.mixed"):f(`${t}-style.${c.value}`)),children:(0,et.jsx)(TldrawUiButtonIcon,{icon:S,small:!0,invertIcon:!0})})}),(0,et.jsx)(TldrawUiPopoverContent,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:(0,et.jsx)(nL,{label:f(r),className:"tlui-buttons__grid",children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"icons",sourceId:"style-panel",children:o.map(e=>(0,et.jsx)(nU,{"data-testid":`style.${t}.${e.value}`,type:"icon",onClick:()=>{h(l,e.value),e$.h.deleteOpenMenu(k,p.contextId),m(!1)},title:`${f(r)} \u2014 ${f(`${t}-style.${e.value}`)}`,children:(0,et.jsx)(TldrawUiButtonIcon,{icon:e.icon,invertIcon:!0})},e.value))})})})]}),(0,et.jsxs)(TldrawUiPopover,{id:_,open:y,onOpenChange:b,children:[(0,et.jsx)(TldrawUiPopoverTrigger,{children:(0,et.jsx)(nU,{type:"icon","data-testid":`style.${n}`,title:f(i)+"  "+(null===u||"mixed"===u.type?f("style-panel.mixed"):f(`${n}-style.${u.value}`)),children:(0,et.jsx)(TldrawUiButtonIcon,{icon:v,small:!0})})}),(0,et.jsx)(TldrawUiPopoverContent,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:(0,et.jsx)(nL,{label:f(i),className:"tlui-buttons__grid",children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"icons",sourceId:"style-panel",children:a.map(e=>(0,et.jsx)(nU,{type:"icon",title:`${f(i)} \u2014 ${f(`${n}-style.${e.value}`)}`,"data-testid":`style.${n}.${e.value}`,onClick:()=>{h(d,e.value),e$.h.deleteOpenMenu(_,p.contextId),b(!1)},children:(0,et.jsx)(TldrawUiButtonIcon,{icon:e.icon})},e.value))})})})]})]})]})}),lr=en.memo(function({id:e,label:t,uiType:n,stylePanelType:r,style:i,items:o,type:a,value:l,onValueChange:d}){let c=useTranslation(),u=(0,eW.jE)(),[h,p]=en.useState(!1),f=en.useMemo(()=>o.find(e=>"shared"===l.type&&e.value===l.value)?.icon,[o,l]),g=c(`style-panel.${r}`),m="mixed"===l.type?c("style-panel.mixed"):g+"  "+c(`${n}-style.${l.value}`),y=t?c(t):"",b=`style panel ${e}`;return(0,et.jsxs)(TldrawUiPopover,{id:b,open:h,onOpenChange:p,children:[(0,et.jsx)(TldrawUiPopoverTrigger,{children:(0,et.jsxs)(nU,{type:a,"data-testid":`style.${n}`,"data-direction":"left",title:m,children:[y&&(0,et.jsx)(TldrawUiButtonLabel,{children:y}),(0,et.jsx)(TldrawUiButtonIcon,{icon:f??"mixed"})]})}),(0,et.jsx)(TldrawUiPopoverContent,{side:"left",align:"center",children:(0,et.jsx)(nL,{label:y,className:eh("tlui-buttons__grid",`tlui-buttons__${r}`),children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"icons",sourceId:"style-panel",children:o.map(e=>(0,et.jsx)(nU,{type:"icon","data-testid":`style.${n}.${e.value}`,title:g+"  "+c(`${n}-style.${e.value}`),isActive:f===e.icon,onClick:()=>{u.markHistoryStoppingPoint("select style dropdown item"),d(i,e.value),e$.h.deleteOpenMenu(b,u.contextId),p(!1)},children:(0,et.jsx)(TldrawUiButtonIcon,{icon:e.icon})},e.value))})})})]})});function DefaultStylePanelContent({styles:e}){let t=(0,eJ.G)();if(!e)return null;let n=e.get(L.Zu),r=e.get(L.ZJ),i=e.get(L.TA),o=e.get(L.dR),a=e.get(L.t8),l=e.get(L.Y8),d=(0,L.y6)({isDarkMode:t});return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(CommonStylePickerSet,{theme:d,styles:e}),void 0!==l&&(0,et.jsx)(TextStylePickerSet,{theme:d,styles:e}),!(void 0===n&&void 0===r&&void 0===i&&void 0===a&&void 0===o)&&(0,et.jsxs)("div",{className:"tlui-style-panel__section",children:[(0,et.jsx)(GeoStylePickerSet,{styles:e}),(0,et.jsx)(ArrowStylePickerSet,{styles:e}),(0,et.jsx)(ArrowheadStylePickerSet,{styles:e}),(0,et.jsx)(SplineStylePickerSet,{styles:e})]})]})}function useStyleChangeCallback(){let e=(0,eW.jE)(),t=useUiEvents();return en.useMemo(()=>function(n,r){e.run(()=>{e.isIn("select")&&e.setStyleForSelectedShapes(n,r),e.setStyleForNextShapes(n,r),e.updateInstanceState({isChangingStyle:!0})}),t("set-style",{source:"style-panel",id:n.id,value:r})},[e,t])}function CommonStylePickerSet({styles:e,theme:t}){let n=useTranslation(),r=(0,eW.jE)(),i=(0,en.useCallback)(e=>r.markHistoryStoppingPoint(e),[r]),o=useStyleChangeCallback(),a=e.get(L.R_),l=e.get(L.pp),d=e.get(L.ci),c=e.get(L.ST);return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)("div",{className:"tlui-style-panel__section__common","data-testid":"style.panel",children:[void 0===a?null:(0,et.jsx)(nL,{label:n("style-panel.color"),children:(0,et.jsx)(sO,{title:n("style-panel.color"),uiType:"color",style:L.R_,items:sF.color,value:a,onValueChange:o,theme:t,onHistoryMark:i})}),(0,et.jsx)(OpacitySlider,{})]}),(void 0!==l||void 0!==d||void 0!==c)&&(0,et.jsxs)("div",{className:"tlui-style-panel__section",children:[void 0===l?null:(0,et.jsx)(nL,{label:n("style-panel.fill"),children:(0,et.jsx)(sO,{title:n("style-panel.fill"),uiType:"fill",style:L.pp,items:sF.fill,value:l,onValueChange:o,theme:t,onHistoryMark:i})}),void 0===d?null:(0,et.jsx)(nL,{label:n("style-panel.dash"),children:(0,et.jsx)(sO,{title:n("style-panel.dash"),uiType:"dash",style:L.ci,items:sF.dash,value:d,onValueChange:o,theme:t,onHistoryMark:i})}),void 0===c?null:(0,et.jsx)(nL,{label:n("style-panel.size"),children:(0,et.jsx)(sO,{title:n("style-panel.size"),uiType:"size",style:L.ST,items:sF.size,value:c,onValueChange:(e,t)=>{o(e,t);let n=r.getSelectedShapeIds();n.length>0&&kickoutOccludedShapes(r,n)},theme:t,onHistoryMark:i})})]})]})}function TextStylePickerSet({theme:e,styles:t}){let n=useTranslation(),r=useStyleChangeCallback(),i=(0,eW.jE)(),o=(0,en.useCallback)(e=>i.markHistoryStoppingPoint(e),[i]),a=t.get(L.Y8),l=t.get(L.lI),d=t.get(L.Xo),c=t.get(L.HO);return void 0===a&&void 0===d?null:(0,et.jsxs)("div",{className:"tlui-style-panel__section",children:[void 0===a?null:(0,et.jsx)(nL,{label:n("style-panel.font"),children:(0,et.jsx)(sO,{title:n("style-panel.font"),uiType:"font",style:L.Y8,items:sF.font,value:a,onValueChange:r,theme:e,onHistoryMark:o})}),void 0===l?null:(0,et.jsxs)(nL,{label:n("style-panel.align"),className:"tlui-style-panel__row",children:[(0,et.jsx)(sO,{title:n("style-panel.align"),uiType:"align",style:L.lI,items:sF.textAlign,value:l,onValueChange:r,theme:e,onHistoryMark:o}),(0,et.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:(0,et.jsx)(nU,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"vertical-align-middle"})})})]}),void 0===d?null:(0,et.jsxs)(nL,{label:n("style-panel.label-align"),className:"tlui-style-panel__row",children:[(0,et.jsx)(sO,{title:n("style-panel.label-align"),uiType:"align",style:L.Xo,items:sF.horizontalAlign,value:d,onValueChange:r,theme:e,onHistoryMark:o}),(0,et.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:void 0===c?(0,et.jsx)(nU,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"vertical-align-middle"})}):(0,et.jsx)(lr,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:L.HO,items:sF.verticalAlign,value:c,onValueChange:r})})]})]})}function GeoStylePickerSet({styles:e}){let t=useTranslation(),n=useStyleChangeCallback(),r=e.get(L.Zu);return void 0===r?null:(0,et.jsx)(nL,{label:t("style-panel.geo"),children:(0,et.jsx)(lr,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",stylePanelType:"geo",style:L.Zu,items:sF.geo,value:r,onValueChange:n})})}function SplineStylePickerSet({styles:e}){let t=useTranslation(),n=useStyleChangeCallback(),r=e.get(L.t8);return void 0===r?null:(0,et.jsx)(nL,{label:t("style-panel.spline"),children:(0,et.jsx)(lr,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",stylePanelType:"spline",style:L.t8,items:sF.spline,value:r,onValueChange:n})})}function ArrowStylePickerSet({styles:e}){let t=useTranslation(),n=useStyleChangeCallback(),r=e.get(L.dR);return void 0===r?null:(0,et.jsx)(nL,{label:t("style-panel.arrow-kind"),children:(0,et.jsx)(lr,{id:"arrow-kind",type:"menu",label:"style-panel.arrow-kind",uiType:"arrow-kind",stylePanelType:"arrow-kind",style:L.dR,items:sF.arrowKind,value:r,onValueChange:n})})}function ArrowheadStylePickerSet({styles:e}){let t=useStyleChangeCallback(),n=e.get(L.ZJ),r=e.get(L.TA);return n&&r?(0,et.jsx)(ln,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:L.TA,itemsA:sF.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:L.ZJ,itemsB:sF.arrowheadEnd,valueB:n,onValueChange:t,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"}):null}let li=[.1,.25,.5,.75,1];function OpacitySlider(){let e=(0,eW.jE)(),t=(0,en.useCallback)(t=>e.markHistoryStoppingPoint(t),[e]),n=(0,O.Hg)("opacity",()=>e.getSharedOpacity(),[e]),r=useUiEvents(),i=useTranslation(),o=en.useCallback(t=>{let n=li[t];e.run(()=>{e.isIn("select")&&e.setOpacityForSelectedShapes(n),e.setOpacityForNextShapes(n),e.updateInstanceState({isChangingStyle:!0})}),r("set-style",{source:"style-panel",id:"opacity",value:t})},[e,r]);if(void 0===n)return null;let a="mixed"===n.type?-1:li.indexOf((0,B.F)(li,e=>Math.abs(e-n.value)));return(0,et.jsx)(lt,{"data-testid":"style.opacity",value:a>=0?a:li.length-1,label:"mixed"===n.type?"style-panel.mixed":`opacity-style.${n.value}`,onValueChange:o,steps:li.length-1,title:i("style-panel.opacity"),onHistoryMark:t,ariaValueModifier:25})}let lo=(0,en.memo)(function({isMobile:e,children:t}){let n=(0,eW.jE)(),r=(0,en.useRef)(null);(0,e1.O)(r);let i=useRelevantStyles(),o=(0,en.useCallback)(()=>{e||n.updateInstanceState({isChangingStyle:!1})},[n,e]),a=t??(0,et.jsx)(DefaultStylePanelContent,{styles:i});return(0,en.useEffect)(()=>{function handleKeyDown(e){"Escape"===e.key&&r.current?.contains(document.activeElement)&&(e.stopPropagation(),n.getContainer().focus())}let e=r.current;return e?.addEventListener("keydown",handleKeyDown,{capture:!0}),()=>{e?.removeEventListener("keydown",handleKeyDown,{capture:!0})}},[n]),(0,et.jsx)("div",{ref:r,className:eh("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:o,children:a})}),TldrawUiContextualToolbar=({children:e,className:t,isMousingDown:n,getSelectionBounds:r,changeOnlyWhenYChanges:i=!1,label:o})=>{let a=(0,eW.jE)(),l=(0,en.useRef)(null);(0,e1.O)(l),usePassThroughMouseOverEvents(l);let{isVisible:d,isInteractive:c,hide:u,show:h,position:p,move:f}=function(e){let t=(0,eW.jE)(),n=(0,en.useRef)({name:"hidden"}),[r,i]=(0,en.useState)(!1),[o,a]=(0,en.useState)(!1),[l,d]=(0,en.useState)({x:-1e3,y:-1e3}),c=(0,en.useRef)(new eF.B(-1e3,-1e3)),u=(0,en.useRef)(new eF.B(-1e3,-1e3)),h=(0,en.useRef)(-1),p=(0,en.useRef)(-1),f=(0,en.useCallback)((r,i,o=!1)=>{if(u.current.x=r,u.current.y=i,"hidden"===n.current.name||"showing"===n.current.name)return;clearTimeout(p.current);let flushMove=()=>{var t,r;if("shown"===n.current.name&&(t=u.current,r=c.current,e?eF.B.Sub(r,t).y**2>=256:eF.B.Len2(eF.B.Sub(r,t))>=256)){let{x:e,y:t}=u.current;c.current=new eF.B(e,t),o?(0,nz.flushSync)(()=>d({x:e,y:t})):d({x:e,y:t})}};o?flushMove():p.current=t.timers.setTimeout(flushMove,150)},[t,e]),g=(0,en.useCallback)((e=!1)=>{switch(n.current.name){case"showing":clearTimeout(h.current),n.current={name:"hidden"};break;case"shown":n.current={name:"hiding"},i(!1),e?(n.current={name:"hidden"},a(!1)):h.current=t.timers.setTimeout(()=>{n.current={name:"hidden"},a(!1)},16)}},[t]),m=(0,en.useCallback)(()=>{switch(n.current.name){case"hidden":n.current={name:"showing"},h.current=t.timers.setTimeout(()=>{let{x:e,y:t}=u.current;c.current=new eF.B(e,t),d({x:e,y:t}),n.current={name:"shown"},a(!0),i(!0)},16);break;case"hiding":clearTimeout(h.current),n.current={name:"shown"},i(!0),f(u.current.x,u.current.y)}},[t,f]);return{isVisible:o,isInteractive:r,show:m,hide:g,move:f,position:l}}(i),g=(0,en.useRef)(!1),[m,y]=(0,en.useState)(!1),b=(0,O.KO)("content size update counter",0);(0,en.useEffect)(()=>{(0,B.hu)(l.current);let e=new ResizeObserver(()=>{b.update(e=>e+1)});return e.observe(l.current),()=>e.disconnect()},[b]),(0,en.useEffect)(()=>{let e=b.get();return(0,F.Ym)("toolbar position",function(){let t=l.current;if(!t)return;let n=b.get();a.getCamera(),b.get();let i=function(e,t,n){let r=n()?.clone();if(!r)return;let i=e.getViewportScreenBounds();if(r.x-=i.x,r.y-=i.y,r.midY<16||r.midY>i.h-16||r.midX<16||r.midX>i.w-16)return;let o=rectToBox(t.getBoundingClientRect());if(!o.width||!o.height)return;let{scrollLeft:a,scrollTop:l}=e.getContainer(),d=r.midX-o.w/2,c=r.y-o.h-8;return d=(0,ei.uZ)(d,16,i.w-o.w-16),c=(0,ei.uZ)(c,16,i.h-o.h-16),d+=a,c+=l,{x:d=Math.round(d),y:c=Math.round(c)}}(a,t,r);if(i){let t=a.getCameraState();if("moving"===t){let e=l.current;e.style.setProperty("transform",`translate(${i.x}px, ${i.y}px)`)}else{let t=e!==n;f(i.x,i.y,t)}g.current||(g.current=!0,y(!0))}else g.current&&(g.current=!1,y(!1));e=n})},[a,r,b,f]);let S=(0,O.Hg)("camera state",()=>a.getCameraState(),[a]);return(0,en.useEffect)(()=>{if(n||!m){u();return}h()},[m,S,n,h,u]),(0,en.useLayoutEffect)(()=>{let e=l.current;e&&(e.dataset.visible=`${d}`)},[d,p]),(0,en.useLayoutEffect)(()=>{let e=l.current;e&&e.style.setProperty("transform",`translate(${p.x}px, ${p.y}px)`)},[p]),(0,en.useLayoutEffect)(()=>{let e=l.current;e&&(e.dataset.interactive=`${c}`)},[c]),(0,et.jsx)("div",{ref:l,"data-interactive":!1,"data-visible":!1,"data-testid":"contextual-toolbar",className:eh("tlui-contextual-toolbar",t),onPointerDown:e0.be,children:(0,et.jsx)(nL,{className:"tlui-menu tlui-buttons__horizontal",label:o,children:e})})};function rectToBox(e){return new e9.xu(e.x,e.y,e.width,e.height)}function AltTextEditor({shapeId:e,onClose:t,source:n}){let r=(0,eW.jE)(),[i,o]=(0,en.useState)(()=>{let t=r.getShape(e);if(!t)return"";if(!("altText"in t.props))throw Error("Shape does not have altText property");return t.props.altText||""}),a=useTranslation(),l=(0,en.useRef)(null),d=useUiEvents(),c=r.getIsReadonly(),handleComplete=()=>{d("set-alt-text",{source:n});let o=r.getShape(e);o&&(r.updateShapes([{id:o.id,type:o.type,props:{altText:i}}]),t())},u=(0,en.useCallback)(()=>t(),[t]);return(0,en.useEffect)(()=>{function handleKeyDown(e){"Escape"===e.key&&(e.stopPropagation(),u())}return l.current?.select(),document.addEventListener("keydown",handleKeyDown,{capture:!0}),()=>{document.removeEventListener("keydown",handleKeyDown,{capture:!0})}},[u]),(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(ni,{ref:l,className:"tlui-media__toolbar-alt-text-input","data-testid":"media-toolbar.alt-text-input",value:i,placeholder:a("tool.media-alt-text-desc"),onValueChange:e=>o(e),onComplete:handleComplete,onCancel:u,disabled:c}),!c&&(0,et.jsx)(tz,{title:a("tool.media-alt-text-confirm"),type:"icon",onPointerDown:e0.PF,onClick:()=>handleComplete(),children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"check"})})]})}let la=(0,O.j)(function({imageShapeId:e,isManipulating:t,onEditAltTextStart:n,onManipulatingStart:r,onManipulatingEnd:i}){let o=(0,eW.jE)(),a=useUiEvents(),l=useTranslation(),d=(0,en.useRef)(null),c=o.getIsReadonly(),u=(0,O.Hg)("crop",()=>o.getShape(e).props.crop,[o,e]),h=u?Math.min(1-(u.bottomRight.x-u.topLeft.x),1-(u.bottomRight.y-u.topLeft.y)):0,[p,f]=(0,en.useState)(u?Math.max(h,1-.3333333333333333):3),g=useActions();(0,en.useEffect)(()=>{f(u?Math.max(h,1-.3333333333333333):3)},[u,h,p]);let m=(0,en.useCallback)(e=>o.markHistoryStoppingPoint(e),[o]),y=(0,en.useCallback)((e,t)=>Math.pow(e/t,1.5)*t,[]),b=u&&p?(0,B.vm)(y(h,p),[0,p],[0,100],!0):0,S=(0,en.useCallback)(t=>{o.setCurrentTool("select.crop.idle");let n=t/100,r=1-.3333333333333333,i=Math.min(r,p??r),l=Math.pow(n,.6666666666666666)*i,d=o.getShape(e);if(!d)return;let c=function(e,t,n){let r,i;let o=t.props.crop||getDefaultCrop(),{width:a,height:l}=getCropDimensions(o),d=a/l,c=1+e*((n?1/(1-n):3)-1);d>1?i=(r=Math.min(1,1/c))/d:r=(i=Math.min(1,1/c))*d;let u=function(e,t,n,r=!0,i=!1){let o,a;let{w:l,h:d}=getUncroppedSize(e.props,e.props.crop??getDefaultCrop()),c=e.props.crop||getDefaultCrop(),u=e.x+e.props.w/2,h=e.y+e.props.h/2;if(r){let{x:e,y:t}=getCropCenter(c);o=e,a=t}else o=.5,a=.5;let p=createCropAroundCenter(o,a,t,n,i),f=t*l,g=n*d;return{crop:p,w:f,h:g,x:u-f/2,y:h-g/2}}(t,r,i,!0,o.isCircle),h=Math.min(3,a/r);u.w*=h,u.h*=h;let p=t.x+t.props.w/2,f=t.y+t.props.h/2;return u.x=p-u.w/2,u.y=f-u.h/2,u}(l>=1?1:l/(2*(1-l)),d,p);o.updateShape({id:d.id,type:d.type,x:c.x,y:c.y,props:{w:c.w,h:c.h,crop:c.crop}}),a("set-style",{source:"image-toolbar",id:"zoom",value:t})},[o,a,e,p]),v=(0,en.useCallback)(()=>g["image-replace"].onSelect("image-toolbar"),[g]),k=(0,en.useCallback)(()=>g["download-original"].onSelect("image-toolbar"),[g]),handleAspectRatioChange=t=>{let n=o.getShape(e);n&&o.run(()=>{o.setCurrentTool("select.crop.idle");let r=function(e,t){let n,r;if("original"===e){let{w:e,h:n}=getUncroppedSize(t.props,t.props.crop??getDefaultCrop()),r=t.x+t.props.w/2,i=t.y+t.props.h/2;return{crop:getDefaultCrop(),w:e,h:n,x:r-e/2,y:i-n/2}}let i=rX[e],{w:o,h:a}=getUncroppedSize(t.props,t.props.crop||getDefaultCrop()),l=o/a,d=t.props.crop||getDefaultCrop(),{width:c,height:u}=getCropDimensions(d),h=getCropCenter(d),p=Math.min(1/c,1/u);if(0!==l&&Number.isFinite(l)&&0!==i){let e,t;let d=c*o,h=u*a,p=Math.max(d,h);d>=h?t=(e=p)/i:e=(t=p)*i,n=e/o,r=t/a,n>1&&(n=1,r=l/i),r>1&&(r=1,n=i/l),n=Math.max(0,Math.min(1,n)),r=Math.max(0,Math.min(1,r))}else n=1,r=1;let f=Math.min(1/n,1/r);n*=f/p,r*=f/p,n=Math.max(0,Math.min(1,n)),r=Math.max(0,Math.min(1,r));let g=createCropAroundCenter(h.x,h.y,n,r,"circle"===e),m=g.bottomRight.x-g.topLeft.x,y=g.bottomRight.y-g.topLeft.y,b=1;c>0?b=t.props.w/(c*o):u>0&&(b=t.props.h/(u*a));let S=m*o*b,v=y*a*b,k=t.x+t.props.w/2,_=t.y+t.props.h/2;return{crop:g,w:S,h:v,x:k-S/2,y:_-v/2}}(t,n);o.markHistoryStoppingPoint("aspect ratio"),o.updateShape({id:e,type:"image",x:r.x,y:r.y,props:{crop:r.crop,w:r.w,h:r.h}}),kickoutOccludedShapes(o,[e])})},_=(0,O.Hg)("altText",()=>o.getShape(e).props.altText,[o,e]),C=(0,O.Hg)("shapeAspectRatio",()=>{let t=o.getShape(e);return t.props.w/t.props.h},[o,e]),E=!u||(0,B.Xy)(u,getDefaultCrop());return((0,en.useEffect)(()=>{t&&o.timers.setTimeout(()=>d.current?.focus(),0)},[o,t]),(0,en.useEffect)(()=>{function handleKeyDown(e){t&&("Escape"===e.key?(o.cancel(),i()):"Enter"===e.key&&(o.complete(),i()))}let e=d.current;return e&&e.addEventListener("keydown",handleKeyDown),()=>{e&&e.removeEventListener("keydown",handleKeyDown)}},[o,t,i]),t)?(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(lt,{ref:d,value:b,label:"tool.image-zoom",onValueChange:S,onHistoryMark:m,min:0,steps:100,"data-testid":"tool.image-zoom",title:l("tool.image-zoom")}),(0,et.jsxs)(TldrawUiDropdownMenuRoot,{id:"image-toolbar-aspect-ratio",children:[(0,et.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,et.jsx)(tz,{title:l("tool.aspect-ratio"),type:"icon",children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"corners"})})}),(0,et.jsx)(TldrawUiDropdownMenuContent,{side:"top",align:"center",children:rY.map(e=>{let t=!1;return E?"original"===e&&(t=!0):t="circle"===e?!!u.isCircle:"square"===e?!u?.isCircle&&(0,ei.C2)(C,rX[e],.1):"original"!==e&&!E&&(0,ei.C2)(C,rX[e],.01),(0,et.jsx)(TldrawUiDropdownMenuCheckboxItem,{onSelect:()=>handleAspectRatioChange(e),checked:t,title:l(`tool.aspect-ratio.${e}`),children:(0,et.jsx)(TldrawUiButtonLabel,{children:l(`tool.aspect-ratio.${e}`)})},e)})})]}),(0,et.jsx)(tz,{type:"icon",onClick:i,"data-testid":"tool.image-confirm",style:{borderLeft:"1px solid var(--color-divider)",marginLeft:"2px"},children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"check"})})]}):(0,et.jsxs)(et.Fragment,{children:[!c&&(0,et.jsx)(tz,{type:"icon",title:l("tool.replace-media"),onClick:v,children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"tool-media"})}),!c&&(0,et.jsx)(tz,{type:"icon",title:l("tool.image-crop"),onClick:r,children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"crop"})}),(0,et.jsx)(tz,{type:"icon",title:l("action.download-original"),onClick:k,children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"download"})}),(_||!c)&&(0,et.jsx)(tz,{type:"normal",title:l("tool.media-alt-text"),onClick:()=>{a("alt-text-start",{source:"image-toolbar"}),n()},children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"alt"})})]})});function DefaultImageToolbar({children:e}){let t=(0,eW.jE)(),n=(0,O.Hg)("imageShape",()=>{let e=t.getOnlySelectedShape();return e&&"image"===e.type?e.id:null},[t]),r=(0,O.Hg)("showToolbar",()=>t.isInAny("select.idle","select.pointing_shape","select.crop"),[t]),i=(0,O.Hg)("locked",()=>!!n&&t.getShape(n)?.isLocked,[t,n]);return n&&r&&!i?(0,et.jsx)(ContextualToolbarInner,{imageShapeId:n,children:e},n):null}function ContextualToolbarInner({children:e,imageShapeId:t}){let n=(0,eW.jE)(),r=useTranslation(),i=(0,O.Hg)("editor path",()=>n.isInAny("select.crop.cropping","select.crop.pointing_crop_handle","select.crop.translating_crop"),[n]),o=(0,O.Hg)("camera",()=>n.getCamera(),[n]),a=(0,O.Hg)("editor path",()=>n.isIn("select.crop."),[n]),l=(0,en.useRef)(),d=(0,en.useCallback)(()=>{n.setCroppingShape(null),n.setCurrentTool("select.idle")},[n]),[c,u]=(0,en.useState)(!1),h=(0,en.useCallback)(()=>u(!0),[]),p=(0,en.useCallback)(()=>n.setCurrentTool("select.crop.idle"),[n]),f=(0,en.useCallback)(()=>u(!1),[]);(0,en.useEffect)(()=>{l.current=void 0},[o]);let g=(0,en.useCallback)(()=>{if(a&&l.current)return l.current;let e=n.getSelectionScreenBounds();if(!e)return;let t=new e9.xu(e.x,e.y,e.width,0);return l.current=t,t},[n,a]);return i?(l.current=void 0,null):(0,et.jsx)(TldrawUiContextualToolbar,{className:"tlui-image__toolbar",getSelectionBounds:g,label:r("tool.image-toolbar-title"),children:e||(c?(0,et.jsx)(AltTextEditor,{shapeId:t,onClose:f,source:"image-toolbar"}):(0,et.jsx)(la,{imageShapeId:t,isManipulating:a,onEditAltTextStart:h,onManipulatingStart:p,onManipulatingEnd:d}))})}function DefaultRichTextToolbarContent({textEditor:e,onEditLinkStart:t}){let n=useUiEvents(),r=useTranslation(),[i,o]=(0,en.useState)(0);(0,en.useEffect)(function(){function forceUpdate(){o(e=>e+1)}e.on("update",forceUpdate),e.on("selectionUpdate",forceUpdate)},[e]),(0,en.useEffect)(()=>{function handleKeyDown(e){t&&(0,tw.q)(e)&&e.shiftKey&&"k"===e.key&&(e.preventDefault(),t())}return document.addEventListener("keydown",handleKeyDown),()=>{document.removeEventListener("keydown",handleKeyDown)}},[t]);let a=(0,en.useMemo)(()=>{function handleOp(t,r){n("rich-text",{operation:t,source:"rich-text-menu"}),e.chain().focus()[r]().run()}return[{name:"bold",onSelect(){handleOp("bold","toggleBold")}},{name:"italic",onSelect(){handleOp("bold","toggleItalic")}},{name:"code",onSelect(){handleOp("bold","toggleCode")}},t?{name:"link",onSelect(){t()}}:void 0,{name:"bulletList",onSelect(){handleOp("bulletList","toggleBulletList")}},{name:"highlight",onSelect(){handleOp("bulletList","toggleHighlight")}}].filter(Boolean)},[e,n,t]);return a.map(({name:t,attrs:n,onSelect:i})=>{let o=e.isActive(t,n);return(0,et.jsx)(nU,{title:r(`tool.rich-text-${t}`),"data-testid":`rich-text.${t}`,type:"icon",isActive:o,onPointerDown:e0.PF,onClick:i,role:"option","aria-pressed":o,children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:t})},t)})}function LinkEditor({textEditor:e,value:t,onClose:n}){let r=(0,eW.jE)(),[i,o]=(0,en.useState)(t),a=useTranslation(),l=(0,en.useRef)(null),d=useUiEvents(),c="rich-text-menu",u=i.startsWith("http")?i:`https://${i}`;return(0,en.useEffect)(()=>{l.current?.focus()},[i]),(0,en.useEffect)(()=>{o(t)},[t]),(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(ni,{ref:l,"data-testid":"rich-text.link-input",className:"tlui-rich-text__toolbar-link-input",value:i,onValueChange:e=>o(e),onComplete:t=>{d("rich-text",{operation:"link-edit",source:c}),t.startsWith("http://")||t.startsWith("https://")||(t=`https://${t}`),e.commands.setLink({href:t}),r.getInstanceState().isCoarsePointer?e.commands.blur():e.commands.focus(),n()},onCancel:()=>n(),placeholder:"example.com"}),(0,et.jsx)(tz,{className:"tlui-rich-text__toolbar-link-visit",title:a("tool.rich-text-link-visit"),type:"icon",onPointerDown:e0.PF,onClick:()=>{d("rich-text",{operation:"link-visit",source:c}),window.open(u,"_blank","noopener, noreferrer"),n()},disabled:!i,children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"external-link"})}),(0,et.jsx)(tz,{className:"tlui-rich-text__toolbar-link-remove",title:a("tool.rich-text-link-remove"),"data-testid":"rich-text.link-remove",type:"icon",onPointerDown:e0.PF,onClick:()=>{d("rich-text",{operation:"link-remove",source:c}),e.chain().unsetLink().focus().run(),n()},children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"trash"})})]})}let ls=(0,O.j)(function({children:e}){let t=(0,eW.jE)(),n=(0,O.Hg)("textEditor",()=>t.getRichTextEditor(),[t]);return t.getInstanceState().isCoarsePointer||!n?null:(0,et.jsx)(DefaultRichTextToolbar_ContextualToolbarInner,{textEditor:n,children:e})});function DefaultRichTextToolbar_ContextualToolbarInner({textEditor:e,children:t}){let{isEditingLink:n,onEditLinkStart:r,onEditLinkClose:i}=function(e){let[t,n]=(0,en.useState)(!1);(0,en.useEffect)(()=>{if(!e){n(!1);return}let handleClick=()=>{let t=e.isActive("link");n(t)};return e.view.dom.addEventListener("click",handleClick),()=>{e.view.dom.removeEventListener("click",handleClick)}},[e,t]),(0,en.useEffect)(()=>{if(e&&e.isActive("link"))try{let{from:t,to:n}=(0,tT.IH)(e.state.doc.resolve(e.state.selection.from),e.schema.marks.link);e.state.selection.empty&&e.commands.setTextSelection({from:t,to:n})}catch{}},[e,t]);let r=(0,en.useCallback)(()=>{n(!0)},[]),i=(0,en.useCallback)(()=>{n(!1)},[]),o=(0,en.useCallback)(()=>{if(n(!1),!e)return;let t=e.state.selection.from;e.commands.setTextSelection({from:t,to:t})},[e]);return{isEditingLink:t,onEditLinkStart:r,onEditLinkClose:o,onEditLinkCancel:i}}(e),[o,a]=(0,en.useState)(null),l=(0,en.useRef)(),d=function(e){let[t,n]=(0,en.useState)(!1);return(0,en.useEffect)(()=>{if(!e)return;let t=(0,B.Ds)(({isPointing:e})=>{n(e)},16),handlePointingDown=()=>t({isPointing:!0}),handlePointingUp=()=>t({isPointing:!1}),r=["touchstart","pointerdown","mousedown"],i=["touchend","pointerup","mouseup"];return r.forEach(t=>{e.view.dom.addEventListener(t,handlePointingDown)}),i.forEach(e=>{document.body.addEventListener(e,handlePointingUp)}),()=>{r.forEach(t=>{e.view.dom.removeEventListener(t,handlePointingDown)}),i.forEach(e=>{document.body.removeEventListener(e,handlePointingUp)})}},[e]),t}(e),c=useTranslation(),u=(0,en.useCallback)(()=>{if(n)return l.current;let e=window.getSelection();if(!o||!e||0===e.rangeCount||e.isCollapsed)return;let t=[];for(let n=0;n<e.rangeCount;n++){let r=e.getRangeAt(n);t.push(rectToBox(r.getBoundingClientRect()))}let r=e9.xu.Common(t);return l.current=r,r},[o,n]);return(0,en.useEffect)(()=>{let handleSelectionUpdate=({editor:e})=>a(e.state.selection);return e.on("selectionUpdate",handleSelectionUpdate),handleSelectionUpdate({editor:e}),()=>{e.off("selectionUpdate",handleSelectionUpdate)}},[e]),(0,et.jsx)(TldrawUiContextualToolbar,{className:"tlui-rich-text__toolbar",getSelectionBounds:u,isMousingDown:d,changeOnlyWhenYChanges:!0,label:c("tool.rich-text-toolbar-title"),children:t||(n?(0,et.jsx)(LinkEditor,{textEditor:e,value:e.isActive("link")?e.getAttributes("link").href:"",onClose:i}):(0,et.jsx)(DefaultRichTextToolbarContent,{textEditor:e,onEditLinkStart:r}))})}function MobileStylePanel(){let e=(0,eW.jE)(),t=useTranslation(),n=useRelevantStyles(),r=n?.get(L.R_),i=(0,L.y6)({isDarkMode:e.user.getIsDarkMode()}),o=(r?.type==="shared"?i[r.value]:i.black).solid,a=(0,O.Hg)("disable style panel",()=>e.isInAny("hand","zoom","eraser","laser"),[e]),l=(0,en.useCallback)(t=>{t||e.updateInstanceState({isChangingStyle:!1})},[e]),{StylePanel:d}=useTldrawUiComponents();return d?(0,et.jsxs)(TldrawUiPopover,{id:"mobile style menu",onOpenChange:l,children:[(0,et.jsx)(TldrawUiPopoverTrigger,{children:(0,et.jsx)(tz,{type:"tool","data-testid":"mobile-styles.button",style:{color:a?"var(--color-muted-1)":o},title:t("style-panel.title"),disabled:a,children:(0,et.jsx)(TldrawUiButtonIcon,{icon:a?"blob":r?.type==="mixed"?"mixed":"blob"})})}),(0,et.jsx)(TldrawUiPopoverContent,{side:"top",align:"end",children:d&&(0,et.jsx)(d,{isMobile:!0})})]}):null}function DefaultToolbarContent(){return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(SelectToolbarItem,{}),(0,et.jsx)(HandToolbarItem,{}),(0,et.jsx)(DrawToolbarItem,{}),(0,et.jsx)(EraserToolbarItem,{}),(0,et.jsx)(ArrowToolbarItem,{}),(0,et.jsx)(TextToolbarItem,{}),(0,et.jsx)(NoteToolbarItem,{}),(0,et.jsx)(AssetToolbarItem,{}),(0,et.jsx)(RectangleToolbarItem,{}),(0,et.jsx)(EllipseToolbarItem,{}),(0,et.jsx)(TriangleToolbarItem,{}),(0,et.jsx)(DiamondToolbarItem,{}),(0,et.jsx)(HexagonToolbarItem,{}),(0,et.jsx)(OvalToolbarItem,{}),(0,et.jsx)(RhombusToolbarItem,{}),(0,et.jsx)(StarToolbarItem,{}),(0,et.jsx)(CloudToolbarItem,{}),(0,et.jsx)(HeartToolbarItem,{}),(0,et.jsx)(XBoxToolbarItem,{}),(0,et.jsx)(CheckBoxToolbarItem,{}),(0,et.jsx)(ArrowLeftToolbarItem,{}),(0,et.jsx)(ArrowUpToolbarItem,{}),(0,et.jsx)(ArrowDownToolbarItem,{}),(0,et.jsx)(ArrowRightToolbarItem,{}),(0,et.jsx)(LineToolbarItem,{}),(0,et.jsx)(HighlightToolbarItem,{}),(0,et.jsx)(LaserToolbarItem,{}),(0,et.jsx)(FrameToolbarItem,{})]})}function useIsToolSelected(e){let t=(0,eW.jE)(),n=e?.meta?.geo;return(0,O.Hg)("is tool selected",()=>{if(!e)return!1;let r=t.getCurrentToolId();return"geo"===r?n===t.getSharedStyles().getAsKnownValue(L.Zu):r===e.id},[t,e?.id,n])}function ToolbarItem({tool:e}){let t=useTools(),n=useIsToolSelected(t[e]);return(0,et.jsx)(TldrawUiMenuToolItem,{toolId:e,isSelected:n})}function SelectToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"select"})}function HandToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"hand"})}function DrawToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"draw"})}function EraserToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"eraser"})}function ArrowToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"arrow"})}function TextToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"text"})}function NoteToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"note"})}function AssetToolbarItem(){return(0,et.jsx)(TldrawUiMenuToolItem,{toolId:"asset"})}function RectangleToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"rectangle"})}function EllipseToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"ellipse"})}function DiamondToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"diamond"})}function TriangleToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"triangle"})}function TrapezoidToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"trapezoid"})}function RhombusToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"rhombus"})}function HeartToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"heart"})}function HexagonToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"hexagon"})}function CloudToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"cloud"})}function StarToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"star"})}function OvalToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"oval"})}function XBoxToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"x-box"})}function CheckBoxToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"check-box"})}function ArrowLeftToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"arrow-left"})}function ArrowUpToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"arrow-up"})}function ArrowDownToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"arrow-down"})}function ArrowRightToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"arrow-right"})}function LineToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"line"})}function HighlightToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"highlight"})}function FrameToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"frame"})}function LaserToolbarItem(){return(0,et.jsx)(ToolbarItem,{tool:"laser"})}let ll="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function addEvent(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on".concat(t),n)}function removeEvent(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent("on".concat(t),n)}function getMods(e,t){let n=t.slice(0,t.length-1);for(let t=0;t<n.length;t++)n[t]=e[n[t].toLowerCase()];return n}function getKeys(e){"string"!=typeof e&&(e=""),e=e.replace(/\s/g,"");let t=e.split(","),n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}let ld={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":ll?173:189,"=":ll?61:187,";":ll?59:186,"'":222,"[":219,"]":221,"\\":220},lc={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,command:91},lu={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},lh={16:!1,18:!1,17:!1,91:!1},lp={};for(let e=1;e<20;e++)ld["f".concat(e)]=111+e;let lf=[],lg=null,lm="all",ly=new Map,code=e=>ld[e.toLowerCase()]||lc[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),getKey=e=>Object.keys(ld).find(t=>ld[t]===e),getModifier=e=>Object.keys(lc).find(t=>lc[t]===e);function setScope(e){lm=e||"all"}function getScope(){return lm||"all"}function unbind(e){if(void 0===e)Object.keys(lp).forEach(e=>{Array.isArray(lp[e])&&lp[e].forEach(e=>eachUnbind(e)),delete lp[e]}),removeKeyEvent(null);else if(Array.isArray(e))e.forEach(e=>{e.key&&eachUnbind(e)});else if("object"==typeof e)e.key&&eachUnbind(e);else if("string"==typeof e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[i,o]=n;"function"==typeof i&&(o=i,i=""),eachUnbind({key:e,scope:i,method:o,splitKey:"+"})}}let eachUnbind=e=>{let{key:t,scope:n,method:r,splitKey:i="+"}=e,o=getKeys(t);o.forEach(e=>{let t=e.split(i),o=t.length,a=t[o-1],l="*"===a?"*":code(a);if(!lp[l])return;n||(n=getScope());let d=o>1?getMods(lc,t):[],c=[];lp[l]=lp[l].filter(e=>{let t=!r||e.method===r,i=t&&e.scope===n&&function(e,t){let n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,i=!0;for(let e=0;e<n.length;e++)-1===r.indexOf(n[e])&&(i=!1);return i}(e.mods,d);return i&&c.push(e.element),!i}),c.forEach(e=>removeKeyEvent(e))})};function eventHandler(e,t,n,r){let i;if(t.element===r&&(t.scope===n||"all"===t.scope)){for(let e in i=t.mods.length>0,lh)Object.prototype.hasOwnProperty.call(lh,e)&&(!lh[e]&&t.mods.indexOf(+e)>-1||lh[e]&&-1===t.mods.indexOf(+e))&&(i=!1);(0!==t.mods.length||lh[16]||lh[18]||lh[17]||lh[91])&&!i&&"*"!==t.shortcut||(t.keys=[],t.keys=t.keys.concat(lf),!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function dispatch(e,t){let n=lp["*"],r=e.keyCode||e.which||e.charCode;if(!hotkeys.filter.call(this,e))return;if((93===r||224===r)&&(r=91),-1===lf.indexOf(r)&&229!==r&&lf.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(t=>{let n=lu[t];e[t]&&-1===lf.indexOf(n)?lf.push(n):!e[t]&&lf.indexOf(n)>-1?lf.splice(lf.indexOf(n),1):"metaKey"===t&&e[t]&&(lf=lf.filter(e=>e in lu||e===r))}),r in lh){for(let e in lh[r]=!0,lc)lc[e]===r&&(hotkeys[e]=!0);if(!n)return}for(let t in lh)Object.prototype.hasOwnProperty.call(lh,t)&&(lh[t]=e[lu[t]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===lf.indexOf(17)&&lf.push(17),-1===lf.indexOf(18)&&lf.push(18),lh[17]=!0,lh[18]=!0);let i=getScope();if(n)for(let r=0;r<n.length;r++)n[r].scope===i&&("keydown"===e.type&&n[r].keydown||"keyup"===e.type&&n[r].keyup)&&eventHandler(e,n[r],i,t);if(!(r in lp))return;let o=lp[r],a=o.length;for(let n=0;n<a;n++)if(("keydown"===e.type&&o[n].keydown||"keyup"===e.type&&o[n].keyup)&&o[n].key){let r=o[n],{splitKey:a}=r,l=r.key.split(a),d=[];for(let e=0;e<l.length;e++)d.push(code(l[e]));d.sort().join("")===lf.sort().join("")&&eventHandler(e,r,i,t)}}function hotkeys(e,t,n){lf=[];let r=getKeys(e),i=[],o="all",a=document,l=0,d=!1,c=!0,u="+",h=!1,p=!1;for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(o=t.scope),t.element&&(a=t.element),t.keyup&&(d=t.keyup),void 0!==t.keydown&&(c=t.keydown),void 0!==t.capture&&(h=t.capture),"string"==typeof t.splitKey&&(u=t.splitKey),!0===t.single&&(p=!0)),"string"==typeof t&&(o=t),p&&unbind(e,o);l<r.length;l++)e=r[l].split(u),i=[],e.length>1&&(i=getMods(lc,e)),(e="*"===(e=e[e.length-1])?"*":code(e))in lp||(lp[e]=[]),lp[e].push({keyup:d,keydown:c,scope:o,mods:i,shortcut:r[l],method:n,key:r[l],splitKey:u,element:a});if(void 0!==a&&window){if(!ly.has(a)){let keydownListener=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;return dispatch(e,a)},keyupListenr=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;dispatch(e,a),function(e){let t=e.keyCode||e.which||e.charCode,n=lf.indexOf(t);if(n>=0&&lf.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&lf.splice(0,lf.length),(93===t||224===t)&&(t=91),t in lh)for(let e in lh[t]=!1,lc)lc[e]===t&&(hotkeys[e]=!1)}(e)};ly.set(a,{keydownListener,keyupListenr,capture:h}),addEvent(a,"keydown",keydownListener,h),addEvent(a,"keyup",keyupListenr,h)}if(!lg){let listener=()=>{lf=[]};lg={listener,capture:h},addEvent(window,"focus",listener,h)}}}function removeKeyEvent(e){let t=Object.values(lp).flat(),n=t.findIndex(t=>{let{element:n}=t;return n===e});if(n<0){let{keydownListener:t,keyupListenr:n,capture:r}=ly.get(e)||{};t&&n&&(removeEvent(e,"keyup",n,r),removeEvent(e,"keydown",t,r),ly.delete(e))}if(t.length<=0||ly.size<=0){let e=Object.keys(ly);if(e.forEach(e=>{let{keydownListener:t,keyupListenr:n,capture:r}=ly.get(e)||{};t&&n&&(removeEvent(e,"keyup",n,r),removeEvent(e,"keydown",t,r),ly.delete(e))}),ly.clear(),Object.keys(lp).forEach(e=>delete lp[e]),lg){let{listener:e,capture:t}=lg;removeEvent(window,"focus",e,t),lg=null}}}let lb={getPressedKeyString:function(){return lf.map(e=>getKey(e)||getModifier(e)||String.fromCharCode(e))},setScope,getScope,deleteScope:function(e,t){let n,r;for(let t in e||(e=getScope()),lp)if(Object.prototype.hasOwnProperty.call(lp,t))for(r=0,n=lp[t];r<n.length;)if(n[r].scope===e){let e=n.splice(r,1);e.forEach(e=>{let{element:t}=e;return removeKeyEvent(t)})}else r++;getScope()===e&&setScope(t||"all")},getPressedKeyCodes:function(){return lf.slice(0)},getAllKeyCodes:function(){let e=[];return Object.keys(lp).forEach(t=>{lp[t].forEach(t=>{let{key:n,scope:r,mods:i,shortcut:o}=t;e.push({scope:r,shortcut:o,mods:i,keys:n.split("+").map(e=>code(e))})})}),e},isPressed:function(e){return"string"==typeof e&&(e=code(e)),-1!==lf.indexOf(e)},filter:function(e){let t=e.target||e.srcElement,{tagName:n}=t,r=!0,i="INPUT"===n&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(i||"TEXTAREA"===n||"SELECT"===n)&&!t.readOnly)&&(r=!1),r},trigger:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(lp).forEach(n=>{let r=lp[n].filter(n=>n.scope===t&&n.shortcut===e);r.forEach(e=>{e&&e.method&&e.method()})})},unbind,keyMap:ld,modifier:lc,modifierMap:lu};for(let e in lb)Object.prototype.hasOwnProperty.call(lb,e)&&(hotkeys[e]=lb[e]);if("undefined"!=typeof window){let e=window.hotkeys;hotkeys.noConflict=t=>(t&&window.hotkeys===hotkeys&&(window.hotkeys=e),hotkeys),window.hotkeys=hotkeys}let lx=["copy","cut","paste","asset"];function useKeyboardShortcuts(){let e=(0,eW.jE)(),t=useReadonly(),n=useActions(),r=useTools(),i=(0,O.Hg)("is focused",()=>e.getInstanceState().isFocused,[e]);(0,en.useEffect)(()=>{var o;if(!i)return;let a=[],l=e.getContainer(),hot=(e,t)=>{hotkeys(e,{element:l.ownerDocument.body},t),a.push(()=>{hotkeys.unbind(e,t)})};for(let r of Object.values(n))r.kbd&&(!t||r.readonlyOk)&&(lx.includes(r.id)||hot(getHotkeysStringFromKbd(r.kbd),t=>{(!useKeyboardShortcuts_areShortcutsDisabled(e)||r.isRequiredA11yAction)&&((0,e0.PF)(t),r.onSelect("kbd"))}));for(let t of Object.values(r))!(!t.kbd||!t.readonlyOk&&e.getIsReadonly())&&(lx.includes(t.id)||hot(getHotkeysStringFromKbd(t.kbd),n=>{useKeyboardShortcuts_areShortcutsDisabled(e)||((0,e0.PF)(n),t.onSelect("kbd"))}));return hot(",",t=>{if(useKeyboardShortcuts_areShortcutsDisabled(e)||e.inputs.keys.has("Comma"))return;(0,e0.PF)(t),e.focus(),e.inputs.keys.add("Comma");let{x:n,y:r,z:i}=e.inputs.currentPagePoint,o=e.pageToScreen({x:n,y:r}),a={type:"pointer",name:"pointer_down",point:{x:o.x,y:o.y,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,metaKey:t.metaKey,accelKey:(0,tw.q)(t),pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(a)}),o=t=>{if(useKeyboardShortcuts_areShortcutsDisabled(e)||!e.inputs.keys.has("Comma"))return;e.inputs.keys.delete("Comma");let{x:n,y:r,z:i}=e.inputs.currentScreenPoint,o={type:"pointer",name:"pointer_up",point:{x:n,y:r,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,metaKey:t.metaKey,accelKey:(0,tw.q)(t),pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(o)},hotkeys(",",{element:l.ownerDocument.body,keyup:!0,keydown:!1},o),a.push(()=>{hotkeys.unbind(",",o)}),()=>{a.forEach(e=>e())}},[n,r,t,e,i])}function useKeyboardShortcuts_areShortcutsDisabled(e){return e.menus.hasAnyOpenMenus()||null!==e.getEditingShapeId()||e.getCrashingError()||!e.user.getAreKeyboardShortcutsEnabled()}function getHotkeysStringFromKbd(e){return(function(e){"string"!=typeof e&&(e=""),e=e.replace(/\s/g,"");let t=e.split(","),n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t})(e).map(e=>{let t=e.includes("!"),n=e.includes("?"),r=e.includes("$"),i=e.replace(/[!?$]/g,"");return t&&n&&r?`cmd+shift+alt+${i},ctrl+shift+alt+${i}`:t&&r?`cmd+shift+${i},ctrl+shift+${i}`:n&&r?`cmd+alt+${i},ctrl+alt+${i}`:n&&t?`shift+alt+${i}`:t?`shift+${i}`:n?`alt+${i}`:r?`cmd+${i},ctrl+${i}`:i}).join(",")}let lw=(0,en.createContext)(!1),lS={1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,0:9};function OverflowingToolbar({children:e}){let t=(0,eW.jE)(),n=(0,e4.Gj)(),r=useBreakpoint(),i=useTranslation(),o=(0,en.useRef)([]),[a,l]=(0,en.useState)(!1),d=Math.min(8,5+r),[c,u]=(0,en.useState)(0),h=(0,en.useRef)(null),[p,f]=(0,en.useState)(null),g=(0,en.useMemo)(()=>{let e=p?`:not([data-value="${p}"])`:"";return`
			#${n}_main > *:nth-child(n + ${d+(p?1:2)})${e} {
				display: none;
			}
			#${n}_more > *:nth-child(-n + ${d}) {
				display: none;
			}
			#${n}_more > *:nth-child(-n + ${d+4}) {
				margin-top: 0;
			}
        `},[p,n,d]),m=(0,eY.z)(()=>{if(!h.current)return;let e=Array.from(h.current.children);u(e.length);let t=e.findIndex(e=>e.getAttribute("data-value")===p);t<=d&&f(null);let n=Array.from(h.current.children).findIndex(e=>"true"===e.getAttribute("aria-pressed"));-1!==n&&(n>=d&&f(e[n].getAttribute("data-value")),o.current=Array.from(h.current?.children??[]).filter(e=>e instanceof HTMLElement&&"button"===e.tagName.toLowerCase()&&!!(e.offsetWidth||e.offsetHeight)))});(0,en.useLayoutEffect)(()=>{m()}),(0,en.useLayoutEffect)(()=>{if(!h.current)return;let e=new MutationObserver(m);return e.observe(h.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-pressed"]}),()=>{e.disconnect()}},[m]),(0,en.useEffect)(()=>{if(t.options.enableToolbarKeyboardShortcuts)return document.addEventListener("keydown",handleKeyDown),()=>{document.removeEventListener("keydown",handleKeyDown)};function handleKeyDown(e){if(useKeyboardShortcuts_areShortcutsDisabled(t)||(0,e0.hZ)(!0)||e.ctrlKey||e.metaKey||e.altKey||e.shiftKey)return;let n=lS[e.key];"number"==typeof n&&((0,e0.PF)(e),o.current[n]?.click())}},[t]);let y="toolbar overflow";return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)("style",{nonce:t.options.nonce,children:g}),(0,et.jsxs)(nL,{className:eh("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<nf.TABLET_SM}),label:i("tool-panel.title"),children:[(0,et.jsx)("div",{id:`${n}_main`,ref:h,className:"tlui-toolbar__tools__list",children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"toolbar",sourceId:"toolbar",children:e})}),c>d+1&&(0,et.jsx)(lw.Provider,{value:!0,children:(0,et.jsxs)(TldrawUiPopover,{id:y,open:a,onOpenChange:l,children:[(0,et.jsx)(TldrawUiPopoverTrigger,{children:(0,et.jsx)(nU,{title:i("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"chevron-up"})})}),(0,et.jsx)(TldrawUiPopoverContent,{side:"top",align:"center",children:(0,et.jsx)(nL,{className:"tlui-buttons__grid","data-testid":"tools.more-content",label:i("tool-panel.more"),id:`${n}_more`,onClick:()=>{e$.h.deleteOpenMenu(y,t.contextId),l(!1)},children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"toolbar-overflow",sourceId:"toolbar",children:e})})})]})})]})]})}function ToggleToolLockedButton({activeToolId:e}){let t=(0,eW.jE)(),n=useBreakpoint(),r=useTranslation(),i=(0,O.Hg)("is tool locked",()=>t.getInstanceState().isToolLocked,[t]),o=(0,O.Hg)("current tool",()=>t.getCurrentTool(),[t]);return e&&o.isLockable?(0,et.jsx)(tz,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:eh("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<nf.TABLET_SM}),onClick:()=>t.updateInstanceState({isToolLocked:!i}),children:(0,et.jsx)(TldrawUiButtonIcon,{icon:i?"lock":"unlock",small:!0})}):null}let lv=(0,en.memo)(function({children:e}){let t=(0,eW.jE)(),n=useTranslation(),r=useBreakpoint(),i=useReadonly(),o=(0,O.Hg)("current tool id",()=>t.getCurrentToolId(),[t]),a=(0,en.useRef)(null);(0,e1.O)(a);let{ActionsMenu:l,QuickActions:d}=useTldrawUiComponents(),c="menu"!==t.options.actionShortcutsLocation&&("toolbar"===t.options.actionShortcutsLocation||r<nf.TABLET);return(0,et.jsx)("div",{ref:a,className:"tlui-toolbar",children:(0,et.jsxs)("div",{className:"tlui-toolbar__inner",children:[(0,et.jsxs)("div",{className:"tlui-toolbar__left",children:[!i&&(0,et.jsxs)("div",{className:"tlui-toolbar__extras",children:[c&&(0,et.jsxs)(nL,{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",label:n("actions-menu.title"),children:[d&&(0,et.jsx)(d,{}),l&&(0,et.jsx)(l,{})]}),(0,et.jsx)(ToggleToolLockedButton,{activeToolId:o})]}),(0,et.jsx)(OverflowingToolbar,{children:e??(0,et.jsx)(DefaultToolbarContent,{})})]}),r<nf.TABLET_SM&&!i&&(0,et.jsx)("div",{className:"tlui-toolbar__tools",children:(0,et.jsx)(MobileStylePanel,{})})]})})}),lT=(0,O.j)(function({videoShapeId:e,onEditAltTextStart:t}){let n=(0,eW.jE)(),r=useUiEvents(),i=useTranslation(),o=n.getIsReadonly(),a=useActions(),l=(0,en.useCallback)(()=>a["video-replace"].onSelect("video-toolbar"),[a]),d=(0,en.useCallback)(()=>a["download-original"].onSelect("video-toolbar"),[a]),c=(0,O.Hg)("altText",()=>n.getShape(e).props.altText,[n,e]);return(0,et.jsxs)(et.Fragment,{children:[!o&&(0,et.jsx)(tz,{type:"icon",title:i("tool.replace-media"),onClick:l,children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"tool-media"})}),(0,et.jsx)(tz,{type:"icon",title:i("action.download-original"),onClick:d,children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"download"})}),(c||!o)&&(0,et.jsx)(tz,{type:"normal",isActive:!!c,title:i("tool.media-alt-text"),onClick:()=>{r("alt-text-start",{source:"video-toolbar"}),t()},children:(0,et.jsx)(TldrawUiButtonIcon,{small:!0,icon:"alt"})})]})}),lk=(0,O.j)(function({children:e}){let t=(0,eW.jE)(),n=(0,O.Hg)("videoShape",()=>{let e=t.getOnlySelectedShape();return e&&"video"===e.type?e.id:null},[t]),r=t.isInAny("select.idle","select.pointing_shape"),i=(0,O.Hg)("locked",()=>!!n&&t.getShape(n)?.isLocked,[t,n]);return n&&r&&!i?(0,et.jsx)(DefaultVideoToolbar_ContextualToolbarInner,{videoShapeId:n,children:e},n):null});function DefaultVideoToolbar_ContextualToolbarInner({children:e,videoShapeId:t}){let n=(0,eW.jE)(),r=useTranslation(),[i,o]=(0,en.useState)(!1),a=(0,en.useCallback)(()=>o(!0),[]),l=(0,en.useCallback)(()=>o(!1),[]),d=(0,en.useCallback)(()=>{let e=n.getSelectionScreenBounds();if(e)return new e9.xu(e.x,e.y,e.width,0)},[n]);return(0,et.jsx)(TldrawUiContextualToolbar,{className:"tlui-video__toolbar",getSelectionBounds:d,label:r("tool.video-toolbar-title"),children:e||(i?(0,et.jsx)(AltTextEditor,{shapeId:t,onClose:l,source:"video-toolbar"}):(0,et.jsx)(lT,{videoShapeId:t,onEditAltTextStart:a}))})}function OfflineIndicator(){let e=useTranslation();return(0,et.jsxs)("div",{className:eh("tlui-offline-indicator"),children:[e("status.offline"),(0,et.jsx)(nr,{label:e("status.offline"),icon:"status-offline",small:!0})]})}function CenteredTopPanelContainer({maxWidth:e=420,ignoreRightWidth:t=0,stylePanelWidth:n=148,marginBetweenZones:r=12,squeezeAmount:i=52,children:o}){let a=(0,en.useRef)(null),l=useBreakpoint(),d=(0,en.useCallback)(()=>{let o=a.current;if(!o)return;let d=o.parentElement.parentElement,c=d.querySelector(".tlui-layout__top__left"),u=d.querySelector(".tlui-layout__top__right"),h=d.offsetWidth,p=c.offsetWidth,f=u.offsetWidth,g=o.offsetWidth-t,m=(h-g)/2;h%2!=0&&(m-=.5);let y=p+r,b=o.offsetLeft,S=Math.min(h-f-p-2*r,e),v=Math.max(m,y)-b;u.offsetWidth>n&&l<=6?o.style.setProperty("max-width",S-i+"px"):o.style.setProperty("max-width",S+"px"),o.style.setProperty("transform",`translate(${v}px, 0px)`)},[l,t,r,e,i,n]);return(0,en.useLayoutEffect)(()=>{let e=a.current;if(!e)return;let t=e.parentElement.parentElement,n=t.querySelector(".tlui-layout__top__left"),r=t.querySelector(".tlui-layout__top__right"),i=new ResizeObserver(d);return i.observe(n),i.observe(r),i.observe(t),i.observe(e),d(),()=>{i.disconnect()}},[d]),(0,en.useLayoutEffect)(()=>{d()}),(0,et.jsx)("div",{ref:a,className:"tlui-top-panel__container",children:o})}function DefaultTopPanel(){let e="offline"===useCollaborationStatus();return(0,et.jsx)(CenteredTopPanelContainer,{children:e&&(0,et.jsx)(OfflineIndicator,{})})}function DefaultZoomMenuContent(){return(0,et.jsxs)(et.Fragment,{children:[(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-in",noClose:!0}),(0,et.jsx)(TldrawUiMenuActionItem,{actionId:"zoom-out",noClose:!0}),(0,et.jsx)(menu_items_ZoomTo100MenuItem,{}),(0,et.jsx)(ZoomToFitMenuItem,{}),(0,et.jsx)(ZoomToSelectionMenuItem,{})]})}let l_=(0,en.memo)(function({children:e}){let t=(0,eG.uK)(),[n,r]=useMenuIsOpen("zoom menu"),i=e??(0,et.jsx)(DefaultZoomMenuContent,{});return(0,et.jsxs)(tV.fC,{dir:"ltr",open:n,onOpenChange:r,modal:!1,children:[(0,et.jsx)(ZoomTriggerButton,{}),(0,et.jsx)(tV.Uv,{container:t,children:(0,et.jsx)(tV.VY,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"zoom-menu",children:i})})})]})}),ZoomTriggerButton=()=>{let e=(0,eW.jE)(),t=useBreakpoint(),n=(0,O.Hg)("zoom",()=>e.getZoomLevel(),[e]),r=useTranslation(),i=(0,en.useCallback)(()=>{e.resetZoom(e.getViewportScreenCenter(),{animation:{duration:e.options.animationMediumMs}})},[e]),o=`${Math.floor(100*n)}%`;return(0,et.jsx)(nU,{asChild:!0,type:"icon","aria-label":`${r("navigation-zone.zoom")} \u2014 ${o}`,title:`${r("navigation-zone.zoom")} \u2014 ${o}`,"data-testid":"minimap.zoom-menu-button",className:"tlui-zoom-menu__button",onDoubleClick:i,children:(0,et.jsx)(tV.xz,{dir:"ltr",children:t<nf.MOBILE?null:(0,et.jsx)("span",{style:{flexGrow:0,textAlign:"center"},children:o})})})},lC=(0,en.createContext)(null);function TldrawUiComponentsProvider({overrides:e={},children:t}){let n=(0,eX.S)(e),r=useShowCollaborationUi();return(0,et.jsx)(lC.Provider,{value:(0,en.useMemo)(()=>({ContextMenu:sf,ActionsMenu:sp,HelpMenu:null,ZoomMenu:l_,MainMenu:sv,Minimap:DefaultMinimap,StylePanel:lo,PageMenu:sP,NavigationPanel:sE,Toolbar:lv,RichTextToolbar:ls,ImageToolbar:DefaultImageToolbar,VideoToolbar:lk,KeyboardShortcutsDialog:rv,QuickActions:sA,HelperButtons:DefaultHelperButtons,DebugPanel:sx,DebugMenu:DefaultDebugMenu,MenuPanel:sS,SharePanel:r?DefaultSharePanel:null,CursorChatBubble:r?sg:null,TopPanel:r?DefaultTopPanel:null,Dialogs:r_,Toasts:rI,A11y:tH,...n}),[n,r]),children:t})}function useTldrawUiComponents(){let e=(0,en.useContext)(lC);if(!e)throw Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return e}let lI=(0,O.j)(function({overrides:e,components:t,assetUrls:n,onUiEvent:r,forceMobile:i,mediaMimeTypes:o,children:a}){let l=(0,eW.Z2)();return(0,et.jsx)(rw.Provider,{value:o,children:(0,et.jsx)(AssetUrlsProvider,{assetUrls:useDefaultUiAssetUrlsWithOverrides(n),children:(0,et.jsx)(TldrawUiTranslationProvider,{overrides:useMergedTranslationOverrides(e),locale:l?.user.getLocale()??ew.ks.locale,children:(0,et.jsx)(TldrawUiEventsProvider,{onEvent:r,children:(0,et.jsx)(TldrawUiToastsProvider,{children:(0,et.jsx)(TldrawUiDialogsProvider,{context:"tla",children:(0,et.jsx)(TldrawUiA11yProvider,{children:(0,et.jsx)(BreakPointProvider,{forceMobile:i,children:(0,et.jsx)(TldrawUiComponentsProvider,{overrides:t,children:(0,et.jsx)(InternalProviders,{overrides:e,children:a})})})})})})})})})})});function InternalProviders({overrides:e,children:t}){let n=function(e){let t=useDefaultHelpers(),n=useShallowArrayEquality(null==e?[]:Array.isArray(e)?e:[e]);return(0,en.useMemo)(()=>(function(e,t){let n={};for(let t of e)if(t.translations)for(let[e,r]of(0,B.EP)(t.translations)){let t=n[e];t||(t=n[e]={}),Object.assign(t,r)}return{actions:(t,n,r)=>{for(let i of e)i.actions&&(n=i.actions(t,n,r));return n},tools:(n,r,i)=>{for(let o of e)o.tools&&(r=o.tools(n,r,{...t,...i}));return r},translations:n}})(n,t),[n,t])}(e);return(0,et.jsx)(ActionsProvider,{overrides:n.actions,children:(0,et.jsx)(ToolsProvider,{overrides:n.tools,children:t})})}let lE=en.memo(function({renderDebugMenuItems:e,children:t,hideUi:n,components:r,...i}){return(0,et.jsx)(lI,{...i,components:r,children:(0,et.jsx)(lM,{hideUi:n,renderDebugMenuItems:e,children:t})})}),lM=en.memo(function({children:e,hideUi:t,...n}){return(0,et.jsxs)(et.Fragment,{children:[e,t?null:(0,et.jsx)(lP,{...n})]})}),lP=en.memo(function(){let e=(0,eW.jE)(),t=useTranslation(),n=useBreakpoint(),r=useReadonly(),i=(0,O.Hg)("focus",()=>e.getInstanceState().isFocusMode,[e]),o=(0,O.Hg)("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:l,MenuPanel:d,StylePanel:c,Toolbar:u,HelpMenu:h,NavigationPanel:p,HelperButtons:f,DebugPanel:g,CursorChatBubble:m,RichTextToolbar:y,ImageToolbar:b,VideoToolbar:S,Toasts:v,Dialogs:k,A11y:_}=useTldrawUiComponents();useKeyboardShortcuts(),useNativeClipboardEvents(),function(){let e=(0,eW.jE)(),{addToast:t}=useToasts();(0,en.useEffect)(()=>{function handleMaxShapes({name:e,count:n}){t({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${e} (${n}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return e.addListener("max-shapes",handleMaxShapes),()=>{e.removeListener("max-shapes",handleMaxShapes)}},[e,t])}();let C=(0,en.useRef)(!1),E=(0,en.useRef)(-1),[M,P]=(0,en.useState)(!1);(0,O.vC)("update hide toolbar while delayed",()=>{let t=eH.a.isIos||eH.a.isAndroid;if(!t)return;let n=e.getEditingShapeId();if(null===n){C.current&&(C.current=!1,clearTimeout(E.current),eH.a.isAndroid?E.current=e.timers.setTimeout(()=>{P(!1)},150):P(!1));return}C.current||(C.current=!0,clearTimeout(E.current),P(!0))},[]);let{"toggle-focus-mode":A}=useActions();return(0,et.jsxs)("div",{className:eh("tlui-layout",{"tlui-layout__mobile":n<nf.TABLET_SM}),"data-iseditinganything":M,"data-breakpoint":n,children:[(0,et.jsx)(SkipToMainContent,{}),i?(0,et.jsx)("div",{className:"tlui-layout__top",children:(0,et.jsx)(tz,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>A.onSelect("menu"),children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"dot"})})}):(0,et.jsxs)(et.Fragment,{children:[(0,et.jsxs)("div",{className:"tlui-layout__top",children:[(0,et.jsxs)("div",{className:"tlui-layout__top__left",children:[d&&(0,et.jsx)(d,{}),f&&(0,et.jsx)(f,{})]}),(0,et.jsx)("div",{className:"tlui-layout__top__center",children:l&&(0,et.jsx)(l,{})}),(0,et.jsxs)("div",{className:"tlui-layout__top__right",children:[a&&(0,et.jsx)(a,{}),c&&n>=nf.TABLET_SM&&!r&&(0,et.jsx)(c,{})]})]}),(0,et.jsxs)("div",{className:"tlui-layout__bottom",children:[(0,et.jsxs)("div",{className:"tlui-layout__bottom__main",children:[p&&(0,et.jsx)(p,{}),u&&(0,et.jsx)(u,{}),h&&(0,et.jsx)(h,{})]}),o&&g&&(0,et.jsx)(g,{}),_&&(0,et.jsx)(_,{})]})]}),y&&(0,et.jsx)(y,{}),b&&(0,et.jsx)(b,{}),S&&(0,et.jsx)(S,{}),v&&(0,et.jsx)(v,{}),k&&(0,et.jsx)(k,{}),(0,et.jsx)(FollowingIndicator,{}),m&&(0,et.jsx)(m,{})]})}),LoadingScreen=()=>{let{Spinner:e}=(0,eZ.o)();return(0,et.jsx)(th.a_,{children:e?(0,et.jsx)(e,{}):null})},lA=[...sl,...av];function Tldraw(e){let{children:t,maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:a,components:l={},shapeUtils:d=[],bindingUtils:c=[],tools:u=[],embeds:h,textOptions:p,...f}=e,g=(0,eX.S)(l),m=(0,en.useMemo)(()=>({Scribble:TldrawScribble,ShapeIndicators:TldrawShapeIndicators,CollaboratorScribble:TldrawScribble,SelectionForeground:rW,Handles:TldrawHandles,Overlays:TldrawOverlays,Spinner:Spinner,LoadingScreen:LoadingScreen,...g}),[g]),y=(0,eX.T)(d),b=(0,en.useMemo)(()=>(0,B.Ct)("type",y,a2),[y]),S=(0,eX.T)(c),v=(0,en.useMemo)(()=>(0,B.Ct)("type",S,rq),[S]),k=(0,eX.T)(u),_=(0,en.useMemo)(()=>(0,B.Ct)("id",k,lA),[k]),C=(0,eX.T)(i??B.Hj),E=(0,eX.T)(o??B.B0),M=(0,en.useMemo)(()=>({addFontsFromNode:defaultAddFontsFromNode,...p,tipTapConfig:{extensions:ah,...p?.tipTapConfig}}),[p]),P=(0,en.useMemo)(()=>[...C,...E],[C,E]),A=useDefaultEditorAssetsWithOverrides(f.assetUrls),j=b.find(e=>"embed"===e.type);return j&&h&&EmbedShapeUtil.setEmbedDefinitions(h),(0,et.jsx)(AssetUrlsProvider,{assetUrls:useDefaultUiAssetUrlsWithOverrides(f.assetUrls),children:(0,et.jsx)(TldrawUiTranslationProvider,{overrides:useMergedTranslationOverrides(f.overrides),locale:f.user?.userPreferences.get().locale??ew.ks.locale,children:(0,et.jsx)(th.gR,{initialState:"select",...f,components:m,shapeUtils:b,bindingUtils:v,tools:_,textOptions:M,assetUrls:A,children:(0,et.jsxs)(lE,{...f,components:m,mediaMimeTypes:P,children:[(0,et.jsx)(InsideOfEditorAndUiContext,{maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:C,acceptedVideoMimeTypes:E,onMount:a}),t]})})})})}function InsideOfEditorAndUiContext({maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r,onMount:i}){let o=(0,eW.jE)(),a=useToasts(),l=useTranslation(),d=useUiEvents();(0,th.FI)(()=>{let c=[];return c.push(registerDefaultSideEffects(o)),o.fonts.requestFonts(ad),o.once("edit",()=>d("edit",{source:"unknown"})),registerDefaultExternalContentHandlers(o,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r,toasts:a,msg:l}),c.push(o.store.props.onMount(o)),c.push(i?.(o)),()=>{c.forEach(e=>e?.())}});let{Canvas:c}=(0,eZ.o)(),{ContextMenu:u}=useTldrawUiComponents();return u?(0,et.jsx)(u,{}):c?(0,et.jsx)(c,{}):null}let lj={tipTapConfig:{extensions:ah},addFontsFromNode:defaultAddFontsFromNode},lD=(0,en.memo)(function(e){let[t,n]=(0,en.useState)(null),[r,i]=(0,en.useState)(null),o=(0,eX.T)(e.shapeUtils??[]),a=(0,en.useMemo)(()=>(0,B.Ct)("type",o,a2),[o]),l=(0,eX.T)(e.bindingUtils??[]),d=(0,en.useMemo)(()=>(0,B.Ct)("type",l,rq),[l]),c=useTLStore({snapshot:e.snapshot,shapeUtils:a}),{pageId:u,bounds:h,scale:p,pixelRatio:f,background:g,padding:m,darkMode:y,preserveAspectRatio:b,format:S="svg",licenseKey:v,assetUrls:k,textOptions:_=lj}=e,C=useDefaultEditorAssetsWithOverrides(k);return(0,en.useLayoutEffect)(()=>{if(!r||!c)return;let e=!1,t=document.createElement("div");r.appendChild(t),r.classList.add("tl-container","tl-theme__light");let i=new ev.M({store:c,shapeUtils:a,bindingUtils:d,tools:[],getContainer:()=>t,licenseKey:v,fontAssetUrls:C.fonts,textOptions:_});u&&i.setCurrentPage(u);let o=i.getCurrentPageShapeIds();return async function(){await i.fonts.loadRequiredFontsForCurrentPage(i.options.maxFontsToLoadBeforeRender);let t=await i.toImage([...o],{bounds:h,scale:p,background:g,padding:m,darkMode:y,preserveAspectRatio:b,format:S});if(!t||e)return;let r=URL.createObjectURL(t.blob);n(r),i.dispose()}(),()=>{e=!0}},[S,r,c,a,d,u,h,p,g,m,y,b,v,f,C,_]),(0,en.useEffect)(()=>()=>{t&&URL.revokeObjectURL(t)},[t]),(0,et.jsx)("div",{ref:i,style:{position:"relative",width:"100%",height:"100%"},children:t&&(0,et.jsx)("img",{src:t,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})})}),lB=(0,en.memo)(function({children:e}){let t=useTranslation(),n=useBreakpoint(),r=(0,en.useRef)(null);(0,e1.O)(r);let i=e??(0,et.jsx)(DefaultHelpMenuContent,{});return n<nf.MOBILE?null:(0,et.jsx)("div",{ref:r,className:"tlui-help-menu",children:(0,et.jsxs)(TldrawUiDropdownMenuRoot,{id:"help menu",children:[(0,et.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,et.jsx)(tz,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:(0,et.jsx)(TldrawUiButtonIcon,{icon:"question-mark",small:!0})})}),(0,et.jsx)(TldrawUiDropdownMenuContent,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:(0,et.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"help-menu",children:i})})]})})});async function preloadFont(e,t){let{url:n,style:r="normal",weight:i="500",display:o,featureSettings:a,stretch:l,unicodeRange:d,variant:c,format:u}=t,h=new FontFace(e,`url(${n})`,{style:r,weight:i,display:o,featureSettings:a,stretch:l,unicodeRange:d,variant:c});return await h.load(),document.fonts.add(h),h.$$_url=n,h.$$_fontface=`
@font-face {
	font-family: ${h.family};
	font-stretch: ${h.stretch};
	font-weight: ${h.weight};
	font-style: ${h.style};
	src: url("${n}") format("${u}")
}`,h}function buildFromV1Document(e,t){let n=t;e.run(()=>{n=function(e,t){let{version:n=0}=e;e.assets||(e.assets={});let r=new Set;return Object.values(e.pages).forEach(e=>Object.values(e.shapes).forEach(t=>{let{parentId:n,children:i,assetId:o}=t;o&&r.add(o),n===e.id||e.shapes[n]||(console.warn("Encountered a shape with a missing parent!"),t.parentId=e.id),"group"===t.type&&i&&i.forEach(n=>{e.shapes[n]||(console.warn("Encountered a parent with a missing child!",t.id,n),i?.splice(i.indexOf(n),1))})})),Object.keys(e.assets).forEach(t=>{r.has(t)||delete e.assets[t]}),n!==t&&(n<14&&Object.values(e.pages).forEach(e=>{Object.values(e.shapes).filter(e=>"text"===e.type).forEach(e=>{void 0===e.style.font&&(e.style.font="script")})}),n<=13&&Object.values(e.pages).forEach(e=>{Object.values(e.bindings).forEach(e=>{Object.assign(e,e.meta)}),Object.values(e.shapes).forEach(e=>{Object.entries(e.style).forEach(([t,n])=>{"string"==typeof n&&(e.style[t]=n.toLowerCase())}),"arrow"===e.type&&e.decorations&&Object.entries(e.decorations).forEach(([t,n])=>{"Arrow"===n&&(e.decorations={...e.decorations,[t]:"arrow"})})})}),n<=13.1&&null==e.name&&(e.name="New Document"),n<15&&null==e.assets&&(e.assets={}),Object.values(e.pages).forEach(e=>{Object.values(e.shapes).forEach(e=>{n<15.2&&("image"===e.type||"video"===e.type)&&null==e.style.isFilled&&(e.style.isFilled=!0),n<15.3&&("rectangle"===e.type||"triangle"===e.type||"ellipse"===e.type||"arrow"===e.type)&&("text"in e&&"string"==typeof e.text&&(e.label=e.text),e.label||(e.label=""),e.labelPoint||(e.labelPoint=[.5,.5]))})})),Object.values(e.pageStates).forEach(t=>{t.selectedIds=t.selectedIds.filter(n=>void 0!==e.pages[t.id].shapes[n]),t.bindingId=void 0,t.editingId=void 0,t.hoveredId=void 0,t.pointedId=void 0}),e.version=t,e}(n,15.5),e.cancel().cancel().cancel().cancel();let t=e.getPages()[0].id;for(let n of(e.setCurrentPage(t),e.getPages().slice(1)))e.deletePage(n.id);e.selectAll(),e.deleteShapes(e.getSelectedShapeIds());let r=new Map;Object.values(n.assets??{}).forEach(t=>{switch(t.type){case"image":{let n=L.Yk.createId();r.set(t.id,n);let i={id:n,typeName:"asset",type:"image",props:{w:coerceDimension(t.size[0]),h:coerceDimension(t.size[1]),name:t.fileName??"Untitled",isAnimated:!1,mimeType:null,src:t.src},meta:{}};e.createAssets([i]),tryMigrateAsset(e,i);break}case"video":{let n=L.Yk.createId();r.set(t.id,n),e.createAssets([{id:n,typeName:"asset",type:"video",props:{w:coerceDimension(t.size[0]),h:coerceDimension(t.size[1]),name:t.fileName??"Untitled",isAnimated:!0,mimeType:null,src:t.src},meta:{}}])}}});let i=new Map;Object.values(n.pages??{}).sort((e,t)=>(e.childIndex??1)<(t.childIndex??1)?-1:1).forEach((t,n)=>{if(0===n)i.set(t.id,e.getCurrentPageId());else{let n=L.ez.createId();i.set(t.id,n),e.createPage({name:t.name??"Page",id:n})}}),Object.values(n.pages??{}).sort((e,t)=>(e.childIndex??1)<(t.childIndex??1)?-1:1).forEach(t=>{e.setCurrentPage(i.get(t.id));let n=new Map,o=new Map,a=Object.values(t.shapes??{}).sort((e,t)=>e.childIndex<t.childIndex?-1:1).slice(0,e.options.maxShapesPerPage);a.forEach(e=>{if("group"!==e.type)return;let t=(0,L.F1)();n.set(e.id,t),o.set(e.id,[])}),a.forEach(a=>{var l,d,c;if("group"===a.type)return;let u=(0,L.F1)();n.set(a.id,u),a.parentId!==t.id&&(o.has(a.parentId)?o.get(a.parentId).push(a.id):console.warn("parent does not exist",a));let h=i.get(t.id),p={id:u,parentId:h,x:coerceNumber(a.point[0]),y:coerceNumber(a.point[1]),rotation:0,isLocked:!!a.isLocked};switch(a.type){case"sticky":e.createShapes([{...p,type:"note",props:{richText:(0,L.Ak)(a.text??""),color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),align:(l=a.style.textAlign)?lG[l]??"middle":"middle"}}]);break;case"rectangle":{e.createShapes([{...p,type:"geo",props:{geo:"rectangle",w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),richText:(0,L.Ak)(a.label??""),fill:getV2Fill(a.style.isFilled,a.style.color),labelColor:getV2Color(a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(p.id);if(e.updateShapes([{id:p.id,type:"geo",props:{richText:(0,L.Ak)(a.label??"")}}]),t.width===t.height){let t=e.getShape(p.id),{growY:n}=t.props,r=coerceDimension(t.props.w),i=coerceDimension(t.props.h),o=r+n/2,a=i+n/2;e.updateShapes([{id:p.id,type:"geo",x:coerceNumber(t.x)-(o-r)/2,y:coerceNumber(t.y)-(a-i)/2,props:{w:o,h:a}}])}break}case"triangle":{e.createShapes([{...p,type:"geo",props:{geo:"triangle",w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),fill:getV2Fill(a.style.isFilled,a.style.color),labelColor:getV2Color(a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(p.id);if(e.updateShapes([{id:p.id,type:"geo",props:{richText:(0,L.Ak)(a.label??"")}}]),t.width===t.height){let t=e.getShape(p.id),{growY:n}=t.props,r=coerceDimension(t.props.w),i=coerceDimension(t.props.h),o=r+n/2,a=i+n/2;e.updateShapes([{id:p.id,type:"geo",x:coerceNumber(t.x)-(o-r)/2,y:coerceNumber(t.y)-(a-i)/2,props:{w:o,h:a}}])}break}case"ellipse":{e.createShapes([{...p,type:"geo",props:{geo:"ellipse",w:2*coerceDimension(a.radius[0]),h:2*coerceDimension(a.radius[1]),fill:getV2Fill(a.style.isFilled,a.style.color),labelColor:getV2Color(a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(p.id);if(e.updateShapes([{id:p.id,type:"geo",props:{richText:(0,L.Ak)(a.label??"")}}]),t.width===t.height){let t=e.getShape(p.id),{growY:n}=t.props,r=coerceDimension(t.props.w),i=coerceDimension(t.props.h),o=r+n/2,a=i+n/2;e.updateShapes([{id:p.id,type:"geo",x:coerceNumber(t.x)-(o-r)/2,y:coerceNumber(t.y)-(a-i)/2,props:{w:o,h:a}}])}break}case"draw":if(0===a.points.length){!function(e){n.delete(e.id);let t=o.has(e.parentId);if(t){let t=o.get(e.parentId).filter(t=>t!==e.id);o.set(e.parentId,t)}}(a);break}e.createShapes([{...p,type:"draw",props:{fill:getV2Fill(a.style.isFilled,a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),dash:getV2Dash(a.style.dash),isPen:!1,isComplete:a.isComplete,segments:[{type:"free",points:a.points.map(getV2Point)}]}}]);break;case"arrow":{let t=coerceNumber(a.bend),n=getV2Point(a.handles.start.point),r=getV2Point(a.handles.end.point),i=eF.B.Dist(n,r);e.createShapes([{...p,type:"arrow",props:{text:a.label??"",color:getV2Color(a.style.color),labelColor:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),arrowheadStart:getV2Arrowhead(a.decorations?.start),arrowheadEnd:getV2Arrowhead(a.decorations?.end),start:{x:coerceNumber(a.handles.start.point[0]),y:coerceNumber(a.handles.start.point[1])},end:{x:coerceNumber(a.handles.end.point[0]),y:coerceNumber(a.handles.end.point[1])},bend:-(i*t)/2}}]);break}case"text":e.createShapes([{...p,type:"text",props:{richText:(0,L.Ak)(a.text??" "),color:getV2Color(a.style.color),size:(d=a.style.size)?lW[d]??"m":"m",font:getV2Font(a.style.font),textAlign:(c=a.style.textAlign)?lK[c]??"middle":"middle",scale:a.style.scale??1}}]);break;case"image":{let t=r.get(a.assetId);if(!t){console.warn("Could not find asset id",a.assetId);return}e.createShapes([{...p,type:"image",props:{w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),assetId:t}}]);break}case"video":{let t=r.get(a.assetId);if(!t){console.warn("Could not find asset id",a.assetId);return}e.createShapes([{...p,type:"video",props:{w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),assetId:t}}])}}let f=coerceNumber(a.rotation);0!==f&&(e.select(u),e.rotateShapesBy([u],f))}),o.forEach((r,i)=>{let o=r.map(e=>n.get(e)),a=n.get(i);e.groupShapes(o,{groupId:a});let l=t.shapes[i],d=coerceNumber(l.rotation);0!==d&&(e.select(a),e.rotateShapesBy([a],d))}),a.forEach(r=>{if("arrow"!==r.type)return;let i=n.get(r.id),o=e.getShapeUtil("arrow");for(let a of(e.inputs.ctrlKey=!1,["start","end"])){let l=r.handles[a].bindingId;if(l){let r=t.bindings[l];if(!r)continue;let d=n.get(r.toId),c=e.getShape(d);if(!c)continue;if(d){let t=e.getShapePageBounds(d),n=e.getShape(i),l=(0,ei.uZ)((coerceNumber(r.point[0])+.5)/2,.2,.8),c=(0,ei.uZ)((coerceNumber(r.point[1])+.5)/2,.2,.8),u=e.getPointInShapeSpace(n,{x:t.minX+t.width*l,y:t.minY+t.height*c}),h=e.getShapeHandles(n),p=o.onHandleDrag(n,{handle:{...h.find(e=>e.id===a),x:u.x,y:u.y},isPrecise:.5!==u.x||.5!==u.y});p&&e.updateShape(p);let f=getArrowBindings(e,e.getShape(i))[a];if(f){let t=(0,B.v4)(f);0===r.distance&&(t.props.isExact=!0),t.toId!==d&&(t.toId=d,t.props.normalizedAnchor={x:l,y:c}),e.updateBinding(t)}}}}})}),e.setCurrentPage(t),e.clearHistory(),e.selectNone();let o=e.getCurrentPageBounds();o&&e.zoomToBounds(o,{targetZoom:1})})}function coerceNumber(e){return"number"!=typeof e||Number.isNaN(e)||!Number.isFinite(e)?0:e}function coerceDimension(e){let t=coerceNumber(e);return t<=0?1:t}async function tryMigrateAsset(e,t){try{if("bookmark"===t.type||!t.props.src)return;let n=await (0,B.he)(t.props.src);if(!n.ok)return;let r=new File([await n.blob()],t.props.name,{type:n.headers.get("content-type")??t.props.mimeType??void 0}),i=await e.getAssetForExternalContent({type:"file",file:r});if(!i)throw Error("Could not get asset for external content");if("bookmark"===i.type)return;e.updateAssets([{id:t.id,type:t.type,props:{...i.props,name:t.props.name}}])}catch{}}var lF=((o=lF||{}).Sticky="sticky",o.Ellipse="ellipse",o.Rectangle="rectangle",o.Triangle="triangle",o.Draw="draw",o.Arrow="arrow",o.Text="text",o.Group="group",o.Image="image",o.Video="video",o),lO=((a=lO||{}).White="white",a.LightGray="lightGray",a.Gray="gray",a.Black="black",a.Green="green",a.Cyan="cyan",a.Blue="blue",a.Indigo="indigo",a.Violet="violet",a.Red="red",a.Orange="orange",a.Yellow="yellow",a),lR=((l=lR||{}).Small="small",l.Medium="medium",l.Large="large",l),lL=((d=lL||{}).Draw="draw",d.Solid="solid",d.Dashed="dashed",d.Dotted="dotted",d),lU=((c=lU||{}).Start="start",c.Middle="middle",c.End="end",c.Justify="justify",c),lN=((u=lN||{}).Script="script",u.Sans="sans",u.Serif="serif",u.Mono="mono",u),lz=((h=lz||{}).Arrow="arrow",h),lH=((p=lH||{}).Image="image",p.Video="video",p);let l$={white:"black",black:"black",lightGray:"grey",gray:"grey",green:"light-green",cyan:"green",blue:"light-blue",indigo:"blue",orange:"orange",yellow:"yellow",red:"red",violet:"light-violet"},lV={mono:"mono",sans:"sans",script:"draw",serif:"serif"},lG={start:"start",middle:"middle",end:"end",justify:"start"},lK={start:"start",middle:"middle",end:"end",justify:"start"},lW={small:"s",medium:"l",large:"xl"},lZ={small:"m",medium:"l",large:"xl"},lq={solid:"solid",dashed:"dashed",dotted:"dotted",draw:"draw"};function getV2Color(e){return e?l$[e]??"black":"black"}function getV2Font(e){return e?lV[e]??"draw":"draw"}function getV2Size(e){return e?lZ[e]??"l":"l"}function getV2Dash(e){return e?lq[e]??"draw":"draw"}function getV2Point(e){return{x:coerceNumber(e[0]),y:coerceNumber(e[1]),z:null==e[2]?.5:coerceNumber(e[2])}}function getV2Arrowhead(e){return"arrow"===e?"arrow":"none"}function getV2Fill(e,t){return e?"black"===t||"white"===t?"semi":"solid":"none"}let lY=".tldr",lX=N.T.object({schemaVersion:N.T.literal(1),storeVersion:N.T.positiveInteger,recordVersions:N.T.dict(N.T.string,N.T.object({version:N.T.positiveInteger,subTypeVersions:N.T.dict(N.T.string,N.T.positiveInteger).optional(),subTypeKey:N.T.string.optional()}))}),lJ=N.T.object({schemaVersion:N.T.literal(2),sequences:N.T.dict(N.T.string,N.T.positiveInteger)}),lQ=N.T.object({tldrawFileFormatVersion:N.T.nonZeroInteger,schema:N.T.numberUnion("schemaVersion",{1:lX,2:lJ}),records:N.T.arrayOf(N.T.object({id:N.T.string,typeName:N.T.string}).allowUnknownProperties())});function parseTldrawJsonFile({json:e,schema:t}){let n,r,i;try{n=lQ.validate(JSON.parse(e))}catch(t){try{if(n=JSON.parse(e),function(e){try{if(e.document?.version)return!0;return!1}catch{return!1}}(n))return B.x4.err({type:"v1File",data:n})}catch{}return B.x4.err({type:"notATldrawFile",cause:t})}if(n.tldrawFileFormatVersion>1)return B.x4.err({type:"fileFormatVersionTooNew",version:n.tldrawFileFormatVersion});try{let e=pruneUnusedAssets(n.records);i=Object.fromEntries(e.map(e=>[e.id,e])),r=t.migrateStoreSnapshot({store:i,schema:n.schema})}catch(e){return B.x4.err({type:"invalidRecords",cause:e})}if("error"===r.type)return B.x4.err({type:"migrationFailed",reason:r.reason});try{return B.x4.ok((0,eg.jx)({snapshot:{store:i,schema:n.schema},schema:t}))}catch(e){return B.x4.err({type:"invalidRecords",cause:e})}}function pruneUnusedAssets(e){let t=new Set;for(let n of e)"shape"===n.typeName&&"assetId"in n.props&&n.props.assetId&&t.add(n.props.assetId);return e.filter(e=>"asset"!==e.typeName||t.has(e.id))}async function serializeTldrawJson(e){let t=[];for(let n of e.store.allRecords())if("asset"===n.typeName){if("bookmark"!==n.type&&n.props.src&&!n.props.src.startsWith("data:")){let r;try{let t=n.props.src;t.startsWith("http")||(t=await e.resolveAssetUrl(n.id,{shouldResolveToOriginal:!0})||""),r=await B.P6.blobToDataUrl(await (await (0,B.he)(t)).blob())}catch{r=n.props.src}t.push({...n,props:{...n.props,src:r}})}else t.push(n)}else t.push(n);return JSON.stringify({tldrawFileFormatVersion:1,schema:e.store.schema.serialize(),records:pruneUnusedAssets(t)})}async function serializeTldrawJsonBlob(e){return new Blob([await serializeTldrawJson(e)],{type:"application/vnd.tldraw+json"})}async function parseAndLoadDocument(e,t,n,r,i,o){let a=parseTldrawJsonFile({schema:e.store.schema,json:t});if(!a.ok){let t;switch(a.error.type){case"notATldrawFile":e.annotateError(a.error.cause,{origin:"file-system.open.parse",willCrashApp:!1,tags:{parseErrorType:a.error.type}}),reportError(a.error.cause),t=n("file-system.file-open-error.not-a-tldraw-file");break;case"fileFormatVersionTooNew":t=n("file-system.file-open-error.file-format-version-too-new");break;case"migrationFailed":t=a.error.reason===R.qx.TargetVersionTooNew?n("file-system.file-open-error.file-format-version-too-new"):n("file-system.file-open-error.generic-corrupted-file");break;case"invalidRecords":e.annotateError(a.error.cause,{origin:"file-system.open.parse",willCrashApp:!1,tags:{parseErrorType:a.error.type}}),reportError(a.error.cause),t=n("file-system.file-open-error.generic-corrupted-file");break;case"v1File":buildFromV1Document(e,a.error.data.document),i?.();return;default:(0,B.iP)(a.error,"type")}r({title:n("file-system.file-open-error.title"),description:t,severity:"error"});return}(0,F.ay)(()=>{let t=a.value.getStoreSnapshot();e.loadSnapshot(t),e.clearHistory(),extractAssets(e,t,n,r);let i=e.getCurrentPageBounds();i&&e.zoomToBounds(i,{targetZoom:1,immediate:!0})}),o&&e.user.updateUserPreferences({colorScheme:"dark"})}async function extractAssets(e,t,n,r){let i=new Map;for(let e of Object.values(t.store))"asset"===e.typeName&&e.props.src&&e.props.src.startsWith("data:")&&("image"===e.type||"video"===e.type)&&i.set(e.id,e);Promise.allSettled([...i].map(async([t,i])=>{try{let n=await (0,B.he)(i.props.src).then(e=>e.blob()),r=new File([n],i.props.name,{type:i.props.mimeType}),o=await e.getAssetForExternalContent({type:"file",file:r});if(!o)throw Error("Could not create an asset");e.updateAssets([{...o,id:t}])}catch(e){r({title:n("assets.files.upload-failed"),severity:"error"}),console.error(e);return}}))}(0,B.x2)("tldraw","3.15.4","esm")},81508:function(e,t,n){"use strict";n.d(t,{Sz:function(){return useContextSelector},kr:function(){return createContext}});var r=n(2265),i=n(94362);n(25566);let o=Symbol(),a=Symbol(),l="undefined"==typeof window||/ServerSideRendering/.test(window.navigator&&window.navigator.userAgent),d=l?r.useEffect:r.useLayoutEffect,c=i.unstable_runWithPriority?e=>{try{(0,i.unstable_runWithPriority)(i.unstable_NormalPriority,e)}catch(t){if("Not implemented."===t.message)e();else throw t}}:e=>e(),createProvider=e=>({value:t,children:n})=>{let i=(0,r.useRef)(t),a=(0,r.useRef)(0),[l,u]=(0,r.useState)(null);l&&(l(t),u(null));let h=(0,r.useRef)();if(!h.current){let e=new Set;h.current={[o]:{v:i,n:a,l:e,u:(t,n)=>{a.current+=1;let r={n:a.current};(null==n?void 0:n.suspense)&&(r.n*=-1,r.p=new Promise(e=>{u(()=>t=>{r.v=t,delete r.p,e(t)})})),e.forEach(e=>e(r)),t()}}}}return d(()=>{i.current=t,a.current+=1,c(()=>{h.current[o].l.forEach(e=>{e({n:a.current,v:t})})})},[t]),(0,r.createElement)(e,{value:h.current},n)};function createContext(e){let t=(0,r.createContext)({[o]:{v:{current:e},n:{current:-1},l:new Set,u:e=>e()}});return t[a]=t.Provider,t.Provider=createProvider(t.Provider),delete t.Consumer,t}function useContextSelector(e,t){let n=(0,r.useContext)(e)[o],{v:{current:i},n:{current:a},l:l}=n,c=t(i),[u,h]=(0,r.useReducer)((e,n)=>{if(!n)return[i,c];if("p"in n)throw n.p;if(n.n===a)return Object.is(e[1],c)?e:[i,c];try{if("v"in n){if(Object.is(e[0],n.v))return e;let r=t(n.v);if(Object.is(e[1],r))return e;return[n.v,r]}}catch(e){}return[...e]},[i,c]);return Object.is(u[1],c)||h(),d(()=>(l.add(h),()=>{l.delete(h)}),[l]),u[1]}}}]);